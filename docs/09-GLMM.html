<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes quantitatives en sciences sociales : un grand bol d’R - 9&nbsp; Régressions à effets mixtes (GLMM)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-Multiniveau.html" rel="next">
<link href="./08-GLM.html" rel="prev">
<link href="./images/introduction/Couverture.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-GLMM.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes quantitatives en sciences sociales : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesQuantitatives" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Découverte de R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-priseenmainR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Prise en main de R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Analyses univariées et représentations graphiques</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-univarie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistiques descriptives univariées</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-magiedesgraphiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Magie des graphiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Analyses bivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-bivarieeQuantiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relation linéaire entre deux variables quantitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-bivarieeQualiQuali.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Relation entre deux variables qualitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-bivarieeQualiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Relation entre une variable qualitative et une variable quantitative</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Modèles de régression</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-regressionlineaire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Régression linéaire multiple</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-GLMM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Multiniveau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Régressions multiniveaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-GAM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modèles généralisés additifs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Analyses exploratoires multivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-AnalysesFactorielles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Méthodes factorielles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-MethodeClassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Annexes et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Annexes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Annexes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-091" id="toc-sec-091" class="nav-link active" data-scroll-target="#sec-091"><span class="header-section-number">9.1</span> Introduction</a>
  <ul class="collapse">
<li><a href="#sec-0911" id="toc-sec-0911" class="nav-link" data-scroll-target="#sec-0911"><span class="header-section-number">9.1.1</span> Indépendance des observations et effets de groupes</a></li>
  <li><a href="#sec-0912" id="toc-sec-0912" class="nav-link" data-scroll-target="#sec-0912"><span class="header-section-number">9.1.2</span> Terminologie&nbsp;: effets fixes et effets aléatoires</a></li>
  </ul>
</li>
  <li>
<a href="#sec-092" id="toc-sec-092" class="nav-link" data-scroll-target="#sec-092"><span class="header-section-number">9.2</span> Principes de base des GLMM</a>
  <ul class="collapse">
<li><a href="#sec-0921" id="toc-sec-0921" class="nav-link" data-scroll-target="#sec-0921"><span class="header-section-number">9.2.1</span> GLMM avec constantes aléatoires</a></li>
  <li><a href="#sec-0923" id="toc-sec-0923" class="nav-link" data-scroll-target="#sec-0923"><span class="header-section-number">9.2.2</span> GLMM avec pentes aléatoires</a></li>
  <li><a href="#sec-0924" id="toc-sec-0924" class="nav-link" data-scroll-target="#sec-0924"><span class="header-section-number">9.2.3</span> GLMM avec constantes et pentes aléatoires</a></li>
  </ul>
</li>
  <li>
<a href="#sec-093" id="toc-sec-093" class="nav-link" data-scroll-target="#sec-093"><span class="header-section-number">9.3</span> Conditions d’application des GLMM</a>
  <ul class="collapse">
<li><a href="#sec-0931" id="toc-sec-0931" class="nav-link" data-scroll-target="#sec-0931"><span class="header-section-number">9.3.1</span> Vérification de la distribution des effets aléatoires</a></li>
  <li><a href="#sec-0932" id="toc-sec-0932" class="nav-link" data-scroll-target="#sec-0932"><span class="header-section-number">9.3.2</span> Homogénéité des variances au sein des groupes</a></li>
  </ul>
</li>
  <li>
<a href="#sec-094" id="toc-sec-094" class="nav-link" data-scroll-target="#sec-094"><span class="header-section-number">9.4</span> Inférence dans les modèles GLMM</a>
  <ul class="collapse">
<li><a href="#sec-0941" id="toc-sec-0941" class="nav-link" data-scroll-target="#sec-0941"><span class="header-section-number">9.4.1</span> Inférence pour les effets fixes</a></li>
  <li><a href="#sec-0942" id="toc-sec-0942" class="nav-link" data-scroll-target="#sec-0942"><span class="header-section-number">9.4.2</span> Inférence pour les effets aléatoires, effet global</a></li>
  <li><a href="#sec-0943" id="toc-sec-0943" class="nav-link" data-scroll-target="#sec-0943"><span class="header-section-number">9.4.3</span> Inférence pour les effets aléatoires, des constantes et des pentes</a></li>
  </ul>
</li>
  <li><a href="#sec-095" id="toc-sec-095" class="nav-link" data-scroll-target="#sec-095"><span class="header-section-number">9.5</span> Conclusion sur les GLMM</a></li>
  <li>
<a href="#sec-096" id="toc-sec-096" class="nav-link" data-scroll-target="#sec-096"><span class="header-section-number">9.6</span> Mise en œuvre des GLMM dans R</a>
  <ul class="collapse">
<li><a href="#sec-0961" id="toc-sec-0961" class="nav-link" data-scroll-target="#sec-0961"><span class="header-section-number">9.6.1</span> Ajustement du modèle avec uniquement une constante aléatoire</a></li>
  <li><a href="#sec-0962" id="toc-sec-0962" class="nav-link" data-scroll-target="#sec-0962"><span class="header-section-number">9.6.2</span> Ajustement du modèle avec constantes et pentes aléatoires</a></li>
  </ul>
</li>
  <li><a href="#sec-097" id="toc-sec-097" class="nav-link" data-scroll-target="#sec-097"><span class="header-section-number">9.7</span> Quiz de révision du chapitre</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesQuantitatives/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap09" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Dans les deux chapitres précédents, nous avons consécutivement présenté la méthode de la régression linéaire multiple (LM) ainsi qu’une de ses extensions, soit les modèles linéaires généralisés (GLM). Dans ce chapitre, nous poursuivons sur cette voie avec une nouvelle extension&nbsp;: les modèles généralisés à effet mixtes (GLMM). À la fin de cette section, vous serez en mesure de&nbsp;:</p>
<ul>
<li>comprendre la distinction entre un modèle GLM et un modèle GLMM;</li>
<li>distinguer un effet fixe d’un effet aléatoire;</li>
<li>formuler des modèles GLMM avec des constantes et/ou des pentes aléatoires;</li>
<li>effectuer les diagnostics d’un GLMM.</li>
</ul>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour créer des graphiques&nbsp;:
<ul>
<li>
<code>ggplot2</code>, le seul, l’unique!</li>
<li>
<code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
<li>
<code>ellipse</code> pour représenter des ellipses sur certains graphiques.</li>
</ul>
</li>
<li>Pour ajuster des modèles GLMM&nbsp;:
<ul>
<li>
<code>lme4</code>, offrant une interface simple pour ajuster des GLMM.</li>
</ul>
</li>
<li>Pour analyser des modèles GLM&nbsp;:
<ul>
<li>
<code>car</code>, essentiellement pour la fonction <code>vif</code>.</li>
<li>
<code>DHARMa</code> pour le diagnostic des résidus simulés.</li>
<li>
<code>merTools</code> pour explorer les résultats d’un GLMM.</li>
<li>
<code>lmerTest</code> pour obtenir des tests de significativité pour les coefficients d’un GLMM.</li>
<li>
<code>MuMin</code> pour calculer les R<sup>2</sup> conditionnel et marginal.</li>
<li>
<code>performance</code> pour calculer l’ICC et d’autres mesures d’ajustement.</li>
</ul>
</li>
</ul>
</div>
</div>
<section id="sec-091" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="sec-091">
<span class="header-section-number">9.1</span> Introduction</h2>
<section id="sec-0911" class="level3" data-number="9.1.1"><h3 data-number="9.1.1" class="anchored" data-anchor-id="sec-0911">
<span class="header-section-number">9.1.1</span> Indépendance des observations et effets de groupes</h3>
<p>Nous avons vu dans les précédents chapitres que l’indépendance des observations est une condition d’application commune à l’ensemble des modèles de régression. Cette condition implique ainsi que chaque unité d’observation de notre jeu de données est indépendante des autres; en d’autres termes, qu’elle ne soit associée à aucune autre observation par un lien de dépendance. Prenons un exemple concret pour illustrer cette notion. Admettons que nous nous intéressons à la performance scolaire d’élèves du secondaire à Montréal. Pour cela, nous collectons la moyenne des résultats aux examens du ministère de tous les élèves des différentes commissions scolaires de l’île de Montréal. Chaque élève appartient à une classe spécifique, et chaque classe se situe dans une école spécifique. Les classes constituent des environnements particuliers, la performance des élèves y est influencée par un ensemble de facteurs comme la personne qui enseigne et les relations entre les élèves d’une même classe. Deux élèves provenant d’une même classe sont donc lié(e)s par une forme de structure propre à leur classe et ne peuvent pas être considéré(e)s comme indépendant(e)s. De même, l’école constitue un environnement particulier pouvant influencer la performance des élèves du fait de moyens financiers plus importants, de la mise en place de programmes spéciaux, de la qualité des infrastructures (bâtiment, gymnase, cour d’école) ou d’une localisation minimisant certaines nuisances à l’apprentissage comme le bruit. À nouveau, deux élèves provenant d’une même école partagent une forme de structure qui, cette fois-ci, est propre à leur école. Si nous collectons des données pour l’ensemble du Canada, nous pourrions étendre ce raisonnement aux villes dans lesquelles les écoles se situent et aux provinces.</p>
<p>Dans cet exemple, la dépendance entre les données est provoquée par un effet de groupe&nbsp;: il est possible de rassembler les observations dans des ensembles (classes et écoles) influençant vraisemblablement la variable étudiée (performance scolaire). Les effets des classes et des écoles ne sont cependant pas intrinsèques aux élèves. En effet, il est possible de changer un ou une élève de classe ou d’école, mais pas de changer son âge ou sa situation familiale. Il est ainsi possible de distinguer la population des élèves, la population des classes, et la population des écoles (<a href="#fig-glmmecoles">figure&nbsp;<span class="quarto-unresolved-ref">fig-glmmecoles</span></a>). Ces effets de groupes sont plus la règle que l’exception dans l’analyse de données en sciences sociales, ce qui met à mal l’hypothèse d’indépendance des observations. Notez que les effets de groupes ne sont pas les seules formes de structures remettant en cause l’indépendance des observations. Il existe également des structures temporelles (deux observations proches dans le temps ont plus de chances de se ressembler) et spatiales (deux observations proches dans l’espace ont plus de chances de se ressembler); cependant, les cas de la dépendance temporelle et spatiale ne sont pas couverts dans ce livre, car ils sont complexes et méritent un ouvrage dédié.</p>
<div id="fig-glmmecoles" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap09/Hierarchie_Ecoles.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.1: Structure hiérarchique entre élèves, classes et écoles</figcaption></figure>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>La notion de pseudo-réplication</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Les effets de dépendance causés par des structures de groupe, temporelles ou spatiales, sont regroupés sous le terme de pseudo-réplication. Il est intéressant de se pencher sur la signification de ce mot pour comprendre le problème intrinsèque causé par la dépendance entre les observations et son influence sur l’inférence.</p>
<p>Reprenons l’exemple des élèves et de la performance scolaire et admettons que nous souhaitons estimer la moyenne générale de l’ensemble des élèves sur l’île de Montréal, mais que nous ne disposons pas du jeu de données complet. Nous devons donc collecter un échantillon suffisamment grand pour estimer la moyenne pour l’ensemble de cette population. Raisonnons en termes de quantité d’informations. Si nous ne disposons d’aucune observation (nous n’avons pas encore interrogé d’élèves), cette quantité est de 0. Si nous interrogeons un premier ou une première élève, nous obtenons une donnée supplémentaire, et donc un point d’information supplémentaire (+1). Admettons maintenant que nous collectons 30 observations dans une école, 10 dans une seconde et 5 dans une troisième. A priori, nous pourrions dire que nous avons ajouté 45 points d’information à notre total de connaissance. Ce serait le cas si les observations étaient indépendantes les unes des autres. Dans un tel contexte, chaque observation ajoute la même quantité d’information. Cependant, puisque les personnes étudiant dans la même école ont plus de chance de se ressembler, interroger les élèves d’une même école apporte moins d’information. Notez que plus la ressemblance entre les élèves d’une même école est forte, plus la quantité d’information est réduite. Nous sommes donc loin de disposer d’une quantité d’information égale à 45. Chaque réplication de l’expérience (demander à un ou une élève sa moyenne annuelle) n’apporte pas autant d’information qu’attendu si les observations étaient indépendantes, c’est pourquoi on parle de <strong>pseudo-réplication</strong>.</p>
<p>La pseudo-réplication influence directement l’inférence statistique puisque le calcul des différents tests statistiques assume que chaque observation apporte autant d’information que les autres. En cas de présence de pseudo-réplication, la quantité d’information présente dans l’échantillon est plus petite qu’attendu. Il est possible de voir cela comme une forme de surestimation de la taille de l’échantillon. En cas de pseudo-réplication, nous disposons en réalité de moins de données que ce que l’on attendrait d’un échantillon de cette taille, si les observations étaient indépendantes. La conséquence est la sous-estimation de la variabilité réelle des données et l’augmentation des risques de trouver des effets significatifs dans l’échantillon alors qu’ils ne le sont pas pour l’ensemble de la population.</p>
</div>
</div>
</section><section id="sec-0912" class="level3" data-number="9.1.2"><h3 data-number="9.1.2" class="anchored" data-anchor-id="sec-0912">
<span class="header-section-number">9.1.2</span> Terminologie&nbsp;: effets fixes et effets aléatoires</h3>
<p>Puisque les effets des classes et des écoles ne sont pas propres aux élèves, il convient de les introduire différemment dans les modèles de régression. Nous appelons un effet fixe, un effet qui est propre aux observations que nous étudions et un effet aléatoire, un effet provoqué par une structure externe (effet de groupe, effet temporel et/ou effet spatial). Un modèle combinant à la fois des effets fixes et des effets aléatoires est appelé un <strong>modèle à effets mixtes</strong>, ou GLMM pour <em>Generalized Linear Mixed Model</em>. Tous les modèles que nous avons ajustés dans les sections précédentes ne comprenaient que des effets fixes alors qu’à plusieurs reprises, des effets aléatoires induits par l’existence de structure de groupe auraient pu (dû) être utilisés. Prenons pour exemple le modèle logistique binomial visant à prédire la probabilité d’utiliser le vélo comme mode de transport pour son trajet le plus fréquent. La variable multinomiale <em>Pays</em>, représentant le pays dans lequel les personnes interrogées résident, a été introduite comme un effet fixe. Cependant, l’effet du pays ne constitue pas une caractéristique propre aux individus; il s’agit plutôt d’un agrégat complexe mêlant culture, météorologie, politiques publiques et formes urbaines. À l’inverse, le sexe ou l’âge sont bien des caractéristiques intrinsèques des individus et peuvent être considérés comme des effets fixes.</p>
<p>Notez que l’utilisation du terme <em>effet aléatoire</em> peut porter à confusion, car il est utilisé différemment en fonction du champ d’études. Parmi les différentes définitions relevées par <span class="citation" data-cites="gelman2005analysis">Gelman (<a href="#ref-gelman2005analysis" role="doc-biblioref">2005</a>)</span> d’un effet aléatoire, citons les suivantes&nbsp;:</p>
<ul>
<li><p>Les effets fixes sont identiques pour tous les individus, alors que les effets aléatoires varient (définition 1).</p></li>
<li><p>Les effets sont fixes s’ils sont intéressants en eux-mêmes, et les effets sont aléatoires si nous nous intéressons à la population dont ils sont issus (définition 2).</p></li>
<li><p>Lorsqu’un échantillon couvre une grande part de la population, la variable correspondante est un effet fixe. Si l’échantillon couvre une faible part de la population, l’effet est aléatoire (définition 3).</p></li>
<li><p>Si l’effet est censé provenir d’une variable aléatoire, alors il s’agit d’un effet aléatoire (définition 4).</p></li>
<li><p>Les effets fixes sont estimés par la méthode des moindres carrés ou par le maximum de vraisemblance, alors que les effets aléatoires sont estimés avec régularisation (<em>shrinkage</em>) (définition 5).</p></li>
</ul>
<p>Il est ainsi possible de se retrouver dans des cas où un effet serait classé comme fixe selon une définition et aléatoire selon une autre. La deuxième définition suppose même qu’un effet peut être aléatoire ou fixe selon l’objectif de l’étude. La dernière définition a l’avantage d’être mathématique, mais ne permet pas de décider si un effet doit être traité comme aléatoire ou fixe. Nous ne proposons pas ici de clore le débat, mais plutôt de donner quelques pistes de réflexion pour décider si un effet doit être modélisé comme fixe ou aléatoire:</p>
<ul>
<li><p>Est-ce que l’effet en question est propre aux individus étudiés ou est externe aux individus? S’il est propre aux individus, il s’agit plus certainement d’un effet fixe. À titre d’exemple, il n’est pas possible de changer l’âge d’une personne, mais il est certainement possible de changer de ville de résidence.</p></li>
<li><p>Existe-t-il un nombre bien arrêté de catégories possibles pour l’effet en question? Si oui, il s’agit plus certainement d’un effet fixe. Il y a un nombre bien arrêté de catégories pour la variable sexe, mais pour la variable pays, de nombreuses autres valeurs peuvent être ajoutées. Il est également possible de se demander s’il semble cohérent d’effectuer un échantillonnage sur les catégories en question. Dans le cas des pays, nous pourrions mener une étude à l’échelle des pays et collecter des données sur un échantillon de l’ensemble des pays. Il existe donc une population de pays, ce que nous ne pouvons pas affirmer pour la variable sexe.</p></li>
<li><p>L’effet en question est direct ou indirect? Dans le second cas, l’effet en question est un agglomérat complexe découlant de plusieurs processus n’ayant pas été mesurés directement, ce qui correspond davantage à un effet aléatoire. Ainsi, l’effet du pays de résidence des individus sur leur probabilité d’utiliser le vélo est bien une agglomération complexe d’effets (culture, météorologie, orientation des politiques publiques, formes urbaines, etc.) n’ayant pas tous été mesurés. À l’inverse, l’âge d’un individu a bien un effet direct sur sa probabilité d’utiliser le vélo.</p></li>
<li><p>L’effet est-il le même pour tous les individus, ou doit-il varier selon le groupe dans lequel l’individu se situe? Si un effet doit varier en fonction d’un groupe, il s’apparente davantage à un effet aléatoire. Pour reprendre l’exemple de l’âge, nous pourrions décider que cette caractéristique des individus n’a peut-être pas le même effet en fonction du pays dans lequel vit l’individu et l’ajouter au modèle comme un effet aléatoire.</p></li>
</ul>
<p>Vous comprendrez donc qu’une partie non négligeable du choix entre effet fixe ou effet aléatoire réside dans le cadre théorique à l’origine du modèle. Maintenant que cette distinction conceptuelle a été détaillée, nous pouvons passer à la présentation statistique des modèles GLMM.</p>
</section></section><section id="sec-092" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="sec-092">
<span class="header-section-number">9.2</span> Principes de base des GLMM</h2>
<p>Un GLMM est donc un modèle GLM introduisant à la fois des effets fixes et des effets aléatoires. Si nous ne considérons que les effets de groupes, un GLMM peut avoir trois formes&nbsp;: constantes aléatoires, pentes aléatoires et constantes et pentes aléatoires. Nous présentons ici ces trois formes en reprenant l’exemple ci-dessus avec des élèves intégré(e)s dans des classes et pour lesquel(le)s le niveau de performance à l’examen ministériel de mathématique nous intéresse.</p>
<section id="sec-0921" class="level3" data-number="9.2.1"><h3 data-number="9.2.1" class="anchored" data-anchor-id="sec-0921">
<span class="header-section-number">9.2.1</span> GLMM avec constantes aléatoires</h3>
<p>Il s’agit de la forme la plus simple d’un GLMM. Plus spécifiquement, elle autorise le modèle à avoir une constante différente pour chaque catégorie d’une variable multinomiale. En d’autres termes, si nous reprenons l’exemple des élèves dans leurs classes, nous tentons d’ajouter dans le modèle l’idée que chaque classe a une moyenne différente en termes de performance à l’examen de mathématique. Il est assez facile de visualiser ce que cela signifie à l’aide d’un graphique. Admettons que nous modélisons la note obtenue par des élèves du secondaire à l’examen ministériel de mathématique à partir d’une autre variable continue représentant le temps de travail moyen par semaine en dehors des heures de classe et d’une variable catégorielle représentant dans quelle classe se trouve chaque élève. Notez qu’il ne s’agit pas ici de vraies données, mais de simples simulations utilisées à titre d’illustration. Si nous ne tenons pas compte des classes, nous pouvons ajuster une régression linéaire simple entre nos deux variables continues comme le propose la <a href="#fig-randominter1">figure&nbsp;<span class="quarto-unresolved-ref">fig-randominter1</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randominter1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randominter1-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.2: Influence du temps de travail sur la performance scolaire d’élèves</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons que notre modèle semble bien identifier la relation positive entre le temps de travail et le niveau de performance, mais la droite de régression est très éloignée de chaque point; nous avons ainsi énormément d’erreurs de prédiction, et donc des résidus importants. Jusqu’ici, nous avons vu que nous pouvons ajouter un prédicteur et intégrer l’effet des classes comme un effet fixe (<a href="#fig-randominter2">figure&nbsp;<span class="quarto-unresolved-ref">fig-randominter2</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randominter2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randominter2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.3: Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe (effet fixe)</figcaption></figure>
</div>
</div>
</div>
<p>Cet ajustement constitue une nette amélioration du modèle. Prenons un instant pour reformuler clairement notre modèle à effets fixes&nbsp;:</p>
<p><span id="eq-glmm1"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \sum^k_{j=1}{\beta_j x_{2j}}\\
&amp;g(x) = x
\end{aligned}
\tag{9.1}\]</span></span></p>
<p>avec <span class="math inline">\(x_1\)</span> le temps de travail et <span class="math inline">\(x_2\)</span> la classe ayant <em>k-1</em> modalités (puisqu’une modalité est la référence). Nous ajustons ainsi un coefficient pour chaque classe, ce qui a pour effet de tirer vers le haut ou vers le bas la prédiction du modèle en fonction de la classe. Cet effet est pour l’instant fixe, mais nous avons déterminé dans les sections précédentes qu’il serait conceptuellement plus approprié de le traiter comme un effet aléatoire.</p>
<p>Passons à présent à la reformulation de ce modèle en transformant l’effet fixe de la classe en effet aléatoire.</p>
<p><span id="eq-glmm2"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = x
\end{aligned}
\tag{9.2}\]</span></span></p>
<p>Remarquez que l’effet fixe de la classe <span class="math inline">\(\sum^k_{j=1}{\beta_j x_{2j}}\)</span> a été remplacé par <span class="math inline">\(\upsilon\)</span> qui est un terme aléatoire propre aux classes et qui suit une distribution normale centrée sur 0 (<span class="math inline">\(\upsilon \sim Normal(0, \sigma_{\upsilon})\)</span>). En d’autres termes, cela signifie que l’effet des classes sur la performance des élèves suit une distribution normale et que si nous moyennons l’effet de toutes les classes, cet effet serait de 0. Nous ne modélisons donc plus l’effet moyen de chaque classe comme dans le modèle à effets fixes, mais la variabilité de l’effet des classes, soit <span class="math inline">\(\sigma_{\upsilon}\)</span>. Notre modèle a donc deux variances, une au niveau des élèves (<span class="math inline">\(\sigma_e\)</span>) et une au niveau des classes (<span class="math inline">\(\sigma_{\upsilon}\)</span>). Cette particularité explique souvent pourquoi ce type de modèle est appelé un modèle hiérarchique ou un modèle de partition de la variance. Cette information est particulièrement intéressante, car elle permet de calculer la part de la variance présente au niveau des élèves et celle au niveau des classes.</p>
<p>Selon cette formulation, les constantes propres à chaque classe sont issues d’une distribution normale (nous reviendrons d’ailleurs sur ce choix plus tard), mais elles n’apparaissent pas directement dans le modèle. Ces paramètres ne sont plus estimés directement dans le modèle, mais a posteriori à partir des prédictions du modèle, et sont appelés <em>Best Linear Unbiased Predictor</em> (<em>BLUP</em>). Ces dernières précisions devraient d’ailleurs mieux vous aider à comprendre l’origine des définitions 1, 2 et 4 que nous avons mentionnées précédemment.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randominter3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randominter3-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.4: Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe (effet aléatoire)</figcaption></figure>
</div>
</div>
</div>
<p>En comparant les figures <a href="#fig-randominter2"><span class="quarto-unresolved-ref ref-noprefix">fig-randominter2</span></a> et <a href="#fig-randominter3"><span class="quarto-unresolved-ref ref-noprefix">fig-randominter3</span></a>, la différence ne saute pas aux yeux; vous pourriez alors légitimement vous demander pourquoi tous ces efforts et cette complexité théorique pour une différence d’ajustement minime? Trois arguments permettent de justifier l’utilisation de constantes aléatoires plutôt que d’effets fixes dans notre cas.</p>
<section id="sec-09221" class="level4" data-number="9.2.1.1"><h4 data-number="9.2.1.1" class="anchored" data-anchor-id="sec-09221">
<span class="header-section-number">9.2.1.1</span> Resserrement (<em>shrinkage</em>) et mutualisation (<em>partial pooling</em>)</h4>
<p>Le premier intérêt d’utiliser un effet aléatoire réside dans sa méthode d’estimation qui diffère largement d’un effet fixe. Il est assez facile de se représenter intuitivement la différence entre les deux. Dans le cas de nos élèves et de nos classes, lorsque l’effet des classes est estimé avec un effet fixe, l’effet de chaque classe est déterminé de façon totalement indépendante des autres classes. En d’autres termes, il n’est possible d’en apprendre plus sur une classe qu’en collectant des données dans cette classe (<em>separate pooling</em>). Si l’effet des classes est estimé comme un effet aléatoire, alors l’information entre les classes est mutualisée (<em>partial pooling</em>). L’idée étant que l’information que nous apprenons sur des élèves dans une classe est au moins en partie valide dans les autres classes. Cette méthode d’estimation est particulièrement intéressante si nous ne disposons que de peu d’observations dans certaines classes, puisque nous pouvons apprendre au moins une partie de l’effet de cette classe à partir des données des autres classes. Cela n’est pas possible dans le cas d’un effet fixe où l’on traite chaque classe en silo. <span class="citation" data-cites="mcelreath2020statistical">McElreath (<a href="#ref-mcelreath2020statistical" role="doc-biblioref">2020</a>)</span> écrit à ce sujet qu’un effet fixe «&nbsp;n’a pas de mémoire&nbsp;» et qu’il oublie tout ce qu’il a appris sur les classes lorsqu’il passe à une nouvelle classe. La conséquence de cette mutualisation de l’information est un resserrement (<em>shrinkage</em>) des effets des classes autour de leur moyenne. Cela signifie que les tailles des effets de chaque classe sont plus petites dans le cas d’un effet aléatoire que d’un effet fixe. Utiliser des effets aléatoires conduit donc à une estimation plus conservatrice de l’effet des classes. Nous pouvons le visualiser en comparant les effets de classes dans le modèle à effets mixtes et le modèle à effets fixes. La <a href="#fig-randominter5">figure&nbsp;<span class="quarto-unresolved-ref">fig-randominter5</span></a> montre clairement que les effets aléatoires tendent à se rapprocher (resserrement) de leur moyenne (ligne noire), et donc à identifier des effets moins extrêmes pour chaque classe. Cette explication est directement en lien avec la définition 5 d’un effet aléatoire vu précédemment.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randominter5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randominter5-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.5: Comparaison des effets des classes pour le modèle à effets fixes versus le modèle à effets aléatoires</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-09222" class="level4" data-number="9.2.1.2"><h4 data-number="9.2.1.2" class="anchored" data-anchor-id="sec-09222">
<span class="header-section-number">9.2.1.2</span> Prédiction pour de nouveaux groupes</h4>
<p>Une autre retombée directe de la mutualisation de l’information est la capacité du modèle à envisager les effets plausibles pour de nouvelles classes. En effet, puisque nous avons approximé l’effet des classes sous forme d’une distribution normale dont nous connaissons la moyenne (0) et l’écart-type (<span class="math inline">\(\sigma_{\upsilon}\)</span>), nous pouvons <strong>simuler</strong> des données pour de nouvelles classes, ce que ne permet pas un effet fixe. Ce constat est d’ailleurs directement lié à la définition 3 des effets aléatoires vue précédemment. Dans notre cas, <span class="math inline">\(\sigma_{\upsilon}\)</span> = 3,542, ce qui nous permet d’affirmer que dans 95&nbsp;% des classes, l’effet de la classe sur la performance scolaire doit se trouver entre -1,96 <span class="math inline">\(\times\)</span> 3,542 et +1,96 <span class="math inline">\(\times\)</span> 3,542, soit l’intervalle [-6,942, 6,942].</p>
</section><section id="sec-09223" class="level4" data-number="9.2.1.3"><h4 data-number="9.2.1.3" class="anchored" data-anchor-id="sec-09223">
<span class="header-section-number">9.2.1.3</span> Partition de la variance</h4>
<p>Un autre avantage net de l’effet aléatoire est l’estimation du paramètre <span class="math inline">\(\sigma_{\upsilon}\)</span>, soit la variance au niveau des écoles. Ce dernier permet de calculer un indicateur très intéressant, soit le <strong>coefficient de corrélation intraclasse (ICC)</strong>&nbsp;:</p>
<p><span id="eq-glmm3"><span class="math display">\[
ICC = \frac{\sigma_{\upsilon}}{\sigma_{\upsilon} + \sigma_{e}}
\tag{9.3}\]</span></span></p>
<p>Il s’agit donc du pourcentage de la variance présente au niveau des classes, qui peut être interprétée comme le niveau de corrélation (de ressemblance) entre les élèves d’une même classe.</p>
<p>Dans notre cas, l’écart-type est de 3,542 au niveau des classes et de 7,734 au niveau des élèves. Nous pouvons donc calculer l’ICC au niveau des classes avec la formule précédente&nbsp;: 3,542 / (3,542 + 7,734) = 0,314. Cela signifie que le niveau de corrélation entre deux élèves d’une même classe est de 0,314 ou encore que 31,4 % de la variance de <em>Y</em> se situe au niveau des classes, ce qui est conséquent. Une telle information ne peut être extraite d’un modèle avec uniquement des effets fixes. Notez ici que l’ICC peut être calculé pour chaque niveau d’un modèle à effet mixte. Dans notre exemple, nous n’avons qu’un seul niveau au-dessus des élèves, soit les classes, mais nous pourrions étendre cette logique à des écoles, par exemple. Notez également que cette formule de l’ICC n’est valide que pour un modèle pour lequel la distribution de la variable <em>Y</em> est normale. Des développements apparaissent pour proposer d’autres formulations adaptées à d’autres distributions, mais il est également possible d’estimer l’ICC à partir des simulations issues du modèle <span class="citation" data-cites="NakagawaICC aly2014reliability stryhn2006interpretation wu2012comparison">(<a href="#ref-NakagawaICC" role="doc-biblioref">Nakagawa, Johnson et Schielzeth 2017</a>; <a href="#ref-aly2014reliability" role="doc-biblioref">Aly et al. 2014</a>; <a href="#ref-stryhn2006interpretation" role="doc-biblioref">Stryhn et al. 2006</a>; <a href="#ref-wu2012comparison" role="doc-biblioref">Wu, Crespi et Wong 2012</a>)</span>. L’idée générale reste d’expliquer la partition de la variance dans le modèle.</p>
<p>En plus de l’ICC, il est également possible de calculer les <strong>R<sup>2</sup> marginal et conditionnel</strong> du modèle. Le premier représente la variance expliquée par le modèle si seulement les effets fixes sont pris en compte, et le second si les effets fixes et aléatoires sont pris en compte. Distinguer les deux sources d’information permet de mieux cerner l’importance du rôle des écoles dans la performance des élèves. Dans notre cas, nous obtenons un R<sup>2</sup> marginal de 0,115 et un R<sup>2</sup> conditionnel de 0,269, ce qui nous confirme à nouveau que le rôle joué par la classe dans le niveau de performance est loin d’être négligeable.</p>
</section></section><section id="sec-0923" class="level3" data-number="9.2.2"><h3 data-number="9.2.2" class="anchored" data-anchor-id="sec-0923">
<span class="header-section-number">9.2.2</span> GLMM avec pentes aléatoires</h3>
<p>Dans cette seconde version du GLMM, nous n’envisageons plus de faire varier une constante en fonction des classes, mais un coefficient en fonction des classes. Admettons que nous voulons tester ici si l’effet du temps de travail (<span class="math inline">\(x_1\)</span>) sur la performance scolaire (<em>Y</em>) n’est pas constant partout. En d’autres termes, nous supposons que, dans certaines classes, le temps de travail hebdomadaire en dehors de l’école est plus ou moins efficace que d’autres classes. L’idée sous-jacente est que nous n’observons pas de différence en termes de moyenne entre deux classes, mais en termes d’effet pour notre variable <span class="math inline">\(x_1\)</span>. À nouveau, nous pouvons nous contenter d’un effet fixe pour intégrer cette idée dans notre modèle. Pour cela, nous avons simplement à ajouter une interaction entre notre variable quantitative <em>temps de travail</em> et notre variable qualitative <em>classe</em>. Nous obtenons le résultat décrit par la <a href="#fig-randomslope">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomslope</span></a>. Notez ici que la constante est bien la même pour chaque classe (les lignes s’intersectent à 0 sur l’axe des x), et que seule la pente change.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randomslope" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randomslope-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.6: Influence du temps de travail sur la performance scolaire d’élèves en interaction avec la classe (effet fixe)</figcaption></figure>
</div>
</div>
</div>
<p>La formulation de ce modèle à effets fixes seulement est la suivante&nbsp;:</p>
<p><span id="eq-glmm4"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \sum^k_{j=1}{\beta_j x_{2j} x_1}\\
&amp;g(x) = x
\end{aligned}
\tag{9.4}\]</span></span></p>
<p>Nous constatons donc que nous avons un effet principal <span class="math inline">\(\beta_1\)</span> décrivant le lien entre le temps de travail et la note obtenue à l’examen pour l’ensemble des élèves, ainsi qu’un bonus ou un malus sur cet effet <span class="math inline">\(\beta_j\)</span> s’appliquant en fonction de la classe. Nous pouvons reformuler ce modèle pour inclure cet effet spécifique par classe comme un effet aléatoire&nbsp;:</p>
<p><span id="eq-glmm5"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon x_1 \\
&amp;\upsilon \sim Normal(0,\sigma_{\upsilon})\\
&amp;g(x) = x
\end{aligned}
\tag{9.5}\]</span></span></p>
<p>Nous formulons ici un modèle dans lequel la classe modifie l’effet de la variable <em>temps d’étude</em> sur la variable <em>note à l’examen</em>. L’effet moyen de <span class="math inline">\(x_1\)</span> (propre aux individus) est capté par le coefficient <span class="math inline">\(\beta_1\)</span>, les bonus ou malus ajoutés à cet effet par la classe sont issus d’une distribution normale centrée sur 0 avec un écart-type, soit <span class="math inline">\(\sigma_{\upsilon}\)</span>. À nouveau, l’idée est que si nous moyennons l’effet de toutes les classes, nous obtenons 0. Aussi, le fait de modéliser cet effet comme un effet aléatoire nous permet de partitionner la variance, de mutualiser l’information entre les classes et de resserrer l’estimation des effets des classes.</p>
<p>Les résultats pour ce second modèle sont présentés à la <a href="#fig-randomslope2">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomslope2</span></a>, et une comparaison entre les estimations des effets fixes et des effets aléatoires est présentée à la <a href="#fig-randomslope3">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomslope3</span></a>. Nous pouvons ainsi constater à nouveau l’effet de resserrement provoqué par l’effet aléatoire.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randomslope2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randomslope2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.7: Influence du temps de travail sur la réussite scolaire d’élèves en interaction avec la classe (effet aléatoire)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-randomslope3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randomslope3-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.8: Influence du temps de travail sur la réussite scolaire d’élèves en interaction avec la classe (effet aléatoire)</figcaption></figure>
</div>
</div>
</div>
<p>Lorsque nous intégrons des pentes aléatoires dans un modèle, nous faisons face au problème suivant&nbsp;: la variance associée aux pentes aléatoires n’est pas fixe, mais proportionnelle à la variable <em>X</em> autorisée à varier. Si nous comparons la <a href="#fig-randominter3">figure&nbsp;<span class="quarto-unresolved-ref">fig-randominter3</span></a> (constantes aléatoires) et la <a href="#fig-randomslope2">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomslope2</span></a> (pentes aléatoires), nous constatons bien que la dispersion des prédictions du modèle (représentées par les lignes) augmente dans le cas de pentes aléatoires et reste identique dans le cas des constantes aléatoires. La conséquence pratique est qu’il existe un nombre infini de valeurs possibles pour l’ICC. Dans ce contexte, il est préférable de laisser de côté cet indicateur et de ne reporter que les R<sup>2</sup> marginal et conditionnel. Dans notre cas, nous obtenons les valeurs 0,109 et 0,258, ce qui confirme une fois encore que le rôle joué par la classe est loin d’être négligeable.</p>
</section><section id="sec-0924" class="level3" data-number="9.2.3"><h3 data-number="9.2.3" class="anchored" data-anchor-id="sec-0924">
<span class="header-section-number">9.2.3</span> GLMM avec constantes et pentes aléatoires</h3>
<p>Vous l’aurez certainement deviné en lisant le titre de cette section&nbsp;: il est tout à fait possible de combiner à la fois des constantes et des pentes aléatoires dans un modèle. Cela augmente bien sûr la complexité du modèle et introduit quelques subtilités comme la notion de distribution normale multivariée, mais chaque chose en son temps.</p>
<p>Si nous reprenons notre exemple avec nos élèves et nos classes, combiner à la fois des constantes et des pentes aléatoires revient à formuler l’hypothèse que chaque classe a un effet sur la moyenne de la performance de ses élèves, mais également un effet sur l’efficacité du temps de travail. Il est possible de créer un modèle avec uniquement des effets fixes tenant compte de ces deux aspects en ajoutant dans le modèle la variable multinomiale <em>classe</em> ainsi que son interaction avec la variable <em>temps de travail</em>. La formulation de ce modèle à effets fixes est la suivante&nbsp;:</p>
<p><span id="eq-glmm6"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \sum^k_{j=1}{\beta_{2j}  x_{2j} + \beta_{3j} x_{2j}  x_1}\\
&amp;g(x) = x
\end{aligned}
\tag{9.6}\]</span></span></p>
<p>Nous pouvons représenter les résultats de ce modèle avec la <a href="#fig-fullrandom1">figure&nbsp;<span class="quarto-unresolved-ref">fig-fullrandom1</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fullrandom1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-fullrandom1-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.9: Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe et de l’effet de la classe sur l’efficacité du temps de travail (effet fixe)</figcaption></figure>
</div>
</div>
</div>
<p>Nous reformulons à présent ce modèle pour intégrer l’effet moyen de chaque classe (constante) et l’effet des classes sur l’efficacité du temps de travail (pente) comme deux effets aléatoires&nbsp;:</p>
<p><span id="eq-glmm7"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \upsilon_1 + (\beta_1 + \upsilon_2) x_1\\
&amp;\left(\begin{array}{l}
\upsilon_{1} \\
\upsilon_{2}
\end{array}\right) \sim \mathcal{N}\left(\left(\begin{array}{l}
0 \\
0
\end{array}\right),\left(\begin{array}{cc}
\sigma_{\upsilon_1} &amp; \sigma_{\upsilon_1\upsilon_2} \\
\sigma_{\upsilon_1\upsilon_2} &amp; \sigma_{\upsilon_1}
\end{array}\right)\right) \\
&amp;g(x) = x
\end{aligned}
\tag{9.7}\]</span></span></p>
<p>Pas de panique! Cette écriture peut être interprétée de la façon suivante&nbsp;:</p>
<p>Le modèle a deux effets aléatoires, l’un faisant varier la constante en fonction de la classe (<span class="math inline">\(\upsilon_1\)</span>) et l’autre l’effet de la classe sur l’efficacité du temps de travail (<span class="math inline">\(\upsilon_2\)</span>). Ces deux effets sont issus d’une distribution normale bivariée (une dimension par effet aléatoire). Cette distribution normale bivariée a donc deux moyennes et ces deux moyennes sont à 0 (les effets s’annulent si nous considérons toutes les classes ensemble). Elle dispose également d’une variance par effet aléatoire (<span class="math inline">\(\sigma_{\upsilon_1}\)</span> et <span class="math inline">\(\sigma_{\upsilon_2}\)</span>) et d’une covariance entre les deux effets aléatoires (<span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span>). Cette covariance permet de tenir compte du fait que, potentiellement, les classes avec une constante plus élevée pourraient systématiquement avoir une efficacité du temps de travail plus faible ou plus élevée. Cette formulation implique donc d’ajuster trois paramètres de variance&nbsp;: <span class="math inline">\(\sigma_{\upsilon_1}\)</span>, <span class="math inline">\(\sigma_{\upsilon_2}\)</span> et <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span>. Il peut arriver que nous n’ayons pas assez de données pour estimer ces trois paramètres, ou que nous décidions, pour des raisons théoriques, qu’aucune corrélation ne soit attendue entre <span class="math inline">\(\sigma_{\upsilon_1}\)</span> et <span class="math inline">\(\sigma_{\upsilon_2}\)</span>. Dans ce cas, il est possible de fixer <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span> à 0, ce qui revient à indiquer au modèle que <span class="math inline">\(\upsilon_1\)</span> et <span class="math inline">\(\upsilon_2\)</span> proviennent de deux distributions normales distinctes, nous pouvons donc écrire&nbsp;:</p>
<p><span id="eq-glmm8"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \upsilon_1 + (\beta_1 + \upsilon_2) x_1\\
&amp;\left(\begin{array}{l}
\upsilon_{1} \\
\upsilon_{2}
\end{array}\right) \sim \mathcal{N}\left(\left(\begin{array}{l}
0 \\
0
\end{array}\right),\left(\begin{array}{cc}
\sigma_{\upsilon_1} &amp; 0 \\
0 &amp; \sigma_{\upsilon_1}
\end{array}\right)\right) \\
&amp;g(x) = x
\end{aligned}
\tag{9.8}\]</span></span></p>
<p>Ce qui est identique à&nbsp;:</p>
<p><span id="eq-glmm9"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \upsilon_1 + (\beta_1 + \upsilon_2) x_1\\
&amp;\upsilon_{1} \sim Normal(0,\sigma_{\upsilon_1}) \\
&amp;\upsilon_{2} \sim Normal(0,\sigma_{\upsilon_2}) \\
&amp;g(x) = x
\end{aligned}
\tag{9.9}\]</span></span></p>
<p>Nous avons déjà abordé la notion de covariance dans la <a href="#sec-042">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-042</span></a>. Pour rappel, la covariance dépend de l’unité de base des deux variables sur laquelle elle est calculée. Ici, il s’agit d’un coefficient et d’une constante. Il est donc préférable de la standardiser pour obtenir la corrélation entre les deux effets&nbsp;:</p>
<p><span id="eq-glmm10"><span class="math display">\[
corr(\upsilon_1;\upsilon_2) = \frac{\sigma_{\upsilon_1\upsilon_2}}{\sqrt{\sigma_{\upsilon_1}}\sqrt{\sigma_{\upsilon_2}}}
\tag{9.10}\]</span></span></p>
<p>Si cette corrélation est positive, cela signifie que les classes ayant tendance à avoir un effet positif sur la performance scolaire ont également tendance à influencer positivement l’efficacité du temps de travail. À l’inverse, une corrélation négative signifie que l’efficacité du temps de travail a tendance à être plus faible dans les classes où la performance scolaire moyenne est élevée. Si la corrélation n’est pas significative, c’est que les deux effets sont indépendants l’un de l’autre.</p>
<p>Pour cet exemple, nous conservons la première formulation afin de montrer comment interpréter <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span>, mais nous ne disposons probablement pas de suffisamment de classes différentes pour estimer correctement ces trois paramètres. Les résultats de ce modèle sont représentés à la <a href="#fig-fullrandom2">figure&nbsp;<span class="quarto-unresolved-ref">fig-fullrandom2</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fullrandom2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-fullrandom2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.10: Influence du temps de travail sur la performance scolaire d’élèves en tenant compte de l’effet de leur classe et de l’effet de la classe sur l’efficacité du temps de travail (effet aléatoire)</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons ainsi constater que pour ce troisième modèle, l’effet de resserrement est bien plus prononcé que pour les modèles précédents (<a href="#fig-fullrandom3">figure&nbsp;<span class="quarto-unresolved-ref">fig-fullrandom3</span></a>). Si nous nous fions au modèle à effets fixes (<a href="#fig-fullrandom1">figure&nbsp;<span class="quarto-unresolved-ref">fig-fullrandom1</span></a>)), alors l’effet de l’école sur l’efficacité du temps de travail est très important. En revanche, le modèle à effet aléatoire identifie que la différence de moyenne entre les écoles est importante, mais la différence en termes d’efficacité du temps de travail est beaucoup plus anecdotique.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fullrandom3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-fullrandom3-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.11: Comparaison des effets fixes et aléatoires pour le modèle intégrant l’effet des classes et l’interaction entre les classes et le temps de travail</figcaption></figure>
</div>
</div>
</div>
<p>Notre modèle estime les valeurs de <span class="math inline">\(\sigma_{\upsilon_1}\)</span> à 8,563, de <span class="math inline">\(\sigma_{\upsilon_2}\)</span> à 0,042 et de <span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}\)</span> à 0,073. La corrélation entre les deux effets est donc de 0,122, ce qui est relativement faible (pour l’anecdote, notez que la valeur originale de corrélation entre ces deux effets était de 0,1 lorsque nous avons simulé ces données, notre modèle a donc bien été capable de retrouver le paramètre original). À nouveau, puisque nous avons des pentes aléatoires dans ce modèle, nous ne pouvons pas calculer l’ICC; nous pouvons cependant rapporter les R<sup>2</sup> marginal et conditionnel. Leurs valeurs respectives sont 0,115 et 0,269, ce qui nous confirme une nouvelle fois que l’ajout d’effets aléatoires contribue à expliquer une partie importante de la variance de la performance scolaire.</p>
<p>Pour terminer cette section, comparons brièvement les trois modèles (constantes aléatoires, pentes aléatoires, constantes et pentes aléatoires) pour déterminer lequel est le mieux ajusté à nos données. Nous ajoutons également un quatrième modèle dans lequel les deux effets aléatoires sont présents, mais non corrélés (<span class="math inline">\(\sigma_{\upsilon_1\upsilon_2}=0\)</span>). Le <a href="#tbl-fullrandom4">tableau&nbsp;<span class="quarto-unresolved-ref">tbl-fullrandom4</span></a> nous permet de constater que l’ajout des constantes aléatoires joue un rôle essentiel dans le premier modèle&nbsp;: le R<sup>2</sup> conditionnel est plus que deux fois supérieur au R<sup>2</sup> marginal. Cependant, l’ajout des pentes aléatoires dans les trois autres modèles apporte finalement très peu d’information, nous laissant penser que l’effet de la classe sur le temps de travail est faible, voire inexistant.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-fullrandom4" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;9.1: Comparaison des trois modèles à effets aléatoires</caption>
<colgroup>
<col style="width: 56%">
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 19%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">modèle</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">R2 marginal</th>
<th style="text-align: right;">R2 conditionnel</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constantes aléatoires</td>
<td style="text-align: right;">2 100,9</td>
<td style="text-align: right;">0,12</td>
<td style="text-align: right;">0,27</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pentes aléatoires</td>
<td style="text-align: right;">2 101,6</td>
<td style="text-align: right;">0,11</td>
<td style="text-align: right;">0,26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pentes et constantes aléatoires corrélées</td>
<td style="text-align: right;">2 104,7</td>
<td style="text-align: right;">0,11</td>
<td style="text-align: right;">0,27</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pentes et constantes aléatoires non corrélées</td>
<td style="text-align: right;">2 102,7</td>
<td style="text-align: right;">0,11</td>
<td style="text-align: right;">0,27</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Modèles à effets mixtes avec des structures croisées</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Jusqu’à présent, nous avons abordé des modèles GLMM comprenant des structures imbriquées (<em>nested</em> en anglais), c’est-à-dire qu’une observation d’un niveau 1 est incluse dans un et un seul groupe du niveau 2. Comme structure imbriquée à trois niveaux, nous avons vu comme exemple des élèves intégrés dans des classes elles-mêmes intégrées dans des écoles (<a href="#fig-glmmecoles">figure&nbsp;<span class="quarto-unresolved-ref">fig-glmmecoles</span></a>)&nbsp;: un ou une élève appartient à une et une seule classe qui est elle-même localisée dans une et une seule école (élève / classe / école).</p>
<p>Notez qu’il est aussi possible d’avoir des structures des données croisées (<em>crossed</em>).</p>
<p>Admettons à présent que nous ne nous intéressons pas à la classe dans laquelle se situe l’élève, mais plutôt à la personne qui enseigne. Admettons également que ces personnes peuvent donner des cours dans plusieurs écoles. Nous nous retrouvons dans un cas de figure où une personne qui enseigne peut se situer dans plusieurs écoles, ce qui diffère du cas précédent où chaque classe appartient à une seule école. Dans ce second cas, on parle d’une <strong>structure croisée</strong> plutôt qu’imbriquée.</p>
<p>Si les personnes enseignent dans toutes les écoles, il est possible de dire que le design d’étude est croisé complet ou croisé partiel si elles n’enseignent que dans certaines écoles. La <a href="#fig-crossednested">figure&nbsp;<span class="quarto-unresolved-ref">fig-crossednested</span></a> résume ces trois situations.</p>
<div id="fig-crossednested" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap09/glmm_croise-nested.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.12: Différentes structures de données hiérarchiques (imbriquée versus croisée)</figcaption></figure>
</div>
<p>Il est important de bien saisir la structure de son jeu de données, car l’estimation d’un modèle avec effets imbriqués ou croisés peut donner des résultats parfois significativement différents. De plus, un modèle imbriqué est généralement moins difficile à ajuster qu’un modèle croisé. En effet, dans un modèle imbriqué, deux personnes étudiant dans deux écoles différentes sont jugées indépendantes. Dans un modèle croisé, deux élèves provenant de deux écoles différentes peuvent tout de même partager une dépendance du fait qu’ils ou elles ont pu avoir le même professeur ou la même professeure. La structure de dépendance (et donc de la matrice de covariance des effets aléatoires) est ainsi plus complexe pour un modèle croisé.</p>
</div>
</div>
</section></section><section id="sec-093" class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="sec-093">
<span class="header-section-number">9.3</span> Conditions d’application des GLMM</h2>
<p>Puisque les GLMM sont une extension des GLM, ils partagent l’essentiel des conditions d’application de ces derniers. Pour simplifier, si vous ajustez un modèle GLMM avec une distribution Gamma, vous devez réaliser les mêmes tests que ceux pour un simple GLM avec une distribution Gamma.</p>
<p>Une question importante se pose souvent lorsque nous ajustons des modèles GLMM&nbsp;: <strong>combien de groupes faut-il au minimum aux différents niveaux?</strong> En effet, pour estimer les différentes variances, nous devons disposer de suffisamment de groupes différents. Dans le cas d’un modèle avec uniquement une constante aléatoire, il est fréquent de lire que nous devons disposer au minimum de cinq groupes différents <span class="citation" data-cites="gelman2006data">(<a href="#ref-gelman2006data" role="doc-biblioref">Gelman et Hill 2006</a>)</span>, en dessous de ce minimum, traiter l’effet comme aléatoire plutôt que fixe apporte très peu d’information. De plus, l’estimation des variances pour chaque niveau est très imprécise, donnant potentiellement des valeurs inexactes pour l’ICC et polluant l’interprétation. Avec cinq groupes ou moins, il est certainement plus judicieux d’ajuster seulement un effet fixe. Dans un modèle avec plusieurs effets aléatoires et plusieurs variances / covariances à estimer, ce nombre doit être augmenté proportionnellement, à moins que les effets aléatoires ne soient estimés indépendamment les uns des autres. Notez ici que, si l’enjeu du modèle était d’estimer avec une grande précision les paramètres de variances, il faudrait compter au minimum une centaine de groupes. Il n’est pas nécessaire d’avoir le même nombre d’observations par groupe, car les modèles GLMM partagent l’information entre les groupes. Cependant, dans les groupes avec peu d’observations (inférieur à 15), l’estimation de leur effet propre (BLUP) est très incertaine.</p>
<p>Puisque les GLMM font intervenir la distribution normale aux niveaux supérieurs du modèle, il est nécessaire de vérifier si les hypothèses qu’elle implique sont respectées. Il s’agit essentiellement de deux hypothèses&nbsp;: les effets aléatoires suivent bien une distribution normale (univariée ou multivariée), et la variance au sein des groupes est bien homogène.</p>
<section id="sec-0931" class="level3" data-number="9.3.1"><h3 data-number="9.3.1" class="anchored" data-anchor-id="sec-0931">
<span class="header-section-number">9.3.1</span> Vérification de la distribution des effets aléatoires</h3>
<p>Reprenons la formulation d’un modèle simple avec seulement deux niveaux et seulement une constante aléatoire:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma_e)\\
&amp;g(\mu) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = x
\end{aligned}
\]</span></p>
<p>Ce modèle formule l’hypothèse que les constantes aléatoires <span class="math inline">\(\upsilon\)</span> proviennent d’une distribution normale avec une moyenne de 0 et un écart-type <span class="math inline">\(\sigma_{\upsilon}\)</span>. La première étape du diagnostic est donc de vérifier si les constantes aléatoires suivent bien une distribution normale, ce que nous pouvons faire habituellement avec un diagramme quantile-quantile. Si nous reprenons notre exemple avec nos données de performance scolaire des sections précédentes, nous obtenons la <a href="#fig-diagglmm1">figure&nbsp;<span class="quarto-unresolved-ref">fig-diagglmm1</span></a>. Puisque les points tombent bien approximativement sur la ligne rouge, nous pouvons conclure que cette condition d’application est bien respectée. Notez qu’il est également possible d’utiliser ici un des tests vus dans le <a href="#sec-chap02">chapitre&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-chap02</span></a> pour tester formellement la distribution des constantes aléatoires, mais nous disposons rarement de suffisamment de valeurs différentes pour qu’un tel test soit pertinent.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagglmm1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-diagglmm1-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.13: Distribution normale univariée des constantes aléatoires</figcaption></figure>
</div>
</div>
</div>
<p>Cette vérification est bien sûr à appliquer à chacun des niveaux (en dehors du niveau de base) du modèle étudié.</p>
<p>Si nous nous intéressons maintenant au modèle avec constantes et pentes aléatoires, nous avons deux cas de figure:</p>
<ul>
<li><p>Notre modèle inclut une covariance entre les constantes et les pentes; elles proviennent donc d’une distribution normale bivariée.</p></li>
<li><p>Notre modèle considère les pentes et les constantes comme indépendantes; elles proviennent donc de deux distributions normales distinctes.</p></li>
</ul>
<p>Le second cas est de loin le plus simple puisqu’il nous suffit de réaliser un graphique de type quantile-quantile pour les deux effets aléatoires séparément. Dans le premier cas, il nous faut adapter notre stratégie pour vérifier si les deux effets aléatoires suivent conjointement une distribution normale multivariée. Pour cela, nous devons, dans un premier temps, observer séparément la distribution des pentes et des constantes, puisque chaque variable provenant d’une distribution normale multivariée suit elle-même une distribution normale univariée <span class="citation" data-cites="burdenski2000evaluating">(<a href="#ref-burdenski2000evaluating" role="doc-biblioref">Burdenski 2000</a>)</span>. Nous pouvons, dans un second temps, construire un graphique nous permettant de juger si nos pentes et nos constantes suivent bien la distribution normale bivariée attendue par le modèle. Pour l’illustrer, nous reprenons le modèle sur la performance scolaire intégrant des pentes et des constantes aléatoires avec une covariance estimée entre les deux.</p>
<p>La <a href="#fig-diagglmm2">figure&nbsp;<span class="quarto-unresolved-ref">fig-diagglmm2</span></a> représente donc les deux graphiques quantile-quantile univariés. Les deux semblent indiquer que nos effets aléatoires suivent bien chacun une distribution normale. La <a href="#fig-diagglmm3">figure&nbsp;<span class="quarto-unresolved-ref">fig-diagglmm3</span></a> montre la distribution normale bivariée attendue par le modèle avec des ellipses représentant différents percentiles de cette distribution. Les valeurs des effets aléatoires sont représentées par des points noirs. Seulement 5&nbsp;% des points noirs devraient se trouver dans la première ellipse et 95&nbsp;% des points devraient se trouver dans la quatrième ellipse. En revanche, seulement 20&nbsp;% des points devraient se trouver dans le dernier anneau et seulement 5&nbsp;% des points en dehors de cet anneau. Il faut donc évaluer si les points sont plus ou moins centrés que ce que nous attendons. Pour simplifier la lecture, il est possible de rajouter des points grisés en arrière-plan représentant des réalisations possibles de cette distribution normale bivariée. Les vrais points noirs devraient avoir une dispersion similaire à celle des points grisés. Dans notre cas, ils semblent suivre un patron cohérent avec notre distribution normale bivariée. Dans le cas contraire, cela signifierait que le modèle doit être révisé.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagglmm2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-diagglmm2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.14: Multiples distributions normales univariées des constantes et pentes aléatoires</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagglmm3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-diagglmm3-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.15: Distribution normale bivariée des constantes et des pentes aléatoires</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0932" class="level3" data-number="9.3.2"><h3 data-number="9.3.2" class="anchored" data-anchor-id="sec-0932">
<span class="header-section-number">9.3.2</span> Homogénéité des variances au sein des groupes</h3>
<p>Dans le <a href="#sec-chap08">chapitre&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-chap08</span></a> sur les GLM, nous avons vu que chaque distribution a sa propre définition de la variance. Pour rappel, un modèle gaussien assume une variance constante, un modèle de Poisson assume une variance égale à son espérance, alors qu’un modèle Gamma assume une variance proportionnelle au carré de son espérance divisée par un paramètre de forme, etc. Nous devions donc, pour chaque GLM, vérifier graphiquement si la variance présente dans les données originales était proche de la variance attendue par le modèle. Dans un modèle GLMM, le même exercice doit être fait pour chaque groupe aux différents niveaux du modèle.</p>
<p>Dans notre exemple sur la performance scolaire, notre variable <em>Y</em> a été modélisée avec une distribution normale. Le modèle assume donc une uniformité de sa variance (homoscédasticité). La <a href="#fig-glmmvariance">figure&nbsp;<span class="quarto-unresolved-ref">fig-glmmvariance</span></a> nous montre ainsi que, quelle que soit la classe, la dispersion des points (notes des élèves) semble bien respecter la variance attendue par le modèle (représentée par les lignes noires).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-glmmvariance" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-glmmvariance-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.16: Homogénéité de la variance pour les différents groupes d’un modèle GLMM gaussien</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-094" class="level2" data-number="9.4"><h2 data-number="9.4" class="anchored" data-anchor-id="sec-094">
<span class="header-section-number">9.4</span> Inférence dans les modèles GLMM</h2>
<p>Une des questions importantes à se poser lorsque nous construisons un modèle est toujours&nbsp;: est-ce que les différents effets présents dans le modèle ont un effet significativement différent de zéro sur la variable dépendante? Cette étape d’inférence est plus compliquée pour les modèles GLMM que dans les modèles GLM à cause de la présence d’effets aléatoires. Ces derniers brouillent le comptage du nombre de paramètres et, par extension, du nombre de degrés de liberté des modèles. Pour un effet aléatoire, il est possible de déterminer que le nombre de degrés de liberté est de 1 puisque nous ajustons un seul paramètre supplémentaire (la variance de cet effet aléatoire). Selon un autre point de vue, il serait possible d’affirmer que le nombre de degrés de liberté est de <span class="math inline">\(k - 1\)</span> (avec <em>k</em> le nombre de groupes dans cet effet aléatoire), ce que nous utilisons habituellement pour un effet fixe. La vraie valeur du nombre de degrés de liberté se situe quelque part entre ces deux extrêmes. L’enjeu du nombre de degrés de liberté est crucial, car il influence directement l’estimation des valeurs de <em>p</em> pour l’ensemble des coefficients du modèle. Avec un nombre de degrés de liberté plus petit, les valeurs de <em>p</em> sont plus faibles et les effets plus significatifs. Le sujet est d’ailleurs l’objet d’une telle controverse que les auteurs de certains <em>packages</em> comme <code>lme4</code> (un des <em>packages</em> les plus utilisés pour ajuster des GLMM) ont fait le choix de ne renvoyer aucune valeur de <em>p</em> dans les résultats des modèles. L’article de <span class="citation" data-cites="bolker2009generalized">Bolker et al. (<a href="#ref-bolker2009generalized" role="doc-biblioref">2009</a>)</span> propose une explication détaillée et relativement accessible du problème (en plus d’une excellente introduction aux GLMM)&nbsp;: en se basant sur leurs recommandations, il est possible de séparer le problème de l’inférence dans les GLMM en trois sous problèmes&nbsp;:</p>
<ul>
<li>Quel est le degré de significativité des effets fixes?</li>
<li>Quel est le degré de significativité de l’effet aléatoire dans le modèle?</li>
<li>Quels sont les degrés de significativité de chaque constante / pente aléatoire?</li>
</ul>
<section id="sec-0941" class="level3" data-number="9.4.1"><h3 data-number="9.4.1" class="anchored" data-anchor-id="sec-0941">
<span class="header-section-number">9.4.1</span> Inférence pour les effets fixes</h3>
<p>Trois approches peuvent être envisagées pour déterminer si un effet fixe est significatif ou non. Elles font appel à trois approches théoriques différentes (test classique, comparaison de modèles et <em>bootstrapping</em>) et peuvent donc donner des résultats différents. À titre exploratoire, il peut être intéressant de toutes les tester, mais certaines peuvent être préférées en fonction de votre champ de recherche.</p>
<section id="sec-09411" class="level4" data-number="9.4.1.1"><h4 data-number="9.4.1.1" class="anchored" data-anchor-id="sec-09411">
<span class="header-section-number">9.4.1.1</span> Test classique</h4>
<p>Nous avons vu, pour les modèles LM et GLM, que les valeurs de <em>p</em> sont calculées à partir de scores obtenus en divisant les coefficients par leurs erreurs standards. Une approche similaire peut être utilisée pour les modèles GLMM. Cependant, la question du nombre de degrés de liberté à utiliser reste un problème. L’approche la plus flexible est certainement l’approximation par la méthode Satterthwaite proposant une estimation de ce nombre de degrés de liberté et, par extension, des valeurs de <em>p</em>.</p>
</section><section id="sec-09412" class="level4" data-number="9.4.1.2"><h4 data-number="9.4.1.2" class="anchored" data-anchor-id="sec-09412">
<span class="header-section-number">9.4.1.2</span> Rapports de vraisemblance</h4>
<p>Si le modèle comprend suffisamment d’observations (par suffisamment, comprenez au moins une centaine d’observations par paramètre), il est également possible d’utiliser une série de tests de rapports de vraisemblance pour vérifier si l’apport de chaque variable indépendante contribue à améliorer significativement le modèle. Cette approche correspond à une analyse de type 3, comme nous l’avons mentionné dans la <a href="#sec-0824">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-0824</span></a> pour le modèle logistique multinomial.</p>
</section><section id="sec-09413" class="level4" data-number="9.4.1.3"><h4 data-number="9.4.1.3" class="anchored" data-anchor-id="sec-09413">
<span class="header-section-number">9.4.1.3</span> Bootstrapping</h4>
<p>L’approche par <em>bootstrapping</em> (<em>parametric-bootstrap</em> ou <em>semi-parametric-bootstrap</em>) permet de calculer, pour les différents paramètres d’un modèle, un intervalle de confiance. L’idée étant de réajuster un grand nombre de fois le modèle sur des sous-échantillons de données pour saisir la variabilité des différents paramètres du modèle. Si les intervalles de confiance ainsi construits ne comprennent pas de zéro, il est possible de dire que cet effet est significatif. À nouveau, cette méthode n’est valide que si le jeu de données comporte suffisamment d’observations. L’intérêt de cette approche est qu’elle ne postule pas d’hypothèse sur la distribution des paramètres qui ont la fâcheuse tendance à ne pas suivre une distribution normale dans le cas des GLMM. Elle est d’ailleurs considérée comme la plus robuste, bien que coûteuse en termes de temps de calcul.</p>
</section></section><section id="sec-0942" class="level3" data-number="9.4.2"><h3 data-number="9.4.2" class="anchored" data-anchor-id="sec-0942">
<span class="header-section-number">9.4.2</span> Inférence pour les effets aléatoires, effet global</h3>
<p>Pour déterminer si un effet aléatoire est significatif dans un modèle, il est recommandé d’utiliser un test de rapport de vraisemblance entre un modèle sans l’effet aléatoire et un modèle avec l’effet aléatoire. L’analyse des différences entre les valeurs de déviance, l’AIC et le BIC peut également aider à déterminer si l’ajout de l’effet aléatoire est justifié. Il est également possible de considérer les valeurs de l’ICC et du R<sup>2</sup> conditionnel. Notez ici que si vous avez une très bonne raison théorique d’ajouter l’effet aléatoire dans votre modèle et suffisamment d’observations / groupes pour l’ajuster, il peut être pertinent de laisser l’effet aléatoire dans le modèle même si tous les indicateurs mentionnés précédemment indiquent qu’il contribue faiblement au modèle. Le retirer risquerait en effet de donner l’impression que les autres paramètres du modèle sont plus significatifs qu’ils ne le sont en réalité.</p>
<p>Notez que l’approche par <em>bootstrapping</em> décrite pour les effets fixes peut aussi être utilisée ici pour obtenir un intervalle de confiance pour l’ICC, le R<sup>2</sup> conditionnel et les différents paramètres de variance et covariance.</p>
</section><section id="sec-0943" class="level3" data-number="9.4.3"><h3 data-number="9.4.3" class="anchored" data-anchor-id="sec-0943">
<span class="header-section-number">9.4.3</span> Inférence pour les effets aléatoires, des constantes et des pentes</h3>
<p>Pour rappel, dans l’approche fréquentiste présentée ici, les valeurs des constantes et des pentes aléatoires ne sont pas à proprement parler des paramètres du modèle&nbsp;: elles sont estimées a posteriori (BLUP). Pour déterminer si ces constantes et des pentes sont significativement différentes de zéro et significativement différentes les unes des autres, il est possible de calculer les intervalles de confiance de chacune d’entre elles par <em>bootstrap</em>, par profilage ou par simulation à partir du modèle. Si la constante du groupe <em>j</em> a zéro dans son intervalle de confiance, nous pouvons alors déclarer que le groupe <em>j</em> en question ne semble pas varier du reste de la population en termes de moyenne. Si la pente <em>l</em> du groupe <em>j</em> a zéro dans son intervalle de confiance, nous pouvons alors déclarer que le groupe <em>j</em> en question ne semble pas varier du reste de la population pour l’effet <em>l</em>. Notez que la méthode par simulation est bien plus rapide que les deux autres, mais que l’approche par <em>bootstrapping</em> reste la plus fiable.</p>
</section></section><section id="sec-095" class="level2" data-number="9.5"><h2 data-number="9.5" class="anchored" data-anchor-id="sec-095">
<span class="header-section-number">9.5</span> Conclusion sur les GLMM</h2>
<p>Les GLMM sont donc une extension des GLM offrant une grande flexibilité de modélisation (variabilité des pentes et des constantes en fonction de groupes) et nous permettant d’analyser la partition de la variance entre plusieurs niveaux de nos données. Cependant, cette flexibilité implique des modèles plus complexes avec un travail de diagnostic et d’interprétation plus long et potentiellement plus ardu.</p>
</section><section id="sec-096" class="level2" data-number="9.6"><h2 data-number="9.6" class="anchored" data-anchor-id="sec-096">
<span class="header-section-number">9.6</span> Mise en œuvre des GLMM dans R</h2>
<p>Pour cet exemple de GLMM, nous proposons d’analyser à nouveau les données présentées dans la <a href="#sec-06211">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-06211</span></a> sur le modèle logistique binomial. Pour rappel, nous modélisions la probabilité qu’un individu utilise le vélo comme mode de transport pour son trajet le plus fréquent en utilisant une enquête réalisée auprès d’environ 26&nbsp;000 Européens. Initialement, nous avons intégré les pays comme un effet fixe. Or, nous savons à présent qu’il serait plus judicieux de les traiter comme un effet aléatoire. Nous comparons deux modèles, un pour lequel seulement la constante varie par pays et un second dans lequel la pente pour l’âge varie également par pays. L’hypothèse étant que l’effet de l’âge sur l’utilisation du vélo pourrait être réduit dans certains pays où la culture du vélo est plus présente. Cette hypothèse implique également la présence potentielle d’une corrélation inverse entre la constante et la pente de chaque pays&nbsp;: dans un pays où la probabilité de base d’utiliser le vélo est plus élevée, l’effet de l’âge est probablement réduit.</p>
<p>Pour ajuster ces modèles, nous utilisons le <em>package</em> <code>lme4</code>, permettant d’ajuster des modèles GLMM avec des distributions gaussienne, Gamma, de Poisson et binomial. Lorsque d’autres distributions sont nécessaires, il est possible de se tourner vers le <em>package</em> <code>gamlss</code>. Notez cependant que les effets aléatoires de <code>gamlss</code> sont estimés avec une méthode appelée PQL très flexible, mais qui peut produire des résultats erronés dans certains cas <span class="citation" data-cites="bolker2009generalized">(<a href="#ref-bolker2009generalized" role="doc-biblioref">Bolker et al. 2009</a>)</span>.</p>
<p>Afin de limiter les répétitions, nous ne recalculons pas ici le VIF et nous excluons d’emblée les observations aberrantes (provenant de Malte ou de Chypre ou avec des temps de trajets supérieurs à 400 minutes).</p>
<section id="sec-0961" class="level3" data-number="9.6.1"><h3 data-number="9.6.1" class="anchored" data-anchor-id="sec-0961">
<span class="header-section-number">9.6.1</span> Ajustement du modèle avec uniquement une constante aléatoire</h3>
<p>Nous commençons donc par ajuster un premier modèle avec une constante aléatoire en fonction du pays. Dans la plupart des <em>packages</em> intégrant des effets aléatoires, la syntaxe suivante est utilisée pour stipuler une constante aléatoire&nbsp;: <code>+ (1|Pays)</code>. Concrètement, nous tentons d’ajuster le modèle décrit par l’<a href="#eq-glmmbinom1">équation&nbsp;<span class="quarto-unresolved-ref">eq-glmmbinom1</span></a>.</p>
<p><span id="eq-glmmbinom1"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Binomial(p)\\
&amp;g(p) = \beta_0 + \beta_1 x_1 + \upsilon \\
&amp;\upsilon \sim Normal(0, \sigma_{\upsilon}) \\
&amp;g(x) = log(\frac{x}{1-x})
\end{aligned}
\tag{9.11}\]</span></span></p>
<p>Il s’agit simplement d’un modèle logistique binomial dans lequel nous avons ajouté une constante aléatoire&nbsp;: <span class="math inline">\(\upsilon\)</span>. Dans notre cas, elle varie avec la variable <code>Pays</code>. La syntaxe dans R pour produire ce modèle est la suivante.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="va">dfenquete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/enquete_transport_UE.csv"</span>, encoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span>
<span><span class="va">dfenquete</span><span class="op">$</span><span class="va">Pays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dfenquete</span><span class="op">$</span><span class="va">Pays</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"Allemagne"</span><span class="op">)</span></span>
<span><span class="co"># Retirer les observations aberrantes</span></span>
<span><span class="va">dfenquete2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dfenquete</span>, <span class="op">(</span><span class="va">dfenquete</span><span class="op">$</span><span class="va">Pays</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Malte"</span>, <span class="st">"Chypre"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">F</span> <span class="op">&amp;</span> </span>
<span>                  <span class="va">dfenquete</span><span class="op">$</span><span class="va">Duree</span> <span class="op">&lt;</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="co"># Ajustement du modèle</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/">lme4</a></span><span class="op">)</span></span>
<span><span class="co"># Nécessité ici de centrer et réduire ces variables pour permettre au modèle de converger</span></span>
<span><span class="va">dfenquete2</span><span class="op">$</span><span class="va">Age2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">dfenquete2</span><span class="op">$</span><span class="va">Age</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dfenquete2</span><span class="op">$</span><span class="va">Duree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">dfenquete2</span><span class="op">$</span><span class="va">Duree</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">modele1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span><span class="va">Sexe</span> <span class="op">+</span> <span class="va">Age2</span> <span class="op">+</span> <span class="va">Education</span> <span class="op">+</span> <span class="va">StatutEmploi</span> <span class="op">+</span> <span class="va">Revenu</span> <span class="op">+</span></span>
<span>              <span class="va">Residence</span> <span class="op">+</span> <span class="va">Duree2</span> <span class="op">+</span> <span class="va">ConsEnv</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Pays</span><span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="st">"bobyqa"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous nous concentrons ici sur l’interprétation des résultats du modèle et nous réalisons l’ensemble des diagnostics dans une section dédiée en fin de chapitre. Notez cependant que le diagnostic <strong>devrait précéder l’interprétation</strong> comme nous l’avons vu dans le chapitre sur les modèles GLM.</p>
<p>Vous constaterez que nous avons centré-réduit les variables <code>Age</code> et <code>Duree</code>. Il est souvent nécessaire de réaliser cette étape en amont pour s’assurer que le modèle converge sans trop de difficulté. Dans notre cas, si ces deux variables sont laissées dans leur échelle d’origine, la fonction <code>glmer</code> ne parvient pas à ajuster le modèle. Notez que cette transformation nous permet d’obtenir les coefficients standardisés, s’exprimant alors en écarts-types. La fonction <code>summary</code> nous donne accès à un premier ensemble d’informations.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence +  
    Duree2 + ConsEnv + (1 | Pays)
   Data: dfenquete2
Control: glmerControl(optimizer = "bobyqa")

     AIC      BIC   logLik deviance df.resid 
 19176.1  19322.8  -9570.1  19140.1    25529 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.1989 -0.4418 -0.3212 -0.2134  7.2461 

Random effects:
 Groups Name        Variance Std.Dev.
 Pays   (Intercept) 0.5949   0.7713  
Number of obs: 25547, groups:  Pays, 26

Fixed effects:
                               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -3.368957   0.212504 -15.854  &lt; 2e-16 ***
Sexehomme                      0.370864   0.037921   9.780  &lt; 2e-16 ***
Age2                          -0.102387   0.018776  -5.453 4.95e-08 ***
Educationsecondaire            0.188098   0.103158   1.823  0.06824 .  
Educationsecondaire inferieur  0.297593   0.111304   2.674  0.00750 ** 
Educationuniversite            0.138671   0.106469   1.302  0.19276    
StatutEmploisans emploi        0.256477   0.042282   6.066 1.31e-09 ***
Revenufaible                   0.073837   0.071642   1.031  0.30271    
Revenumoyen                    0.039405   0.065232   0.604  0.54579    
Revenusans reponse             0.215705   0.102286   2.109  0.03496 *  
Revenutres eleve              -0.121254   0.185272  -0.654  0.51281    
Revenutres faible              0.237388   0.085700   2.770  0.00561 ** 
Residencegrande ville          0.272280   0.069276   3.930 8.48e-05 ***
Residencepetite-moyenne ville  0.276285   0.061492   4.493 7.02e-06 ***
Residencezone rurale          -0.118965   0.069091  -1.722  0.08510 .  
Duree2                        -0.018718   0.019241  -0.973  0.33065    
ConsEnv                        0.101757   0.009277  10.969  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>La première partie de ce résumé nous rappelle la formule utilisée pour le modèle et nous indique différents indicateurs de qualité d’ajustement comme l’AIC, le BIC et la déviance. Nous avons ensuite une partie dédiée aux effets aléatoires (<code>Random Effects</code>) et une partie dédiée aux effets fixes (<code>Fixed effects</code>). Cette dernière s’interprète de la même manière que pour un modèle à effets fixes, n’oubliez cependant pas d’utiliser la fonction exponentielle pour obtenir les rapports de cotes (fonction de lien logistique).</p>
<section id="sec-09611" class="level4" data-number="9.6.1.1"><h4 data-number="9.6.1.1" class="anchored" data-anchor-id="sec-09611">
<span class="header-section-number">9.6.1.1</span> Rôle joué par l’effet aléatoire</h4>
<p>Comme vous pouvez le constater, la section <code>Random Effects</code> ne comprend qu’un seul paramètre&nbsp;: la variance de l’effet pays. Nous pouvons ainsi écrire que l’effet du pays suit une distribution normale avec une moyenne de 0 et une variance <span class="math inline">\(\sigma^2\)</span> de 0,595. Pour aller plus loin dans cette analyse, nous pouvons calculer le coefficient de corrélation intraclasse (ICC). Cependant, puisque notre modèle est binomial et non gaussien, nous ne disposons pas d’un paramètre de variance au niveau des individus, il est donc possible, à la place, d’utiliser la variance théorique du modèle&nbsp;: <span class="math inline">\(\frac{\pi^2}{3}\)</span>. Nous calculons ainsi notre ICC&nbsp;:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction de la variance des Pays</span></span>
<span><span class="va">var_pays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">modele1</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># Calcul de l'ICC</span></span>
<span><span class="va">var_pays</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">pi</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="va">var_pays</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1531364</code></pre>
</div>
</div>
<p>Nous pouvons parvenir au même résultat en utilisant la fonction <code>icc</code> du <em>package</em> <code>performance</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/">performance</a></span><span class="op">)</span></span>
<span><span class="co"># Calcul de l'ICC</span></span>
<span><span class="fu"><a href="https://easystats.github.io/performance/reference/icc.html">icc</a></span><span class="op">(</span><span class="va">modele1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Intraclass Correlation Coefficient

    Adjusted ICC: 0.153
  Unadjusted ICC: 0.148</code></pre>
</div>
</div>
<p>Notez que cette fonction distingue un ICC ajusté et un ICC conditionnel. Le premier correspond à l’ICC que nous avons présenté jusqu’ici et que nous avons calculé à la main. L’ICC conditionnel inclut dans son estimation la variance présente dans les effets fixes. Un fort écart entre ces deux ICC indique que les effets fixes sont capables de capturer une très forte variance dans les données, ce qui pourrait remettre en cause la pertinence de l’effet aléatoire. Dans notre cas, la différence entre les deux est très faible.</p>
<p>En plus du ICC, nous pouvons calculer les R<sup>2</sup> marginal et conditionnel. Pour cela, nous utilisons la fonction <code>r.squaredGLMM</code> du <em>package</em> <code>MuMIn</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">MuMIn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MuMIn/man/r.squaredGLMM.html">r.squaredGLMM</a></span><span class="op">(</span><span class="va">modele1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   R2m        R2c
theoretical 0.03492162 0.18271030
delta       0.01554525 0.08133291</code></pre>
</div>
</div>
<p>Cette fonction nous renvoie à la fois les R<sup>2</sup> obtenus en utilisant la variance théorique du modèle (<span class="math inline">\(\frac{\pi^2}{3}\)</span> dans notre cas) et la variance estimée par la méthode delta. La seconde est plus conservative, mais les deux résultats indiquent que les effets aléatoires expliquent une part importante de la variance comparativement aux effets fixes. Notez également que la fonction <code>r2</code> du <em>package</em> <code>performance</code> peut calculer ces deux R<sup>2</sup>, mais seulement en utilisant la variance théorique.</p>
</section><section id="sec-09612" class="level4" data-number="9.6.1.2"><h4 data-number="9.6.1.2" class="anchored" data-anchor-id="sec-09612">
<span class="header-section-number">9.6.1.2</span> Significativité de l’effet aléatoire</h4>
<p>Nous souhaitons déterminer ici si notre effet aléatoire contribue à significativement améliorer le modèle. Pour cela, nous effectuons un test de rapport de vraisemblance entre le modèle sans l’effet aléatoire (un simple GLM ici) et le modèle complet. Nous utilisons pour cela la fonction <code>anova</code>&nbsp;:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement d'un modèle sans l'effet aléatoire</span></span>
<span><span class="va">model_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span><span class="va">Sexe</span> <span class="op">+</span> <span class="va">Age2</span> <span class="op">+</span> <span class="va">Education</span> <span class="op">+</span> <span class="va">StatutEmploi</span> <span class="op">+</span> <span class="va">Revenu</span> <span class="op">+</span></span>
<span>              <span class="va">Residence</span> <span class="op">+</span> <span class="va">Duree2</span> <span class="op">+</span> <span class="va">ConsEnv</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">)</span></span>
<span><span class="co"># Comparaison des deux modèles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">modele1</span>, <span class="va">model_simple</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: dfenquete2
Models:
model_simple: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + Duree2 + ConsEnv
modele1: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + Duree2 + ConsEnv + (1 | Pays)
             npar   AIC   BIC   logLik deviance Chisq Df Pr(&gt;Chisq)    
model_simple   17 20521 20660 -10243.6    20487                        
modele1        18 19176 19323  -9570.1    19140  1347  1  &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Le test indique clairement que le modèle complet est mieux ajusté&nbsp;: les valeurs de l’AIC, du BIC et de la déviance sont toutes grandement réduites et le test est largement significatif.</p>
<p>Pour aller plus loin, nous pouvons utiliser une approche par <em>bootstrap</em> pour calculer un intervalle de confiance pour la variance de l’effet aléatoire, l’ICC et le R<sup>2</sup> conditionnel. Nous utilisons pour cela la fonction <code>bootMer</code>. Si vous essayez de lancer cette syntaxe, vous constaterez qu’elle prend énormément de temps, ce qui s’explique par le grand nombre de fois où le modèle doit être réajusté. Nous vous recommandons donc de bien enregistrer vos résultats après l’exécution de la fonction avec la fonction <code>save.</code> Notez que pour réduire significativement le temps de calcul, il est possible d’utiliser simultanément plusieurs cœurs de votre processeur, ce que nous faisons ici avec le <em>package</em> <code>snow</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Définition d'une fonction pour extraire les valeurs qui nous intéressent</span></span>
<span><span class="va">extractor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">vari</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">ICC</span> <span class="op">&lt;-</span> <span class="va">vari</span> <span class="op">/</span> <span class="op">(</span><span class="va">vari</span> <span class="op">+</span> <span class="op">(</span><span class="va">pi</span><span class="op">**</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">r2cond</span> <span class="op">&lt;-</span> <span class="fu">performance</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/performance/reference/r2.html">r2</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vari"</span><span class="op">=</span><span class="va">vari</span>,<span class="st">"icc"</span><span class="op">=</span><span class="va">ICC</span>,<span class="st">"r2cond"</span><span class="op">=</span><span class="va">r2cond</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Préparation d'un environnement multitraitement pour accélérer le calcul</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">snow</span><span class="op">)</span></span>
<span><span class="co"># Préparation de huit coeurs (attention si votre machine en a moins!)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/snow/man/snow-startstop.html">makeCluster</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/snow/man/snow-cluster.html">clusterEvalQ</a></span><span class="op">(</span><span class="va">cl</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/">"lme4"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">valeurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/bootMer.html">bootMer</a></span><span class="op">(</span><span class="va">modele1</span>, FUN <span class="op">=</span> <span class="va">extractor</span>, nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                   use.u <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"parametric"</span>, ncpus <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   parallel<span class="op">=</span><span class="st">"snow"</span>,</span>
<span>                   cl <span class="op">=</span> <span class="va">cl</span><span class="op">)</span></span>
<span><span class="co"># Sauvegarde des résultats</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">valeurs</span>, file <span class="op">=</span> <span class="st">'data/glmm/boot_binom.rda'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons à présent analyser l’incertitude de ces différents paramètres. Pour cela, nous devons commencer par observer graphiquement leurs distributions obtenues par <em>bootstrap</em> avec la <a href="#fig-bottdistrib">figure&nbsp;<span class="quarto-unresolved-ref">fig-bottdistrib</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement de nos valeurs préalablement enregistrées</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">'data/glmm/boot_binom.rda'</span><span class="op">)</span></span>
<span><span class="co"># Construction de trois graphiques de distribution</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"variance"</span> , <span class="st">"icc"</span> , <span class="st">"R2cond"</span><span class="op">)</span></span>
<span><span class="va">breaks1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">variance</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>,<span class="fl">0.85</span>, <span class="fl">0.999</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">labs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">breaks1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">variance</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, fill <span class="op">=</span> <span class="st">"#e63946"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">variance</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks1</span>, labels <span class="op">=</span> <span class="va">labs1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">breaks2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">icc</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>,<span class="fl">0.85</span>, <span class="fl">0.999</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">labs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">breaks2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">icc</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, fill <span class="op">=</span> <span class="st">"#a8dadc"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">icc</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks2</span>, labels <span class="op">=</span> <span class="va">labs2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">breaks3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">R2cond</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>,<span class="fl">0.15</span>,<span class="fl">0.5</span>,<span class="fl">0.85</span>, <span class="fl">0.999</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">labs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">breaks3</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">R2cond</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, fill <span class="op">=</span> <span class="st">"#1d3557"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">R2cond</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks3</span>, labels <span class="op">=</span> <span class="va">labs3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bottdistrib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-bottdistrib-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.17: Distributions obtenues par bootstrap de la variance de l’effet aléatoire, de l’ICC et du R carré conditionnel</figcaption></figure>
</div>
</div>
</div>
<p>Les trois distributions sont toutes suffisamment éloignées de zéro pour que nous puissions en conclure que ces différentes valeurs sont toutes différentes de zéro. Notez également que les distributions sont relativement symétriques, indiquant que nous disposons de probablement suffisamment d’information dans nos données pour inclure notre effet aléatoire. Des distributions fortement asymétriques indiqueraient, au contraire, une forte difficulté du modèle à estimer le paramètre de variance à partir des données. Dans un article, il n’est pas nécessaire de reporter ces graphiques, mais plus simplement les intervalles de confiance à 95&nbsp;% et les médianes.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Intervalle de confiance pour la variance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">variance</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0275</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.75%       50%     97.5% 
0.3059400 0.5578986 0.9200472 </code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Intervalle de confiance pour l'ICC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">icc</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0275</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.75%       50%     97.5% 
0.0850824 0.1449928 0.2185428 </code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Intervalle de confiance pour le R2 conditionnel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">R2cond</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0275</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.75%       50%     97.5% 
0.1208577 0.1772778 0.2462622 </code></pre>
</div>
</div>
</section><section id="sec-09613" class="level4" data-number="9.6.1.3"><h4 data-number="9.6.1.3" class="anchored" data-anchor-id="sec-09613">
<span class="header-section-number">9.6.1.3</span> Significativité des différentes constantes</h4>
<p>Puisque nous avons conclu que l’effet aléatoire contribue significativement au modèle, nous pouvons à présent vérifier si les constantes ajustées pour chaque pays varient significativement les unes des autres. Pour rappel, les pentes et les constantes aléatoires ne sont pas directement estimées par le modèle, mais a posteriori. Il en résulte qu’il n’y a pas de moyen direct de mesurer l’incertitude de ces paramètres, et donc de construire des intervalles de confiance. Une première option pour contourner ce problème est d’effectuer des simulations à partir de la distribution postérieure du modèle. Notez que cette approche s’inspire largement de l’approche statistique bayésienne. Nous utilisons ici le <em>package</em> <code>merTools</code> pour effectuer 1000 simulations et obtenir une erreur standard pour chaque constante aléatoire de chaque pays.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simulations et extraction des effets aléatoires</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">merTools</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">simsRE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/merTools/man/REsim.html">REsim</a></span><span class="op">(</span><span class="va">modele1</span>, n.sims <span class="op">=</span> <span class="fl">1000</span>, oddsRatio <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Calcul des intervalles de confiance</span></span>
<span><span class="va">simsRE</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">sd</span></span>
<span><span class="va">simsRE</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">mean</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">sd</span></span>
<span><span class="co"># Variable binaire pour la significativité</span></span>
<span><span class="va">simsRE</span><span class="op">$</span><span class="va">sign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">simsRE</span><span class="op">$</span><span class="va">lower</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">upper</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"inf"</span>,</span>
<span>  <span class="va">simsRE</span><span class="op">$</span><span class="va">lower</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">upper</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"sup"</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"not"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Représentation des intervalles de confiance</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">simsRE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>, xmax <span class="op">=</span> <span class="va">upper</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">groupID</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, height <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">groupID</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="va">sign</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inf"</span> <span class="op">=</span> <span class="st">"#0077b6"</span>, <span class="st">"sup"</span> <span class="op">=</span> <span class="st">"#e63946"</span>, <span class="st">"not"</span><span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span>, </span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sign. &lt; 0"</span>, <span class="st">"sign. &gt; 0"</span>, <span class="st">"non sign."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Constante aléatoire"</span>, y <span class="op">=</span> <span class="st">"Pays"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstantes1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randomconstantes1-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.18: Constantes aléatoires estimées par Pays (IC par simulations)</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-randomconstantes1">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomconstantes1</span></a> permet de repérer en un coup d’oeil les pays pour lesquels la probabilité d’utiliser le vélo comme moyen de transport pour le trajet le plus fréquent est la plus élevée ou la plus faible. Notez cependant que les valeurs représentées sont pour l’instant des logarithmes de rapport de cotes. Nous devons donc les convertir en rapports de cotes avec la fonction exponentielle pour faciliter leur interprétation.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Conversion en rapports de cote (et arrondissement à trois décimales)</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">simsRE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span> , <span class="st">"lower"</span> , <span class="st">"upper"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">groupID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"RC"</span> , <span class="st">"RC.025"</span> , <span class="st">"RC.975"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   RC RC.025 RC.975
Allemagne       1.667  1.191  2.333
Autriche        1.311  0.927  1.853
Belgique        1.428  1.022  1.997
Bulgarie        0.541  0.374  0.784
Croatie         1.880  1.354  2.610
Danemark        4.043  2.926  5.587
Espagne         0.292  0.194  0.439
Estonie         1.121  0.787  1.598
Finlande        2.242  1.621  3.102
France          0.523  0.357  0.766
Grande Bretagne 0.396  0.269  0.583
Grèce           0.615  0.422  0.897
Hongrie         2.359  1.700  3.273
Ireland         0.377  0.254  0.558
Italie          0.805  0.575  1.126
Lettonie        1.270  0.901  1.790
Lituanie        0.902  0.632  1.287
Luxembourg      0.419  0.262  0.670
Pays-Bas        3.939  2.873  5.400
Pologne         1.658  1.189  2.311
Portugal        0.218  0.139  0.340
Roumanie        0.542  0.376  0.781
Slovaquie       1.029  0.727  1.455
Slovénie        1.363  0.969  1.916
Suède           2.166  1.555  3.018
Tchéquie        1.172  0.837  1.641</code></pre>
</div>
</div>
<p>Nous observons ainsi qu’une personne vivant en Finlande voit ses chances multipliées par 2,25 d’utiliser le vélo comme mode de transport pour son trajet le plus fréquent comparativement à la moyenne des pays européens. À l’inverse, une personne résidant en France a 47&nbsp;% de chances de moins d’utiliser le vélo.</p>
<p>Notez cependant que cette approche basée sur des simulations peut poser des problèmes, car elle ne renvoie qu’une erreur standard pour mesurer l’incertitude de nos constantes. Dans les cas où nous ne disposons pas de beaucoup d’observations par groupe, la distribution a posteriori des constantes peut être asymétrique, rendant l’estimation des intervalles de confiance par les erreurs standards inutiles. Il est possible de détecter ce cas de figure quand les médianes et les moyennes renvoyées par la fonction <code>simsRE</code> diffèrent nettement. Une alternative plus robuste est à nouveau d’estimer la variabilité des effets aléatoires par <em>bootstrap</em>. Cette méthode requiert bien plus de temps de calcul que la précédente, nous vous recommandons donc de commencer par la méthode par simulations pour disposer d’un premier aperçu des résultats et d’utiliser ensuite la méthode <em>bootstrap</em> quand votre modèle est dans sa forme finale.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Création de la fonction d'extraction</span></span>
<span><span class="va">extractor2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">elements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">Pays</span></span>
<span>  <span class="va">vec</span> <span class="op">&lt;-</span> <span class="va">elements</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">elements</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Préparation de l'opération en multitraitement</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/snow/man/snow-startstop.html">makeCluster</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/snow/man/snow-cluster.html">clusterEvalQ</a></span><span class="op">(</span><span class="va">cl</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/">"lme4"</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Calcul des effets aléatoires en bootstrap</span></span>
<span><span class="va">valeurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/bootMer.html">bootMer</a></span><span class="op">(</span><span class="va">modele1</span>, FUN <span class="op">=</span> <span class="va">extractor2</span>, nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                   use.u <span class="op">=</span> <span class="cn">T</span>, type <span class="op">=</span> <span class="st">"parametric"</span>, ncpus <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   parallel<span class="op">=</span><span class="st">"snow"</span>,</span>
<span>                   cl <span class="op">=</span> <span class="va">cl</span><span class="op">)</span></span>
<span><span class="co"># Sauvegarder des résultats!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">valeurs</span>, file <span class="op">=</span> <span class="st">'data/glmm/boot_binom2.rda'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puisque nous disposons des distributions <em>bootstrapées</em> des différents effets aléatoires, nous pouvons directement les représenter dans un graphique (<a href="#fig-randomconstantes2">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomconstantes2</span></a>). Les résultats sont très similaires à ceux de la <a href="#fig-randomconstantes1">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomconstantes1</span></a>, ce qui s’explique par le grand nombre d’observations et de groupes. Avec moins d’observations, il est recommandé de privilégier l’approche par <em>bootstrap</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement de nos valeurs bootstrapées</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">'data/glmm/boot_binom2.rda'</span><span class="op">)</span></span>
<span><span class="co"># Conversion des bootstraps en intervalle de confiance</span></span>
<span><span class="va">q025</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">q975</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="va">df_med</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Var2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>  med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu">q025</span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu">q975</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Ajout d'une variable pour la couleur si significatif</span></span>
<span><span class="va">df_med</span><span class="op">$</span><span class="va">sign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">df_med</span><span class="op">$</span><span class="va">lower</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">df_med</span><span class="op">$</span><span class="va">upper</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"inf"</span>,</span>
<span>  <span class="va">df_med</span><span class="op">$</span><span class="va">lower</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">df_med</span><span class="op">$</span><span class="va">upper</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"sup"</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"not"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des résultats</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df_med</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>, xmax <span class="op">=</span> <span class="va">upper</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">med</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">med</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Var2</span>, <span class="va">med</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">sign</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inf"</span> <span class="op">=</span> <span class="st">"#0077b6"</span>, <span class="st">"sup"</span> <span class="op">=</span> <span class="st">"#e63946"</span>, <span class="st">"not"</span><span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span>, </span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sign. &lt; 0"</span>, <span class="st">"sign. &gt; 0"</span>, <span class="st">"non sign."</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Constante aléatoire"</span>, y <span class="op">=</span> <span class="st">"Pays"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstantes2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randomconstantes2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.19: Constantes aléatoires estimées par Pays (IC par bootstrap)</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-0962" class="level3" data-number="9.6.2"><h3 data-number="9.6.2" class="anchored" data-anchor-id="sec-0962">
<span class="header-section-number">9.6.2</span> Ajustement du modèle avec constantes et pentes aléatoires</h3>
<p>Dans le modèle précédent, nous avons ajusté, pour chaque pays, une constante aléatoire afin de vérifier si la probabilité d’utiliser le vélo comme mode de transport principal changeait d’un pays d’Europe à l’autre. Nous souhaitons à présent tester l’hypothèse que l’effet de l’âge sur la probabilité d’utiliser le vélo varie d’un pays à l’autre. Pour cela, nous ajustons des constantes aléatoires par pays. Nous comparons trois modèles, triés ici selon leur niveau de complexité (nombre de paramètres)&nbsp;:</p>
<ul>
<li>le modèle avec uniquement des constantes aléatoires;</li>
<li>le modèle avec des constantes et des pentes aléatoires indépendantes;</li>
<li>le modèle avec des constantes et des pentes aléatoires corrélées.</li>
</ul>
<p>Dans le <em>package</em> <code>lme4</code>, les syntaxes pour ajuster ces trois modèles sont les suivantes&nbsp;:</p>
<ul>
<li>constantes aléatoires&nbsp;: <code>+(1|Pays)</code>;</li>
<li>constantes et pentes aléatoires indépendantes&nbsp;: <code>+(1 + Age||Pays)</code>;</li>
<li>constantes et pentes aléatoires corrélées&nbsp;: <code>+(1 + Age|Pays)</code>.</li>
</ul>
<p>Notez qu’il est aussi possible d’ajuster un modèle avec uniquement des pentes aléatoires avec la syntaxe&nbsp;: <code>+(-1 + Age|Pays)</code>. Le paramètre <code>-1</code> sert à retirer explicitement la constante aléatoire du modèle. Ajustons donc nos deux modèles avec pentes et constantes aléatoires.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Constantes et pentes aléatoires indépendantes</span></span>
<span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Sexe</span> <span class="op">+</span> <span class="va">Age2</span> <span class="op">+</span> <span class="va">Education</span> <span class="op">+</span> <span class="va">StatutEmploi</span> <span class="op">+</span> <span class="va">Revenu</span> <span class="op">+</span></span>
<span>              <span class="va">Residence</span> <span class="op">+</span> <span class="va">Duree2</span> <span class="op">+</span> <span class="va">ConsEnv</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Age2</span><span class="op">||</span><span class="va">Pays</span><span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="st">"bobyqa"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">)</span></span>
<span><span class="co"># Constantes et pentes aléatoires corrélées</span></span>
<span><span class="va">modele3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">Sexe</span> <span class="op">+</span> <span class="va">Age2</span> <span class="op">+</span> <span class="va">Education</span> <span class="op">+</span> <span class="va">StatutEmploi</span> <span class="op">+</span> <span class="va">Revenu</span> <span class="op">+</span></span>
<span>              <span class="va">Residence</span> <span class="op">+</span> <span class="va">Duree2</span> <span class="op">+</span> <span class="va">ConsEnv</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Age2</span><span class="op">|</span><span class="va">Pays</span><span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html">glmerControl</a></span><span class="op">(</span>optimizer <span class="op">=</span> <span class="st">"bobyqa"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-09621" class="level4" data-number="9.6.2.1"><h4 data-number="9.6.2.1" class="anchored" data-anchor-id="sec-09621">
<span class="header-section-number">9.6.2.1</span> Significativité de l’effet aléatoire</h4>
<p>Puisque les trois modèles sont imbriqués, la première étape est de vérifier si les ajouts successifs au modèle de base sont significatifs, ce que nous pouvons tester avec un rapport de vraisemblance.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">modele1</span>, <span class="va">modele2</span>, <span class="va">modele3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: dfenquete2
Models:
modele1: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + Duree2 + ConsEnv + (1 | Pays)
modele2: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + Duree2 + ConsEnv + (1 + Age2 || Pays)
modele3: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence + Duree2 + ConsEnv + (1 + Age2 | Pays)
        npar   AIC   BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)   
modele1   18 19176 19323 -9570.1    19140                        
modele2   19 19171 19325 -9566.3    19133 7.5754  1   0.005917 **
modele3   20 19172 19335 -9566.1    19132 0.4033  1   0.525385   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Nous constatons ainsi que l’ajout des pentes aléatoires permet d’améliorer significativement le modèle, mais que l’ajout de la corrélation entre les pentes et les constantes aléatoires a un apport très marginal. Nous décidons tout de même de le garder dans un premier temps, car ce paramètre a un intérêt théorique. Affichons le résumé du modèle 3.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: binomial  ( logit )
Formula: y ~ Sexe + Age2 + Education + StatutEmploi + Revenu + Residence +  
    Duree2 + ConsEnv + (1 + Age2 | Pays)
   Data: dfenquete2
Control: glmerControl(optimizer = "bobyqa")

     AIC      BIC   logLik deviance df.resid 
 19172.2  19335.1  -9566.1  19132.2    25527 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.2087 -0.4392 -0.3218 -0.2137  7.1677 

Random effects:
 Groups Name        Variance Std.Dev. Corr 
 Pays   (Intercept) 0.594976 0.77135       
        Age2        0.007326 0.08559  -0.22
Number of obs: 25547, groups:  Pays, 26

Fixed effects:
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -3.35793    0.21306 -15.760  &lt; 2e-16 ***
Sexehomme                      0.37289    0.03796   9.823  &lt; 2e-16 ***
Age2                          -0.08775    0.02780  -3.157 0.001594 ** 
Educationsecondaire            0.17963    0.10382   1.730 0.083597 .  
Educationsecondaire inferieur  0.28700    0.11189   2.565 0.010315 *  
Educationuniversite            0.13012    0.10713   1.215 0.224510    
StatutEmploisans emploi        0.25625    0.04251   6.028 1.66e-09 ***
Revenufaible                   0.07058    0.07182   0.983 0.325727    
Revenumoyen                    0.03841    0.06534   0.588 0.556594    
Revenusans reponse             0.20362    0.10265   1.984 0.047304 *  
Revenutres eleve              -0.12420    0.18566  -0.669 0.503528    
Revenutres faible              0.23562    0.08595   2.741 0.006117 ** 
Residencegrande ville          0.26958    0.06936   3.887 0.000102 ***
Residencepetite-moyenne ville  0.27570    0.06157   4.478 7.53e-06 ***
Residencezone rurale          -0.11897    0.06917  -1.720 0.085428 .  
Duree2                        -0.01889    0.01927  -0.980 0.327069    
ConsEnv                        0.10189    0.00929  10.967  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>À nouveau, nous nous intéressons ici principalement à la section <code>Random Effect</code>, puisque les effets fixes s’interprètent exactement comme dans les modèles présentés dans le <a href="#sec-chap06">chapitre&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-chap06</span></a>. Les constantes ont une variance de 0,595 et les pentes de 0,007. La corrélation entre les deux effets est de -0,22. Cette corrélation est négative et relativement faible, ce qui signifie que les pays dans lesquels la constante est forte tendent à avoir un coefficient plus petit pour l’âge, et donc une réduction accrue de la probabilité d’utiliser le vélo avec l’âge. Nous devons cependant encore nous assurer qu’elle est significativement différente de 0. Pour cela, nous devons calculer l’intervalle de confiance des trois paramètres de variance du modèle. Nous utilisons à nouveau une approche par <em>bootstrap</em> et nous enregistrons les résultats.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fonction d'extraction des trois paramètres de variance</span></span>
<span><span class="va">extractor3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">vari1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">vari2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">covari</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vari1"</span><span class="op">=</span><span class="va">vari1</span>,<span class="st">"vari2"</span><span class="op">=</span><span class="va">vari2</span>,<span class="st">"covari"</span><span class="op">=</span><span class="va">covari</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Lancement du bootstrap</span></span>
<span><span class="va">valeurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/bootMer.html">bootMer</a></span><span class="op">(</span><span class="va">modele3</span>, FUN <span class="op">=</span> <span class="va">extractor3</span>, nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                   use.u <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"parametric"</span>, ncpus <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                   parallel<span class="op">=</span><span class="st">"snow"</span>,</span>
<span>                   cl <span class="op">=</span> <span class="va">cl</span>,</span>
<span>                   .progress<span class="op">=</span><span class="st">"txt"</span>, PBarg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>style<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Enregistrement des résultats</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">valeurs</span>, file <span class="op">=</span> <span class="st">'data/glmm/boot_binom3.rda'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À partir des valeurs <em>bootstrapées</em>, nous pouvons représenter les distributions de ces trois paramètres (variance des constantes, variance des pentes et corrélation entre les deux).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des résultats</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">'data/glmm/boot_binom3.rda'</span><span class="op">)</span></span>
<span><span class="co"># Conversion des valeurs de covariance en corrélation</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  corr_values <span class="op">=</span> <span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  vari_const <span class="op">=</span> <span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>  vari_pente <span class="op">=</span> <span class="va">valeurs</span><span class="op">$</span><span class="va">t</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># Histogramme pour la variance des constantes</span></span>
<span><span class="va">breaks1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_const</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>,<span class="fl">0.999</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">label1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">breaks1</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">vari_const</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_const</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_const</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_const</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Variance des constantes"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks1</span>, labels <span class="op">=</span> <span class="va">label1</span><span class="op">)</span></span>
<span><span class="co"># Histogramme pour la variance des pentes</span></span>
<span><span class="va">breaks2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_pente</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>,<span class="fl">0.999</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">label2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">breaks2</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">vari_pente</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_pente</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_pente</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">vari_pente</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Variance des pentes"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks2</span>, labels <span class="op">=</span> <span class="va">label2</span><span class="op">)</span></span>
<span><span class="co"># Histogramme pour la corrélation</span></span>
<span><span class="va">breaks3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">corr_values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">label3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">breaks3</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">corr_values</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">corr_values</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">corr_values</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">corr_values</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span>, </span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Corrélation pentes/constantes"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks3</span>, labels <span class="op">=</span> <span class="va">label3</span><span class="op">)</span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-glmmvarboot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-glmmvarboot-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.20: Incertitude autour des paramètres de variance obtenue par bootstrap</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons ainsi, à la <a href="#fig-glmmvarboot">figure&nbsp;<span class="quarto-unresolved-ref">fig-glmmvarboot</span></a>, que la variance des constantes aléatoires est significativement différente de zéro (cette valeur n’est pas dans l’intervalle de confiance à 95&nbsp;% représenté par les lignes verticales bleues) et une médiane de 0,56 (ligne verticale rouge). Pour les pentes, zéro est également à la limite de l’intervalle de confiance, et la distribution asymétrique et étalée nous indique que ce paramètre est fortement incertain dans le modèle. Enfin, la corrélation entre les pentes et les constantes est de loin le paramètre le plus incertain et son intervalle de confiance est franchement à cheval sur zéro, ce qui devrait nous amener à privilégier un modèle sans ce paramètre.</p>
<p>Pour terminer, nous pouvons calculer les R<sup>2</sup> marginal et conditionnel du modèle afin de mieux cerner le rôle joué par les effets fixes et les effets aléatoires.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/MuMIn/man/r.squaredGLMM.html">r.squaredGLMM</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   R2m        R2c
theoretical 0.03413723 0.18360167
delta       0.01419943 0.07636937</code></pre>
</div>
</div>
<p>Les valeurs des R<sup>2</sup> marginal et conditionnel du modèle sont similaires à celles que nous avons obtenus avec seulement des constantes aléatoires dans la section précédente, signalant l’apport relativement faible des pentes aléatoires.</p>
</section><section id="sec-09622" class="level4" data-number="9.6.2.2"><h4 data-number="9.6.2.2" class="anchored" data-anchor-id="sec-09622">
<span class="header-section-number">9.6.2.2</span> Analyse des effets aléatoires</h4>
<p>Pour analyser facilement les constantes et les pentes aléatoires de chaque pays, nous pouvons représenter graphiquement leurs intervalles de confiance construits à partir des simulations tirées de la distribution a posteriori du modèle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simulations et extraction des effets aléatoires</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">merTools</span><span class="op">)</span></span>
<span><span class="va">simsRE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/merTools/man/REsim.html">REsim</a></span><span class="op">(</span><span class="va">modele3</span>, n.sims <span class="op">=</span> <span class="fl">1000</span>, oddsRatio <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Calcul des intervalles de confiance</span></span>
<span><span class="va">simsRE</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">sd</span></span>
<span><span class="va">simsRE</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">mean</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">sd</span></span>
<span><span class="co"># Variable binaire pour la significativité</span></span>
<span><span class="va">simsRE</span><span class="op">$</span><span class="va">sign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">simsRE</span><span class="op">$</span><span class="va">lower</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">upper</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"inf"</span>,</span>
<span>  <span class="va">simsRE</span><span class="op">$</span><span class="va">lower</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">upper</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">~</span> <span class="st">"sup"</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"not"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">simsRE</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="va">simsRE</span><span class="op">$</span><span class="va">term</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">simsRE</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Age2"</span>, <span class="va">simsRE</span><span class="op">$</span><span class="va">term</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Représentation des intervalles de confiance</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>, xmax <span class="op">=</span> <span class="va">upper</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">groupID</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, height <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">groupID</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="va">sign</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inf"</span> <span class="op">=</span> <span class="st">"#0077b6"</span>, <span class="st">"sup"</span> <span class="op">=</span> <span class="st">"#e63946"</span>, <span class="st">"not"</span><span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span>, </span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sign. &lt; 0"</span>, <span class="st">"non sign."</span>, <span class="st">"sign. &gt; 0"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Constante aléatoire"</span>, y <span class="op">=</span> <span class="st">"Pays"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>, xmax <span class="op">=</span> <span class="va">upper</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">groupID</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, height <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">groupID</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="va">sign</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inf"</span> <span class="op">=</span> <span class="st">"#0077b6"</span>, <span class="st">"sup"</span> <span class="op">=</span> <span class="st">"#e63946"</span>, <span class="st">"not"</span><span class="op">=</span><span class="st">"#000000"</span><span class="op">)</span>, </span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sign. &lt; 0"</span>, <span class="st">"non sign."</span>, <span class="st">"sign. &gt; 0"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Pente aléatoire (âge)"</span>, y <span class="op">=</span> <span class="st">"Pays"</span><span class="op">)</span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstantes2b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-randomconstantes2b-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.21: Constantes aléatoires estimées par pays (intervalles de confiance obtenus par simulations)</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-randomconstantes2b">figure&nbsp;<span class="quarto-unresolved-ref">fig-randomconstantes2b</span></a> nous permet ainsi de constater que l’effet des pays sur les pentes est presque toujours non significatif, sauf pour le Danemark. Son effet négatif (-0,136) indique un renforcement de l’effet général, lui-même négatif (-0,088). Une interprétation possible est qu’au Danemark, l’utilisation du vélo est proportionnellement plus courante par les jeunes que dans le reste des pays de l’Europe.</p>
<p>Pour l’interprétation finale, il est nécessaire d’afficher les valeurs exactes de ces différents paramètres et, dans notre cas, de les convertir en rapports de cotes avec la fonction exponentielle. Pour les pentes aléatoires, il peut être plus facile d’interpréter la somme de l’effet fixe et de l’effet aléatoire.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des effets aléatoires obtenus par simulation</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span> , <span class="st">"lower"</span> , <span class="st">"upper"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mat</span><span class="op">$</span><span class="va">Pays</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">groupID</span></span>
<span><span class="va">mat</span><span class="op">$</span><span class="va">effet</span> <span class="op">&lt;-</span> <span class="va">simsRE</span><span class="op">$</span><span class="va">term</span></span>
<span><span class="co"># Séparation des pentes et des constantes</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mat</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="va">mat</span><span class="op">$</span><span class="va">effet</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mat</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Age2"</span>, <span class="va">mat</span><span class="op">$</span><span class="va">effet</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Conversion en rapports de cotes pour les pentes (+ effet fixe)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">RC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">mean</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">RC025</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">lower</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">RC975</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">upper</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html">fixef</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pays"</span> , <span class="st">"RC"</span> , <span class="st">"RC025"</span> , <span class="st">"RC975"</span><span class="op">)</span><span class="op">]</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Pays    RC RC025 RC975
27 Allemagne 0.835 0.744 0.937
28  Autriche 0.986 0.875 1.112
29  Belgique 0.895 0.797 1.005
30  Bulgarie 0.946 0.824 1.086
31   Croatie 0.905 0.802 1.020
32  Danemark 0.799 0.720 0.886
33   Espagne 0.920 0.796 1.063
34   Estonie 0.950 0.835 1.080
35  Finlande 0.865 0.774 0.967
36    France 0.897 0.783 1.029</code></pre>
</div>
</div>
<p>Nous constatons ainsi qu’au Danemark, les chances pour un individu d’utiliser le vélo sont réduites de 20&nbsp;% à chaque augmentation de l’âge d’un écart-type, contre seulement 1,5&nbsp;% en Autriche (non significatif pour ce dernier). Notons ici que l’écart-type de la variable <code>Age</code> est de 11 ans. Nous pouvons à présent analyser les constantes.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Conversion en rapports de cotes pour les constantes</span></span>
<span><span class="va">df1</span><span class="op">$</span><span class="va">RC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df1</span><span class="op">$</span><span class="va">RC025</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">df1</span><span class="op">$</span><span class="va">RC975</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pays"</span> , <span class="st">"RC"</span> , <span class="st">"RC025"</span> , <span class="st">"RC975"</span><span class="op">)</span><span class="op">]</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Pays    RC RC025 RC975
1  Allemagne 1.691 1.207 2.369
2   Autriche 1.312 0.925 1.860
3   Belgique 1.435 1.015 2.029
4   Bulgarie 0.547 0.375 0.799
5    Croatie 1.885 1.350 2.630
6   Danemark 4.087 2.937 5.686
7    Espagne 0.291 0.192 0.440
8    Estonie 1.131 0.798 1.602
9   Finlande 2.243 1.609 3.125
10    France 0.527 0.359 0.774</code></pre>
</div>
</div>
<p>En revanche, les chances pour un individu d’utiliser le vélo comme mode de transport pour son trajet le plus fréquent sont 4 fois supérieures à la moyenne européenne, contre seulement 1,3 fois en Autriche. Notez à nouveau que les intervalles de confiance pour ces pentes et ces constantes pourraient être estimés plus fiablement par <em>bootstrap</em>.</p>
</section><section id="sec-09623" class="level4" data-number="9.6.2.3"><h4 data-number="9.6.2.3" class="anchored" data-anchor-id="sec-09623">
<span class="header-section-number">9.6.2.3</span> Diagnostic des effets aléatoires</h4>
<p>Pour rappel, dans un modèle GLMM, les effets aléatoires sont modélisés comme provenant de distributions normales. Nous devons donc vérifier qu’ils respectent cette condition d’application. La <a href="#fig-diagbinomglmm1">figure&nbsp;<span class="quarto-unresolved-ref">fig-diagbinomglmm1</span></a> (graphique quantile-quantile) nous permet de constater que les constantes suivent bien une distribution normale, ce qui ne semble pas vraiment être le cas pour les pentes. Considérant que leurs effets sont petits, il serait plus pertinent ici de les retirer du modèle.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagbinomglmm1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-diagbinomglmm1-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.22: Distribution normale univariée des constantes et des pentes aléatoires</figcaption></figure>
</div>
</div>
</div>
<p>Considérant que ce modèle inclut une corrélation entre les constantes et les pentes aléatoires, il est également nécessaire de vérifier si elles suivent conjointement une distribution normale bivariée. La <a href="#fig-diagbinomglmm2">figure&nbsp;<span class="quarto-unresolved-ref">fig-diagbinomglmm2</span></a> semble indiquer que c’est le cas.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cor_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/VarCorr.html">VarCorr</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">re_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">$</span><span class="va">Pays</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">re_effects</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"constante"</span> , <span class="st">"pente"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmurdoch/ellipse">ellipse</a></span><span class="op">)</span></span>
<span><span class="va">levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.75</span>,<span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">els</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">levels</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">el</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://dmurdoch.github.io/ellipse/reference/ellipse.html">ellipse</a></span><span class="op">(</span><span class="va">cor_mat</span>, center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, level <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">el</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span> , <span class="st">"y"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">el</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">ref_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cor_mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ref_points</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span> , <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ref_points</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>data <span class="op">=</span> <span class="va">els</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>data <span class="op">=</span> <span class="va">els</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>data <span class="op">=</span> <span class="va">els</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>data <span class="op">=</span> <span class="va">els</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="st">"d"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">re_effects</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">constante</span>, y <span class="op">=</span> <span class="va">pente</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">=</span><span class="st">"#90e0ef"</span>,</span>
<span>                                <span class="st">"b"</span><span class="op">=</span><span class="st">"#00b4d8"</span>,</span>
<span>                                <span class="st">"c"</span><span class="op">=</span><span class="st">"#0077b6"</span>,</span>
<span>                                <span class="st">"d"</span><span class="op">=</span><span class="st">"#03045e"</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"5 %"</span> , <span class="st">"25 %"</span> , <span class="st">"75 %"</span> , <span class="st">"95 %"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Constantes"</span>, y <span class="op">=</span> <span class="st">"Pentes"</span>, color <span class="op">=</span> <span class="st">"quantiles"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diagbinomglmm2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="09-GLMM_files/figure-html/fig-diagbinomglmm2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;9.23: Distribution normale bivariée des constantes et des pentes aléatoires</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-09624" class="level4" data-number="9.6.2.4"><h4 data-number="9.6.2.4" class="anchored" data-anchor-id="sec-09624">
<span class="header-section-number">9.6.2.4</span> Inférence pour les effets fixes</h4>
<p>Nous avons mentionné, dans les sections précédentes, que le calcul de valeurs de <em>p</em> pour les effets fixes fait l’objet de controverses pour les modèles GLMM. La méthode offrant le meilleur compromis entre rapidité de calcul et fiabilité est la méthode Satterthwaite implémentée dans le <em>package</em> <code>lmerTest</code>. Pour l’utiliser, il suffit de charger le <em>package</em> <code>lmerTest</code> après <code>lme4</code>, ce qui modifie la fonction <code>summary</code> pour qu’elle utilise directement cette approche.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runehaubo/lmerTestR">lmerTest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span>,<span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)                     -3.358      0.213 -15.760    0.000
Sexehomme                        0.373      0.038   9.823    0.000
Age2                            -0.088      0.028  -3.157    0.002
Educationsecondaire              0.180      0.104   1.730    0.084
Educationsecondaire inferieur    0.287      0.112   2.565    0.010
Educationuniversite              0.130      0.107   1.215    0.225
StatutEmploisans emploi          0.256      0.043   6.028    0.000
Revenufaible                     0.071      0.072   0.983    0.326
Revenumoyen                      0.038      0.065   0.588    0.557
Revenusans reponse               0.204      0.103   1.984    0.047
Revenutres eleve                -0.124      0.186  -0.669    0.504
Revenutres faible                0.236      0.086   2.741    0.006
Residencegrande ville            0.270      0.069   3.887    0.000
Residencepetite-moyenne ville    0.276      0.062   4.478    0.000
Residencezone rurale            -0.119      0.069  -1.720    0.085
Duree2                          -0.019      0.019  -0.980    0.327
ConsEnv                          0.102      0.009  10.967    0.000</code></pre>
</div>
</div>
<p>Les deux autres options envisageables sont&nbsp;: effectuer une analyse de type 3 ou calculer les intervalles de confiance par <em>bootstrap</em>. Cependant, elles requièrent beaucoup plus de temps de calcul. Par conséquent, elles ne sont pas présentées ici.</p>
</section></section></section><section id="sec-097" class="level2" data-number="9.7"><h2 data-number="9.7" class="anchored" data-anchor-id="sec-097">
<span class="header-section-number">9.7</span> Quiz de révision du chapitre</h2>
<div id="quizz_glmm" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_glmm;
  window.onload = function() {
    quizz_quizz_glmm = new Quiz('quizz_glmm', ['1','4',['1', '2', '3', '4'],['1', '2', '3'],['1', '5'],'2',['2']]);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
GLMM est un acronyme signifiant :
</div>
<div>
Relisez au besoin la <a href="#sec-0912">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-0912</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>modèles linéaires généralisés à effets mixtes</label>
</td>
<td>
<input type="radio" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>modèles linéaires gaussiens à effets Mixtes</label>
</td>
<td>
<input type="radio" name="q1" value="2">
</td>
</tr>
<tr>
<td>
<label>modèles linéaires généralisés multinomiaux</label>
</td>
<td>
<input type="radio" name="q1" value="3">
</td>
</tr>
<tr>
<td>
<label>modèles linéaires généralisés multiniveau</label>
</td>
<td>
<input type="radio" name="q1" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Les modèles GLMM, comparativement aux GLM, permettent de tenir compte de :
</div>
<div>
Relisez au besoin la <a href="#sec-0911">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-0911</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>la distribution spécifique de la variable Y</label>
</td>
<td>
<input type="radio" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>les distributions spécifiques des variables X</label>
</td>
<td>
<input type="radio" name="q2" value="2">
</td>
</tr>
<tr>
<td>
<label>l’hétéroscédasticité des résidus</label>
</td>
<td>
<input type="radio" name="q2" value="3">
</td>
</tr>
<tr>
<td>
<label>la non-indépendance des observations</label>
</td>
<td>
<input type="radio" name="q2" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un effet aléatoire se distingue d’un effet fixe, car :
</div>
<div>
Relisez au besoin la <a href="#sec-0912">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-0912</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Un effet aléatoire n’est pas propre aux individus (unités d’observations), mais provient de facteurs externes.</label>
</td>
<td>
<input type="checkbox" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>Un effet aléatoire induit une forme de hiérarchie, de regroupement d’individus dans des groupes au sein desquels les observations ont plus tendance à se ressembler.</label>
</td>
<td>
<input type="checkbox" name="q3" value="2">
</td>
</tr>
<tr>
<td>
<label>Un effet aléatoire provient d’une autre population que les unités d’observations et peut donc être également échantillonné.</label>
</td>
<td>
<input type="checkbox" name="q3" value="3">
</td>
</tr>
<tr>
<td>
<label>Un effet aléatoire implique un partage de l’information dans son estimation. Comparativement à un effet fixe, la conséquence est notamment la réduction des tailles d’effet (shrinkage).</label>
</td>
<td>
<input type="checkbox" name="q3" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels sont les principaux types d’effets que nous pouvons modéliser avec des effets aléatoires?
</div>
<div>
Relisez au besoin la <a href="#sec-092">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-092</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Des constantes aléatoires, suggérant des écarts absolus entre les groupes</label>
</td>
<td>
<input type="checkbox" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>Des pentes aléatoires, suggérant des écarts en termes d’effets pour certains prédicteurs en fonction des groupes</label>
</td>
<td>
<input type="checkbox" name="q4" value="2">
</td>
</tr>
<tr>
<td>
<label>Des pentes et des constantes aléatoires</label>
</td>
<td>
<input type="checkbox" name="q4" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quels indicateurs peuvent être utilisés pour analyser la part de la variance / déviance expliquée aux différents niveaux d’un GLMM?
</div>
<div>
Relisez au besoin la <a href="#sec-09223">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-09223</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>L’ICC, soit le coefficient de corrélation intraclasse</label>
</td>
<td>
<input type="checkbox" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>Le BIC, soit le critère d’information bayésien</label>
</td>
<td>
<input type="checkbox" name="q5" value="2">
</td>
</tr>
<tr>
<td>
<label>L’AIC</label>
</td>
<td>
<input type="checkbox" name="q5" value="3">
</td>
</tr>
<tr>
<td>
<label>La déviance expliquée</label>
</td>
<td>
<input type="checkbox" name="q5" value="4">
</td>
</tr>
<tr>
<td>
<label>Les R2 marginal et conditionnel</label>
</td>
<td>
<input type="checkbox" name="q5" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Toutes les variables catégorielles devraient être incluses dans un modèle comme des effets aléatoires.
</div>
<div>
Relisez au besoin la <a href="#sec-0912">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-0912</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q6" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Lors de l’estimation d’un effet aléatoire, le modèle estime exactement :
</div>
<div>
Relisez au besoin la <a href="#sec-0921">section&nbsp;<span class="quarto-unresolved-ref ref-noprefix">sec-0921</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>k + 1 paramètres, soit le nombre de catégories plus un paramètre pour la variance de l’effet aléatoire en question</label>
</td>
<td>
<input type="checkbox" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>un seul paramètre, la variance de la distribution normale associée à l’effet aléatoire en question</label>
</td>
<td>
<input type="checkbox" name="q7" value="2">
</td>
</tr>
<tr>
<td>
<label>k paramètres, soit le nombre de catégories pour l’effet aléatoire en question</label>
</td>
<td>
<input type="checkbox" name="q7" value="3">
</td>
</tr>
<tr>
<td>
<label>k - 1 paramètres, soit le nombre de catégories moins un pour la catégorie de référence</label>
</td>
<td>
<input type="checkbox" name="q7" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_glmm);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-aly2014reliability" class="csl-entry" role="listitem">
Aly, Sharif S, Jianyang Zhao, Ben Li et Jiming Jiang. 2014. <span>«&nbsp;Reliability of environmental sampling culture results using the negative binomial intraclass correlation coefficient.&nbsp;»</span> <em>SpringerPlus</em> 3 (1): 40. <a href="https://doi.org/10.1186/2193-1801-3-40">https://doi.org/10.1186/2193-1801-3-40</a>.
</div>
<div id="ref-bolker2009generalized" class="csl-entry" role="listitem">
Bolker, Benjamin M, Mollie E Brooks, Connie J Clark, Shane W Geange, John R Poulsen, M Henry H Stevens et Jada-Simone S White. 2009. <span>«&nbsp;Generalized linear mixed models: a practical guide for ecology and evolution.&nbsp;»</span> <em>Trends in ecology &amp; evolution</em> 24 (3): 127‑135. <a href="https://doi.org/10.1016/j.tree.2008.10.008">https://doi.org/10.1016/j.tree.2008.10.008</a>.
</div>
<div id="ref-burdenski2000evaluating" class="csl-entry" role="listitem">
Burdenski, Jr Thomas K. 2000. <span>«&nbsp;Evaluating univariate, bivariate, and multivariate normality using graphical procedures.&nbsp;»</span> <em>ERIC</em>: 1‑62.
</div>
<div id="ref-gelman2005analysis" class="csl-entry" role="listitem">
Gelman, Andrew. 2005. <span>«&nbsp;Analysis of variance—why it is more important than ever.&nbsp;»</span> <em>The annals of statistics</em> 33 (1): 1‑53. <a href="https://doi.org/10.1214/009053604000001048">https://doi.org/10.1214/009053604000001048</a>.
</div>
<div id="ref-gelman2006data" class="csl-entry" role="listitem">
Gelman, Andrew et Jennifer Hill. 2006. <em>Data analysis using regression and multilevel/hierarchical models</em>. Cambridge university press.
</div>
<div id="ref-mcelreath2020statistical" class="csl-entry" role="listitem">
McElreath, Richard. 2020. <em>Statistical rethinking: A Bayesian course with examples in R and Stan</em>. CRC press.
</div>
<div id="ref-NakagawaICC" class="csl-entry" role="listitem">
Nakagawa, Shinichi, Paul C. D. Johnson et Holger Schielzeth. 2017. <span>«&nbsp;The coefficient of determination R2 and intra-class correlation coefficient from generalized linear mixed-effects models revisited and expanded.&nbsp;»</span> <em>Journal of The Royal Society Interface</em> 14 (134): 20170213. <a href="https://doi.org/10.1098/rsif.2017.0213">https://doi.org/10.1098/rsif.2017.0213</a>.
</div>
<div id="ref-stryhn2006interpretation" class="csl-entry" role="listitem">
Stryhn, H, J Sanchez, P Morley, C Booker et IR Dohoo. 2006. <span>«&nbsp;Interpretation of variance parameters in multilevel Poisson regression models.&nbsp;»</span> In <em>Proceedings of the 11th International Symposium on Veterinary Epidemiology and Economics</em>. Vol. 702. s.n.
</div>
<div id="ref-wu2012comparison" class="csl-entry" role="listitem">
Wu, Sheng, Catherine M Crespi et Weng Kee Wong. 2012. <span>«&nbsp;Comparison of methods for estimating the intraclass correlation coefficient for binary responses in cancer prevention cluster randomized trials.&nbsp;»</span> <em>Contemporary clinical trials</em> 33 (5): 869‑880. <a href="https://doi.org/10.1016/j.cct.2012.05.004">https://doi.org/10.1016/j.cct.2012.05.004</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./08-GLM.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-Multiniveau.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Régressions multiniveaux</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes quantitatives en sciences sociales : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>