<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes quantitatives en sciences sociales : un grand bol d’R - 8&nbsp; Régressions linéaires généralisées (GLM)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-GLMM.html" rel="next">
<link href="./07-regressionlineaire.html" rel="prev">
<link href="./images/introduction/Couverture.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-GLM.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes quantitatives en sciences sociales : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesQuantitatives" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Découverte de R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-priseenmainR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Prise en main de R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Analyses univariées et représentations graphiques</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-univarie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistiques descriptives univariées</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-magiedesgraphiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Magie des graphiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Analyses bivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-bivarieeQuantiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relation linéaire entre deux variables quantitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-bivarieeQualiQuali.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Relation entre deux variables qualitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-bivarieeQualiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Relation entre une variable qualitative et une variable quantitative</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Modèles de régression</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-regressionlineaire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Régression linéaire multiple</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-GLM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-GLMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Multiniveau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Régressions multiniveaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-GAM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modèles généralisés additifs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Analyses exploratoires multivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-AnalysesFactorielles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Méthodes factorielles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-MethodeClassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Annexes et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Annexes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Annexes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-081" id="toc-sec-081" class="nav-link active" data-scroll-target="#sec-081"><span class="header-section-number">8.1</span> Qu’est qu’un modèle GLM?</a>
  <ul class="collapse">
<li><a href="#sec-0811" id="toc-sec-0811" class="nav-link" data-scroll-target="#sec-0811"><span class="header-section-number">8.1.1</span> Formulation d’un GLM</a></li>
  <li><a href="#sec-0812" id="toc-sec-0812" class="nav-link" data-scroll-target="#sec-0812"><span class="header-section-number">8.1.2</span> Autres distributions et rôle de la fonction de lien</a></li>
  <li><a href="#sec-0813" id="toc-sec-0813" class="nav-link" data-scroll-target="#sec-0813"><span class="header-section-number">8.1.3</span> Conditions d’application</a></li>
  <li><a href="#sec-0814" id="toc-sec-0814" class="nav-link" data-scroll-target="#sec-0814"><span class="header-section-number">8.1.4</span> Résidus et déviance</a></li>
  <li><a href="#sec-0815" id="toc-sec-0815" class="nav-link" data-scroll-target="#sec-0815"><span class="header-section-number">8.1.5</span> Vérification l’ajustement</a></li>
  <li><a href="#sec-0816" id="toc-sec-0816" class="nav-link" data-scroll-target="#sec-0816"><span class="header-section-number">8.1.6</span> Comparaison de deux modèles GLM</a></li>
  </ul>
</li>
  <li>
<a href="#sec-082" id="toc-sec-082" class="nav-link" data-scroll-target="#sec-082"><span class="header-section-number">8.2</span> Modèles GLM pour des variables qualitatives</a>
  <ul class="collapse">
<li><a href="#sec-0821" id="toc-sec-0821" class="nav-link" data-scroll-target="#sec-0821"><span class="header-section-number">8.2.1</span> Modèle logistique binomial</a></li>
  <li><a href="#sec-0822" id="toc-sec-0822" class="nav-link" data-scroll-target="#sec-0822"><span class="header-section-number">8.2.2</span> Modèle probit binomial</a></li>
  <li><a href="#sec-0823" id="toc-sec-0823" class="nav-link" data-scroll-target="#sec-0823"><span class="header-section-number">8.2.3</span> Modèle logistique des cotes proportionnelles</a></li>
  <li><a href="#sec-0824" id="toc-sec-0824" class="nav-link" data-scroll-target="#sec-0824"><span class="header-section-number">8.2.4</span> Modèle logistique multinomial</a></li>
  <li><a href="#conclusion-sur-les-mod%C3%A8les-pour-des-variables-qualitatives" id="toc-conclusion-sur-les-modèles-pour-des-variables-qualitatives" class="nav-link" data-scroll-target="#conclusion-sur-les-mod%C3%A8les-pour-des-variables-qualitatives"><span class="header-section-number">8.2.5</span> Conclusion sur les modèles pour des variables qualitatives</a></li>
  </ul>
</li>
  <li>
<a href="#sec-083" id="toc-sec-083" class="nav-link" data-scroll-target="#sec-083"><span class="header-section-number">8.3</span> Modèles GLM pour des variables de comptage</a>
  <ul class="collapse">
<li><a href="#sec-0831" id="toc-sec-0831" class="nav-link" data-scroll-target="#sec-0831"><span class="header-section-number">8.3.1</span> Modèle de Poisson</a></li>
  <li><a href="#sec-0832" id="toc-sec-0832" class="nav-link" data-scroll-target="#sec-0832"><span class="header-section-number">8.3.2</span> Modèle binomial négatif</a></li>
  <li><a href="#sec-0833" id="toc-sec-0833" class="nav-link" data-scroll-target="#sec-0833"><span class="header-section-number">8.3.3</span> Modèle de Poisson avec excès fixe de zéros</a></li>
  <li><a href="#sec-0834" id="toc-sec-0834" class="nav-link" data-scroll-target="#sec-0834"><span class="header-section-number">8.3.4</span> Modèle de Poisson avec excès ajusté de zéros</a></li>
  <li><a href="#sec-0835" id="toc-sec-0835" class="nav-link" data-scroll-target="#sec-0835"><span class="header-section-number">8.3.5</span> Conclusion sur les modèles destinés à des variables de comptage</a></li>
  </ul>
</li>
  <li>
<a href="#sec-084" id="toc-sec-084" class="nav-link" data-scroll-target="#sec-084"><span class="header-section-number">8.4</span> Modèles GLM pour des variables continues</a>
  <ul class="collapse">
<li><a href="#sec-0841" id="toc-sec-0841" class="nav-link" data-scroll-target="#sec-0841"><span class="header-section-number">8.4.1</span> Modèle GLM gaussien</a></li>
  <li><a href="#sec-0842" id="toc-sec-0842" class="nav-link" data-scroll-target="#sec-0842"><span class="header-section-number">8.4.2</span> Modèle GLM avec une distribution de Student</a></li>
  <li><a href="#sec-0843" id="toc-sec-0843" class="nav-link" data-scroll-target="#sec-0843"><span class="header-section-number">8.4.3</span> Modèle GLM avec distribution Gamma</a></li>
  <li><a href="#sec-0844" id="toc-sec-0844" class="nav-link" data-scroll-target="#sec-0844"><span class="header-section-number">8.4.4</span> Modèle GLM avec une distribution bêta</a></li>
  </ul>
</li>
  <li><a href="#sec-085" id="toc-sec-085" class="nav-link" data-scroll-target="#sec-085"><span class="header-section-number">8.5</span> Conclusion sur les modèles linéaires généralisés</a></li>
  <li><a href="#sec-086" id="toc-sec-086" class="nav-link" data-scroll-target="#sec-086"><span class="header-section-number">8.6</span> Quiz de révision du chapitre</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesQuantitatives/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap08" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Dans ce chapitre, nous présentons les modèles linéaires généralisés plus communément appelés GLM (<em>generalized linear models</em> en anglais). Il s’agit d’une extension directe du modèle de régression linéaire multiple (LM) basé sur la méthode des moindres carrés ordinaires, décrite dans le chapitre précédent. Pour aborder cette section sereinement, il est important d’avoir bien compris le concept de distribution présenté dans la <a href="02-univarie.html#sec-024">section&nbsp;<span>2.4</span></a>. À la fin de cette section, vous serez en mesure de&nbsp;:</p>
<ul>
<li>Comprendre la distinction entre un modèle LM classique et un GLM.</li>
<li>Identifier les composantes d’un GLM.</li>
<li>Interpréter les résultats d’un GLM.</li>
<li>Effectuer les diagnostics d’un GLM.</li>
</ul>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<p>Dans ce chapitre, nous utilisons principalement les <em>packages</em> suivants&nbsp;:</p>
<ul>
<li>Pour créer des graphiques&nbsp;:
<ul>
<li>
<code>ggplot2</code>, le seul, l’unique!</li>
<li>
<code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
</ul>
</li>
<li>Pour ajuster des modèles GLM&nbsp;:
<ul>
<li>
<code>VGAM</code> et <code>gamlss</code> offrent tous les deux un très large choix de distributions et de fonctions de diagnostic, mais nécessitent souvent un peu plus de code.</li>
<li>
<code>mgcv</code> offre moins de distributions que les deux précédents, mais est plus simple d’utilisation.</li>
</ul>
</li>
<li>Pour analyser des modèles GLM&nbsp;:</li>
<li>
<code>car</code> essentiellement pour la fonction <code>vif</code>.</li>
<li>
<code>DHARMa</code> pour le diagnostic des résidus simulés.</li>
<li>
<code>ROCR</code> et <code>caret</code> pour l’analyse de la qualité d’ajustement de modèles pour des variables qualitatives.</li>
<li>
<code>AER</code> pour des tests de sur-dispersion.</li>
<li>
<code>fitdistrplus</code> pour ajuster des distributions à des données.</li>
<li>
<code>LaplacesDemon</code> pour manipuler certaines distributions.</li>
<li>
<code>sandwich</code> pour générer des erreurs standards robustes pour le modèle GLM logistique binomial.</li>
</ul>
</div>
</div>
<section id="sec-081" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="sec-081">
<span class="header-section-number">8.1</span> Qu’est qu’un modèle GLM?</h2>
<p>Nous avons vu qu’une régression linéaire multiple (LM) ne peut être appliquée que si la variable dépendante analysée est continue et si elle est normalement distribuée, une fois les variables indépendantes contrôlées. Il s’agit d’une limite très importante puisqu’elle ne peut être utilisée pour modéliser et prédire des variables binaires, multinomiales, de comptage, ordinales ou plus simplement des données anormalement distribuées. Une seconde limite importante des LM est que l’influence des variables indépendantes sur la variable dépendante ne peut être que linéaire. L’augmentation d’une unité de <em>X</em> conduit à une augmentation (ou diminution) de <span class="math inline">\(\beta\)</span> (coefficient de régression) unités de <em>Y</em>, ce qui n’est pas toujours représentatif des phénomènes étudiés. Afin de dépasser ces contraintes, <span class="citation" data-cites="GLMnelder">Nelder et Wedderburn (<a href="references.html#ref-GLMnelder" role="doc-biblioref">1972</a>)</span> ont proposé une extension des modèles LM, soit les modèles linéaires généralisés (GLM).</p>
<section id="sec-0811" class="level3" data-number="8.1.1"><h3 data-number="8.1.1" class="anchored" data-anchor-id="sec-0811">
<span class="header-section-number">8.1.1</span> Formulation d’un GLM</h3>
<p>Puisqu’un modèle GLM est une extension des modèles LM, il est possible de traduire un modèle LM sous forme d’un GLM. Nous utilisons ce point de départ pour détailler la morphologie d’un GLM. Nous avons vu dans la section précédente qu’un modèle LM est formulé de la façon suivante (notation matricielle)&nbsp;:</p>
<p><span id="eq-regmultiple5B"><span class="math display">\[
Y = \beta_0 + X\beta + \epsilon
\tag{8.1}\]</span></span></p>
<p>Avec <span class="math inline">\(\beta_0\)</span> la constante (<em>intercept</em> en anglais) et <span class="math inline">\(\beta\)</span> un vecteur de coefficients de régression pour les <em>k</em> variables indépendantes (<em>X</em>).</p>
<p>D’après cette formule, nous modélisons la variable <em>Y</em> avec une équation de régression linéaire et un terme d’erreur que nous estimons être normalement distribué. Nous pouvons reformuler ce simple LM sous forme d’un GLM avec l’écriture suivante&nbsp;:</p>
<p><span id="eq-glm1"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta X\\
&amp;g(x) = x
\end{aligned}
\tag{8.2}\]</span></span></p>
<p>Pas de panique! Cette écriture se lit comme suit&nbsp;: la variable <em>Y</em> est issue d’une distribution normale <span class="math inline">\((Y \sim Normal)\)</span> avec deux paramètres&nbsp;: <span class="math inline">\(\mu\)</span> (sa moyenne) et <span class="math inline">\(\sigma\)</span> (son écart-type). <span class="math inline">\(\mu\)</span> varie en fonction d’une équation de régression linéaire (<span class="math inline">\(\beta_0 + \beta X\)</span>) transformée par une fonction de lien <em>g</em> (détaillée plus loin). Dans ce cas précis, la fonction de lien est appelée fonction identitaire puisqu’elle n’applique aucune transformation (<span class="math inline">\(g(x) = x\)</span>). Notez ici que le second paramètre de la distribution normale <span class="math inline">\(\sigma\)</span> (paramètre de dispersion) a une valeur fixe et ne dépend donc pas des variables indépendantes à la différence de <span class="math inline">\(\mu\)</span>. Dans ce modèle spécifiquement, les paramètres à estimer sont <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span>. Notez que dans la notation traditionnelle, la fonction de lien est appliquée au paramètre modélisé. Il est possible de renverser cette notation en utilisant la réciproque (<span class="math inline">\(g'\)</span>) de la fonction de lien (<span class="math inline">\(g\)</span>)&nbsp;:</p>
<p><span id="eq-glm2"><span class="math display">\[
g(\mu) = \beta_0 + \beta X \Longleftrightarrow \mu = g'(\beta_0 + \beta X)
\text{ si : }g'(g(x)) = x
\tag{8.3}\]</span></span></p>
<p>Dans un modèle GLM, la distribution attendue de la variable <em>Y</em> est déclarée de façon explicite ainsi que la façon dont nos variables indépendantes conditionnent cette distribution. Ici, c’est la moyenne (<span class="math inline">\(\mu\)</span>) de la distribution qui est modélisée, nous nous intéressons ainsi au changement moyen de <em>Y</em> provoqué par les variables <em>X</em>.</p>
<p>Avec cet exemple, nous voyons les deux composantes supplémentaires d’un modèle GLM&nbsp;:</p>
<ul>
<li><p>La distribution supposée de la variable <em>Y</em> conditionnée par les variables <em>X</em> (ici, la distribution normale).</p></li>
<li><p>Une fonction de lien associant l’équation de régression formée par les variables indépendantes et un paramètre de la distribution retenue (ici, la fonction identitaire et le paramètre <span class="math inline">\(\mu\)</span>).</p></li>
</ul>
<p>Notez également que l’estimation des paramètres d’un modèle GLM (ici, <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta X\)</span> et <span class="math inline">\(\sigma\)</span>) ne se fait plus avec la méthode des moindres carrés ordinaires utilisée pour les modèles LM. À la place, la méthode par maximum de vraisemblance (<em>maximum likelihood</em>) est la plus souvent utilisée, mais certains <em>packages</em> utilisent également la méthode des moments (<em>method of moments</em>). Ces deux méthodes nécessitent des échantillons plus grands que la méthode des moindres carrés. Dans le cas spécifique d’un modèle GLM utilisant une distribution normale, la méthode des moindres carrés et la méthode par maximum de vraisemblance produisent les mêmes résultats.</p>
</section><section id="sec-0812" class="level3" data-number="8.1.2"><h3 data-number="8.1.2" class="anchored" data-anchor-id="sec-0812">
<span class="header-section-number">8.1.2</span> Autres distributions et rôle de la fonction de lien</h3>
<p>À première vue, il est possible de se demander pourquoi ajouter ces deux éléments puisqu’ils ne font que complexifier le modèle. Pour mieux saisir la pertinence des GLM, prenons un exemple appliqué au cas d’une variable binaire. Admettons que nous souhaitons modéliser / prédire la probabilité qu’une personne à vélo décède lors d’une collision avec un véhicule motorisé. Notre variable dépendante est donc binaire (0 = survie, 1 = décès) et nous souhaitons la prédire avec trois variables continues que sont&nbsp;: la vitesse de déplacement du ou de la cycliste (<span class="math inline">\(x_1\)</span>), la vitesse de déplacement du véhicule (<span class="math inline">\(x_2\)</span>) et la masse du véhicule (<span class="math inline">\(x_3\)</span>). Puisque la variable <em>Y</em> n’est pas continue, il serait absurde de supposer qu’elle est issue d’une distribution normale. Il serait plus logique de penser qu’elle provient d’une distribution de Bernoulli (pour rappel, une distribution de Bernoulli permet de modéliser un phénomène ayant deux issues possibles comme un lancer de pièce de monnaie (<a href="02-univarie.html#sec-024">section&nbsp;<span>2.4</span></a>). Plus spécifiquement, nous pourrions formuler l’hypothèse que nos trois variables <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span> et <span class="math inline">\(x_3\)</span> influencent le paramètre <em>p</em> (la probabilité d’occurrence de l’évènement) d’une distribution de Bernoulli. À partir de ces premières hypothèses, nous pouvons écrire le modèle suivant&nbsp;:</p>
<p><span id="eq-glm3"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Bernoulli(p)\\
&amp;g(p) = \beta_0 + \beta X\\
&amp;g(x) = x
\end{aligned}
\tag{8.4}\]</span></span></p>
<p>Toutefois, le résultat n’est pas entièrement satisfaisant. En effet, <em>p</em> est une probabilité et, par nature, ce paramètre doit être compris entre 0 et 1 (entre 0 et 100&nbsp;% de «&nbsp;chances de décès&nbsp;», ni plus ni moins). L’équation de régression que nous utilisons actuellement peut produire des résultats compris entre <span class="math inline">\(-\infty\)</span> et <span class="math inline">\(+\infty\)</span> pour <em>p</em> puisque rien ne contraint la somme <span class="math inline">\(\beta_0+ \beta_1x_1+\beta_2x_2+ \beta_3x_3\)</span> à être comprise entre 0 et 1. Il est possible de visualiser le problème soulevé par cette situation avec les figures suivantes. Admettons que nous avons observé une variable <em>Y</em> binaire et que nous savons qu’elle est influencée par une variable <em>X</em> qui, plus elle augmente, plus les chances que <em>Y</em> soit 1 augmentent (<a href="#fig-linearbinom">figure&nbsp;<span>8.1</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-linearbinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-linearbinom-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.1: Exemple de données issues d’une distribution de Bernoulli</figcaption></figure>
</div>
</div>
</div>
<p>Si nous utilisons l’équation de régression actuelle, cela revient à trouver la droite la mieux ajustée passant dans ce nuage de points (<a href="#fig-linearbinom2">figure&nbsp;<span>8.2</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-linearbinom2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-linearbinom2-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.2: Ajustement d’une droite de régression aux données issues d’une distribution de Bernoulli</figcaption></figure>
</div>
</div>
</div>
<p>Ce modèle semble bien cerner l’influence positive de <em>X</em> sur <em>Y</em>, mais la droite est au final très éloignée de chaque point, indiquant un faible ajustement du modèle. De plus, la droite prédit des probabilités négatives lorsque <em>X</em> est inférieur à −2,5 et des probabilités supérieures à 1 quand <em>X</em> est supérieur à 1. Elle est donc loin de bien représenter les données.</p>
<p>C’est ici qu’intervient la fonction de lien. La fonction identitaire que nous avons utilisée jusqu’ici n’est pas satisfaisante, nous devons la remplacer par une fonction qui conditionnera la somme <span class="math inline">\(\beta_0+ \beta_1x_1+\beta_2x_2+ \beta_3x_3\)</span> pour donner un résultat entre 0 et 1. Une candidate toute désignée est la fonction <em>sigmoidale</em>, plus souvent appelée la fonction <em>logistique</em>!</p>
<p><span id="eq-glm4"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Bernoulli(p)\\
&amp;S(p) = \beta_0 + \beta X\\
&amp;S(x) = \frac{e^{x}}{e^x+1}
\end{aligned}
\tag{8.5}\]</span></span></p>
<p>La fonction logistique prend la forme d’un <em>S</em>. Plus la valeur entrée dans la fonction est grande, plus le résultat produit par la fonction est proche de 1 et inversement. Si nous reprenons l’exemple précédent, nous obtenons le modèle illustré à la <a href="#fig-linearbinom3">figure&nbsp;<span>8.3</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-linearbinom3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-linearbinom3-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.3: Utilisation de la fonction de lien logistique</figcaption></figure>
</div>
</div>
</div>
<p>Une fois cette fonction insérée dans le modèle, nous constatons qu’une augmentation de la somme <span class="math inline">\(\beta_0+ \beta_1x_1+\beta_2x_2+ \beta_3x_3\)</span> conduit à une augmentation de la probabilité <em>p</em> et inversement, et que cet effet est non linéaire. Nous avons donc maintenant un GLM permettant de prédire la probabilité d’un décès lors d’un accident en combinant une distribution et une fonction de lien adéquates.</p>
</section><section id="sec-0813" class="level3" data-number="8.1.3"><h3 data-number="8.1.3" class="anchored" data-anchor-id="sec-0813">
<span class="header-section-number">8.1.3</span> Conditions d’application</h3>
<p>La famille des GLM englobe de (très) nombreux modèles du fait de la diversité de distributions existantes et des fonctions de liens utilisables. Cependant, certaines combinaisons sont plus souvent utilisées que d’autres. Nous présentons donc dans les prochaines sections les modèles GLM les plus communs. Les conditions d’application varient d’un modèle à l’autre, il existe cependant quelques conditions d’application communes à tous ces modèles&nbsp;:</p>
<ul>
<li><p>l’indépendance des observations (et donc des erreurs);</p></li>
<li><p>l’absence de valeurs aberrantes / fortement influentes;</p></li>
<li><p>l’absence de multicolinéarité excessive entre les variables indépendantes.</p></li>
</ul>
<p>Ces trois conditions sont également valables pour les modèles LM tel qu’abordé dans le <a href="07-regressionlineaire.html">chapitre&nbsp;<span>7</span></a>. La distance de <em>Cook</em> peut ainsi être utilisée pour détecter les potentielles valeurs aberrantes et le facteur d’inflation de la variance (<em>VIF</em>) pour détecter la multicolinéarité. Les conditions d’application particulières sont détaillées dans les sections dédiées à chaque modèle.</p>
</section><section id="sec-0814" class="level3" data-number="8.1.4"><h3 data-number="8.1.4" class="anchored" data-anchor-id="sec-0814">
<span class="header-section-number">8.1.4</span> Résidus et déviance</h3>
<p>Dans la section sur la régression linéaire simple, nous avons présenté la notion de résidu, soit l’écart entre la valeur observée (réelle) de <em>Y</em> et la valeur prédite par le modèle. Pour un modèle GLM, ces résidus traditionnels (aussi appelés résidus naturels) ne sont pas très informatifs si la variable à modéliser est binaire, multinomiale ou même de comptage. Lorsque l’on travaille avec des GLM, nous préférons utiliser trois autres formes de résidus, soit les résidus de Pearson, les résidus de déviance et les résidus simulés.</p>
<p><strong>Les résidus de Pearson</strong> sont une forme ajustée des résidus classiques, obtenus par la division des résidus naturels par la racine carrée de la variance modélisée. Leur formule varie donc d’un modèle à l’autre puisque l’expression de la variance change en fonction de la distribution du modèle. Pour un modèle GLM gaussien, elle s’écrit&nbsp;:</p>
<p><span id="eq-glm5"><span class="math display">\[
r_i = \frac{y_i - \mu_i}{\sigma}
\tag{8.6}\]</span></span></p>
<p>Pour un modèle GLM de Bernoulli, elle s’écrit&nbsp;:</p>
<p><span id="eq-glm6"><span class="math display">\[
r_i = \frac{y_i - p_i}{\sqrt{p_i(1-p_i)}}
\tag{8.7}\]</span></span></p>
<p>avec <span class="math inline">\(\mu_i\)</span> et <span class="math inline">\(p_i\)</span> les prédictions du modèle pour l’observation <em>i</em>.</p>
<p><strong>Les résidus de déviance</strong> sont basés sur le concept de <em>likelihood</em> présenté dans la <a href="02-univarie.html#sec-02adjdistrib">section&nbsp;<span>2.5.4.2</span></a>. Pour rappel, le <em>likelihood</em>, ou la vraisemblance d’un modèle, correspond à la probabilité conjointe d’avoir observé les données <em>Y</em> selon le modèle étudié. Pour des raisons mathématiques (voir <a href="02-univarie.html#sec-02adjdistrib">section&nbsp;<span>2.5.4.2</span></a>), le <em>log likelihood</em> est plus souvent calculé. Plus cette valeur est forte, moins le modèle se trompe. Cette interprétation est donc inverse à celle des résidus classiques, c’est pourquoi le <em>log likelihood</em> est généralement multiplié par −2 pour retrouver une interprétation intuitive. Ainsi, pour chaque observation <em>i</em>, nous pouvons calculer&nbsp;:</p>
<p><span id="eq-glm7"><span class="math display">\[
d_i = \mbox{-2} \times log(P(y_i|M_e))
\tag{8.8}\]</span></span></p>
<p>avec <span class="math inline">\(d_i\)</span> le résidu de déviance et <span class="math inline">\(P(y_i|M_e)\)</span> la probabilité d’avoir observé la valeur <span class="math inline">\(y_i\)</span> selon le modèle étudié (<span class="math inline">\(M_e\)</span>).</p>
<p>La somme de tous ces résidus est appelée la déviance totale du modèle.</p>
<p><span id="eq-glm8"><span class="math display">\[
D(M_e) = \sum_{i=1}^n \mbox{-2} \times log(P(y_i|M_e))
\tag{8.9}\]</span></span></p>
<p>Il s’agit donc d’une quantité représentant à quel point le modèle est erroné vis-à-vis des données. Notez qu’en tant que telle, la déviance n’a pas d’interprétation directe en revanche, elle est utilisée pour calculer des mesures d’ajustement des modèles GLM.</p>
<p><strong>Les résidus simulés</strong> sont une avancée récente dans le monde des GLM, ils fournissent une définition et une interprétation harmonisée des résidus pour l’ensemble des modèles GLM. Dans la section sur les LM (<a href="07-regressionlineaire.html#sec-0722">section&nbsp;<span>7.2.2</span></a>), nous avons vu comment interpréter les graphiques des résidus pour détecter d’éventuels problèmes dans le modèle. Cependant, cette technique est bien plus compliquée à mettre en œuvre pour les GLM puisque la forme attendue des résidus varie en fonction de la distribution choisie pour modéliser <em>Y</em>. La façon la plus efficace de procéder est d’interpréter les graphiques des résidus simulés qui ont la particularité d’être <strong>identiquement distribués, quel que soit le modèle GLM construit</strong>. Ces résidus simulés sont compris entre 0 et 1 et sont calculés de la manière suivante&nbsp;:</p>
<ul>
<li><p>À partir du modèle GLM construit, simuler <em>S</em> fois (généralement 1&nbsp;000) une variable <em>Y’</em> avec autant d’observation (<em>n</em>) que <em>Y</em>. Cette variable simulée est une combinaison de la prédiction du modèle (coefficient et variables indépendantes) et de sa dispersion (variance). Ces simulations représentent des variations vraisemblables de la variable <em>Y</em> si le modèle est correctement spécifié. En d’autres termes, si le modèle représente bien le phénomène à l’origine de la variable <em>Y</em>, alors les simulations <em>Y’</em> issues du modèle devraient être proches de la variable <em>Y</em> originale. Pour une explication plus détaillée de ce que signifie simuler des données à partir d’un modèle, référez-vous au <em>bloc attention</em> intitulé <em>Distinction entre simulation et prédiction</em> dans la <a href="#sec-08152">section&nbsp;<span>8.1.5.2</span></a>.</p></li>
<li><p>Pour chaque observation, nous obtenons ainsi <em>S</em> valeurs formant une distribution <span class="math inline">\(Ds_i\)</span>, soit les valeurs simulées par le modèle pour cette observation.</p></li>
<li><p>Pour chacune de ces distributions, nous calculons la probabilité cumulative d’observer la vraie valeur <span class="math inline">\(Y_i\)</span> d’après la distribution <span class="math inline">\(Ds_i\)</span>. Cette valeur est comprise entre 0 (toutes les valeurs simulées sont plus grandes que <span class="math inline">\(Y_i\)</span>) et 1 (toutes les valeurs simulées sont inférieures à <span class="math inline">\(Y_i\)</span>).</p></li>
</ul>
<p>Si le modèle est correctement spécifié, le résultat attendu est que la distribution de ces résidus est uniforme. En effet, il y a autant de chances que les simulations produisent des résultats supérieurs ou inférieurs à <span class="math inline">\(Y_i\)</span> si le modèle représente bien le phénomène <span class="citation" data-cites="RandomizedResid gelman2006data">(<a href="references.html#ref-RandomizedResid" role="doc-biblioref">Dunn et Smyth 1996</a>; <a href="references.html#ref-gelman2006data" role="doc-biblioref">Gelman et Hill 2006</a>)</span>. Si la distribution des résidus ne suit pas une loi uniforme, cela signifie que le modèle échoue à reproduire le phénomène à l’origine de <em>Y</em>, ce qui doit nous alerter sur sa pertinence.</p>
</section><section id="sec-0815" class="level3" data-number="8.1.5"><h3 data-number="8.1.5" class="anchored" data-anchor-id="sec-0815">
<span class="header-section-number">8.1.5</span> Vérification l’ajustement</h3>
<p>Il existe trois façons de vérifier l’ajustement d’un modèle GLM&nbsp;:</p>
<ul>
<li>utiliser des mesures d’ajustement (AIC, pseudo-R<sup>2</sup>, déviance expliquée, etc.);</li>
<li>comparer les distributions de la variable originale et celle des prédictions;</li>
<li>comparer les prédictions du modèle avec les valeurs originales.</li>
</ul>
<p>Notez d’emblée que vérifier la qualité d’ajustement d’un modèle (ajustement aux données originales) ne revient pas à vérifier la validité d’un modèle (respect des conditions d’application). Cependant, ces deux éléments sont généralement liés, car un modèle mal ajusté a peu de chances d’être valide et inversement.</p>
<section id="sec-08151" class="level4" data-number="8.1.5.1"><h4 data-number="8.1.5.1" class="anchored" data-anchor-id="sec-08151">
<span class="header-section-number">8.1.5.1</span> Mesures d’ajustement</h4>
<p>Les mesures d’ajustement sont des indicateurs plus ou moins arbitraires dont le principal intérêt est de faciliter la comparaison entre plusieurs modèles similaires. Il est nécessaire de les reporter, car dans certains cas, ils peuvent indiquer que des modèles sont très mal ajustés.</p>
<section id="sec-081511" class="level5" data-number="8.1.5.1.1"><h5 data-number="8.1.5.1.1" class="anchored" data-anchor-id="sec-081511">
<span class="header-section-number">8.1.5.1.1</span> Déviance expliquée</h5>
<p>Rappelons que la déviance d’un modèle est une quantité représentant à quel point le modèle est erroné. L’objectif de l’indicateur de la déviance expliquée est d’estimer le pourcentage de la déviance maximale observable dans les données que le modèle est parvenu à expliquer. La déviance maximale observable dans les données est obtenue en utilisant la déviance totale du modèle nul (notée <span class="math inline">\(M_n\)</span>, soit un modèle dans lequel aucune variable indépendante n’est ajoutée et ne comportant qu’une constante). Cette déviance est maximale puisqu’aucune variable indépendante n’est présente dans le modèle. Nous calculons ensuite le pourcentage de cette déviance totale qui a été contrôlée par le modèle étudié (<span class="math inline">\(M_e\)</span>).</p>
<p><span id="eq-glm9"><span class="math display">\[
\mbox{déviance expliquée} = \frac{D(M_n) - D(M_e)}{D(M_n)} = 1- \frac{D(M_e)}{D(M_n)}
\tag{8.10}\]</span></span></p>
<p>Il s’agit donc d’un simple calcul de pourcentage entre la déviance maximale (<span class="math inline">\(D(M_n)\)</span>) et la déviance expliquée par le modèle étudié (<span class="math inline">\(D(M_n )-D(M_e)\)</span>). Cet indicateur est compris entre 0 et 1&nbsp;: plus il est petit, plus la capacité de prédiction du modèle est faible. Attention, cet indicateur ne tient pas compte de la complexité du modèle. Ajouter une variable indépendante supplémentaire ne fait qu’augmenter la déviance expliquée, ce qui ne signifie pas que la complexification du modèle soit justifiée (<strong>voir l’encadré sur le principe de parcimonie</strong>, <a href="07-regressionlineaire.html#sec-0732">section&nbsp;<span>7.3.2</span></a>).</p>
</section><section id="sec-081512" class="level5" data-number="8.1.5.1.2"><h5 data-number="8.1.5.1.2" class="anchored" data-anchor-id="sec-081512">
<span class="header-section-number">8.1.5.1.2</span> Pseudo-R<sup>2</sup>
</h5>
<p>Le R<sup>2</sup> est une mesure d’ajustement représentant la part de la variance expliquée dans un modèle linéaire classique. Cette mesure n’est pas directement transposable au cas des GLM puisqu’ils peuvent être appliqués à des variables non continues et anormalement distribuées. Toutefois, il existe des mesures semblables appelées pseudo-R<sup>2</sup>, remplissant un rôle similaire. Notez cependant qu’ils ne peuvent pas être interprétés comme le R<sup>2</sup> classique (d’une régression linéaire multiple)&nbsp;: <strong>ils ne représentent pas la part de la variance expliquée</strong>. Ils sont compris dans l’intervalle 0 et 1; plus leurs valeurs s’approchent de 1, plus le modèle est ajusté.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-pseudor2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.1: Principaux pseudos-<span class="math inline">\(R^2\)</span>
</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 28%">
<col style="width: 66%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Formule</th>
<th style="text-align: left;">Commentaire</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">McFadden</td>
<td style="text-align: left;"><span class="math inline">\(1-\frac{loglike(M_e)}{loglike(M_n)}\)</span></td>
<td style="text-align: left;">Le rapport des <em>loglikelihood</em>, très proche de la déviance expliquée.</td>
</tr>
<tr class="even">
<td style="text-align: left;">McFadden ajusté</td>
<td style="text-align: left;"><span class="math inline">\(1-\frac{loglike(M_e)-K}{loglike(M_n)}\)</span></td>
<td style="text-align: left;">Version ajustée du R<sup>2</sup> de McFadden tenant compte du nombre de paramètres (<em>k</em>) dans le modèle.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Efron</td>
<td style="text-align: left;"><span class="math inline">\(1-\frac{\sum_{i=1}^n(y_i-\hat{y}_i)^2}{\sum_{i=1}^n(y_i-\bar{y}_i)^2}\)</span></td>
<td style="text-align: left;">Rapport entre la somme des résidus classiques au carré (numérateur) et de la somme des écarts au carré à la moyenne (dénominateur). Notez que pour un GLM gaussien, ce pseudo-R<sup>2</sup> est identique au R<sup>2</sup> classique.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cox &amp; Snell</td>
<td style="text-align: left;"><span class="math inline">\(1-e^{-\frac{2}{n}({loglike(M_e) - loglike(M_n))}}\)</span></td>
<td style="text-align: left;">Transformation de la déviance afin de la mettre sur une échelle de 0 à 1 (mais ne pouvant atteindre exactement 1).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nagelkerke</td>
<td style="text-align: left;"><span class="math inline">\(\frac{1-e^{-\frac{2}{n}({loglike(M_e) - loglike(M_n))}}}{1-e^{\frac{2*loglike(M_n)}{n}}}\)</span></td>
<td style="text-align: left;">Ajustement du R<sup>2</sup> de Cox et Snell pour que l’échelle de valeurs possibles puisse comporter 1 (attention, car les valeurs de ce R<sup>2</sup> tendent à être toujours plus fortes que les autres).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>En dehors du pseudo-R<sup>2</sup> de McFadden ajusté, aucune de ces mesures ne tient compte de la complexité du modèle. Il est cependant important de les reporter, car des valeurs très faibles indiquent vraisemblablement un modèle avec une moindre capacité informative. À l’inverse, des valeurs trop fortes pourraient indiquer un problème de surajustement (<strong>voir encadré sur le principe de parcimonie</strong>, <a href="07-regressionlineaire.html#sec-0732">section&nbsp;<span>7.3.2</span></a>).</p>
</section><section id="sec-081513" class="level5" data-number="8.1.5.1.3"><h5 data-number="8.1.5.1.3" class="anchored" data-anchor-id="sec-081513">
<span class="header-section-number">8.1.5.1.3</span> Critère d’information d’Akaike (AIC)</h5>
<p>Probablement l’indicateur le plus répandu, sa formule est relativement simple, car il s’agit seulement d’un ajustement de la déviance&nbsp;:</p>
<p><span id="eq-glm10"><span class="math display">\[
AIC = D(M_e) + 2K
\tag{8.11}\]</span></span></p>
<p>avec <em>K</em> le nombre de paramètres à estimer dans le modèle (coefficients, paramètres de distribution, etc.).</p>
<p>L’AIC n’a pas d’interprétation directe, mais permet de comparer deux modèles imbriqués (<a href="07-regressionlineaire.html#sec-0732">section&nbsp;<span>7.3.2</span></a>). Plus l’AIC est petit, mieux le modèle est ajusté. L’idée derrière cet indicateur est relativement simple. Si la déviance <em>D</em> est grande, alors le modèle est mal ajusté. Ajouter des paramètres (des coefficients pour de nouvelles variables <em>X</em>, par exemple) ne peut que réduire <em>D</em>, mais cette réduction n’est pas forcément suffisamment grande pour justifier la complexification du modèle. L’AIC pondère donc <em>D</em> en lui ajoutant 2 fois le nombre de paramètres du modèle. Un modèle plus simple (avec moins de paramètres) parvenant à une même déviance est préférable à un modèle complexe (principe de parcimonie ou du rasoir d’Ockham), ce que permet de «&nbsp;quantifier&nbsp;» l’AIC. Attention, l’AIC <strong>ne peut pas être utilisé pour comparer des modèles non imbriqués</strong>. Notez que d’autres indicateurs similaires comme le WAIC, le BIC et le DIC sont utilisés dans un contexte d’inférence bayésienne. Retenez simplement que ces indicateurs sont conceptuellement proches du AIC et s’interprètent (à peu de choses près) de la même façon.</p>
</section></section><section id="sec-08152" class="level4" data-number="8.1.5.2"><h4 data-number="8.1.5.2" class="anchored" data-anchor-id="sec-08152">
<span class="header-section-number">8.1.5.2</span> Comparaison des distributions originales et prédites</h4>
<p>Une façon rapide de vérifier si un modèle est mal ajusté est de comparer la forme de la distribution originale et celle capturée par le modèle. L’idée est la suivante : si le modèle est bien ajusté aux données, il est possible de se servir de celui-ci pour générer de nouvelles données dont la distribution ressemble à celle des données originales. Si une différence importante est observable, alors les résultats du modèle ne sont pas fiables, car le modèle échoue à reproduire le phénomène étudié. Cette lecture graphique ne permet pas de s’assurer que le modèle est valide ou bien ajusté, mais simplement d’écarter rapidement les mauvais candidats. Notez que cette méthode ne s’applique pas lorsque la variable modélisée est binaire, multinomiale ou ordinale. Le graphique à réaliser comprend donc la distribution de la variable dépendante <em>Y</em> (représentée avec un histogramme ou un graphique de densité) et plusieurs distributions simulées à partir du modèle. Cette approche est plus répandue dans la statistique bayésienne, mais elle reste pertinente dans l’approche fréquentiste. Il est rare de reporter ces figures, mais elles doivent faire partie de votre diagnostic.</p>
<div class="bloc_attention">
<div class="bloc_attention-header">
<div class="bloc_attention-icon">

</div>
<p><strong>Distinction entre simulation et prédiction</strong></p>
</div>
<div class="bloc_attention-body">
<p>Notez ici que <strong>simuler des données</strong> à partir d’un modèle et <strong>effectuer des prédictions</strong> à partir d’un modèle sont deux opérations différentes. Prédire une valeur à partir d’un modèle revient simplement à appliquer son équation de régression à des données. Si nous réutilisons les mêmes données, la prédiction renvoie toujours le même résultat, il s’agit de la partie systématique (ou déterministe) du modèle. Pour illustrer cela, admettons que nous avons ajusté un modèle GLM de type gaussien (fonction de lien identitaire) avec trois variables continues <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span> et <span class="math inline">\(X_3\)</span> et des coefficients respectifs de 0,5, 1,2 et 1,8 ainsi qu’une constante de 7. Nous pouvons utiliser ces valeurs pour prédire la valeur attendue de <span class="math inline">\(Y\)</span> quand <span class="math inline">\(X_1= 3\)</span>, <span class="math inline">\(X_2= 5\)</span> et <span class="math inline">\(X_3 = 5\)</span>&nbsp;:</p>
<p><span class="math inline">\(\mbox{Prédiction} = \mbox{7 + 3}\times \mbox{0,5 + 5}\times \mbox{1,2 + 5}\times\mbox{1,8 = 23,5}\)</span></p>
<p>En revanche, simuler des données à partir d’un modèle revient à ajouter la dimension stochastique (aléatoire) du modèle. Puisque notre modèle GLM est gaussien, il comporte un paramètre <span class="math inline">\(\sigma\)</span> (son écart-type); admettons, pour cet exemple, qu’il est de 1,2. Ainsi, avec les données précédentes, il est possible de simuler un ensemble infini de valeurs dont la distribution est la suivante&nbsp;: <span class="math inline">\(Normal(\mu = \mbox{23,5, } \sigma = \mbox{1,2})\)</span>. 95&nbsp;% du temps, ces valeurs simulées se trouveront dans l’intervalle <span class="math inline">\(\mbox{[21,1-25,9]}\)</span> (<span class="math inline">\(\mu - 2\sigma \text{; } \mu + 2\sigma\)</span>), puisque cette distribution est normale. Les valeurs simulées dépendent donc de la distribution choisie pour le modèle et de l’ensemble des paramètres du modèle, pas seulement de l’équation de régression.</p>
<p>Si vous aviez à ne retenir qu’une seule phrase de ce bloc, retenez que la prédiction ne se réfère qu’à la partie systématique du modèle (équation de régression), alors que la simulation incorpore la partie stochastique (aléatoire) de la distribution du modèle. Deux prédictions effectuées sur des données identiques donnent nécessairement des résultats identiques, ce qui n’est pas le cas pour la simulation.</p>
</div>
</div>
</section><section id="sec-08153" class="level4" data-number="8.1.5.3"><h4 data-number="8.1.5.3" class="anchored" data-anchor-id="sec-08153">
<span class="header-section-number">8.1.5.3</span> Comparaison des prédictions du modèle avec les valeurs originales</h4>
<p>Les prédictions d’un modèle devraient être proches des valeurs réelles observées. Si ce n’est pas le cas, alors le modèle n’est pas fiable et ses paramètres ne sont pas informatifs. Dépendamment de la nature de la variable modélisée (quantitative ou qualitative), plusieurs approches peuvent être utilisées pour quantifier l’écart entre valeurs réelles et valeurs prédites.</p>
<section id="sec-081531" class="level5" data-number="8.1.5.3.1"><h5 data-number="8.1.5.3.1" class="anchored" data-anchor-id="sec-081531">
<span class="header-section-number">8.1.5.3.1</span> Pour une variable quantitative</h5>
<p>La mesure la plus couramment utilisée pour une variable quantitative est l’erreur moyenne quadratique (<em>Root Mean Square Error</em> – RMSE en anglais).</p>
<p><span id="eq-glm11"><span class="math display">\[
RMSE = \sqrt{\frac{\sum_{i=1}^n(y_i - \hat{y_i})^2}{n}}
\tag{8.12}\]</span></span></p>
<p>Il s’agit de la racine carrée de la moyenne des écarts au carré entre valeurs réelles et prédites. Le RMSE est exprimé dans la même unité que la donnée originale et nous donne une indication sur l’erreur moyenne de la prédiction du modèle. Admettons, par exemple, que nous modélisons les niveaux de bruit environnemental en ville en décibels et que notre modèle de régression ait un RMSE de 3,5. Cela signifierait qu’en moyenne notre modèle se trompe de 3,5 décibels (erreur pouvant être négative ou positive), ce qui serait énorme (3 décibels correspondent à une multiplication par deux de l’intensité sonore) et nous amènerait à reconsidérer la fiabilité du modèle. Notez que l’usage d’une moyenne quadratique plutôt qu’une moyenne arithmétique permet de donner plus d’influence aux larges erreurs et donc de pénaliser davantage des modèles faisant parfois de grosses erreurs de prédiction. Le RMSE est donc très sensible à la présence de valeurs aberrantes. À la place de la moyenne quadratique, il est possible d’utiliser la simple moyenne arithmétique des valeurs absolues des erreurs (MAE). Cette mesure est cependant moins souvent utilisée&nbsp;:</p>
<p><span id="eq-glm12"><span class="math display">\[
MAE = \frac{\sum_{i=1}^n|y_i - \hat{y_i|}}{n}
\tag{8.13}\]</span></span></p>
<p>Ces deux mesures peuvent être utilisées pour comparer la capacité de prédiction de deux modèles appliqués aux mêmes données, même s’ils ne sont pas imbriqués. Elles ne permettent cependant pas de prendre en compte la complexité du modèle. Un modèle plus complexe aura toujours des valeurs de RMSE et de MAE plus faibles.</p>
</section><section id="sec-081532" class="level5" data-number="8.1.5.3.2"><h5 data-number="8.1.5.3.2" class="anchored" data-anchor-id="sec-081532">
<span class="header-section-number">8.1.5.3.2</span> Pour une variable qualitative</h5>
<p>Lorsque l’on modélise une variable qualitative, une erreur revient à prédire la mauvaise catégorie pour une observation. Il est ainsi possible de compter, pour un modèle, le nombre de bonnes et de mauvaises prédictions et d’organiser cette information dans une <strong>matrice de confusion</strong>. Cette dernière prend la forme suivante pour un modèle binaire&nbsp;:</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-confusmat1" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.2: Exemple de matrice de confusion</caption>
<thead><tr class="header">
<th style="text-align: left;">Valeur prédite / Valeur réelle</th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">Total (%)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">18 (41,9)</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">25 (51,1)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total (%)</td>
<td style="text-align: right;">20 (46,6)</td>
<td style="text-align: right;">23 (53,5)</td>
<td style="text-align: right;">43 (81,4)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>En colonne du <a href="#tbl-confusmat1">tableau&nbsp;<span>8.2</span></a>, nous avons les catégories observées et en ligne, les catégories prédites. La diagonale représente les prédictions correctes. Dans le cas présent, le modèle a bien catégorisé 35 (15 + 20) observations sur 43, soit une précision totale de 81,4&nbsp;%; huit sont mal classifiées (18,6&nbsp;%); cinq avec la modalité A ont été catégorisées comme des B, soit 20&nbsp;% des A, et seules trois B ont été catégorisées comme des A (13&nbsp;%).</p>
<p>La matrice ci-dessus (<a href="#tbl-confusmat1">tableau&nbsp;<span>8.2</span></a>) ne comporte que deux catégories possibles puisque la variable <em>Y</em> modélisée est binaire. Il est facile d’étendre le concept de matrice de confusion au cas des variables avec plus de deux modalités (multinomiale). Le <a href="#tbl-confusmat2">tableau&nbsp;<span>8.3</span></a> est un exemple de matrice de confusion multinomiale.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-confusmat2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.3: Exemple de matrice de confusion multinomiale</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Valeur prédite / Valeur réelle</th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">C</th>
<th style="text-align: right;">D</th>
<th style="text-align: right;">Total (%)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">24 (18,7)</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">39 (30,4)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">45 (35,2)</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">20 (15,6)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total (%)</td>
<td style="text-align: right;">23 (18,1)</td>
<td style="text-align: right;">33 (25,7)</td>
<td style="text-align: right;">33 (25,7)</td>
<td style="text-align: right;">39 (30,5)</td>
<td style="text-align: right;">128</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Trois mesures pour chaque catégorie peuvent être utilisées pour déterminer la capacité de prédiction du modèle&nbsp;:</p>
<ul>
<li><p>La précision (<em>precision</em> en anglais), soit le nombre de fois où une catégorie a été correctement prédite, divisé par le nombre de fois où la catégorie a été prédite.</p></li>
<li><p>Le rappel (<em>recall</em> en anglais), soit le nombre de fois où une catégorie a été correctement prédite divisé par le nombre de fois où elle se trouve dans les données originales.</p></li>
<li><p>Le score <em>F1</em> est la moyenne harmonique entre la précision et le rappel, soit&nbsp;:</p></li>
</ul>
<p><span id="eq-glm13"><span class="math display">\[
\text{F1} = 2 \times \frac{\text{précision} \times \text{rappel}}{\text{précision} + \text{rappel}}
\tag{8.14}\]</span></span></p>
<p>Il est possible de calculer les moyennes pondérées des différents indicateurs (macro-indicateurs) afin de disposer d’une valeur d’ensemble pour le modèle. La pondération est faite en fonction du nombre de cas observé de chaque catégorie; l’idée étant qu’il est moins grave d’avoir des indicateurs plus faibles pour des catégories moins fréquentes. Cependant, il est tout à fait possible que cette pondération ne soit pas souhaitable. C’est par exemple le cas dans de nombreuses études en santé portant sur des maladies rares où l’attention est concentrée sur ces catégories peu fréquentes.</p>
<p>Le <strong>coefficient de Kappa</strong> (variant de 0 à 1) peut aussi être utilisé pour quantifier la fidélité générale de la prédiction du modèle. Il est calculé avec l’<a href="#eq-kappEq">équation&nbsp;<span>8.15</span></a> :</p>
<p><span id="eq-kappEq"><span class="math display">\[
k = \frac{Pr(a)-Pr(e)}{1-Pr(e)}
\tag{8.15}\]</span></span></p>
<p>avec <span class="math inline">\(Pr(a)\)</span> la proportion d’accords entre les catégories observées et les catégories prédites, et <span class="math inline">\(Pr(e)\)</span> la probabilité d’un accord aléatoire entre les catégories observées et les catégories prédites (<a href="#eq-kappEq2">équation&nbsp;<span>8.16</span></a>).</p>
<p><span id="eq-kappEq2"><span class="math display">\[
Pr(e) = \sum^{J}_{j=1} \frac{Cnt_{prédit}(j)}{n\times2} \times \frac{Cnt_{réel}(j)}{n\times2}
\tag{8.16}\]</span></span></p>
<p>avec <em>n</em> le nombre d’observations, <span class="math inline">\(Cnt_{prédit}(j)\)</span> le nombre de fois où le modèle prédit la catégorie <em>j</em> et <span class="math inline">\(Cnt_{réel}(j)\)</span> le nombre de fois où la catégorie <em>j</em> a été observée.</p>
<p>Pour l’interprétation du coefficient de Kappa, référez-vous au <a href="#tbl-Kappvals">tableau&nbsp;<span>8.4</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-Kappvals" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.4: Inteprétation des valeurs du coefficient de Kappa</caption>
<thead><tr class="header">
<th style="text-align: left;">K</th>
<th style="text-align: left;">Interprétation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">&lt; 0</td>
<td style="text-align: left;">Désaccord</td>
</tr>
<tr class="even">
<td style="text-align: left;">0 - 0,20</td>
<td style="text-align: left;">Accord très faible</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0,21 - 0,40</td>
<td style="text-align: left;">Accord faible</td>
</tr>
<tr class="even">
<td style="text-align: left;">0,41 - 0,60</td>
<td style="text-align: left;">Accord modéré</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0,61 - 0,80</td>
<td style="text-align: left;">Accord fort</td>
</tr>
<tr class="even">
<td style="text-align: left;">0,81 - 1</td>
<td style="text-align: left;">Accord presque parfait</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Enfin, un test statistique basé sur la distribution binomiale peut être utilisé pour vérifier que le modèle atteint un niveau de précision supérieur au seuil de non-information. Ce seuil correspond à la proportion de la modalité la plus présente dans le jeu de données. Dans la matrice de confusion utilisée dans le <a href="#tbl-Kappvals">tableau&nbsp;<span>8.4</span></a>, ce seuil est de 30,5&nbsp;% (catégorie D), ce qui signifie qu’un modèle prédisant tout le temps la catégorie D aurait une précision de 30,5&nbsp;% pour cette catégorie. Il est donc nécessaire que notre modèle fasse mieux que ce seuil.</p>
<p>Dans le cas de la matrice de confusion du <a href="#tbl-confusmat2">tableau&nbsp;<span>8.3</span></a>, nous obtenons donc les valeurs affichées dans le <a href="#tbl-confusIndic">tableau&nbsp;<span>8.5</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-confusIndic" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.5: Indicateurs de qualité de prédiction</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">précision</th>
<th style="text-align: right;">rappel</th>
<th style="text-align: right;">F1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">65,2</td>
<td style="text-align: right;">31,3</td>
<td style="text-align: right;">42,3</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">60,6</td>
<td style="text-align: right;">25,6</td>
<td style="text-align: right;">36,0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">75,8</td>
<td style="text-align: right;">27,8</td>
<td style="text-align: right;">40,7</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: right;">35,9</td>
<td style="text-align: right;">35,0</td>
<td style="text-align: right;">35,4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">macro</td>
<td style="text-align: right;">57,8</td>
<td style="text-align: right;">30,0</td>
<td style="text-align: right;">38,2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kappa</td>
<td style="text-align: right;">0,44</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Valeur de p (précision &gt; NIR)</td>
<td style="text-align: right;">&lt; 0,0001</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>À la lecture du <a href="#tbl-confusIndic">tableau&nbsp;<span>8.5</span></a>, nous remarquons que&nbsp;:</p>
<ul>
<li><p>La catégorie D est la moins bien prédite des quatre catégories (faible précision et faible rappel).</p></li>
<li><p>La catégorie C a une forte précision, mais un faible rappel, ce qui signifie que de nombreuses observations étant originalement des A, B ou D ont été prédites comme des C. Ce constat est également vrai pour la catégorie B.</p></li>
<li><p>Le coefficient de Kappa indique un accord modéré entre les valeurs originales et la prédiction.</p></li>
<li><p>La probabilité que la précision du modèle ne dépasse pas le seuil de non-information est inférieure à 0,001, indiquant que le modèle à une précision supérieure à ce seuil.</p></li>
</ul></section></section></section><section id="sec-0816" class="level3" data-number="8.1.6"><h3 data-number="8.1.6" class="anchored" data-anchor-id="sec-0816">
<span class="header-section-number">8.1.6</span> Comparaison de deux modèles GLM</h3>
<p>Tel qu’abordé dans le chapitre sur les régressions linéaires classiques, il est courant de comparer plusieurs modèles imbriqués (<a href="07-regressionlineaire.html#sec-0732">section&nbsp;<span>7.3.2</span></a>). Cette procédure permet de déterminer si l’ajout d’une ou de plusieurs variables contribue à significativement améliorer le modèle. Il est possible d’appliquer la même démarche aux GLM à l’aide du test de rapport de vraisemblance (<em>likelihood ratio test</em>). Le principe de base de ce test est de comparer le <em>likelihood</em> de deux modèles GLM imbriqués; la valeur de ce test se calcule avec l’équation suivante&nbsp;:</p>
<p><span id="eq-glm14"><span class="math display">\[
LR = 2(loglik(M_2) - loglik(M_1))
\tag{8.17}\]</span></span></p>
<p>avec <span class="math inline">\(M_2\)</span> un modèle reprenant toutes les variables du modèle <span class="math inline">\(M_1\)</span>, impliquant donc que <span class="math inline">\(loglik(M_2) &gt;= loglik(M_1)\)</span>.</p>
<p>Avec ce test, nous supposons que le modèle <span class="math inline">\(M_2\)</span>, qui comporte plus de paramètres que le modèle <span class="math inline">\(M_1\)</span>, devrait être mieux ajusté aux données. Si c’est bien le cas, la différence entre les <em>loglikelihood</em> de deux modèles devrait être supérieure à zéro. La valeur calculée <em>LR</em> suit une distribution du khi-deux avec un nombre de degrés de liberté égal au nombre de paramètres supplémentaires dans le modèle <span class="math inline">\(M_2\)</span> comparativement à <span class="math inline">\(M_1\)</span>. Avec ces deux informations, il est possible de déterminer la valeur de <em>p</em> associée à ce test et de déterminer si <span class="math inline">\(M_2\)</span> est significativement mieux ajusté que <span class="math inline">\(M_1\)</span> aux données. Notez qu’il existe aussi deux autres tests (test de Wald et test de Lagrange) ayant la même fonction. Il s’agit, dans les deux cas, d’approximation du test de rapport des vraisemblances dont la puissance statistique est inférieure au test de rapport de vraisemblance <span class="citation" data-cites="NeymanLemma">(<a href="references.html#ref-NeymanLemma" role="doc-biblioref">Neyman, Pearson et Pearson 1933</a>)</span>.</p>
<p>Dans les prochaines sections, nous décrivons les modèles GLM les plus couramment utilisés. Il en existe de nombreuses variantes que nous ne pouvons pas toutes décrire ici. L’objectif est de comprendre les rouages de ces modèles afin de pouvoir, en cas de besoin, transposer ces connaissances sur des modèles plus spécifiques. Pour faciliter la lecture de ces sections, nous vous proposons une carte d’identité de chacun des modèles présentés. Elles contiennent l’ensemble des informations pertinentes à retenir pour chaque modèle.</p>
</section></section><section id="sec-082" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="sec-082">
<span class="header-section-number">8.2</span> Modèles GLM pour des variables qualitatives</h2>
<p>Nous abordons en premier les principaux GLM utilisés pour modéliser des variables binaires, multinomiales et ordinales. Prenez bien le temps de saisir le fonctionnement du modèle logistique binomial, car il sert de base pour les trois autres modèles présentés.</p>
<section id="sec-0821" class="level3" data-number="8.2.1"><h3 data-number="8.2.1" class="anchored" data-anchor-id="sec-0821">
<span class="header-section-number">8.2.1</span> Modèle logistique binomial</h3>
<p>Le modèle logistique binomial est une généralisation du modèle de Bernoulli que nous avons présenté dans l’introduction de cette section. Le modèle logistique binomiale couvre donc deux cas de figure&nbsp;:</p>
<ol type="1">
<li><p>La variable observée est binaire (0 ou 1). Dans ce cas, le modèle logistique binomiale devient un simple modèle de Bernoulli.</p></li>
<li><p>La variable observée est un comptage (nombre de réussites) et nous disposons d’une autre variable avec le nombre de réplications de l’expérience. Par exemple, pour chaque intersection d’un réseau routier, nous pourrions avoir le nombre de décès à vélo (variable <em>Y</em> de comptage) et le nombre de collisions vélo / automobile (variable quantifiant le nombre d’expériences, chaque collision étant une expérience). Spécifiquement, nous tentons de prédire le paramètre <em>p</em> de la distribution binomiale à l’aide de notre équation de régression et de la fonction logistique comme fonction de lien. Notez ici que cette fonction de lien influence directement l’interprétation des paramètres du modèle. Pour rappel, cette fonction est définie comme&nbsp;:</p></li>
</ol>
<p><span class="math display">\[
g(x) = ln(\frac{x}{1-x})
\]</span></p>
<p>avec <span class="math inline">\(ln\)</span> étant le logarithme naturel.</p>
<p>Au-delà de sa propriété mathématique assurant que <span class="math inline">\(g(x) \in \mathopen[0,1\mathclose]\)</span>, cette fonction offre une interprétation intéressante. La partie <span class="math inline">\(\frac{x}{1-x}\)</span> est une cote et s’interprète en termes de chances d’observer un évènement. Par exemple, dans le cas des accidents de cyclistes, si la probabilité d’observer un décès suite à une collision est de 0,1, alors la cote de cet évènement est <span class="math inline">\(\frac{\frac{1}{10}}{\frac{9}{10}} = \frac{1}{9}\)</span> soit un contre neuf. Dans un modèle GLM logistique, les coefficients ajustés pour les variables indépendantes représentent des <strong>logarithmes de rapport de cote</strong>, car ils comparent les chances d’observer l’évènement (y = 1) en fonction des valeurs des variables indépendantes.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-binomidentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.6: Carte d’identité du modèle logistique binomial</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable binaire (0 ou 1) ou comptage de réussite à une expérience (ex : 3 réussites sur 5 expériences)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Binomiale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Binomial(p)\)</span> <span class="math inline">\(g(p) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">Logistique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;">p</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Non-séparation complète, absence de sur-dispersion ou de sous-dispersion</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08211" class="level4" data-number="8.2.1.1"><h4 data-number="8.2.1.1" class="anchored" data-anchor-id="sec-08211">
<span class="header-section-number">8.2.1.1</span> Interprétation des paramètres</h4>
<p>Les seuls paramètres à estimer du modèle sont les coefficients <span class="math inline">\(\beta\)</span> et la constante <span class="math inline">\(\beta_0\)</span>. La fonction de lien logistique transforme la valeur de ces coefficients, en conséquence, <strong>ils ne peuvent plus être interprétés directement</strong>. <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span> sont exprimés dans une unité particulière: des logarithmes de rapports de cote (<em>log odd ratio</em>). Le rapport de cote est relativement facile à interpréter contrairement à son logarithme. Pour l’obtenir, il suffit d’utiliser la fonction exponentielle (l’inverse de la fonction logarithme) pour passer des log rapports de cote à de simples rapports de cote. Donc si <span class="math inline">\(exp(\beta)\)</span> est inférieur à 1, il réduit les chances d’observer l’évènement et inversement si <span class="math inline">\(exp(\beta)\)</span> est supérieur à 1.</p>
<p>Par exemple, admettons que nous ayons un coefficient <span class="math inline">\(\beta_1\)</span> de 1,2 pour une variable <span class="math inline">\(X_1\)</span> dans une régression logistique. Il est nécessaire d’utiliser son exponentiel pour l’interpréter de façon intuitive. <span class="math inline">\(exp\mbox{(1,2)} = \mbox{3,32}\)</span>, ce qui signifie que lorsque <span class="math inline">\(X_1\)</span> augmente d’une unité, les chances d’observer 1 plutôt que 0 comme valeur de <em>Y</em> sont multipliées par 3,32. Admettons maintenant que <span class="math inline">\(\beta_1\)</span> vaille −1,2, nous calculons donc <span class="math inline">\(exp\mbox{(-1,2) = 0,30}\)</span>, ce qui signifie qu’à chaque augmentation d’une unité de <span class="math inline">\(X_1\)</span>, les chances d’observer 1 plutôt que 0 comme valeur de <em>Y</em> sont multipliées par 0,30. En d’autres termes,les chances d’observer 1 plutôt que 0 sont divisées par 3,33 (<span class="math inline">\(\mbox{1}/\mbox{0,30} = \mbox{3,33}\)</span>), soit une diminution de 70&nbsp;% (<span class="math inline">\(\mbox{1}-\mbox{0,3} = \mbox{0,7}\)</span>) des chances d’observer 1 plutôt que 0.</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Les rapports de cotes</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Le rapport de cote ou rapport des chances est une mesure utilisée pour exprimer l’effet d’un facteur sur une probabilité. Il est très utilisé dans le domaine de la santé, mais aussi des paris. Prenons un exemple concret avec le port du casque à vélo. Si sur 100 accidents impliquant des cyclistes portant un casque, nous observons seulement&nbsp;3 cas de blessures graves à la tête, contre 15 dans un second groupe de 100 cyclistes ne portant pas de casque, nous pouvons calculer le rapport de cote suivant&nbsp;:</p>
<p><span class="math display">\[
\frac{p(1-q)}{q(1-p)} = \frac{\mbox{0,15} \times (\mbox{1}-\mbox{0,03})}{\mbox{0,03} \times (\mbox{1}-\mbox{0,15})} = \mbox{5,71}
\]</span></p>
<p>avec <em>p</em> la probabilité d’observer le phénomène (ici la blessure grave à la tête) dans le groupe 1 (ici les cyclistes sans casque) et <em>q</em> la probabilité d’observer le phénomène dans le groupe 2 (ici les cyclistes avec un casque). Ce rapport de cote indique que les cyclistes sans casques ont 5,71 fois plus de risques de se blesser gravement à la tête lors d’un accident comparativement aux cyclistes portant un casque.</p>
</div>
</div>
</section><section id="sec-08212" class="level4" data-number="8.2.1.2"><h4 data-number="8.2.1.2" class="anchored" data-anchor-id="sec-08212">
<span class="header-section-number">8.2.1.2</span> Conditions d’application</h4>
<p>La non-séparation complète signifie qu’aucune des variables <em>X</em> n’est, à elle seule, capable de parfaitement distinguer les deux catégories 0 et 1 de la variable <em>Y</em>. Dans un tel cas de figure, les algorithmes d’ajustement utilisés pour estimer les paramètres des modèles sont incapables de converger. Notez aussi l’absurdité de créer un modèle pour prédire une variable <em>Y</em> si une variable <em>X</em> est capable à elle seule de la prédire à coup sûr. Ce problème est appelé un effet de Hauck-Donner. Il est assez facile de le repérer, car la plupart du temps les fonctions de R signalent ce problème (message d’erreur sur la convergence). Sinon, des valeurs extrêmement élevées ou faibles pour certains rapports de cote peuvent aussi indiquer un effet de Hauck-Donner.</p>
<p>La sur-dispersion est un problème spécifique aux distributions n’ayant pas de paramètre de dispersion (binomiale, de Poisson, exponentielle, etc.), pour lesquelles la variance dépend directement de l’espérance. La sur-dispersion désigne une situation dans laquelle les résidus (ou erreurs) d’un modèle sont plus dispersés que ce que suppose la distribution utilisée. À l’inverse, il est aussi possible (mais rare) d’observer des cas de sous-dispersion (lorsque la dispersion des résidus est plus petite que ce que suppose la distribution choisie). Ce cas de figure se produit généralement lorsque le modèle parvient à réaliser une prédiction trop précise pour être crédible. Si vous rencontrez une forte sous-dispersion, cela signifie souvent que l’une de vos variables indépendantes provoque une séparation complète. La meilleure option, dans ce cas, est de supprimer la variable en question du modèle. La variance attendue d’une distribution binomiale est <span class="math inline">\(nb \times p \times(1-p)\)</span>, soit le produit entre le nombre de tirages, la probabilité de réussite et la probabilité d’échec. À titre d’exemple, si nous considérons une distribution binomiale avec un seul tirage et 50&nbsp;% de chances de réussite, sa variance serait&nbsp;: <span class="math inline">\(1 \times \mbox{0,5} \times \mbox{(1}-\mbox{0,5}) = \mbox{0,25}\)</span>.</p>
<p>Plusieurs raisons peuvent expliquer la présence de sur-dispersion dans un modèle&nbsp;:</p>
<ul>
<li><p>il manque des variables importantes dans le modèle, conduisant à un mauvais ajustement et donc une sur-dispersion des erreurs;</p></li>
<li><p>les observations ne sont pas indépendantes, impliquant qu’une partie de la variance n’est pas contrôlée et augmente les erreurs;</p></li>
<li><p>la probabilité de succès de chaque expérience varie d’une répétition à l’autre (différentes distributions).</p></li>
</ul>
<p>La conséquence directe de la sur-dispersion est la sous-estimation de la variance des coefficients de régression. En d’autres termes, la sur-dispersion conduit à sous-estimer notre incertitude quant aux coefficients obtenus et réduit les valeurs de <em>p</em> calculées pour ces coefficients. Les risques de trouver des résultats significatifs à cause des fluctuations d’échantillonnage augmentent.</p>
<p>Pour détecter une sur-dispersion ou une sous-dispersion dans un modèle logistique binomial, il est possible d’observer les résidus de déviance du modèle. Ces derniers sont supposés suivre une distribution du khi-deux avec <em>n−k</em> degrés de liberté (avec <em>n</em> le nombre d’observations et <em>k</em> le nombre de coefficients dans le modèle). Par conséquent, la somme des résidus de déviance d’un modèle logistique binomiale divisée par le nombre de degrés de liberté devrait être proche de 1. Une légère déviation (jusqu’à 0,15 au-dessus ou au-dessous de 1) n’est pas alarmante; au-delà, il est nécessaire d’ajuster le modèle.</p>
<p>Notez que si la variable <em>Y</em> modélisée est exactement binaire (chaque expérience est indépendante et n’est composée que d’un seul tirage) et que le modèle utilise donc une distribution de Bernoulli, le test précédent pour détecter une éventuelle sur-dispersion n’est pas valide. <span class="citation" data-cites="hilbe2009logistic">Hilbe (<a href="references.html#ref-hilbe2009logistic" role="doc-biblioref">2009</a>)</span> parle de sur-dispersion implicite pour le modèle de Bernoulli et recommande notamment de toujours ajuster les erreurs standards des modèles utilisant des distributions de Bernoulli, binomiale et de Poisson. L’idée ici est d’éviter d’être trop optimiste face à l’incertitude du modèle sur les coefficients et de l’ajuster en conséquence. Pour cela, il est possible d’utiliser des quasi-distributions ou des estimateurs robustes <span class="citation" data-cites="zeileis2004econometric">(<a href="references.html#ref-zeileis2004econometric" role="doc-biblioref">Zeileis 2004</a>)</span>. Notez que si le modèle ne souffre pas de sur ou sous-dispersion, ces ajustements produisent des résultats équivalents aux résultats non ajustés.</p>
</section><section id="sec-08213" class="level4" data-number="8.2.1.3"><h4 data-number="8.2.1.3" class="anchored" data-anchor-id="sec-08213">
<span class="header-section-number">8.2.1.3</span> Exemple appliqué dans R</h4>
<p><strong>Présentation des données</strong></p>
<p>Pour illustrer le modèle logistique binomial, nous utilisons ici un jeu de données proposé par l’Union européenne&nbsp;: <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/P82V9X">l’enquête de déplacement sur la demande pour des systèmes de transports innovants</a>. Pour cette enquête, un échantillon de 1&nbsp;000 individus représentatifs de la population a été constitué dans chacun des 26 États membres de l’UE, soit un total de 26&nbsp;000 observations. Pour chaque individu, plusieurs informations ont été collectées relatives à la catégorie socioprofessionnelle, le mode de transport le plus fréquent, le temps du trajet de son déplacement le plus fréquent et son niveau de sensibilité à la cause environnementale. Nous modélisons ici la probabilité qu’un individu déclare utiliser le plus fréquemment le vélo comme moyen de transport. Les variables explicatives sont résumées au <a href="#tbl-binomdata">tableau&nbsp;<span>8.7</span></a>. Il existe bien évidemment un grand nombre de facteurs individuels qui influence la prise de décision sur le mode de transport. Les résultats de ce modèle ne doivent donc pas être pris avec un grand sérieux; il est uniquement construit à des fins pédagogiques, sans cadre conceptuel solide.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-binomdata" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.7: Variables indépendantes utilisées pour prédire le mode de transport le plus utilisé</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 21%">
<col style="width: 8%">
<col style="width: 63%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom de la variable</th>
<th style="text-align: left;">Signification</th>
<th style="text-align: left;">Type de variable</th>
<th style="text-align: left;">Mesure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pays</td>
<td style="text-align: left;">Pays de résidence</td>
<td style="text-align: left;">Variable multinomiale</td>
<td style="text-align: left;">Le nom d’un des 26 pays membres de l’UE</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sexe</td>
<td style="text-align: left;">Sexe biologique</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Homme ou femme</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Âge biologique</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">L’âge en nombre d’années variant de 16 à 84 ans dans le jeu de données</td>
</tr>
<tr class="even">
<td style="text-align: left;">Education</td>
<td style="text-align: left;">Niveau d’éducation maximum atteint</td>
<td style="text-align: left;">Variable multinomiale</td>
<td style="text-align: left;">Premier cycle, secondaire inférieur (classes supérieures de l’école élémentaire), secondaire, troisième cycle</td>
</tr>
<tr class="odd">
<td style="text-align: left;">StatutEmploi</td>
<td style="text-align: left;">Employé ou non</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Employé ou non</td>
</tr>
<tr class="even">
<td style="text-align: left;">Revenu</td>
<td style="text-align: left;">Niveau de revenu autodéclaré</td>
<td style="text-align: left;">Variable multinomiale</td>
<td style="text-align: left;">Très faible revenu, faible revenu, revenu moyen, revenu élevé, revenu très élevé, sans reponse</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residence</td>
<td style="text-align: left;">Lieu de résidence</td>
<td style="text-align: left;">Variable multinomiale</td>
<td style="text-align: left;">Zone rurale, petite ou moyenne ville (moins de 250 000 habitants), grande ville (entre 250 000 et 1 million d’habitants) , aire métropolitaine (plus d’un million d’habitants)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Duree</td>
<td style="text-align: left;">Durée du voyage le plus fréquent autodéclarée (en minutes)</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Nombre de minutes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ConsEnv</td>
<td style="text-align: left;">Préoccupation environnementale</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Échelle de Likert de 1 à 10</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Vérification des conditions d’application</strong></p>
<p>La première étape de la vérification des conditions d’application est de calculer les valeurs du facteur d’inflation de variance (VIF) pour s’assurer de l’absence de multicolinéarité trop forte entre les variables indépendantes. L’ensemble des valeurs de VIF sont inférieures à 5, indiquant l’absence de multicolinéarité excessive dans le modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="co"># Chargement des données</span></span>
<span><span class="va">dfenquete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/enquete_transport_UE.csv"</span>, encoding <span class="op">=</span> <span class="st">'UTF-8'</span><span class="op">)</span></span>
<span><span class="va">dfenquete</span><span class="op">$</span><span class="va">Pays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dfenquete</span><span class="op">$</span><span class="va">Pays</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"Allemagne"</span><span class="op">)</span></span>
<span><span class="co"># Vérification du VIF</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span></span>
<span>              <span class="va">Pays</span> <span class="op">+</span> <span class="va">Sexe</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Education</span> <span class="op">+</span> <span class="va">StatutEmploi</span> <span class="op">+</span> <span class="va">Revenu</span> <span class="op">+</span></span>
<span>              <span class="va">Residence</span> <span class="op">+</span> <span class="va">Duree</span> <span class="op">+</span> <span class="va">ConsEnv</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 GVIF Df GVIF^(1/(2*Df))
Pays         1.794797 27        1.010890
Sexe         1.028618  1        1.014208
Age          1.060256  1        1.029687
Education    1.428872  3        1.061285
StatutEmploi 1.151879  1        1.073256
Revenu       1.220934  5        1.020162
Residence    1.130526  3        1.020658
Duree        1.042638  1        1.021096
ConsEnv      1.090987  1        1.044503</code></pre>
</div>
</div>
<p>La seconde étape de vérification est le calcul des distances de Cook et l’identification d’éventuelles valeurs aberrantes (<a href="#fig-cookdistGLMbinom">figure&nbsp;<span>8.4</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul et représentation des distances de Cook</span></span>
<span><span class="va">cookd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dfenquete</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">cookd</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">dist</span> <span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.002</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"observations"</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistGLMbinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistGLMbinom-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.4: Distances de Cook pour le modèle binomial avec toutes les observations</figcaption></figure>
</div>
</div>
</div>
<p>Le calcul de la distance de Cook révèle un ensemble d’observations se démarquant nettement des autres (délimitées dans la <a href="#fig-cookdistGLMbinom">figure&nbsp;<span>8.4</span></a>) par la ligne rouge). Nous les isolons dans un premier temps pour les analyser.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Isoler les observations avec de très fortes valeurs de Cook</span></span>
<span><span class="co"># valeur seuil choisie : 0,002</span></span>
<span><span class="va">cas_etranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dfenquete</span>, <span class="va">cookd</span><span class="op">$</span><span class="va">dist</span><span class="op">&gt;=</span><span class="fl">0.002</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cas_etranges</span><span class="op">)</span>,<span class="st">'observations se démarquant dans le modèle'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19 observations se démarquant dans le modèle</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etranges</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          X y       Pays  Sexe Age            Education Statut_emploi
7660   7660 1  Slovaquie homme  50           universite      Employed
25150 25150 1      Malte homme  16           secondaire  Not Employed
25227 25227 1      Malte femme  53 secondaire inferieur  Not Employed
25309 25309 1      Malte femme  32           secondaire      Employed
25322 25322 1      Malte homme  38           universite      Employed
25536 25536 1      Malte homme  27           universite      Employed
25541 25541 1      Malte homme  38 secondaire inferieur      Employed
25549 25549 1      Malte homme  31           universite      Employed
25690 25690 1 Luxembourg homme  32           universite      Employed
26190 26190 1     Chypre homme  24           secondaire  Not Employed
26201 26201 1     Chypre homme  25           secondaire      Employed
26244 26244 1     Chypre homme  32           secondaire      Employed
26269 26269 1     Chypre homme  60           secondaire  Not Employed
26303 26303 1     Chypre homme  59           secondaire  Not Employed
26393 26393 1     Chypre homme  30        premier cycle      Employed
26444 26444 1     Chypre femme  52           universite      Employed
26516 26516 1     Chypre homme  21           universite  Not Employed
26549 26549 1     Chypre homme  28           universite      Employed
26600 26600 1     Chypre homme  36           secondaire      Employed
            Revenu            Residence Duree mode_pref StatutEmploi ConsEnv
7660         moyen          zone rurale   775      velo      employe       7
25150        moyen          zone rurale    15      velo  sans emploi       3
25227        moyen          zone rurale    45    marche  sans emploi       5
25309        moyen petite-moyenne ville    25    marche      employe       4
25322        eleve          zone rurale    30    marche      employe      10
25536   tres eleve petite-moyenne ville    14      velo      employe      10
25541        moyen          zone rurale     5    marche      employe       8
25549 sans reponse petite-moyenne ville    60      velo      employe      10
25690   tres eleve petite-moyenne ville   720      velo      employe       6
26190        moyen         grande ville    20      velo  sans emploi       5
26201       faible          zone rurale    20      velo      employe       5
26244  tres faible petite-moyenne ville    18      velo      employe       4
26269        moyen petite-moyenne ville     5      velo  sans emploi       7
26303        moyen          zone rurale     7      velo  sans emploi       8
26393   tres eleve petite-moyenne ville    61      velo      employe       5
26444        eleve petite-moyenne ville   120      velo      employe       3
26516        moyen petite-moyenne ville    25      velo  sans emploi       8
26549  tres faible petite-moyenne ville    15      velo      employe       2
26600        moyen petite-moyenne ville     8      velo      employe       1</code></pre>
</div>
</div>
<p>À la lecture des valeurs pour ces 19 cas étranges, nous remarquons que la plupart des observations proviennent de Malte et de Chypre. Ces deux petites îles constituent des cas particuliers en Europe et devraient vraisemblablement faire l’objet d’une analyse séparée. Nous décidons donc de les retirer du jeu de données. Deux autres observations étranges sont observables en Slovaquie et au Luxembourg. Dans les deux cas, les répondants ont renseigné des temps de trajet fantaisistes de respectivement 775 et 720&nbsp;minutes. Nous les retirons donc également de l’analyse.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retirer les observations aberrantes</span></span>
<span><span class="va">dfenquete2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dfenquete</span>, <span class="op">(</span><span class="va">dfenquete</span><span class="op">$</span><span class="va">Pays</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Malte"</span>, <span class="st">"Chypre"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">F</span> <span class="op">&amp;</span> </span>
<span>                  <span class="va">dfenquete</span><span class="op">$</span><span class="va">Duree</span> <span class="op">&lt;</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="co"># Réajuster le modèle</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span></span>
<span>              <span class="va">Pays</span> <span class="op">+</span> <span class="va">Sexe</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Education</span> <span class="op">+</span> <span class="va">StatutEmploi</span> <span class="op">+</span> <span class="va">Revenu</span> <span class="op">+</span></span>
<span>              <span class="va">Residence</span> <span class="op">+</span> <span class="va">Duree</span> <span class="op">+</span> <span class="va">ConsEnv</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">)</span></span>
<span><span class="co"># Recalculer la distance de Cook</span></span>
<span><span class="va">cookd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dfenquete2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">cookd</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">dist</span> <span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"observations"</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistGLMbinom2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistGLMbinom2-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.5: Distances de Cook pour le modèle binomial sans les valeurs aberrantes</figcaption></figure>
</div>
</div>
</div>
<p>Après avoir retiré ces valeurs aberrantes, nous n’observons plus de nouveaux cas singuliers avec les distances de Cook (<a href="#fig-cookdistGLMbinom2">figure&nbsp;<span>8.5</span></a>).</p>
<p>La prochaine étape de vérification des conditions d’application est l’analyse des résidus simulés. Nous commençons donc par calculer ces résidus et afficher leur histogramme (<a href="#fig-residsimbinomHistoUnif">figure&nbsp;<span>8.6</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/">DHARMa</a></span><span class="op">)</span></span>
<span><span class="co"># Extraire les probabilités prédites par le modèle</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Calculer 1000 simulations a partir du modele ajuste</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">probs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">matsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">sims</span><span class="op">)</span></span>
<span><span class="co"># Utiliser le package DHARMa pour calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">matsim</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">probs</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.3</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"résidus simulés"</span>, y <span class="op">=</span> <span class="st">"fréquence"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residsimbinomHistoUnif" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-residsimbinomHistoUnif-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.6: Distribution des résidus simulés pour le modèle binomial</figcaption></figure>
</div>
</div>
</div>
<p>L’histogramme indique clairement que les résidus simulés suivent une distribution uniforme (<a href="#fig-residsimbinomHistoUnif">figure&nbsp;<span>8.6</span></a>). Il est possible d’aller plus loin dans le diagnostic en utilisant la fonction <code>plot</code> sur l’objet <code>sim_res</code>. La partie de droite de la figure ainsi obtenue (<a href="#fig-residsimbinom">figure&nbsp;<span>8.7</span></a>) est un diagramme de quantiles-quantiles (ou Q-Q plot). Les points du graphique sont supposés suivre une ligne droite matérialisée par la ligne rouge. Une déviation de cette ligne indique un éloignement des résidus de leur distribution attendue. Trois tests sont également réalisés par la fonction&nbsp;:</p>
<ul>
<li><p>Le premier (Test de Kolmogorov-Smirnov, <em>KS test</em>) permet de tester si les points dévient significativement de la ligne droite. Dans notre cas, la valeur de <em>p</em> n’est pas significative, indiquant que les résidus ne dévient pas de la distribution uniforme.</p></li>
<li><p>Le second test permet de vérifier la présence de sur ou sous-dispersion. Dans notre cas, ce test n’est pas significatif, n’indiquant aucun problème de sur-dispersion ou de sous-dispersion.</p></li>
<li><p>Le dernier test permet de vérifier si des valeurs aberrantes sont présentes dans les résidus. Une valeur non significative indique une absence de valeurs aberrantes.</p></li>
</ul>
<p>Le second graphique permet de comparer les résidus et les valeurs prédites. L’idéal est donc d’observer une ligne droite horizontale au milieu du graphique qui indiquerait une absence de relation entre les valeurs prédites et les résidus (ce que nous observons bien ici).</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-residsimbinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/fig-residsimbinom.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.7: Diagnostic des résidus simulés par le package DHARMa</figcaption></figure>
</div>
</div>
</div>
<p>L’analyse approfondie des résidus nous permet donc de conclure que le modèle respecte les conditions d’application et que nous pouvons passer à la vérification de la qualité d’ajustement du modèle.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<p>Pour calculer les différents R<sup>2</sup> d’un modèle GLM, nous proposons la fonction suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rsqs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">loglike.full</span>, <span class="va">loglike.null</span>, <span class="va">full.deviance</span>, <span class="va">null.deviance</span>, <span class="va">nb.params</span>, <span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Calcul de la déviance expliquée</span></span>
<span>  <span class="va">explained_dev</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">full.deviance</span> <span class="op">/</span> <span class="va">null.deviance</span><span class="op">)</span></span>
<span>  <span class="va">K</span> <span class="op">&lt;-</span> <span class="va">nb.params</span></span>
<span>  <span class="co"># R2 de McFadden ajusté</span></span>
<span>  <span class="va">r2_faddenadj</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span> <span class="op">(</span><span class="va">loglike.full</span> <span class="op">-</span> <span class="va">K</span><span class="op">)</span> <span class="op">/</span> <span class="va">loglike.null</span></span>
<span>  <span class="va">Lm</span> <span class="op">&lt;-</span> <span class="va">loglike.full</span></span>
<span>  <span class="va">Ln</span> <span class="op">&lt;-</span> <span class="va">loglike.null</span></span>
<span>  <span class="co"># R2 de Cox and Snell</span></span>
<span>  <span class="va">Rcs</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">Lm</span><span class="op">-</span><span class="va">Ln</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># R2 de Nagelkerke</span></span>
<span>  <span class="va">Rn</span> <span class="op">&lt;-</span> <span class="va">Rcs</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">Ln</span><span class="op">/</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"deviance expliquee"</span> <span class="op">=</span> <span class="va">explained_dev</span>,</span>
<span>         <span class="st">"McFadden ajuste"</span> <span class="op">=</span> <span class="va">r2_faddenadj</span>,</span>
<span>         <span class="st">"Cox and Snell"</span> <span class="op">=</span> <span class="va">Rcs</span>,</span>
<span>         <span class="st">"Nagelkerke"</span> <span class="op">=</span> <span class="va">Rn</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous l’utilisons pour l’ensemble des modèles GLM de ce chapitre. Dans le cas du modèle binomial, nous obtenons&nbsp;:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajuster un modele null avec seulement une constante</span></span>
<span><span class="va">model2.null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">dfenquete2</span><span class="op">)</span></span>
<span><span class="co"># Calculer les R2</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span><span class="op">)</span>, <span class="co"># loglikelihood du modèle complet</span></span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">model2.null</span><span class="op">)</span><span class="op">)</span>, <span class="co"># loglikelihood du modèle nul</span></span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span>, <span class="co"># déviance du modèle complet</span></span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">model2.null</span><span class="op">)</span>, <span class="co"># déviance du modèle nul</span></span>
<span>     nb.params <span class="op">=</span> <span class="va">model2</span><span class="op">$</span><span class="va">rank</span>, <span class="co"># nombre de paramètres dans le modèle</span></span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dfenquete2</span><span class="op">)</span> <span class="co"># nombre d'observations</span></span>
<span>     <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.0876057

$`McFadden ajuste`
[1] 0.08357379

$`Cox and Snell`
[1] 0.0689509

$Nagelkerke
[1] 0.1236597</code></pre>
</div>
</div>
<p>La déviance expliquée par le modèle est de 8,8&nbsp;%, les pseudos R<sup>2</sup> de McFadden (ajusté), d’Efron et de Nagelkerke sont respectivement 0,084, 0,069 et 0,124. Toutes ces valeurs sont relativement faibles et indiquent qu’une large partie de la variabilité de <em>Y</em> reste inexpliquée.</p>
<p>Pour vérifier la qualité de prédiction du modèle, nous devons comparer les catégories prédites et les catégories réelles de notre variable dépendante et construire une matrice de confusion. Cependant, un modèle GLM binomial prédit <strong>la probabilité d’appartenance au groupe 1</strong> (ici les personnes utilisant le vélo pour effectuer leur déplacement le plus fréquent). Pour convertir ces probabilités prédites en catégories prédites, il faut choisir un seuil de probabilité au-delà duquel nous considérons que la valeur attendue est 1 (cycliste) plutôt que 0 (autre). Un exemple naïf serait de prendre le seuil 0,5, ce qui signifierait que si le modèle prédit qu’une observation a au moins 50&nbsp;% de chance d’être une personne à vélo, alors nous l’attribuons à cette catégorie. Cependant, cette méthode est rarement optimale; il est donc plus judicieux de fixer le seuil de probabilité en trouvant le point d’équilibre entre la sensibilité (proportion de 1 correctement identifiés) et la spécificité (proportion de 0 correctement identifiés). Ce point d’équilibre est identifiable graphiquement en calculant la spécificité et la sensibilité de la prédiction selon toutes les valeurs possibles du seuil.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ipa-tys.github.io/ROCR/">ROCR</a></span><span class="op">)</span></span>
<span><span class="co"># Obtention des prédictions du modèle</span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Calcul de la sensibilité et de la spécificité (package ROCR)</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/prediction.html">prediction</a></span><span class="op">(</span><span class="va">prob</span>, <span class="va">dfenquete2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">sens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html">performance</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="st">"sens"</span><span class="op">)</span><span class="op">@</span><span class="va">x.values</span><span class="op">)</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html">performance</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="st">"sens"</span><span class="op">)</span><span class="op">@</span><span class="va">y.values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html">performance</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="st">"spec"</span><span class="op">)</span><span class="op">@</span><span class="va">x.values</span><span class="op">)</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html">performance</a></span><span class="op">(</span><span class="va">predictions</span>, <span class="st">"spec"</span><span class="op">)</span><span class="op">@</span><span class="va">y.values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Trouver numériquement la valeur seuil (minimiser la différence absolue</span></span>
<span><span class="co"># entre sensibilité et spécificité)</span></span>
<span><span class="va">real</span> <span class="op">&lt;-</span> <span class="va">dfenquete2</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">find_cutoff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">seuil</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">prob</span><span class="op">&gt;</span><span class="va">seuil</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">sensi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">real</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">pred</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">real</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">real</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">pred</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">real</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">sensi</span><span class="op">-</span><span class="va">spec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">prob_seuil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">find_cutoff</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, maximum <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">minimum</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Le seuil de probabilité à retenir équilibrant"</span>,</span>
<span>  <span class="st">"la sensibilité et la spécificité est de"</span>, <span class="va">prob_seuil</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le seuil de probabilité à retenir équilibrant la sensibilité et la spécificité est de 0.14785</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Affichage du graphique</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sens</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">spec</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>sec.axis <span class="op">=</span> <span class="fu">sec_axis</span><span class="op">(</span><span class="op">~</span><span class="va">.</span>, name <span class="op">=</span> <span class="st">"Spécificité"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Seuil de probabilité"</span>, y <span class="op">=</span> <span class="st">"Sensibilité"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">prob_seuil</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="va">prob_seuil</span>, y <span class="op">=</span> <span class="fl">0.01</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">prob_seuil</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title.y.right <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-equlibresensispeci" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-equlibresensispeci-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.8: Point d’équilibre entre sensibilité et spécificité</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons à la <a href="#fig-equlibresensispeci">figure&nbsp;<span>8.8</span></a> que si la valeur du seuil est 0&nbsp;%, alors la prédiction a une sensibilité parfaite (le modèle prédit toujours 1, donc tous les 1 sont détectés); à l’inverse, si le seuil choisi est 100&nbsp;%, alors la prédiction à une spécificité parfaite (le modèle prédit toujours 0, donc tous les 0 sont détectés). Dans notre cas, la valeur d’équilibre est d’environ 0,148, donc si le modèle prédit une probabilité au moins égale à 14,8&nbsp;% qu’un individu utilise le vélo pour son déplacement le plus fréquent, nous devons l’attribuer à la catégorie <em>cycliste</em>. Avec ce seuil, nous pouvons convertir les probabilités prédites en classes prédites et construire notre matrice de confusion.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span> <span class="co"># pour la matrice de confusion</span></span>
<span><span class="co"># Calcul des catégories prédites</span></span>
<span><span class="va">ypred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0.148</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dfenquete2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">ypred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Affichage des valeurs brutes de la matrice de confusion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 14355  7576
         1  1251  2365
                                          
               Accuracy : 0.6545          
                 95% CI : (0.6486, 0.6603)
    No Information Rate : 0.6109          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.1783          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.9198          
            Specificity : 0.2379          
         Pos Pred Value : 0.6546          
         Neg Pred Value : 0.6540          
             Prevalence : 0.6109          
         Detection Rate : 0.5619          
   Detection Prevalence : 0.8585          
      Balanced Accuracy : 0.5789          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
<p>Les résultats proposés par le <em>package</em> <code>caret</code> sont exhaustifs; nous vous proposons ici une façon de les présenter dans deux tableaux&nbsp;: l’un présente la matrice de confusion (<a href="#tbl-confusmatbinom">tableau&nbsp;<span>8.8</span></a>) et l’autre, les indicateurs de qualité de prédiction (<a href="#tbl-confusmatbinom2">tableau&nbsp;<span>8.9</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-confusmatbinom" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.8: Matrice de confusion pour le modèle binomial</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: right;">0 (réel)</th>
<th style="text-align: right;">1 (réel)</th>
<th style="text-align: right;">Total</th>
<th style="text-align: right;">%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0 (prédit)</td>
<td style="text-align: right;">14355</td>
<td style="text-align: right;">7576</td>
<td style="text-align: right;">21931</td>
<td style="text-align: right;">85.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1 (prédit)</td>
<td style="text-align: right;">1251</td>
<td style="text-align: right;">2365</td>
<td style="text-align: right;">3616</td>
<td style="text-align: right;">14.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Total</td>
<td style="text-align: right;">15606</td>
<td style="text-align: right;">9941</td>
<td style="text-align: right;">25547</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">%</td>
<td style="text-align: right;">61.1</td>
<td style="text-align: right;">38.9</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>D’après ces indicateurs, nous constatons que le modèle a une capacité de prédiction relativement faible, mais tout de même significativement supérieure au seuil de non-information. La valeur de rappel pour la catégorie 1 (cycliste) est faible, indiquant que le modèle a manqué un nombre important de cyclistes lors de sa prédiction.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-confusmatbinom2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.9: Matrice de confusion pour le modèle binomial</caption>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;"></th>
<th style="text-align: right;">Précision</th>
<th style="text-align: right;">Rappel</th>
<th style="text-align: right;">F1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.76</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">macro_scores</td>
<td style="text-align: left;">macro</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Kappa</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Valeur de p (précision &gt; NIR)</td>
<td style="text-align: right;">&lt; 0,0001</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Interprétation des résultats du modèle</strong></p>
<p>L’interprétation des résultats d’un modèle binomial passe par la lecture des rapports de cotes (exponentiel des coefficients) et de leurs intervalles de confiance. Nous commençons donc par calculer la version robuste des erreurs standards des coefficients.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/">sandwich</a></span><span class="op">)</span> <span class="co"># pour calculer les erreurs standards robustes</span></span>
<span><span class="va">covModel2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html">vcovHC</a></span><span class="op">(</span><span class="va">model2</span>, type <span class="op">=</span> <span class="st">"HC0"</span><span class="op">)</span> <span class="co"># méthode HC0, basée sur les résidus</span></span>
<span><span class="va">stdErrRobuste</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">covModel2</span><span class="op">)</span><span class="op">)</span> <span class="co"># extraire la diagonale</span></span>
<span><span class="co"># Extraction des coefficients</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">model2</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co"># Recalcul des scores Z</span></span>
<span><span class="va">zvalRobuste</span> <span class="op">&lt;-</span> <span class="va">coeffs</span> <span class="op">/</span> <span class="va">stdErrRobuste</span></span>
<span><span class="co"># Recalcul des valeurs de P</span></span>
<span><span class="va">pvalRobuste</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">zvalRobuste</span><span class="op">)</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Calcul des rapports de cote</span></span>
<span><span class="va">oddRatio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span></span>
<span><span class="co"># Calcul des intervalles de confiance à 95 % des rapports de cote</span></span>
<span><span class="va">lowerBound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">stdErrRobuste</span><span class="op">)</span></span>
<span><span class="va">upperBound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">stdErrRobuste</span><span class="op">)</span></span>
<span><span class="co"># Étoiles pour les valeurs de p</span></span>
<span><span class="va">starsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">pvalRobuste</span> <span class="op">&lt;=</span>  <span class="fl">0.001</span>  <span class="op">~</span> <span class="st">"***"</span>,</span>
<span>                    <span class="va">pvalRobuste</span> <span class="op">&gt;</span>  <span class="fl">0.001</span> <span class="op">&amp;</span> <span class="va">pvalRobuste</span> <span class="op">&lt;=</span> <span class="fl">0.01</span> <span class="op">~</span> <span class="st">"**"</span>,</span>
<span>                    <span class="va">pvalRobuste</span> <span class="op">&gt;</span>  <span class="fl">0.01</span> <span class="op">&amp;</span> <span class="va">pvalRobuste</span> <span class="op">&lt;=</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="st">"*"</span>,</span>
<span>                    <span class="va">pvalRobuste</span> <span class="op">&gt;</span>  <span class="fl">0.05</span> <span class="op">&amp;</span> <span class="va">pvalRobuste</span> <span class="op">&lt;=</span> <span class="fl">0.1</span> <span class="op">~</span> <span class="st">"."</span>,</span>
<span>                    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">""</span></span>
<span>                    <span class="op">)</span></span>
<span><span class="co"># Compilation des résultats dans un tableau</span></span>
<span><span class="va">tableau_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  coefficients <span class="op">=</span> <span class="va">coeffs</span>,</span>
<span>  rap.cote <span class="op">=</span> <span class="va">oddRatio</span>,</span>
<span>  err.std <span class="op">=</span> <span class="va">stdErrRobuste</span>,</span>
<span>  score.z <span class="op">=</span> <span class="va">zvalRobuste</span>,</span>
<span>  p.val <span class="op">=</span> <span class="va">pvalRobuste</span>,</span>
<span>  rap.cote.2.5 <span class="op">=</span> <span class="va">lowerBound</span>,</span>
<span>  rap.cote.97.5 <span class="op">=</span> <span class="va">upperBound</span>,</span>
<span>  sign <span class="op">=</span> <span class="va">starsp</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Considérant que la variable <em>Pays</em> a 24 modalités, il est plus judicieux de présenter ses 23 rapports de cotes sous forme d’un graphique. Nous avons choisi l’Allemagne comme catégorie de référence puisqu’elle fait partie des pays avec une importante part modale pour le vélo sans pour autant constituer un cas extrême comme le Danemark.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Isoler les ligne du tableau récapitualtif pour les pays</span></span>
<span><span class="va">paysdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tableau_binom</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Pays"</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tableau_binom</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#paysdf$Pays &lt;- gsub("Pays" , "", row.names(paysdf), fixed = TRUE)</span></span>
<span><span class="va">paysdf</span><span class="op">$</span><span class="va">Pays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">paysdf</span><span class="op">)</span>, <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">paysdf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">paysdf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span> <span class="co">#afficher la valeur de référence</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">rap.cote.2.5</span>, xmax <span class="op">=</span> <span class="va">rap.cote.97.5</span>, </span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Pays</span>, <span class="va">rap.cote</span><span class="op">)</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rap.cote</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Pays</span>, <span class="va">rap.cote</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rap.cote.97.5</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Pays</span>, <span class="va">rap.cote</span><span class="op">)</span>, </span>
<span>                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"RC : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rap.cote</span>,<span class="fl">2</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">3</span>, nudge_x <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Rapports de cote"</span>, y <span class="op">=</span> <span class="st">"Pays (référence : Allemagne)"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-paysbinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-paysbinom-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.9: Rapports de cote pour les différents pays de l’UE</figcaption></figure>
</div>
</div>
</div>
<p>Dans la <a href="#fig-paysbinom">figure&nbsp;<span>8.9</span></a>, la barre horizontale pour chaque pays représente l’intervalle de confiance de son rapport de cotes (le point); plus cette ligne est longue, plus grande est l’incertitude autour de ce paramètre. Lorsque les lignes de deux pays se chevauchent, cela signifie qu’il n’y a pas de différence significative au seuil 0,05 entre les rapports de cotes des deux pays. La ligne rouge tracée à x = 1, représente le rapport de cotes du pays de référence (ici l’Allemagne). Nous constatons ainsi que comparativement à un individu vivant en Allemagne, ceux vivant au Danemark et aux Pays-Bas ont 2,4 fois plus de chances d’utiliser le vélo pour leur déplacement le plus fréquent. Les Pays de l’Ouest (France, Luxembourg, Royaume-Uni, Irlande) et du Sud (Grèce, Italie, Espagne, Portugal) ont en revanche des rapports de cotes plus faibles. En France, les chances qu’un individu utilise le vélo pour son trajet le plus fréquent sont 3,22 (1/0,31) fois plus faibles que si l’individu vivait en Allemagne.</p>
<p>Pour le reste des coefficients et des rapports de cotes, nous les rapportons dans le <a href="#tbl-coeffbinom">tableau&nbsp;<span>8.10</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffbinom" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.10: Résultats du modèle binomial</caption>
<colgroup>
<col style="width: 27%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coefficient</th>
<th style="text-align: right;">Rapport de cote</th>
<th style="text-align: right;">Err.std</th>
<th style="text-align: right;">Val.z</th>
<th style="text-align: right;">P</th>
<th style="text-align: right;">RC 2,5 %</th>
<th style="text-align: right;">RC 97,5 %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">-2,497</td>
<td style="text-align: right;">0,082</td>
<td style="text-align: right;">0,183</td>
<td style="text-align: right;">-13,674</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,058</td>
<td style="text-align: right;">0,118</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Sexe</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : femme</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">homme</td>
<td style="text-align: right;">0,372</td>
<td style="text-align: right;">1,451</td>
<td style="text-align: right;">0,038</td>
<td style="text-align: right;">9,803</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,347</td>
<td style="text-align: right;">1,562</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: right;">-0,009</td>
<td style="text-align: right;">0,991</td>
<td style="text-align: right;">0,002</td>
<td style="text-align: right;">-5,361</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,988</td>
<td style="text-align: right;">0,994</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Education</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : premier cycle</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">secondaire</td>
<td style="text-align: right;">0,193</td>
<td style="text-align: right;">1,213</td>
<td style="text-align: right;">0,105</td>
<td style="text-align: right;">1,836</td>
<td style="text-align: right;">0,066</td>
<td style="text-align: right;">0,987</td>
<td style="text-align: right;">1,490</td>
</tr>
<tr class="odd">
<td style="text-align: left;">secondaire inferieur</td>
<td style="text-align: right;">0,301</td>
<td style="text-align: right;">1,351</td>
<td style="text-align: right;">0,114</td>
<td style="text-align: right;">2,649</td>
<td style="text-align: right;">0,008</td>
<td style="text-align: right;">1,081</td>
<td style="text-align: right;">1,687</td>
</tr>
<tr class="even">
<td style="text-align: left;">universite</td>
<td style="text-align: right;">0,146</td>
<td style="text-align: right;">1,157</td>
<td style="text-align: right;">0,108</td>
<td style="text-align: right;">1,349</td>
<td style="text-align: right;">0,177</td>
<td style="text-align: right;">0,936</td>
<td style="text-align: right;">1,432</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>StatutEmploi</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ref : employe</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sans emploi</td>
<td style="text-align: right;">0,257</td>
<td style="text-align: right;">1,293</td>
<td style="text-align: right;">0,043</td>
<td style="text-align: right;">6,045</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,190</td>
<td style="text-align: right;">1,405</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Revenu</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : eleve</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">faible</td>
<td style="text-align: right;">0,077</td>
<td style="text-align: right;">1,080</td>
<td style="text-align: right;">0,072</td>
<td style="text-align: right;">1,067</td>
<td style="text-align: right;">0,286</td>
<td style="text-align: right;">0,938</td>
<td style="text-align: right;">1,244</td>
</tr>
<tr class="odd">
<td style="text-align: left;">moyen</td>
<td style="text-align: right;">0,042</td>
<td style="text-align: right;">1,043</td>
<td style="text-align: right;">0,065</td>
<td style="text-align: right;">0,639</td>
<td style="text-align: right;">0,523</td>
<td style="text-align: right;">0,917</td>
<td style="text-align: right;">1,185</td>
</tr>
<tr class="even">
<td style="text-align: left;">sans reponse</td>
<td style="text-align: right;">0,217</td>
<td style="text-align: right;">1,242</td>
<td style="text-align: right;">0,102</td>
<td style="text-align: right;">2,120</td>
<td style="text-align: right;">0,034</td>
<td style="text-align: right;">1,016</td>
<td style="text-align: right;">1,517</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tres eleve</td>
<td style="text-align: right;">-0,120</td>
<td style="text-align: right;">0,887</td>
<td style="text-align: right;">0,188</td>
<td style="text-align: right;">-0,637</td>
<td style="text-align: right;">0,524</td>
<td style="text-align: right;">0,613</td>
<td style="text-align: right;">1,283</td>
</tr>
<tr class="even">
<td style="text-align: left;">tres faible</td>
<td style="text-align: right;">0,240</td>
<td style="text-align: right;">1,271</td>
<td style="text-align: right;">0,086</td>
<td style="text-align: right;">2,776</td>
<td style="text-align: right;">0,006</td>
<td style="text-align: right;">1,073</td>
<td style="text-align: right;">1,505</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Residence</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ref : aire metropolitaine</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grande ville</td>
<td style="text-align: right;">0,273</td>
<td style="text-align: right;">1,314</td>
<td style="text-align: right;">0,070</td>
<td style="text-align: right;">3,911</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,146</td>
<td style="text-align: right;">1,507</td>
</tr>
<tr class="even">
<td style="text-align: left;">petite-moyenne ville</td>
<td style="text-align: right;">0,277</td>
<td style="text-align: right;">1,319</td>
<td style="text-align: right;">0,061</td>
<td style="text-align: right;">4,503</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,169</td>
<td style="text-align: right;">1,487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">zone rurale</td>
<td style="text-align: right;">-0,119</td>
<td style="text-align: right;">0,888</td>
<td style="text-align: right;">0,069</td>
<td style="text-align: right;">-1,713</td>
<td style="text-align: right;">0,087</td>
<td style="text-align: right;">0,775</td>
<td style="text-align: right;">1,017</td>
</tr>
<tr class="even">
<td style="text-align: left;">Duree</td>
<td style="text-align: right;">-0,001</td>
<td style="text-align: right;">0,999</td>
<td style="text-align: right;">0,001</td>
<td style="text-align: right;">-0,981</td>
<td style="text-align: right;">0,326</td>
<td style="text-align: right;">0,998</td>
<td style="text-align: right;">1,001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ConsEnv</td>
<td style="text-align: right;">0,102</td>
<td style="text-align: right;">1,108</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">10,502</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,087</td>
<td style="text-align: right;">1,130</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Les chances pour un individu d’utiliser le vélo pour son trajet le plus fréquent sont augmentées de 45&nbsp;% s’il s’agit d’un homme plutôt qu’une femme. Pour l’âge, nous constatons un effet relativement faible puisque chaque année supplémentaire réduit les chances qu’un individu utilise le vélo comme mode de transport pour son trajet le plus fréquent de 0,9&nbsp;% <span class="math inline">\(((\mbox{0,991}-\mbox{1})\times\mbox{100})\)</span>. Le fait d’être sans emploi augmente les chances d’utiliser le vélo de 29&nbsp;% comparativement au fait d’avoir un emploi. Concernant le niveau d’éducation, seul le coefficient pour le groupe des personnes de la catégorie «&nbsp;secondaire inférieure&nbsp;» est significatif, indiquant que les personnes de ce groupe ont 35&nbsp;% de chances en plus d’utiliser le vélo comme mode de transport pour leur déplacement le plus fréquent comparativement aux personnes de la catégorie «&nbsp;premier cycle&nbsp;». Pour le revenu, seul le groupe avec de très faibles revenus se distingue significativement du groupe avec un revenu élevé avec un rapport de cotes de 1,27, soit 27&nbsp;% de chances en plus d’utiliser le vélo.</p>
<p>Comparativement à ceux vivant dans une aire métropolitaine, les personnes vivant dans de petites, moyennes et grandes villes ont des chances accrues d’utiliser le vélo comme mode de déplacement pour leur trajet le plus fréquent. En revanche, nous n’observons aucune différence entre la probabilité d’utiliser le vélo dans une métropole et en zone rurale. La <a href="#fig-villebinom">figure&nbsp;<span>8.10</span></a> permet de clairement visualiser cette situation. Rappelons que la référence est la situation&nbsp;: vivre dans une région métropolitaine, représentée par la ligne verticale rouge. Plusieurs pistes d’interprétation peuvent être envisagées pour ce résultat&nbsp;:</p>
<ul>
<li><p>En métropole et dans les zones rurales, les distances domicile-travail tendent à être plus grandes que dans les petites, moyennes et grandes villes.</p></li>
<li><p>En métropole, le système de transport en commun est davantage développé et entre donc en concurrence avec les modes de transport actifs.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Isoler les lignes du tableau récapitulatif pour les lieux de résidence</span></span>
<span><span class="va">residdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">tableau_binom</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Residence"</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">tableau_binom</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">residdf</span><span class="op">$</span><span class="va">resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"Residence"</span> , <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">residdf</span><span class="op">)</span>, fixed<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">residdf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span> <span class="co">#afficher la valeur de référence</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">rap.cote.2.5</span>, xmax <span class="op">=</span> <span class="va">rap.cote.97.5</span>, y <span class="op">=</span> <span class="va">resid</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rap.cote</span>, y <span class="op">=</span> <span class="va">resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rap.cote.97.5</span>, y <span class="op">=</span> <span class="va">resid</span>, </span>
<span>                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"RC : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rap.cote</span>,<span class="fl">2</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">3</span>, nudge_x <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Rapports de cotes"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Lieu de résidence (référence : aire métropolitaine)"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-villebinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-villebinom-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.10: Rapports de cote pour les différents lieux de résidence</figcaption></figure>
</div>
</div>
</div>
<p>Il est aussi intéressant de noter que la durée des trajets ne semble pas influencer la probabilité d’utiliser le vélo. Enfin, une conscience environnementale plus affirmée semble être associée avec une probabilité supérieure d’utiliser le vélo pour son déplacement le plus fréquent, avec une augmentation des chances de 11&nbsp;% pour chaque point supplémentaire sur l’échelle de Likert.</p>
<p>Afin de simplifier la présentation de certains résultats, il est possible de calculer exactement les prédictions réalisées par le modèle. Un bon exemple ici est le cas de la variable <em>âge</em>. À quelle différence pouvons-nous nous attendre entre deux individus identiques ayant seulement une différence d’âge de 15 ans?</p>
<p>Prenons comme individu un homme de 30 ans, vivant dans une grande ville allemande, ayant un niveau d’éducation de niveau secondaire, employé, dans la tranche de revenu moyen, déclarant effectuer un trajet de 45 minutes et ayant rapporté un niveau de conscience environnementale de 5 (sur 10). Nous pouvons prédire la probabilité qu’il utilise le vélo pour son trajet le plus fréquent en utilisant la formule suivante&nbsp;:</p>
<p><span class="math display">\[logit(p) =  -\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{30} \times -\mbox{0,009} +  \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102}\]</span></p>
<p><span class="math display">\[p = \frac{exp(-\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{30} \times -\mbox{0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + 1 \times \mbox{0,273} + 45 \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102})}{(\mbox{1}+exp(-\mbox{2,497} + 1 \times \mbox{0,372} + \mbox{30} \times-\mbox{0,009} + 1 \times \mbox{0,193} + 1 \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + 5 \times \mbox{0,102}))} = \mbox{0,194}\]</span></p>
<p>Il y aurait 19,4&nbsp;% de chances pour que cette personne soit cycliste. Comme cette probabilité dépasse le seuil que nous avons sélectionné, cette personne serait classée comme cycliste. Si nous augmentons son âge de 15 ans, nous obtenons&nbsp;:</p>
<p><span class="math display">\[p = \frac{exp(-\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{45} \times \mbox{-0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102})} {(\mbox{1}+exp(-\mbox{2,497} + \mbox{1} \times \mbox{0,372} + \mbox{45} \times -\mbox{0,009} + \mbox{1} \times \mbox{0,193} + \mbox{1} \times \mbox{0,042} + \mbox{1} \times \mbox{0,273} + \mbox{45} \times -\mbox{0,001} + \mbox{5} \times \mbox{0,102}))} = \mbox{0,174}\]</span></p>
<p>soit une réduction de 2 points de pourcentages. Il est également possible de représenter cette évolution sur un graphique pour montrer l’effet sur l’étendue des valeurs possibles. Sur ces graphiques des effets marginaux, il est essentiel de représenter l’incertitude quant à la prédiction. En temps normal, la fonction <code>predict</code> calcule directement l’erreur standard de la prédiction et cette dernière peut être utilisée pour calculer l’intervalle de confiance de la prédiction. Cependant, nous voulons ici utiliser nos erreurs standards robustes. Nous devons donc procéder par simulation pour déterminer l’intervalle de confiance à 95&nbsp;% de nos prédictions. Cette opération nécessite de réaliser plusieurs opérations manuellement dans R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Créer un jeu de données fictif pour la prédiction</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">terms</span>, <span class="va">model2</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">age2seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">80</span><span class="op">)</span></span>
<span><span class="va">mat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">mat</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age2seq</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mat</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Age"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">age2seq</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"PaysBelgique"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Duree"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">45</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"ConsEnv"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"StatutEmploisans emploi"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Residencegrande ville"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Educationsecondaire"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Sexehomme"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Revenumoyen"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">mat2</span><span class="op">[</span>,<span class="st">"Revenufaible"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co"># Calculer la prédiction comme un log de rapport de cote (avec les erreurs standards)</span></span>
<span><span class="co"># en multipliant les coefficient par les valeurs des données fictives</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">model2</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="va">coeffs</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">mat2</span><span class="op">)</span></span>
<span><span class="co"># Simulation de prédictions (toujours en log de rapport de cote)</span></span>
<span><span class="co"># Étape 1 : simuler 1000 valeurs pour chaque coefficient</span></span>
<span><span class="va">sim_coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">coef</span> <span class="op">&lt;-</span> <span class="va">coeffs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">std.err</span> <span class="op">&lt;-</span> <span class="va">stdErrRobuste</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, mean <span class="op">=</span> <span class="va">coef</span>, sd <span class="op">=</span> <span class="va">std.err</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">vals</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sim_coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">sim_coeffs</span><span class="op">)</span></span>
<span><span class="co"># Étape 2 : effectuer les prédictions à partir des coefficients simulés</span></span>
<span><span class="va">sim_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">mat_sim_coeffs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">temp_coefs</span> <span class="op">&lt;-</span> <span class="va">mat_sim_coeffs</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">temp_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">temp_coefs</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">mat2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">temp_pred</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sim_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">sim_preds</span><span class="op">)</span></span>
<span><span class="co"># Étape 3 : extraire les intervalles de confiance pour les simulations</span></span>
<span><span class="va">intervals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mat_sim_preds</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">vec</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Étape 4 : récupérer tous ces éléments dans un DataFrame</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">80</span><span class="op">)</span>,</span>
<span>  pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Étape 5 : appliquer l'inverse de la fonction de lien pour</span></span>
<span><span class="co"># obtenir les prédictions en termes de probabilité</span></span>
<span><span class="va">ilink</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">family</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span><span class="op">$</span><span class="va">linkinv</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">prob_pred</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">prob_lower</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">prob_upper</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span></span>
<span><span class="co"># Étape 6 : représenter le tout sur un graphique</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age</span>, ymax <span class="op">=</span> <span class="va">prob_upper</span>, ymin <span class="op">=</span> <span class="va">prob_lower</span><span class="op">)</span>, </span>
<span>              fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age</span>, y <span class="op">=</span> <span class="va">prob_pred</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.15</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Âge"</span>, y <span class="op">=</span> <span class="st">"Probabilité prédite (intervalle de confiance à 95 %)"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-agebinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-agebinom-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.11: Effet de l’âge sur la probabilité d’utiliser le vélo comme moyen de déplacement pour son trajet le plus fréquent</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-agebinom">figure&nbsp;<span>8.11</span></a> permet de bien constater la diminution de la probabilité d’utiliser le vélo pour son trajet le plus fréquent avec l’âge, mais cette réduction est relativement ténue. Dans le cas utilisé en exemple, l’individu ne serait plus classé cycliste qu’après 67 ans.</p>
</section></section><section id="sec-0822" class="level3" data-number="8.2.2"><h3 data-number="8.2.2" class="anchored" data-anchor-id="sec-0822">
<span class="header-section-number">8.2.2</span> Modèle probit binomial</h3>
<p>Le modèle GLM probit binomial est pour ainsi dire le frère du modèle logistique binomial. La seule différence entre les deux réside dans l’utilisation d’une autre fonction de lien: probit plutôt que logistique. La fonction de lien probit (Φ) correspond à la fonction cumulative de la distribution normale et a également une forme de <em>S</em>. Cette version du modèle est plus souvent utilisée par les économistes. Le principal changement réside dans l’interprétation des coefficients <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span>. Du fait de la transformation probit, ces derniers indiquent le changement en termes de scores Z de la probabilité modélisée. Vous conviendrez qu’il ne s’agit pas d’une échelle très intuitive; la plupart du temps, seuls la significativité et le signe (positif ou négatif) des coefficients sont interprétés.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-probitdentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.11: Carte d’identité du modèle probit binomial</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable binaire (0 ou 1) ou comptage de réussite à une expérience (ex : 3 réussites sur 5 expériences)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Binomiale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Binomial(p)\)</span> <span class="math inline">\(g(p) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) = \Phi^-1(x)\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">probit</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;">p</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Non-séparation complète, absence de sur-dispersion ou de sous-dispersion</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-0823" class="level3" data-number="8.2.3"><h3 data-number="8.2.3" class="anchored" data-anchor-id="sec-0823">
<span class="header-section-number">8.2.3</span> Modèle logistique des cotes proportionnelles</h3>
<p>Le modèle logistique des cotes proportionnelles (aussi appelé modèle logistique cumulatif) est utilisé pour modéliser une variable qualitative ordinale. Un exemple classique de ce type de variable est une échelle de satisfaction (très insatisfait, insatisfait, mitigé, satisfait, très satisfait) qui peut être recodée avec des valeurs numériques (0, 1, 2, 3, 4; ces échelons étant notés <em>j</em>). Il n’existe pas à proprement parler de distribution pour représenter ces données, mais avec une petite astuce, il est possible de simplement utiliser la distribution binomiale. Cette astuce consiste à poser l’hypothèse de la proportionnalité des cotes, soit que le passage de la catégorie 0 à la catégorie 1 est proportionnel au passage de la catégorie 1 à la catégorie 2 et ainsi de suite. Si cette hypothèse est respectée, alors les coefficients du modèle pourront autant décrire le passage de la catégorie <em>satisfait</em> à celle <em>très satisfait</em> que le passage de <em>insatisfait</em> à <em>mitigé</em>. Si cette hypothèse n’est pas respectée, il faudrait des coefficients différents pour représenter les passages d’une catégorie à l’autre (ce qui est le cas pour le modèle multinomial présenté dans la <a href="#sec-0824">section&nbsp;<span>8.2.4</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-cumuldentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.12: Carte d’identité du modèle logistique des cotes proportionnelles</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable qualitative ordinale avec <em>j</em> catégories</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Binomiale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Binomial(p)\)</span> <span class="math inline">\(g(p \leq j) = \beta_{0j} + \beta X\)</span> <span class="math inline">\(g(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">logistique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;">p</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta\)</span> et <em>j</em>-1 constantes <span class="math inline">\(\beta_{0j}\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Non-séparation complète, absence de sur-dispersion ou de sous-dispersion, Proportionnalité des cotes</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Ainsi, dans le modèle logistique binomial vu précédemment, nous modélisons la probabilité d’observer un évènement <span class="math inline">\(P(Y = 1)\)</span>. Dans un modèle logistique ordinal, nous modélisons la probabilité cumulative d’observer l’échelon <em>j</em> de notre variable ordinale <span class="math inline">\(P(Y \leq j)\)</span>. L’intérêt de cette reformulation est que nous conservons la facilité d’interprétation du modèle logistique binomial classique avec les rapports de cotes, à ceci prêt qu’ils représentent maintenant la probabilité de passer à un échelon supérieur de <em>Y</em>. La différence pratique est que notre modèle se retrouve avec autant de constantes qu’il y a de catégories à prédire moins une, chacune de ces constantes contrôlant la probabilité de base de passer de la catégorie <em>j</em> à la catégorie <em>j</em>&nbsp;+&nbsp;1.</p>
<section id="sec-08231" class="level4" data-number="8.2.3.1"><h4 data-number="8.2.3.1" class="anchored" data-anchor-id="sec-08231">
<span class="header-section-number">8.2.3.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que pour un modèle binomial, avec bien sûr l’ajout de l’hypothèse sur la proportionnalité des cotes. Selon cette hypothèse, l’effet de chaque variable indépendante est identique sur la probabilité de passer d’un échelon de la variable <em>Y</em> au suivant. Afin de tester cette condition, deux approches sont envisageables&nbsp;:</p>
<ol type="1">
<li><p>Utiliser l’approche de Brant <span class="citation" data-cites="brant1990assessing">(<a href="references.html#ref-brant1990assessing" role="doc-biblioref">1990</a>)</span>. Il s’agit d’un test statistique comparant les résultats du modèle ordinal avec ceux d’une série de modèles logistiques binomiaux (1 pour chaque catégorie possible de <em>Y</em>).</p></li>
<li><p>Ajuster un modèle ordinal sans l’hypothèse de proportionnalité des cotes et effectuer un test de ratio des <em>likelihood</em> pour vérifier si le premier est significativement mieux ajusté.</p></li>
</ol>
<p>Si certaines variables ne respectent pas cette condition d’application, trois options sont possibles pour y remédier&nbsp;:</p>
<ol type="1">
<li><p>Supprimer la variable du modèle (à éviter si cette variable est importante dans votre cadre théorique).</p></li>
<li><p>Autoriser la variable à avoir un effet différent entre chaque palier (possible avec le <em>package</em> <code>VGAM</code>).</p></li>
<li><p>Changer de modèle et opter pour un modèle des catégories adjacentes. Il s’agit du cas particulier où toutes les variables sont autorisées à changer à chaque niveau. Ne pas confondre ce dernier modèle et le modèle multinomial (<a href="#sec-0824">section&nbsp;<span>8.2.4</span></a>), puisque le modèle des catégories adjacentes continue à prédire la probabilité de passer à une catégorie supérieure.</p></li>
</ol></section><section id="sec-08232" class="level4" data-number="8.2.3.2"><h4 data-number="8.2.3.2" class="anchored" data-anchor-id="sec-08232">
<span class="header-section-number">8.2.3.2</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous analysons un jeu de données proposé par <a href="http://insideairbnb.com/get-the-data.html">Inside Airbnb</a>, une organisation sans but lucratif collectant des données des annonces sur le site d’Airbnb pour alimenter le débat sur l’effet de cette société sur les quartiers. Plus spécifiquement, nous utilisons le jeu de données pour Montréal compilé le 30 juin 2020. Nous modélisons ici le prix par nuit des logements, ce type d’exercice est appelé modélisation hédonique. Il est particulièrement utilisé en économie urbaine pour évaluer les déterminants du marché immobilier et prédire son évolution. Le cas d’Airbnb a déjà été étudié dans plusieurs articles <span class="citation" data-cites="teubner2017price wang2017price zhang2017key">(<a href="references.html#ref-teubner2017price" role="doc-biblioref">Teubner, Hawlitschek et Dann 2017</a>; <a href="references.html#ref-wang2017price" role="doc-biblioref">Wang et Nicolau 2017</a>; <a href="references.html#ref-zhang2017key" role="doc-biblioref">Zhang et al. 2017</a>)</span>. Il en ressort notamment que le niveau de confiance inspiré par l’hôte, les caractéristiques intrinsèques du logement et sa localisation sont les principales variables indépendantes de son prix. Nous construisons donc notre modèle sur cette base. Notez que nous avons décidé de retirer les logements avec des prix supérieurs à 250&nbsp;$ par nuit qui constituent des cas particuliers et qui devraient faire l’objet d’une analyse à part entière. Nous avons également retiré les observations pour lesquelles certaines données sont manquantes, et obtenons un nombre final de 9&nbsp;051 observations.</p>
<p>La distribution originale du prix des logements dans notre jeu de données est présentée à la <a href="#fig-histopriceairbnb">figure&nbsp;<span>8.12</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Charger le jeu de données</span></span>
<span><span class="va">data_airbnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/airbnb_data.csv"</span><span class="op">)</span></span>
<span><span class="co"># Afficher la distribution du prix</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_airbnb</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">price</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                 color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"#1d3557"</span>, linewidth <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Prix (en dollars)"</span>, y <span class="op">=</span> <span class="st">"Fréquence"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-histopriceairbnb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-histopriceairbnb-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.12: Distribution des prix des logements Airbnb</figcaption></figure>
</div>
</div>
</div>
<p>Nous avons ensuite découpé le prix des logements en trois catégories&nbsp;: inférieur à 50&nbsp;$, de 50&nbsp;$ à 99&nbsp;$ et de 100&nbsp;$ à 249&nbsp;$. Ces catégories forment une variable ordinale de trois échelons que nous modélisons à partir de trois catégories de variables&nbsp;:</p>
<ul>
<li>les caractéristiques propres au logement;</li>
<li>les caractéristiques environnementales autour du logement;</li>
<li>les notes obtenues par le logement sur le site d’Airbnb.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Afficher le nombre de logement par catégories</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data_airbnb</span><span class="op">$</span><span class="va">fac_price_cat</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2    3 
2212 3911 2928 </code></pre>
</div>
</div>
<p>Le <a href="#tbl-variablecumul">tableau&nbsp;<span>8.13</span></a> présente l’ensemble des variables utilisées dans le modèle.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-variablecumul" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.13: Variables indépendantes utilisées pour prédire la catégorie de prix de logements Airbnb</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 32%">
<col style="width: 8%">
<col style="width: 48%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom de la variable</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Type de variable</th>
<th style="text-align: left;">Mesure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beds</td>
<td style="text-align: left;">Nombre de lits dans le logement</td>
<td style="text-align: left;">Variable de comptage</td>
<td style="text-align: left;">Nombre de lits dans le logement</td>
</tr>
<tr class="even">
<td style="text-align: left;">Garden_or_backyard</td>
<td style="text-align: left;">Présence d’un jardin ou d’une arrière-cour</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Oui ou non</td>
</tr>
<tr class="odd">
<td style="text-align: left;">private</td>
<td style="text-align: left;">Le logement est entièrement à disposition du locataire ou seulement une pièce</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Privé ou partagé</td>
</tr>
<tr class="even">
<td style="text-align: left;">Free_street_parking</td>
<td style="text-align: left;">Une place de stationnement gratuite est disponible sur la rue</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Oui ou non</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Host_greets_you</td>
<td style="text-align: left;">L’hôte accueille personnellement les locataires</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Oui ou non</td>
</tr>
<tr class="even">
<td style="text-align: left;">prt_veg_500m</td>
<td style="text-align: left;">Végétation dans les environs du logement</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de surface végétale dans un rayon de 500 mètres autour du logement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">has_metro_500m</td>
<td style="text-align: left;">Présence d’une station de métro à proximité du logement</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Présence d’une station de métro dans un rayon de 500 mètres autour du logement</td>
</tr>
<tr class="even">
<td style="text-align: left;">commercial_1km</td>
<td style="text-align: left;">Commerce dans les environs du logement</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de surface dédiée au commerce (mode d’occupation du sol) dans un rayon d’un kilomètre autour du logement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cat_review</td>
<td style="text-align: left;">Évaluation de la qualité du logement par les usagers</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Note obtenue par le logement sur une échelle allant de 1 (très mauvais) à 5 (parfait)</td>
</tr>
<tr class="even">
<td style="text-align: left;">host_total_listings_count</td>
<td style="text-align: left;">Nombre total de logements détenus par l’hôte sur Airbnb</td>
<td style="text-align: left;">Variable de comptage</td>
<td style="text-align: left;">Nombre total de logements détenus par l’hôte sur Airbnb</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Avant d’ajuster le modèle, il convient de vérifier l’absence de multicolinéarité excessive entre les variables indépendantes.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Notez que la fonction vif ne s'intéresse qu'aux variables indépendantes.</span></span>
<span><span class="co"># Vous pouvez ainsi utiliser la fonction glm avec la fonction vif </span></span>
<span><span class="co"># pour n'importe quel modèle glm</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">price</span> <span class="op">~</span> <span class="va">beds</span> <span class="op">+</span></span>
<span>    <span class="va">Garden_or_backyard</span> <span class="op">+</span> <span class="va">Host_greets_you</span> <span class="op">+</span> <span class="va">Free_street_parking</span> <span class="op">+</span> </span>
<span>      <span class="va">prt_veg_500m</span> <span class="op">+</span> <span class="va">has_metro_500m</span> <span class="op">+</span> <span class="va">commercial_1km</span> <span class="op">+</span><span class="va">host_total_listings_count</span> <span class="op">+</span></span>
<span>      <span class="va">private</span> <span class="op">+</span> <span class="va">cat_review</span>, data <span class="op">=</span> <span class="va">data_airbnb</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     beds        Garden_or_backyard           Host_greets_you 
                 1.123595                  1.079324                  1.046884 
      Free_street_parking              prt_veg_500m            has_metro_500m 
                 1.142189                  1.532536                  1.239516 
           commercial_1km host_total_listings_count                   private 
                 1.225301                  1.058232                  1.143932 
               cat_review 
                 1.015778 </code></pre>
</div>
</div>
<p>Toutes les valeurs de VIF sont inférieures à 2, indiquant une absence de multicolinéarité excessive. Nous pouvons alors ajuster le modèle et analyser les distances de Cook afin de vérifier la présence ou non d’observations très influentes. Pour ajuster le modèle, nous utilisons le <em>package</em> <code>VGAM</code> et la fonction <code>vglm</code> qui nous donnent accès à la famille <code>cumulative</code> pour ajuster des modèles logistiques ordinaux. Notez que le fonctionnement de base de cette famille est de modéliser <span class="math inline">\(P(Y\leq1),P(Y\leq2),...,P(Y\leq J)\)</span> avec <em>J</em> le nombre de catégories. Cependant, nous voulons ici modéliser la probabilité de passer à une catégorie supérieure de prix. Pour cela, il est nécessaire de spécifier le paramètre <code>reverse = TRUE</code> pour la famille <code>cumulative</code> (voir <code><a href="https://rdrr.io/pkg/VGAM/man/cumulative.html">help(cumulative)</a></code> pour plus de détails).</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.auckland.ac.nz/~yee/VGAM/">VGAM</a></span><span class="op">)</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">fac_price_cat</span> <span class="op">~</span> <span class="va">beds</span> <span class="op">+</span></span>
<span>                <span class="va">Garden_or_backyard</span> <span class="op">+</span> <span class="va">Free_street_parking</span> <span class="op">+</span> </span>
<span>                <span class="va">prt_veg_500m</span> <span class="op">+</span> <span class="va">has_metro_500m</span> <span class="op">+</span> <span class="va">commercial_1km</span> <span class="op">+</span></span>
<span>                <span class="va">private</span> <span class="op">+</span> <span class="va">cat_review</span> <span class="op">+</span> <span class="va">host_total_listings_count</span> ,</span>
<span>             family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/cumulative.html">cumulative</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logitlink"</span>, <span class="co"># fonction de lien </span></span>
<span>                                 parallel <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># cote proportionnelle</span></span>
<span>                                 reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_airbnb</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notez que, puisque la variable <em>Y</em> a trois catégories différentes et que nous modélisons la probabilité de passer à une catégorie supérieure, chaque observation a alors deux (3-1) valeurs de résidus différentes. Par conséquent, nous calculons deux distances de Cook différentes que nous devons analyser conjointement. Malheureusement, la fonction <code>cook.distance</code> ne fonctionne pas avec les objets <code>vglm</code>, nous devons donc les calculer manuellement.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span><span class="co"># Extraction des résidus</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span>
<span><span class="co"># Extraction de la hat matrix (nécessaire pour calculer la distance de Cook)</span></span>
<span><span class="va">hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hatvalues.html">hatvaluesvlm</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">cooks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="va">hat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">cook</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">r</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">h</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">*</span> <span class="va">modele</span><span class="op">@</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Structuration dans un DataFrame</span></span>
<span><span class="va">matcook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">cooks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">matcook</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dist1"</span> , <span class="st">"dist2"</span><span class="op">)</span></span>
<span><span class="va">matcook</span><span class="op">$</span><span class="va">oid</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">matcook</span><span class="op">)</span></span>
<span><span class="co"># Afficher les distances de Cook</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">matcook</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">dist1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, subtitle <span class="op">=</span> <span class="st">"distance de Cook P(Y&gt;=2)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">matcook</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">dist2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, subtitle <span class="op">=</span> <span class="st">"distance de Cook P(Y&gt;=3)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-CookdCotePropor" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-CookdCotePropor-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.13: Distances de Cook pour le modèle logistique des cotes proportionnelles</figcaption></figure>
</div>
</div>
</div>
<p>Les distances de Cook (<a href="#fig-CookdCotePropor">figure&nbsp;<span>8.13</span></a>) nous permettent d’identifier quelques observations potentiellement trop influentes, mais elles semblent être différentes d’un graphique à l’autre. Nous décidons donc de ne pas retirer d’observations à ce stade et de passer à l’analyse des résidus simulés. Pour effectuer des simulations à partir de ce modèle, nous nous basons sur les probabilités d’appartenance prédites par le modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraire les probabilités prédites</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">predicted</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      1     2     3
1 0.706 0.267 0.028
2 0.073 0.461 0.466
3 0.687 0.283 0.030
4 0.049 0.383 0.568</code></pre>
</div>
</div>
<p>Nous constatons ainsi que, pour la première observation, la probabilité prédite d’appartenir au groupe 1 est de 69,4&nbsp;%, de 27,7&nbsp;% pour le groupe 2 et de 2,9&nbsp;% pour le groupe 3. Si nous effectuons 1&nbsp;000 simulations, nous pouvons nous attendre à ce qu’en moyenne, sur ces 1&nbsp;000 simulations, 694&nbsp;indiqueront 1 comme catégorie prédite, 277&nbsp;indiqueront 2 et seulement 29&nbsp;indiqueront 3.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Nous effectuerons 1000 simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="co"># Lancement des simulations pour chaque observation (lignes dans predicted)</span></span>
<span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">predicted</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">nsim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Combiner les prédictions dans un tableau</span></span>
<span><span class="va">matsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulations</span><span class="op">)</span></span>
<span><span class="co"># Observons si nos simulations sont proches de ce que nous attendions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">matsim</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  1   2   3 
719 255  26 </code></pre>
</div>
</div>
<p>À partir de ces simulations de prédiction, nous pouvons réaliser un diagnostic des résidus simulés grâce au <em>package</em> <code>DHARMa</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/">DHARMa</a></span><span class="op">)</span></span>
<span><span class="co"># Extraction de la prédiction moyenne du modèle</span></span>
<span><span class="va">pred_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data_airbnb</span><span class="op">$</span><span class="va">fac_price_cat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Préparer les données avec le package DHARMa</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">matsim</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data_airbnb</span><span class="op">$</span><span class="va">fac_price_cat</span><span class="op">)</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">pred_cat</span><span class="op">)</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Afficher le graphique de diagnostic général</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diagressimcumul" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-diagressimcumul-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.14: Diagnostic général des résidus simulés du modèle des cotes proportionnelles</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-diagressimcumul">figure&nbsp;<span>8.14</span></a> nous indique que les résidus simulés suivent bien une distribution uniforme et qu’aucune valeur aberrante n’est observable. Pour affiner notre diagnostic, nous vérifions également si aucune relation ne semble exister entre chaque variable indépendante et les résidus.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Préparons un plot multiple</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nombre de lits"</span> <span class="op">=</span> <span class="st">"beds"</span>,</span>
<span>          <span class="st">"couvert végétal"</span> <span class="op">=</span> <span class="st">"prt_veg_500m"</span>, </span>
<span>          <span class="st">"commercial"</span> <span class="op">=</span> <span class="st">"commercial_1km"</span>,</span>
<span>          <span class="st">"nb logements hôte"</span> <span class="op">=</span> <span class="st">"host_total_listings_count"</span>,</span>
<span>          <span class="st">"jardin"</span> <span class="op">=</span> <span class="st">"Garden_or_backyard"</span>,</span>
<span>          <span class="st">"accueil"</span> <span class="op">=</span> <span class="st">"Host_greets_you"</span>,</span>
<span>          <span class="st">"stationnement gratuit"</span> <span class="op">=</span> <span class="st">"Free_street_parking"</span>, </span>
<span>          <span class="st">"métro"</span> <span class="op">=</span> <span class="st">"has_metro_500m"</span>, </span>
<span>          <span class="st">"logement privé"</span> <span class="op">=</span> <span class="st">"private"</span>,</span>
<span>          <span class="st">"évaluation"</span> <span class="op">=</span> <span class="st">"cat_review"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">name</span> <span class="kw">in</span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="va">vars</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html">plotResiduals</a></span><span class="op">(</span><span class="va">sim_res</span>, <span class="va">data_airbnb</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span>, rank <span class="op">=</span> <span class="cn">FALSE</span>, quantreg <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">""</span>,</span>
<span>                xlab <span class="op">=</span> <span class="va">name</span>, ylab <span class="op">=</span> <span class="st">"résidus"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagressimcumul2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/diagressimcumul2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.15: Diagnostic des variables indépendantes et des résidus simulés du modèle des cotes proportionnelles</figcaption></figure>
</div>
</div>
</div>
<p>La fonction <code>plotResiduals</code> du <em>package</em> <code>DHARMa</code> produit des graphiques peu esthétiques, mais pratiques pour effectuer ce type de diagnostic.</p>
<p>La <a href="#fig-diagressimcumul2">figure&nbsp;<span>8.15</span></a> indique qu’aucune relation marquée n’existe entre nos variables indépendantes et nos résidus simulés, sauf pour la variable <em>nombre de lits</em>. En effet, nous pouvons constater que les résidus ont tendance à être toujours plus faibles quand le nombre de lits augmente. Cet effet est sûrement lié au fait qu’au-delà de cinq lits, le logement en question est vraisemblablement un dortoir. Il pourrait être judicieux de retirer ces observations de l’analyse, considérant qu’elles sont peu nombreuses et constituent un type de logement particulier.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_airbnb2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_airbnb</span>, <span class="va">data_airbnb</span><span class="op">$</span><span class="va">beds</span> <span class="op">&lt;=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">fac_price_cat</span> <span class="op">~</span> <span class="va">beds</span>  <span class="op">+</span> </span>
<span>                <span class="va">Garden_or_backyard</span> <span class="op">+</span> <span class="va">Free_street_parking</span> <span class="op">+</span> </span>
<span>                <span class="va">prt_veg_500m</span> <span class="op">+</span> <span class="va">has_metro_500m</span> <span class="op">+</span> <span class="va">commercial_1km</span> <span class="op">+</span></span>
<span>                <span class="va">private</span> <span class="op">+</span> <span class="va">cat_review</span> <span class="op">+</span> <span class="va">host_total_listings_count</span> ,</span>
<span>             family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/cumulative.html">cumulative</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logitlink"</span>, <span class="co"># fonction de lien </span></span>
<span>                                 parallel <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># cote proportionelle</span></span>
<span>                                 reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             data <span class="op">=</span> <span class="va">data_airbnb2</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons ensuite recalculer les résidus simulés pour observer si cette tendance a été corrigée. La <a href="#fig-diagressimcumul3">figure&nbsp;<span>8.16</span></a> montre qu’une bonne partie du problème a été corrigée; cependant, il semble tout de même que les résidus soient plus forts pour les logements avec un seul lit.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Nous effectuerons 1000 simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Lancement des simulations pour chaque observation (lignes dans predicted)</span></span>
<span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">predicted</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">nsim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Combiner les prédictions dans un tableau</span></span>
<span><span class="va">matsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulations</span><span class="op">)</span></span>
<span><span class="co"># Extraction de la prédiction moyenne du modèle</span></span>
<span><span class="va">pred_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data_airbnb2</span><span class="op">$</span><span class="va">fac_price_cat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Préparer les donnees avec le package DHARMa</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">matsim</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data_airbnb2</span><span class="op">$</span><span class="va">fac_price_cat</span><span class="op">)</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">pred_cat</span><span class="op">)</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nombre de lits"</span> <span class="op">=</span> <span class="st">"beds"</span>,</span>
<span>          <span class="st">"couvert végétal"</span> <span class="op">=</span> <span class="st">"prt_veg_500m"</span>, </span>
<span>          <span class="st">"commercial"</span> <span class="op">=</span> <span class="st">"commercial_1km"</span>,</span>
<span>          <span class="st">"nb logements hôte"</span> <span class="op">=</span> <span class="st">"host_total_listings_count"</span>,</span>
<span>          <span class="st">"jardin"</span> <span class="op">=</span> <span class="st">"Garden_or_backyard"</span>,</span>
<span>          <span class="st">"accueil"</span> <span class="op">=</span> <span class="st">"Host_greets_you"</span>,</span>
<span>          <span class="st">"stationnement gratuit"</span> <span class="op">=</span> <span class="st">"Free_street_parking"</span>, </span>
<span>          <span class="st">"métro"</span> <span class="op">=</span> <span class="st">"has_metro_500m"</span>, </span>
<span>          <span class="st">"logement privé"</span> <span class="op">=</span> <span class="st">"private"</span>,</span>
<span>          <span class="st">"évaluation"</span> <span class="op">=</span> <span class="st">"cat_review"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">name</span> <span class="kw">in</span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vars</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="va">vars</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html">plotResiduals</a></span><span class="op">(</span><span class="va">sim_res</span>, <span class="va">data_airbnb2</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span>, rank <span class="op">=</span> <span class="cn">FALSE</span>, quantreg <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">""</span>,</span>
<span>                xlab <span class="op">=</span> <span class="va">name</span>, ylab <span class="op">=</span> <span class="st">"résidus"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagressimcumul3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/diagressimcumul3.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.16: Diagnostic des variables indépendantes et des résidus simulés du modèle des cotes proportionnelles (après correction)</figcaption></figure>
</div>
</div>
</div>
<p>La prochaine étape du diagnostic est de vérifier l’absence de séparation parfaite provoquée par une de nos variables indépendantes. Le <em>package</em> <code>VGAM</code> propose pour cela la fonction <code>hdeff</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hdeff.html">hdeff</a></span><span class="op">(</span><span class="va">modele2</span><span class="op">)</span></span>
<span><span class="va">problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tests</span><span class="op">)</span></span>
<span><span class="va">problem</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tests
FALSE 
   11 </code></pre>
</div>
</div>
<p>La fonction nous informe qu’aucune de nos variables indépendantes ne provoque de séparation parfaite&nbsp;: toutes les valeurs renvoyées par la fonction <code>hdeff</code> sont égales à <code>FALSE.</code></p>
<p>Il ne nous reste donc plus qu’à vérifier que l’hypothèse de proportionnalité des cotes est respectée, soit que l’effet de chacune des variables indépendantes est bien le même pour passer de la catégorie 1 à 2 que pour passer de la catégorie 2 à 3. Pour cela, deux approches sont possibles&nbsp;: le test de Brant ou la réalisation d’une séquence de tests de rapport de vraisemblance.</p>
<p>Le <em>package</em> <code>brant</code> propose une implémentation du test de Brant, mais celle-ci ne peut être appliquée qu’à des modèles construits avec la fonction <code>polr</code> du <em>package</em> <code>MASS</code>. Nous avons donc récupéré le code source de la fonction <code>brant</code> du <em>package</em> <code>brant</code> et apporté quelques modifications pour qu’elle soit utilisable sur un objet <code>vglm</code>. Cette nouvelle fonction, appelée <code>brant.vglm</code>, est disponible dans le code source de ce livre.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tableau_brant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">brant.vglm</span><span class="op">(</span><span class="va">modele2</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------ 
Test for            X2  df  probability 
------------------------------------------------------------ 
Omnibus             113.72  9   0
beds                0.63    1   0.43
Garden_or_backyardYES       0.16    1   0.69
Free_street_parkingYES  0.84    1   0.36
prt_veg_500m            6.49    1   0.01
has_metro_500mYES       0.02    1   0.89
commercial_1km          0.01    1   0.92
privateEntier           93.56   1   0
cat_review          0.63    1   0.43
host_total_listings_count   1.51    1   0.22
------------------------------------------------------------ 

H0: Parallel Regression Assumption holds</code></pre>
</div>
</div>
<p>Ce premier tableau nous indique que seule la variable indiquant si le logement est disponible en entier ou partagé contrevient à l’hypothèse de proportionnalité des cotes (la seule valeur <em>p</em> significative). Pour confirmer cette observation, nous pouvons réaliser un ensemble de tests de rapport de vraisemblance. Pour chaque variable du modèle, nous créons un second modèle dans lequel cette variable est autorisée à varier pour chaque catégorie et nous comparons les niveaux d’ajustement des modèles. Nous avons implémenté cette procédure dans la fonction <code>parallel.likelihoodtest.vglm</code> disponible dans le code source de ce livre.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tableau_likelihood</span> <span class="op">&lt;-</span> <span class="fu">parallel.likelihoodtest.vglm</span><span class="op">(</span><span class="va">modele2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tableau_likelihood</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     variable non parallele   AIC loglikelihood p.val loglikelihood ratio test
1                      beds 15304         -7640                          0.271
2        Garden_or_backyard 15305         -7641                          0.417
3       Free_street_parking 15301         -7639                          0.079
4              prt_veg_500m 15296         -7636                          0.007
5            has_metro_500m 15303         -7640                          0.191
6            commercial_1km 15305         -7640                          0.271
7                   private 15215         -7595                          0.000
8                cat_review 15306         -7641                          0.430
9 host_total_listings_count 15304         -7640                          0.257</code></pre>
</div>
</div>
<p>Les résultats de cette seconde série de tests confirment les précédents, la variable concernant le type de logement doit être autorisée à varier en fonction de la catégorie. Ce second tableau nous indique que la variable concernant la densité de végétation pourrait aussi être amenée à varier en fonction du groupe, mais ce changement a un effet très marginal (différence entre les valeurs d’AIC de seulement 8&nbsp;points). Nous ajustons donc un nouveau modèle autorisant la variable <code>private</code> à changer en fonction de la catégorie prédite.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">fac_price_cat</span> <span class="op">~</span> <span class="va">beds</span> <span class="op">+</span> </span>
<span>                  <span class="va">Garden_or_backyard</span> <span class="op">+</span> <span class="va">Host_greets_you</span> <span class="op">+</span> <span class="va">Free_street_parking</span> <span class="op">+</span> </span>
<span>                  <span class="va">prt_veg_500m</span> <span class="op">+</span> <span class="va">has_metro_500m</span> <span class="op">+</span> <span class="va">commercial_1km</span> <span class="op">+</span></span>
<span>                  <span class="va">private</span> <span class="op">+</span> <span class="va">cat_review</span> <span class="op">+</span> <span class="va">host_total_listings_count</span>,</span>
<span>                family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/cumulative.html">cumulative</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logitlink"</span>,</span>
<span>                                    parallel <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">~</span> <span class="va">private</span> ,</span>
<span>                                    reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">data_airbnb2</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Vérification l’ajustement du modèle</strong></p>
<p>Maintenant que toutes les conditions d’application ont été passées en revue, nous pouvons passer à la vérification de l’ajustement du modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelenull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">fac_price_cat</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/cumulative.html">cumulative</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logitlink"</span>,</span>
<span>                                    parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">data_airbnb2</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modele3</span><span class="op">@</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_airbnb2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.2087098

$`McFadden ajuste`
[1] 0.2073552

$`Cox and Snell`
[1] 0.3606848

$Nagelkerke
[1] 0.4085924</code></pre>
</div>
</div>
<p>Le modèle final parvient à expliquer 21&nbsp;% de la déviance originale. Il obtient un R<sup>2</sup> ajusté de McFadden de 0,21, et des R<sup>2</sup> de Cox et Snell et de Nagelkerke de respectivement 0,36 et 0,41. Construisons à présent la matrice de confusion de la prédiction du modèle (nous utilisons ici la fonction <code>nice_confusion_matrix</code> également disponible dans le code source de ce livre).</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span></span>
<span><span class="va">pred_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">preds_probs</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="va">matrices</span> <span class="op">&lt;-</span> <span class="fu">nice_confusion_matrix</span><span class="op">(</span><span class="va">data_airbnb2</span><span class="op">$</span><span class="va">fac_price_cat</span>, <span class="va">pred_cat</span><span class="op">)</span></span>
<span><span class="co"># Afficher la matrice de confusion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">matrices</span><span class="op">$</span><span class="va">confusion_matrix</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          rowsnames    1          2          3          rs      rp    
colsnames ""           "1 (reel)" "2 (reel)" "3 (reel)" "Total" "%"   
1         "1 (predit)" "1576"     "736"      "168"      "2480"  "27.7"
2         "2 (predit)" "579"      "2385"     "1331"     "4295"  "48"  
3         "3 (predit)" "49"       "771"      "1360"     "2180"  "24.3"
          "Total"      "2204"     "3892"     "2859"     "8955"  NA    
          "%"          "24.6"     "43.5"     "31.9"     NA      NA    </code></pre>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Afficher les indicateurs de qualité de prédiction</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">matrices</span><span class="op">$</span><span class="va">indicators</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             rnames                           precision rappel F1    
1            "1"                              "0.64"    "0.72" "0.67"
2            "2"                              "0.56"    "0.61" "0.58"
3            "3"                              "0.62"    "0.48" "0.54"
macro_scores "macro"                          "0.6"     "0.59" "0.59"
             "Kappa"                          "0.37"    NA     NA    
             "Valeur de p  (precision &gt; NIR)" "0"       NA     NA    </code></pre>
</div>
</div>
<p>Le modèle a une précision totale de 61&nbsp;% (61&nbsp;% des observations ont été correctement prédites). La catégorie 1 a de loin la meilleure précision (72&nbsp;%) et la 3 a la pire (48&nbsp;%), ce qui indique qu’il manque vraisemblablement des variables indépendantes contribuant à prédire les prix des logements les plus chers. Le coefficient de Kappa (0,37) indique un niveau d’accord entre modéré et faible, mais le modèle parvient à une prédiction significativement supérieure au seuil de non-information. Si l’ajustement du modèle est imparfait, il est suffisamment fiable pour nous donner des renseignements pertinents sur le phénomène étudié.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>. À partir des coefficients et de leurs erreurs standards, il est possible de calculer les rapports de cotes ainsi que leurs intervalles de confiance.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tableau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">@</span><span class="va">coef3</span></span>
<span><span class="va">rappCote</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">tableau</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rappCote2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">tableau</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">tableau</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rappCote97.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">tableau</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">tableau</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tableau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tableau</span>, <span class="va">rappCote</span>, <span class="va">rappCote2.5</span>, <span class="va">rappCote97.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">tableau</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Estimate Std. Error z value Pr(&gt;|z|) rappCote
(Intercept):1               -1.203      0.137  -8.768    0.000    0.300
(Intercept):2               -3.240      0.151 -21.516    0.000    0.039
beds                         0.748      0.027  28.143    0.000    2.113
Garden_or_backyardYES        0.120      0.067   1.795    0.073    1.128
Host_greets_youYES           0.094      0.060   1.548    0.122    1.098
Free_street_parkingYES      -0.015      0.046  -0.320    0.749    0.985
prt_veg_500m                -0.026      0.003 -10.182    0.000    0.975
has_metro_500mYES            0.063      0.048   1.326    0.185    1.065
commercial_1km               0.008      0.008   0.955    0.340    1.008
privateEntier:1              2.445      0.062  39.241    0.000   11.533
privateEntier:2              1.576      0.081  19.573    0.000    4.834
cat_review                   0.200      0.021   9.563    0.000    1.222
host_total_listings_count   -0.002      0.001  -2.094    0.036    0.998
                          rappCote2.5 rappCote97.5
(Intercept):1                   0.230        0.393
(Intercept):2                   0.029        0.053
beds                            2.006        2.226
Garden_or_backyardYES           0.989        1.287
Host_greets_youYES              0.975        1.236
Free_street_parkingYES          0.900        1.078
prt_veg_500m                    0.970        0.980
has_metro_500mYES               0.970        1.170
commercial_1km                  0.992        1.024
privateEntier:1                10.207       13.031
privateEntier:2                 4.128        5.660
cat_review                      1.173        1.273
host_total_listings_count       0.996        1.000</code></pre>
</div>
</div>
<p>Pour faciliter la lecture des résultats, nous proposons le <a href="#tbl-FinalOrdinale">tableau&nbsp;<span>8.14</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-FinalOrdinale" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.14: Coefficients du modèle logistique des cotes proportionnelles</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 7%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coefficient</th>
<th style="text-align: right;">RC</th>
<th style="text-align: right;">P</th>
<th style="text-align: right;">RC 2,5 %</th>
<th style="text-align: right;">RC 97,5 %</th>
<th style="text-align: right;">sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept):1</td>
<td style="text-align: right;">-1,200</td>
<td style="text-align: right;">0,300</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,230</td>
<td style="text-align: right;">0,395</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">(Intercept):2</td>
<td style="text-align: right;">-3,240</td>
<td style="text-align: right;">0,039</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,029</td>
<td style="text-align: right;">0,052</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beds</td>
<td style="text-align: right;">0,750</td>
<td style="text-align: right;">2,113</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">2,014</td>
<td style="text-align: right;">2,226</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Garden_or_backyard</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : NO</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">YES</td>
<td style="text-align: right;">0,120</td>
<td style="text-align: right;">1,128</td>
<td style="text-align: right;">0,073</td>
<td style="text-align: right;">0,990</td>
<td style="text-align: right;">1,284</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Host_greets_you</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ref : NO</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="odd">
<td style="text-align: left;">YES</td>
<td style="text-align: right;">0,090</td>
<td style="text-align: right;">1,098</td>
<td style="text-align: right;">0,122</td>
<td style="text-align: right;">0,980</td>
<td style="text-align: right;">1,234</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Free_street_parking</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : NO</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">YES</td>
<td style="text-align: right;">-0,010</td>
<td style="text-align: right;">0,985</td>
<td style="text-align: right;">0,749</td>
<td style="text-align: right;">0,896</td>
<td style="text-align: right;">1,083</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">prt_veg_500m</td>
<td style="text-align: right;">-0,030</td>
<td style="text-align: right;">0,975</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,970</td>
<td style="text-align: right;">0,980</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>has_metro_500m</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : NO</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">YES</td>
<td style="text-align: right;">0,060</td>
<td style="text-align: right;">1,065</td>
<td style="text-align: right;">0,185</td>
<td style="text-align: right;">0,970</td>
<td style="text-align: right;">1,174</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">commercial_1km</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">1,008</td>
<td style="text-align: right;">0,340</td>
<td style="text-align: right;">0,990</td>
<td style="text-align: right;">1,020</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">cat_review</td>
<td style="text-align: right;">0,200</td>
<td style="text-align: right;">1,222</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,174</td>
<td style="text-align: right;">1,271</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">host_total_listings_count</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,998</td>
<td style="text-align: right;">0,036</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Effets par niveau</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>private</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : Chambre</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">Entier:1</td>
<td style="text-align: right;">2,450</td>
<td style="text-align: right;">11,533</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">10,176</td>
<td style="text-align: right;">13,066</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Entier:2</td>
<td style="text-align: right;">1,580</td>
<td style="text-align: right;">4,834</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">4,137</td>
<td style="text-align: right;">5,641</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Sans surprise, chaque lit supplémentaire contribue à augmenter les chances que le logement soit dans une catégorie de prix supérieure (multiplication par deux à chaque lit supplémentaire). En revanche, la présence d’un stationnement gratuit, d’un jardin et l’accueil en personne par l’hôte n’ont pas d’effets significatifs. Comme l’indiquent les articles mentionnés en début de section, les revues positives augmentent la probabilité d’appartenir à une catégorie supérieure de prix. Pour chaque point supplémentaire sur l’échelle de 1 à 5, la probabilité d’appartenir à une catégorie de prix supérieure augmente de 22,2&nbsp;%. Il est intéressant de noter que le fait de disposer du logement entier plutôt que d’une simple chambre augmente davantage les chances de passer du groupe de prix 1 à 2 (multiplication par 2,45) que du groupe 2 à 3 (multiplication par 1,58). Il semble également que si l’hôte possède plusieurs logements, la probabilité d’avoir une classe de prix supérieure diminue légèrement. Cependant, l’effet est trop petit pour pouvoir se livrer à des interprétations.</p>
<p>Les variables environnementales ont peu d’effet&nbsp;: le pourcentage de surface commerciale dans un rayon d’un kilomètre et la présence d’une station de métro ne sont pas significatifs. En revanche, une augmentation de la surface végétale dans un rayon de 500 mètres tend à réduire la probabilité d’appartenir à une classe supérieure. Notre hypothèse concernant ce résultat est que cette variable représente un effet associé à la localisation des Airbnb, les plus centraux ayant tendance à être plus dispendieux, mais avec un environnement moins vert et inversement. Pour l’illustrer, prédisons les probabilités d’appartenance aux différents niveaux de prix d’un logement avec les caractéristiques suivantes&nbsp;: entièrement privé, 2 lits, un jardin, une place de stationnement gratuite, l’hôte ne dispose que d’un logement sur Airbnb et accueille les arrivants en personne, 10&nbsp;% de surface commerciale dans un rayon d’un kilomètre, noté 2 comme catégorie de revue, absence de métro dans un rayon de 500 mètres.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Créer un jeu de données pour effectuer des prédictions</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  prt_veg_500m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">90</span><span class="op">)</span>,</span>
<span>  beds <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  Garden_or_backyard <span class="op">=</span> <span class="st">"YES"</span>,</span>
<span>  Host_greets_you <span class="op">=</span> <span class="st">"YES"</span>,</span>
<span>  Free_street_parking <span class="op">=</span> <span class="st">"YES"</span>,</span>
<span>  has_metro_500m <span class="op">=</span> <span class="st">"NO"</span>,</span>
<span>  commercial_1km <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  private <span class="op">=</span> <span class="st">"Entier"</span>,</span>
<span>  cat_review <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  host_total_listings_count <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Effectuer les prédictions (dans l'échelle log)</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele3</span>, newdata <span class="op">=</span> <span class="va">df</span>, type <span class="op">=</span> <span class="st">"link"</span>, se.fit<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># Définir l'inverse de la fonction de lien</span></span>
<span><span class="va">ilink</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="co"># Calculer les probabilités et leurs intervalles de confiance</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=2]"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=2] 2,5"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">preds</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=2] 97,5"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">preds</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=3]"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=3] 2,5"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">preds</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=3] 97,5"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">preds</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">preds</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y=1]"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=2]"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y=1] 2,5"</span> <span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=2] 2,5"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y=1] 97,5"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">df</span><span class="op">[[</span><span class="st">"P[Y&gt;=2] 97,5"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># Afficher les résultats</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg_500m</span>, </span>
<span>                         ymin <span class="op">=</span> <span class="va">`P[Y&gt;=2] 2,5`</span>,</span>
<span>                         ymax <span class="op">=</span> <span class="va">`P[Y&gt;=2] 97,5`</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#f94144"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg_500m</span>, y <span class="op">=</span> <span class="va">`P[Y&gt;=2]`</span>, color <span class="op">=</span> <span class="st">"Y2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg_500m</span>, </span>
<span>                         ymin <span class="op">=</span> <span class="va">`P[Y&gt;=3] 2,5`</span>,</span>
<span>                         ymax <span class="op">=</span> <span class="va">`P[Y&gt;=3] 97,5`</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#90be6d"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg_500m</span>, y <span class="op">=</span> <span class="va">`P[Y&gt;=3]`</span>, color <span class="op">=</span> <span class="st">"Y3"</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg_500m</span>, </span>
<span>                         ymin <span class="op">=</span> <span class="va">`P[Y=1] 2,5`</span>,</span>
<span>                         ymax <span class="op">=</span> <span class="va">`P[Y=1] 97,5`</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#277da1"</span> , alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg_500m</span>, y <span class="op">=</span> <span class="va">`P[Y=1]`</span>, color <span class="op">=</span> <span class="st">"Y1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Probabilités prédites"</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span>, <span class="st">"Y3"</span><span class="op">)</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P[Y=1]"</span>, <span class="st">"P[Y&gt;=2]"</span>, <span class="st">"P[Y&gt;=3]"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Y2"</span> <span class="op">=</span> <span class="st">"#f94144"</span>, <span class="st">"Y3"</span> <span class="op">=</span> <span class="st">"#90be6d"</span>,</span>
<span>                                   <span class="st">"Y1"</span> <span class="op">=</span> <span class="st">"#277da1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Densité de végétation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Probabilité"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Y1 : moins de 50 $; Y2 : 50 à 99 $; Y3 : 100 à 249 $"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-predpricecatveg" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-predpricecatveg-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.17: Prédiction de la probabilité d’appartenance aux trois catégories de prix en fonction de la densité de végétation</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons, à la <a href="#fig-predpricecatveg">figure&nbsp;<span>8.17</span></a>, que les probabilités d’appartenir aux niveaux 2 et 3 diminuent à mesure qu’augmente le pourcentage de végétation. La probabilité d’appartenir à la classe 2 et plus (en rouge) passe de plus de 95&nbsp;% en cas d’absence de végétation et à environ 75&nbsp;% avec 80&nbsp;% de végétation dans un rayon de 500 mètres. Comme vous pouvez le constater, la probabilité <span class="math inline">\(P[Y=1]\)</span> est la symétrie de <span class="math inline">\(P[Y&gt;=2]\)</span> puisque <span class="math inline">\(P[Y=1]+P[Y&gt;=2] = 1\)</span>.</p>
</section></section><section id="sec-0824" class="level3" data-number="8.2.4"><h3 data-number="8.2.4" class="anchored" data-anchor-id="sec-0824">
<span class="header-section-number">8.2.4</span> Modèle logistique multinomial</h3>
<p>La régression logistique multinomiale est utilisée pour modéliser une variable <em>Y</em> qualitative multinomiale, c’est-à-dire une variable dont les modalités ne peuvent pas être ordonnées. Dans le modèle précédent, nous avons vu qu’il était possible de modéliser une variable ordinale avec une distribution binomiale en formulant l’hypothèse de la proportionnalité des cotes. Avec une variable multinomiale, cette hypothèse ne tient plus, car les catégories ne sont plus ordonnées. Il faut donc formuler le modèle différemment.</p>
<p>L’idée derrière un modèle multinomial est de choisir une catégorie de référence, puis de modéliser les probabilités d’appartenir à chaque autre catégorie plutôt qu’à cette catégorie de référence (<a href="#tbl-multinomdentity">tableau&nbsp;<span>8.15</span></a>). Si nous avons <em>K</em> catégories possibles dans notre variable <em>Y</em>, nous obtenons <em>K</em>-1 comparaisons. Chaque comparaison est modélisée avec sa propre équation, ce qui génère de nombreux paramètres. Par exemple, admettons que notre variable <em>Y</em> a cinq catégories et que nous disposons de six variables <em>X</em> prédictives. Nous avons ainsi 4 (5-1) équations de régression avec 7 paramètres (6 coefficients et une constante), soit 28 coefficients à analyser.</p>
<p>Considérant cette tendance à la multiplication des coefficients, il est fréquent de recourir à une méthode appelée <em>Analyse de type 3</em> pour limiter au maximum le nombre de variables indépendantes (VI) dans le modèle. L’idée de cette méthode est de recalculer plusieurs versions du modèle dans lesquelles une variable indépendante est retirée, puis de réaliser un test de rapport de vraisemblance en comparant ce nouveau modèle (complet moins une VI) au modèle complet (toutes les VI) pour vérifier si la variable en question améliore significativement le modèle. Il est alors possible de retirer toutes les variables dont l’apport est négligeable si elles sont également peu intéressantes du point de vue théorique.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-multinomdentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.15: Carte d’identité du modèle logistique multinomial</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 81%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable qualitative multinomiale avec <em>K</em> catégories</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Binomiale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Binomial(p)\)</span> <span class="math inline">\(g(p = k\text{ avec }ref = a) = \beta_{0k} + \beta X_{k}\)</span> <span class="math inline">\(g(x) = \frac{log(x)}{1-x}\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">Logistique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;">p</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_{0k}\)</span>, <span class="math inline">\(\beta\)</span>k pour <span class="math inline">\(k \in [2,...,K]\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Non-séparation complète, absence de sur-dispersion ou de sous-dispersion, Indépendance des alternatives non pertinentes</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08241" class="level4" data-number="8.2.4.1"><h4 data-number="8.2.4.1" class="anchored" data-anchor-id="sec-08241">
<span class="header-section-number">8.2.4.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que pour un modèle binomial, avec l’ajout de l’hypothèse sur <strong>l’indépendance des alternatives non pertinentes</strong>. Cette dernière suppose que le choix entre deux catégories est indépendant des catégories proposées. Voici un exemple simple pour illustrer cette hypothèse: admettons que nous disposons d’une trentaine de personnes et que nous leur demandons la couleur de leurs yeux. Cette variable ne serait pas affectée par la présence de nouvelles couleurs en dehors de notre échantillon. En revanche, si nous leur demandons de choisir un mode de transport parmi une liste pour se rendre à leur lieu de travail, leur réponse serait nécessairement affectée par la liste des modes de transport disponibles. Les tests développés pour vérifier cette hypothèse sont connus pour leur <a href="https://statisticalhorizons.com/iia">faible fiabilité</a>. Il est plus pertinent de décider théoriquement si cette hypothèse est valide ou non. Dans le cas contraire, il est possible d’utiliser une classe de modèle logistique plus rare: le modèle logistique imbriqué.</p>
<p>Notez également que le grand nombre de paramètres dans ce type de modèle implique de disposer d’un plus grand nombre d’observations afin d’avoir suffisamment d’information dans chaque catégorie pour ajuster tous les paramètres.</p>
<p>Pour vérifier la présence de sur-dispersion, il est possible, dans le cas du modèle multinomial, de calculer le rapport entre le khi-deux de Pearson et le nombre de degrés de liberté du modèle. Si ce rapport est supérieur à 1 (des valeurs jusqu’à 1,15 ne sont pas problématiques), alors le modèle souffre de sur-dispersion <span class="citation" data-cites="Sasmultinom">(<a href="references.html#ref-Sasmultinom" role="doc-biblioref">SAS Institute Inc 2020a</a>)</span>. Le khi-deux de Pearson est simplement la somme des résidus de Pearson au carré dans le cas d’un modèle GLM.</p>
<p><span id="eq-glm15"><span class="math display">\[
\chi^2 = \sum_{i=1}^N\sum_{c=1}^K{\frac{(y_{ic} - p_{ic})^2}{p_{ic}}}
\tag{8.18}\]</span></span></p>
<p>Avec <span class="math inline">\(y_{ic}\)</span> 1 si l’observation <em>i</em> appartient à la catégorie <em>c</em>, 0 autrement, <span class="math inline">\(p_{ic}\)</span> la probabilité prédite pour l’observation <em>i</em> d’appartenir à la catégorie <em>c</em>, <em>N</em> le nombre d’observations et <em>K</em> le nombre de catégories.</p>
<p>Le ratio est ensuite calculé comme suit: <span class="math inline">\(\frac{\chi^2}{(N - p)(K-1)}\)</span>, avec <em>N</em> le nombre d’observations et <em>K</em> le nombre de modalités dans la variable <em>Y</em>. Si ce ratio est égal ou supérieur à 1, alors le modèle souffre de sur-dispersion, si le ratio est inférieur à 1, le modèle souffre de sous-dispersion. Un léger écart (&gt;&nbsp;0,15) n’est pas considéré comme problématique.</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Le modèle logistique imbriqué</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Du fait de sa proximité avec les modèles à effets mixtes que nous abordons au <a href="09-GLMM.html">chapitre&nbsp;<span>9</span></a>, nous ne détaillons pas ici le modèle logistique imbriqué, mais présentons plutôt son principe général. Il s’agit d’une généralisation du modèle logistique multinomial basé sur l’idée que certaines catégories pourraient être regroupées dans des «&nbsp;nids&nbsp;» (<em>nest</em> en anglais). Dans ces groupes, les erreurs peuvent être corrélées, indiquant ainsi que si une catégorie est manquante, une autre catégorie du même groupe sera préférée. Un paramètre <span class="math inline">\(\lambda\)</span> contrôle spécifiquement cette corrélation et permet de mesurer sa force une fois le modèle ajusté. Il peut être pertinent de comparer un modèle imbriqué à un modèle multinomial pour déterminer lequel des deux est le mieux ajusté aux données.</p>
</div>
</div>
</section><section id="sec-08242" class="level4" data-number="8.2.4.2"><h4 data-number="8.2.4.2" class="anchored" data-anchor-id="sec-08242">
<span class="header-section-number">8.2.4.2</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous reproduisons une partie de l’analyse effectuée dans l’étude de <span class="citation" data-cites="mcfadden2016examining">McFadden (<a href="references.html#ref-mcfadden2016examining" role="doc-biblioref">2016</a>)</span>. Cet article s’intéresse aux écarts entre les croyances des individus et les connaissances scientifiques sur les sujets des OGM et du réchauffement climatique. Les auteurs utilisent pour cela des données issues d’une enquête auprès de 961 individus formant un échantillon représentatif de la population des États-Unis. Les données issues de cette enquête sont téléchargeables sur le <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0166140">site de l’éditeur</a>, ce qui nous permet ici de reproduire l’analyse effectuée par les auteurs. Deux questions sont centrales dans l’enquête&nbsp;:</p>
<ul>
<li>Dans quelle mesure êtes-vous en accord ou en désaccord avec la phrase suivante&nbsp;: les plantations génétiquement modifiées sont sans danger pour la consommation ?</li>
<li>Dans quelle mesure êtes-vous en accord ou en désaccord avec la phrase suivante&nbsp;: la Terre se réchauffe du fait des activités humaines ?</li>
</ul>
<p>Pour ces deux questions, les répondants devaient sélectionner leur degré d’accord sur une échelle de Likert allant de 1 (fortement en désaccord) à 5 (fortement en accord). Les réponses à ces deux questions ont été utilisées pour former une variable multinomiale à quatre modalités&nbsp;:</p>
<ul>
<li>A. Les individus sont en accord avec les deux propositions.</li>
<li>B. Les individus sont en désaccord sur les OGM, mais en accord sur le réchauffement climatique.</li>
<li>C. Les individus sont en accord sur les OGM, mais en désaccord sur le réchauffement climatique.</li>
<li>D. Les individus sont en désaccord avec les deux propositions.</li>
</ul>
<p>Un modèle logistique multinomial a été utilisé pour déterminer quels facteurs contribuent à la probabilité d’appartenir à ces différentes catégories. Les variables indépendantes présentes dans le modèle sont détaillées dans le <a href="#tbl-variablemultinom">tableau&nbsp;<span>8.16</span></a>. Les auteurs avaient notamment conclu que&nbsp;:</p>
<ul>
<li><p>Les effets des connaissances (réelles ou perçues) sur l’appartenance aux différentes catégories n’étaient pas uniformes et pouvaient varier en fonction du sujet.</p></li>
<li><p>L’orientation politique avait une influence significative sur les croyances.</p></li>
<li><p>Les répondants avec de plus hauts résultats au test de cognition CRT avaient plus souvent des opinions divergentes de la communauté scientifique.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-variablemultinom" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.16: Variables indépendantes utilisées dans le modèle logistique multinomial</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 56%">
<col style="width: 7%">
<col style="width: 28%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom de la variable</th>
<th style="text-align: left;">signification</th>
<th style="text-align: left;">Type de variable</th>
<th style="text-align: left;">Mesure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PercepOGM</td>
<td style="text-align: left;">La recherche scientifique supporte ma vision sur la sécurité des plantes OGM</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Échelle de Likert de 1 (fortement en désaccord) à 5 (fortement en accord)</td>
</tr>
<tr class="even">
<td style="text-align: left;">PercepRechClim</td>
<td style="text-align: left;">La recherche scientifique supporte ma vision sur le réchauffement climatique</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Échelle de Likert de 1 (fortement en désaccord) à 5 (fortement en accord)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ConnaisOGM</td>
<td style="text-align: left;">Niveau de connaissance sur les OGM</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Nombre de réponses sur trois questions portant sur les OGM</td>
</tr>
<tr class="even">
<td style="text-align: left;">ConnaisRechClim</td>
<td style="text-align: left;">Niveau de connaissance sur le réchauffement climatique</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Nombre de réponses sur trois questions portant sur le réchauffement climatique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CRT</td>
<td style="text-align: left;">Score obtenu au Cognitive Reflection Test, utilisé pour déterminer la propension à faire preuve d’esprit d’analyse plutôt que choisir des réponses intuitives</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Nombre de réponses sur trois questions pièges</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parti</td>
<td style="text-align: left;">Orientation politique du répondant</td>
<td style="text-align: left;">Variable multinomiale</td>
<td style="text-align: left;">Républicain, démocrate et autre</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sexe</td>
<td style="text-align: left;">Sexe du répondant</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Femme ou homme</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Âge du répondant</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Âge du répondant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Revenu</td>
<td style="text-align: left;">Niveau de revenu du répondant</td>
<td style="text-align: left;">Variable ordinale</td>
<td style="text-align: left;">Échelle de 1 (moins de 20 000 $) à (140 000 $ et plus)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Avant d’ajuster le modèle, nous commençons par vérifier l’absence de multicolinéarité excessive entre les variables indépendantes. Toutes les valeurs de VIF sont inférieures à 2, indiquant bien une absence de multicolinéarité.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_quest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/enquete_PublicOpinion_vs_Science.csv"</span><span class="op">)</span></span>
<span><span class="co"># Choix des valeurs de références dans les facteurs</span></span>
<span><span class="va">data_quest</span><span class="op">$</span><span class="va">Parti</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">$</span><span class="va">Parti</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"Democrate"</span><span class="op">)</span></span>
<span><span class="va">data_quest</span><span class="op">$</span><span class="va">Sexe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">$</span><span class="va">Sexe</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"homme"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">SCIGM</span> <span class="op">~</span> <span class="va">PercepOGM</span> <span class="op">+</span> <span class="va">PercepRechClim</span> <span class="op">+</span> <span class="va">ConnaisOGM</span> <span class="op">+</span> <span class="va">ConnaisRechClim</span> <span class="op">+</span></span>
<span>          <span class="va">CRT</span> <span class="op">+</span> <span class="va">Parti</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">Sexe</span> <span class="op">+</span> <span class="va">Revenu</span>, data <span class="op">=</span> <span class="va">data_quest</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    GVIF Df GVIF^(1/(2*Df))
PercepOGM       1.092693  1        1.045320
PercepRechClim  1.177495  1        1.085125
ConnaisOGM      1.150662  1        1.072689
ConnaisRechClim 1.158438  1        1.076307
CRT             1.155371  1        1.074882
Parti           1.130817  2        1.031212
AGE             1.071655  1        1.035208
Sexe            1.064918  1        1.031949
Revenu          1.049499  1        1.024451</code></pre>
</div>
</div>
<p>La seconde étape est d’ajuster le modèle et de vérifier l’absence de sur ou sous-dispersion. Pour ajuster le modèle, nous utilisons à nouveau la fonction <code>vglm</code> du <em>package</em> <code>VGAM</code>, avec le paramètre <code>family = multinomial()</code>. Le ratio entre la statistique de Pearson et le nombre de degrés de liberté du modèle indique une absence de sur ou sous-dispersion (1,04).</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement du modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">PercepOGM</span> <span class="op">+</span> <span class="va">PercepRechClim</span> <span class="op">+</span> <span class="va">ConnaisOGM</span> <span class="op">+</span> <span class="va">ConnaisRechClim</span> <span class="op">+</span> </span>
<span>                 <span class="va">CRT</span> <span class="op">+</span> <span class="va">Parti</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">Sexe</span> <span class="op">+</span> <span class="va">Revenu</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_quest</span>, </span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/multinomial.html">multinomial</a></span><span class="op">(</span>refLevel <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># Calcul du Khi2 de Pearson</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type<span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">cat_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">freq_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">freq_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cat_predict</span><span class="op">)</span></span>
<span></span>
<span><span class="va">khi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">rank</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">freq_real</span><span class="op">)</span></span>
<span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">khi2</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">N</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">r</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.045889</code></pre>
</div>
</div>
<p>La troisième étape de la vérification des conditions d’application est l’analyse des distances de Cook. À nouveau, puisque le modèle évalue la probabilité d’appartenir à <span class="math inline">\(K-1\)</span> catégorie, nous pouvons calculer <span class="math inline">\(K-1\)</span> résidus par observation et par extension <span class="math inline">\(K-1\)</span> distances de Cook. Aucune observation ne semble se détacher nettement dans la <a href="#fig-cookmultinom">figure&nbsp;<span>8.18</span></a>. Nous décidons donc pour le moment de conserver toutes les observations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des résidus</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span>
<span><span class="co"># Extraction de la hat matrix (nécessaire pour calculer la distance de Cook)</span></span>
<span><span class="va">hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hatvalues.html">hatvaluesvlm</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span> , <span class="st">"B"</span> , <span class="st">"C"</span> , <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="va">cooks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">h</span> <span class="op">&lt;-</span> <span class="va">hat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">cook</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">r</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">h</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">h</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">*</span> <span class="va">modele</span><span class="op">@</span><span class="va">rank</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cook</span><span class="op">)</span>,</span>
<span>    cook <span class="op">=</span> <span class="va">cook</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"distance de Cook P("</span>,<span class="va">vals</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">" VS "</span>,<span class="va">vals</span><span class="op">[[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">")"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">cooks</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookmultinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookmultinom-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.18: Distances de Cook pour le modèle logistique multinomial</figcaption></figure>
</div>
</div>
</div>
<p>Avant de passer à l’analyse de résidus simulés, il est pertinent de réaliser une analyse de type 3 afin de retirer les variables indépendantes dont l’apport au modèle est négligeable. La fonction <code>AnalyseType3</code> (disponible dans le code source de ce livre) permet d’effectuer cette opération automatiquement pour un objet de type <code>vglm</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tableau</span> <span class="op">&lt;-</span> <span class="fu">AnalyseType3</span><span class="op">(</span><span class="va">modele</span>, <span class="va">data_quest</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************* 
Type 3 Analysis of Effects 
************************************* 
AIC model complet :  1855 
loglikelihood model complet :  1789 
  variable retiree  AIC loglikelihood  p.val
1        PercepOGM 1879          1819      0
2   PercepRechClim 1941          1881      0
3       ConnaisOGM 1910          1850      0
4  ConnaisRechClim 1862          1802 0.0059
5              CRT 1860          1800 0.0125
6            Parti 1879          1825      0
7              AGE 1852          1792 0.4469
8             Sexe 1875          1815      0
9           Revenu 1850          1790 0.7718</code></pre>
</div>
</div>
<p>L’analyse de type 3 nous permet de déterminer que l’âge et le revenu sont deux variables dont la contribution au modèle est marginale. À titre de rappel, l’analyse de type 3 permet de comparer si le modèle complet (avec l’ensemble des variables indépendantes) est statistiquement mieux ajusté que le modèle avec l’ensemble des variables, sauf une. Or, dans notre cas, le modèle complet n’est pas statistiquement mieux ajusté que le modèle complet sans la variable <em>Age</em> (<em>p</em>&nbsp;=&nbsp;0,44) et que le modèle complet sans la variable Revenu (<em>p</em>&nbsp;=&nbsp;0,77). Cela signifie donc que ces deux variables n’ont pas un apport significatif au modèle et peuvent par conséquent être ôtées par parcimonie. Nous décidons donc de les retirer afin d’alléger les tableaux de coefficients que nous présentons plus loin. Nous pouvons également en conclure que ces deux variables ne jouent aucun rôle dans la propension à être en désaccord avec la recherche scientifique. Nous réajustons le modèle en conséquence.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">PercepOGM</span> <span class="op">+</span> <span class="va">PercepRechClim</span> <span class="op">+</span> <span class="va">ConnaisOGM</span> <span class="op">+</span> <span class="va">ConnaisRechClim</span> <span class="op">+</span> </span>
<span>                 <span class="va">CRT</span> <span class="op">+</span> <span class="va">Parti</span> <span class="op">+</span> <span class="va">Sexe</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_quest</span>, </span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/multinomial.html">multinomial</a></span><span class="op">(</span>refLevel <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons à présent passer à l’analyse des résidus simulés. Le problème avec ce modèle est que sa variable <em>Y</em> est qualitative alors que la méthode d’analyse des résidus du <em>package</em> <code>DHARMa</code> ne peut traiter que des variables quantitatives, binaires ou ordinales. Pour rappel, il est possible d’envisager la prédiction d’un modèle logistique multinomial comme la prédiction d’une série de modèles logistiques binomiaux. En représentant nos prédictions de cette façon, nous pouvons à nouveau utiliser le <em>package</em> <code>DHARMa</code> pour analyser nos résidus. Veuillez noter que cette approche n’est pas optimale et que cette section du livre peut être amenée à changer.</p>
<p>La <a href="#fig-residusmultinom">figure&nbsp;<span>8.19</span></a> indique que les résidus suivent bien une distribution uniforme et qu’aucune valeur aberrante n’est observable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraire les prédictions du modèle</span></span>
<span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span> , <span class="st">"C"</span> , <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele2</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">ilink</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="co"># Boucler sur chacune des catégories en dehors de la référence</span></span>
<span><span class="va">data_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">categorie</span> <span class="op">&lt;-</span> <span class="va">categories</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># Extraire les observation de la catégorie i et de la référence</span></span>
<span>  <span class="va">test</span> <span class="op">&lt;-</span> <span class="va">data_quest</span><span class="op">$</span><span class="va">Y</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="va">categorie</span><span class="op">)</span></span>
<span>  <span class="co"># Calculer les probabilité d'appartenance à i</span></span>
<span>  <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">predicted</span><span class="op">[</span><span class="va">test</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span>  <span class="co"># Extraire les valeurs réelles et les convertir en 0 / 1</span></span>
<span>  <span class="va">real</span> <span class="op">&lt;-</span> <span class="va">data_quest</span><span class="op">[</span><span class="va">test</span>,<span class="op">]</span><span class="op">$</span><span class="va">Y</span></span>
<span>  <span class="va">real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">real</span><span class="op">==</span><span class="st">"A"</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># Enregistrer ces différents éléments</span></span>
<span>  <span class="va">all_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">probs</span>, <span class="va">probs</span><span class="op">)</span></span>
<span>  <span class="va">sub_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_quest</span>, <span class="va">test</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"real"</span> <span class="op">=</span> <span class="va">real</span>, <span class="st">"probs"</span> <span class="op">=</span> <span class="va">all_probs</span>, <span class="st">"data"</span> <span class="op">=</span> <span class="va">sub_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co"># Extraire les probabilités prédites</span></span>
<span><span class="va">all_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data_sims</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">i</span><span class="op">$</span><span class="va">probs</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Extraire les vrais catégories</span></span>
<span><span class="va">all_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data_sims</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">i</span><span class="op">$</span><span class="va">real</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Effectuer les simulations</span></span>
<span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">all_probs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">all_probs</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">nsim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">matsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulations</span><span class="op">)</span></span>
<span><span class="co"># Calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">matsim</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">all_real</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">all_probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Afficher les résultats</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residusmultinom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-residusmultinom-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.19: Diagnostic général des résidus simulés pour le modèle multinomial</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-residusmultinom2">figure&nbsp;<span>8.20</span></a> permet d’affiner le diagnostic en s’assurant de l’absence de relation entre les variables indépendantes et les résidus. Il est possible de remarquer des irrégularités pour les variables de perception (premier et second panneaux). Dans les deux cas, la catégorie 1 (fort désaccord) se démarque nettement des autres catégories. Nous proposons donc de les recoder comme des variables binaires&nbsp;: en désaccord / pas en désaccord pour minimiser cet effet.</p>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recomposer les données pour coller au format</span></span>
<span><span class="co"># étendu de la prediction</span></span>
<span><span class="va">etend_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data_sims</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">i</span><span class="op">$</span><span class="va">data</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PercepOGM"</span>, <span class="st">"PercepRechClim"</span>, <span class="st">"ConnaisOGM"</span>, </span>
<span>          <span class="st">"ConnaisRechClim"</span>, <span class="st">"CRT"</span>, <span class="st">"Parti"</span>, <span class="st">"Sexe"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">v</span> <span class="kw">in</span>  <span class="va">vars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html">plotResiduals</a></span><span class="op">(</span><span class="va">sim_res</span>, <span class="va">etend_data</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span>, xlab<span class="op">=</span> <span class="va">v</span>, ylab <span class="op">=</span> <span class="st">"résidus"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-residusmultinom2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/residusmultinom2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.20: Diagnostic des variables indépendantes et des résidus simulés pour le modèle multinomial</figcaption></figure>
</div>
</div>
</div>
<p>Nous réajustons donc le modèle et recalculons nos résidus ajustés (masqué ici pour alléger le document). La <a href="#fig-residusmultinom3">figure&nbsp;<span>8.21</span></a> nous confirme que le problème a été corrigé.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convertir les variables ordinales et variables binaires</span></span>
<span><span class="va">data_quest</span><span class="op">$</span><span class="va">PercepOGMDes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">$</span><span class="va">PercepOGM</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">data_quest</span><span class="op">$</span><span class="va">PercepRechClimDes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">$</span><span class="va">PercepRechClim</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="co"># Réajuster le modèle</span></span>
<span><span class="va">modele3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">PercepOGMDes</span> <span class="op">+</span> <span class="va">PercepRechClimDes</span> <span class="op">+</span> </span>
<span>                  <span class="va">ConnaisOGM</span> <span class="op">+</span> <span class="va">ConnaisRechClim</span> <span class="op">+</span> </span>
<span>                  <span class="va">CRT</span> <span class="op">+</span> <span class="va">Parti</span> <span class="op">+</span> <span class="va">Sexe</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_quest</span>, </span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/multinomial.html">multinomial</a></span><span class="op">(</span>refLevel <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-residusmultinom3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/residusmultinom3.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.21: Diagnostic général des résidus simulés pour le modèle multinomial (version 3)</figcaption></figure>
</div>
</div>
</div>
<p>Profitons du fait que nous utilisons le <em>package</em> <code>VGAM</code> pour vérifier l’absence d’effet de Hauck-Donner qui indiquerait que des variables indépendantes provoquent des séparations parfaites.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hdeff.html">hdeff</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span></span>
<span><span class="va">test</span><span class="op">[</span><span class="va">test</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">]</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept):2 (Intercept):3 
         TRUE          TRUE </code></pre>
</div>
</div>
<p>La fonction nous informe que les constantes permettant de comparer le groupe C au groupe A, et le groupe D au groupe A provoquent des séparations parfaites. Cela s’explique notamment par le faible nombre d’observations tombant dans ces catégories. Considérant que comparativement à la catégorie A, être dans les catégories B, C, ou D signifie remettre en cause au moins un consensus scientifique, il peut être raisonnable de fixer la constante pour qu’elle soit la même pour les trois comparaisons. Ainsi, les chances de passer de A à un autre groupe ne dépenderaient pas du groupe en question, mais uniquement des variables indépendantes. Pour cela, nous pouvons forcer le modèle à n’ajuster qu’une seule constante avec la syntaxe suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">PercepOGMDes</span> <span class="op">+</span> <span class="va">PercepRechClimDes</span> <span class="op">+</span> </span>
<span>                  <span class="va">ConnaisOGM</span> <span class="op">+</span> <span class="va">ConnaisRechClim</span> <span class="op">+</span> </span>
<span>                  <span class="va">CRT</span> <span class="op">+</span> <span class="va">Parti</span> <span class="op">+</span> <span class="va">Sexe</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_quest</span>, </span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/multinomial.html">multinomial</a></span><span class="op">(</span>refLevel <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>                                    parallel <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">~</span><span class="fl">1</span><span class="op">)</span>, model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hdeff.html">hdeff</a></span><span class="op">(</span><span class="va">modele4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>test
FALSE 
   25 </code></pre>
</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du khi2 de Pearson</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele4</span>, type<span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">cat_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">freq_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">freq_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cat_predict</span><span class="op">)</span></span>
<span><span class="va">khi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">modele4</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">modele4</span><span class="op">@</span><span class="va">rank</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">freq_real</span><span class="op">)</span></span>
<span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">khi2</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">r</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">-</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.010319</code></pre>
</div>
</div>
<p>Nous n’avons donc plus de séparation complète ni de sur ou sous-dispersion et les résidus simulés de la quatrième version du modèle sont toujours acceptables (<a href="#fig-residusmultinom4">figure&nbsp;<span>8.22</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraire les prédictions du modèle</span></span>
<span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B"</span> , <span class="st">"C"</span> , <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele4</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">ilink</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Boucler sur chacune des catégories en dehors de la référence</span></span>
<span><span class="va">data_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">categorie</span> <span class="op">&lt;-</span> <span class="va">categories</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co"># Extraire les observation de la catégorie i et de la référence</span></span>
<span>  <span class="va">test</span> <span class="op">&lt;-</span> <span class="va">data_quest</span><span class="op">$</span><span class="va">Y</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="va">categorie</span><span class="op">)</span></span>
<span>  <span class="co"># Calculer les probabilité d'appartenance à i</span></span>
<span>  <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">predicted</span><span class="op">[</span><span class="va">test</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span>  <span class="co"># Extraire les valeurs réelles et les convertir en 0 / 1</span></span>
<span>  <span class="va">real</span> <span class="op">&lt;-</span> <span class="va">data_quest</span><span class="op">[</span><span class="va">test</span>,<span class="op">]</span><span class="op">$</span><span class="va">Y</span></span>
<span>  <span class="va">real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">real</span><span class="op">==</span><span class="st">"A"</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># Enregistrer ces différents éléments</span></span>
<span>  <span class="va">all_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">probs</span>, <span class="va">probs</span><span class="op">)</span></span>
<span>  <span class="va">sub_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_quest</span>, <span class="va">test</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"real"</span> <span class="op">=</span> <span class="va">real</span>, <span class="st">"probs"</span> <span class="op">=</span> <span class="va">all_probs</span>, <span class="st">"data"</span> <span class="op">=</span> <span class="va">sub_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extraire les probabilités prédites</span></span>
<span><span class="va">all_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data_sims</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">i</span><span class="op">$</span><span class="va">probs</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extraire les vrais catégories</span></span>
<span><span class="va">all_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">data_sims</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="va">i</span><span class="op">$</span><span class="va">real</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Effectuer les simulations</span></span>
<span><span class="va">simulations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">all_probs</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">all_probs</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">nsim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">matsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulations</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">matsim</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">all_real</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">all_probs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residusmultinom4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-residusmultinom4-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.22: Diagnostic général des résidus simulés pour le modèle multinomial (version 4)</figcaption></figure>
</div>
</div>
</div>
<p><strong>Vérification l’ajustement du modèle</strong></p>
<p>Puisque les conditions d’application du modèle sont respectées, nous pouvons à présent vérifier sa qualité d’ajustement.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelenull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span> ,</span>
<span>                   data <span class="op">=</span> <span class="va">data_quest</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/multinomial.html">multinomial</a></span><span class="op">(</span>refLevel <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>                                        parallel <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">CRT</span><span class="op">)</span></span>
<span>                   , model <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele4</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modele4</span><span class="op">)</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modele4</span><span class="op">@</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data_quest</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.1750071

$`McFadden ajuste`
[1] 0.1530715

$`Cox and Snell`
[1] 0.3397248

$Nagelkerke
[1] 0.3746843</code></pre>
</div>
</div>
<p>Le modèle parvient à expliquer 17,5&nbsp;% de la déviance totale. Il obtient un R<sup>2</sup> ajusté de McFadden de 0,15, et des R<sup>2</sup> de Cox et Snell et de Nagelkerke de respectivement 0,34 et 0,37. Passons à la construction de la matrice de confusion pour analyser la capacité de prédiction du modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele4</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">pred_cats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">real</span> <span class="op">&lt;-</span> <span class="va">data_quest</span><span class="op">$</span><span class="va">Y</span></span>
<span><span class="va">matrices</span> <span class="op">&lt;-</span> <span class="fu">nice_confusion_matrix</span><span class="op">(</span><span class="va">real</span>, <span class="va">pred_cats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Afficher la matrice de confusion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">matrices</span><span class="op">$</span><span class="va">confusion_matrix</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          rowsnames    A          B          C          D          rs     
colsnames ""           "A (reel)" "B (reel)" "C (reel)" "D (reel)" "Total"
A         "A (predit)" "482"      "168"      "75"       "29"       "754"  
B         "B (predit)" "31"       "88"       "9"        "20"       "148"  
C         "C (predit)" "10"       "6"        "18"       "6"        "40"   
D         "D (predit)" "3"        "4"        "3"        "9"        "19"   
          "Total"      "526"      "266"      "105"      "64"       "961"  
          "%"          "54.7"     "27.7"     "10.9"     "6.7"      NA     
          rp    
colsnames "%"   
A         "78.5"
B         "15.4"
C         "4.2" 
D         "2"   
          NA    
          NA    </code></pre>
</div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Afficher les indicateurs de qualité de prédiction</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">matrices</span><span class="op">$</span><span class="va">indicators</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             rnames                           precision rappel F1    
A            "A"                              "0.64"    "0.92" "0.75"
B            "B"                              "0.59"    "0.33" "0.43"
C            "C"                              "0.45"    "0.17" "0.25"
D            "D"                              "0.47"    "0.14" "0.22"
macro_scores "macro"                          "0.6"     "0.62" "0.57"
             "Kappa"                          "0.27"    NA     NA    
             "Valeur de p  (precision &gt; NIR)" "0"       NA     NA    </code></pre>
</div>
</div>
<p>La précision globale (macro) du modèle est de 60&nbsp;% et dépasse significativement le seuil de non-information. L’indicateur de Kappa indique un accord modéré entre la prédiction et les valeurs réelles. Les catégories C et D sont les catégories avec la plus faible précision, indiquant ainsi que le modèle a tendance à manquer les prédictions pour les individus en désaccord avec le consensus scientifique sur le réchauffement climatique. Les indices de rappel sont également très faibles pour les catégories B, C et D, indiquant que très peu d’observations appartenant originalement à ces groupes ont bien été classées dans ces groupes. La capacité de prédiction du modèle est donc relativement faible.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>Puisque nous disposons de quatre catégories dans notre variable <em>Y</em>, nous obtenons au final trois tableaux de coefficients. Il est possible de visualiser l’ensemble des coefficients du modèle avec la fonction <code>summary</code>, nous proposons les tableaux <a href="#tbl-coeffsmultinom1"><span>8.17</span></a>, <a href="#tbl-coeffsmultinom2"><span>8.18</span></a> et <a href="#tbl-coeffsmultinom3"><span>8.19</span></a> pour présenter l’ensemble des résultats.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffsmultinom1" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.17: Coefficients du modèle multinomial A versus B</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 17%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 8%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coefficient</th>
<th style="text-align: right;">RC</th>
<th style="text-align: right;">val.p</th>
<th style="text-align: right;">RC 2,5 %</th>
<th style="text-align: right;">RC 97,5 %</th>
<th style="text-align: right;">sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PercepOGMDes</td>
<td style="text-align: right;">1,940</td>
<td style="text-align: right;">6,989</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">4,221</td>
<td style="text-align: right;">11,588</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">PercepRechClimDes</td>
<td style="text-align: right;">0,430</td>
<td style="text-align: right;">1,532</td>
<td style="text-align: right;">0,305</td>
<td style="text-align: right;">0,677</td>
<td style="text-align: right;">3,456</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ConnaisOGM</td>
<td style="text-align: right;">-0,330</td>
<td style="text-align: right;">0,718</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,607</td>
<td style="text-align: right;">0,852</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">ConnaisRechClim</td>
<td style="text-align: right;">0,180</td>
<td style="text-align: right;">1,197</td>
<td style="text-align: right;">0,084</td>
<td style="text-align: right;">0,980</td>
<td style="text-align: right;">1,462</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CRT</td>
<td style="text-align: right;">0,350</td>
<td style="text-align: right;">1,417</td>
<td style="text-align: right;">0,016</td>
<td style="text-align: right;">1,073</td>
<td style="text-align: right;">1,878</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Parti</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : Democrate</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">autre</td>
<td style="text-align: right;">0,660</td>
<td style="text-align: right;">1,934</td>
<td style="text-align: right;">0,001</td>
<td style="text-align: right;">1,310</td>
<td style="text-align: right;">2,858</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Republicain</td>
<td style="text-align: right;">0,650</td>
<td style="text-align: right;">1,910</td>
<td style="text-align: right;">0,003</td>
<td style="text-align: right;">1,259</td>
<td style="text-align: right;">2,915</td>
<td style="text-align: right;">**</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Sexe</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : homme</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">femme</td>
<td style="text-align: right;">1,280</td>
<td style="text-align: right;">3,581</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">2,535</td>
<td style="text-align: right;">5,053</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Le <a href="#tbl-coeffsmultinom1">tableau&nbsp;<span>8.17</span></a> compare donc le groupe A (en accord avec la recherche scientifique sur les deux sujets) et le groupe B (en désaccord sur la question des OGM). Les résultats indiquent que le fait de se percevoir en désaccord avec le consensus scientifique sur la question des OGM multiplie par sept les chances d’appartenir au groupe B comparativement au groupe A. Cependant, pour chaque bonne réponse supplémentaire sur les questions testant les connaissances sur les OGM, les chances d’appartenir au groupe B comparativement au groupe A diminuent de 28&nbsp;%. Ainsi, un individu ayant répondu correctement aux trois questions verrait ses chances réduites de 63&nbsp;% d’appartenir au groupe B (<span class="math inline">\(exp(-\text{0,33}\times\text{3})\)</span>). Il est intéressant de noter que les variables concernant le réchauffement climatique n’ont pas d’effet significatif ici. La variable CRT indique qu’à chaque bonne réponse supplémentaire au test de cognition, les chances d’appartenir au groupe B augmentent de 42&nbsp;%. Un individu qui aurait répondu aux trois questions du test aurait donc 2,9 fois plus de chances d’appartenir au groupe B qu’au groupe A. Concernant le parti politique, comparativement à une personne se déclarant plus proche du parti démocrate, les personnes proches du parti républicain ou d’un autre parti ont près de deux fois plus de chances d’appartenir au groupe B. Enfin, une femme, comparativement à un homme, a 3,6 fois plus de chance d’appartenir au groupe B.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffsmultinom2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.18: Coefficients du modèle multinomial A versus C</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 17%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 8%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">Coefficient</th>
<th style="text-align: right;">RC</th>
<th style="text-align: right;">val.p</th>
<th style="text-align: right;">RC 2,5 %</th>
<th style="text-align: right;">RC 97,5 %</th>
<th style="text-align: right;">sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PercepOGMDes</td>
<td style="text-align: right;">-0,180</td>
<td style="text-align: right;">0,834</td>
<td style="text-align: right;">0,705</td>
<td style="text-align: right;">0,326</td>
<td style="text-align: right;">2,138</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">PercepRechClimDes</td>
<td style="text-align: right;">2,060</td>
<td style="text-align: right;">7,821</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">3,819</td>
<td style="text-align: right;">16,119</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ConnaisOGM</td>
<td style="text-align: right;">-0,110</td>
<td style="text-align: right;">0,896</td>
<td style="text-align: right;">0,287</td>
<td style="text-align: right;">0,733</td>
<td style="text-align: right;">1,094</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ConnaisRechClim</td>
<td style="text-align: right;">0,280</td>
<td style="text-align: right;">1,323</td>
<td style="text-align: right;">0,024</td>
<td style="text-align: right;">1,041</td>
<td style="text-align: right;">1,682</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CRT</td>
<td style="text-align: right;">0,240</td>
<td style="text-align: right;">1,275</td>
<td style="text-align: right;">0,149</td>
<td style="text-align: right;">0,914</td>
<td style="text-align: right;">1,768</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Parti</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : Democrate</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">autre</td>
<td style="text-align: right;">-0,190</td>
<td style="text-align: right;">0,828</td>
<td style="text-align: right;">0,496</td>
<td style="text-align: right;">0,482</td>
<td style="text-align: right;">1,433</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Republicain</td>
<td style="text-align: right;">0,920</td>
<td style="text-align: right;">2,512</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,584</td>
<td style="text-align: right;">4,015</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Sexe</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : homme</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">femme:1</td>
<td style="text-align: right;">-0,450</td>
<td style="text-align: right;">0,640</td>
<td style="text-align: right;">0,040</td>
<td style="text-align: right;">0,419</td>
<td style="text-align: right;">0,980</td>
<td style="text-align: right;">*</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Le <a href="#tbl-coeffsmultinom2">tableau&nbsp;<span>8.18</span></a> compare les groupes A et C (en désaccord sur le réchauffement climatique). Il est intéressant de noter ici que se percevoir en désaccord avec la recherche scientifique est associé avec une forte augmentation des chances d’appartenir au groupe C. Cependant, un plus grand nombre de bonnes réponses aux questions sur le réchauffement climatique est également associé avec une augmentation des chances (30&nbsp;% à chaque bonne réponse supplémentaire) d’appartenir au groupe C. Le CRT n’a cette fois-ci pas d’effet. Se déclarer proche du parti républicain, comparativement au parti démocrate, multiplie les chances par 2,5 d’appartenir au groupe C. Comparativement au tableau précédent, le fait d’être une femme diminue les chances de 36&nbsp;% d’appartenir au groupe C.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffsmultinom3" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.19: Coefficients du modèle multinomial A versus D</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 8%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">Coefficient</th>
<th style="text-align: right;">RC</th>
<th style="text-align: right;">val.p</th>
<th style="text-align: right;">RC 2,5 %</th>
<th style="text-align: right;">RC 97,5 %</th>
<th style="text-align: right;">sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PercepOGMDes</td>
<td style="text-align: right;">1,500</td>
<td style="text-align: right;">4,488</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">2,270</td>
<td style="text-align: right;">8,935</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">PercepRechClimDes</td>
<td style="text-align: right;">2,440</td>
<td style="text-align: right;">11,501</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">5,312</td>
<td style="text-align: right;">25,028</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ConnaisOGM</td>
<td style="text-align: right;">-0,480</td>
<td style="text-align: right;">0,621</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,492</td>
<td style="text-align: right;">0,787</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">ConnaisRechClim</td>
<td style="text-align: right;">0,130</td>
<td style="text-align: right;">1,140</td>
<td style="text-align: right;">0,399</td>
<td style="text-align: right;">0,844</td>
<td style="text-align: right;">1,553</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">CRT</td>
<td style="text-align: right;">0,340</td>
<td style="text-align: right;">1,409</td>
<td style="text-align: right;">0,119</td>
<td style="text-align: right;">0,914</td>
<td style="text-align: right;">2,160</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Parti</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : Democrate</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">autre</td>
<td style="text-align: right;">0,190</td>
<td style="text-align: right;">1,211</td>
<td style="text-align: right;">0,531</td>
<td style="text-align: right;">0,664</td>
<td style="text-align: right;">2,203</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Republicain</td>
<td style="text-align: right;">0,630</td>
<td style="text-align: right;">1,872</td>
<td style="text-align: right;">0,038</td>
<td style="text-align: right;">1,041</td>
<td style="text-align: right;">3,387</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Sexe</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : homme</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">femme:1</td>
<td style="text-align: right;">-0,110</td>
<td style="text-align: right;">0,896</td>
<td style="text-align: right;">0,664</td>
<td style="text-align: right;">0,543</td>
<td style="text-align: right;">1,477</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Le dernier tableau (<a href="#tbl-coeffsmultinom3"><span>8.19</span></a>) compare le groupe A au groupe D (en désaccord sur les deux sujets). Les variables les plus importantes sont une fois encore le fait de se sentir en désaccord avec la recherche scientifique et le degré de connaissance sur les OGM. La variable concernant le parti politique est significative au seuil 0,05 et exprime toujours une tendance accrue pour les individus du parti républicain à appartenir au groupe D.</p>
<p>Nos propres conclusions corroborent celles de l’article original. Une des conclusions intéressantes est que le rejet du consensus scientifique ne semble pas nécessairement être associé à un déficit d’information ni à une plus faible capacité analytique, mais relèverait davantage d’une polarisation politique. Notez que cette littérature sur les croyances et la confiance dans la recherche est complexe, si le sujet vous intéresse, la discussion de l’article de <span class="citation" data-cites="mcfadden2016examining">McFadden (<a href="references.html#ref-mcfadden2016examining" role="doc-biblioref">2016</a>)</span> est un bon point de départ.</p>
</section></section><section id="conclusion-sur-les-modèles-pour-des-variables-qualitatives" class="level3" data-number="8.2.5"><h3 data-number="8.2.5" class="anchored" data-anchor-id="conclusion-sur-les-modèles-pour-des-variables-qualitatives">
<span class="header-section-number">8.2.5</span> Conclusion sur les modèles pour des variables qualitatives</h3>
<p>Nous avons vu dans cette section, les trois principales formes de modèles GLM pour modéliser une variable binaire (modèle binomial), une variable ordinale (modèle de cotes proportionnel) et une variable multinomiale (modèle multinomial). Pour ces trois modèles, nous avons vu que la distribution utilisée est toujours la distribution binomiale et la fonction de lien logistique. Les coefficients obtenus s’interprètent comme des rapports de cotes, une fois qu’ils sont transformés avec la fonction exponentielle.</p>
</section></section><section id="sec-083" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="sec-083">
<span class="header-section-number">8.3</span> Modèles GLM pour des variables de comptage</h2>
<p>Dans cette section, nous présentons les principaux modèles utilisés pour modéliser des variables de comptage. Il peut s’agir de variables comme le nombre d’accidents à une intersection, le nombre de cafés par quartier, le nombre de cas d’une maladie donnée par entité géographique, etc.</p>
<section id="sec-0831" class="level3" data-number="8.3.1"><h3 data-number="8.3.1" class="anchored" data-anchor-id="sec-0831">
<span class="header-section-number">8.3.1</span> Modèle de Poisson</h3>
<p>Le modèle GLM de base pour modéliser une variable de comptage est le modèle de Poisson. Pour rappel, la distribution de Poisson a un seul paramètre: <span class="math inline">\(\lambda\)</span>. Il représente le nombre moyen d’évènements observés sur l’intervalle de temps d’une observation, ainsi que la dispersion de la distribution. En conséquence, <span class="math inline">\(\lambda\)</span> doit être un nombre strictement positif; autrement dit, nous ne pouvons pas observer un nombre négatif d’évènements. Il est donc nécessaire d’utiliser une fonction de lien pour contraindre l’équation de régression sur l’intervalle <span class="math inline">\([0 ,+\infty]\)</span>. La fonction la plus utilisée est le logarithme naturel (<em>log</em>) dont la réciproque est la fonction exponentielle (<em>exp</em>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-poissondentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.20: Carte d’identité du modèle de Poisson</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable de comptage</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Poisson</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Poisson(\lambda)\)</span> <span class="math inline">\(g(\lambda) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) =log(x)\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">log</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\lambda\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Absence d’excès de zéros, absence de sur-dispersion ou de sous-dispersion</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08311" class="level4" data-number="8.3.1.1"><h4 data-number="8.3.1.1" class="anchored" data-anchor-id="sec-08311">
<span class="header-section-number">8.3.1.1</span> Interprétation des paramètres</h4>
<p>Les coefficients du modèle expriment l’effet du changement d’une unité des variables <em>X</em> sur <span class="math inline">\(\lambda\)</span> (le nombre de cas) dans l’échelle logarithmique (<em>log-scale</em>). Pour rappel, l’échelle logarithmique est multiplicative&nbsp;: si nous convertissons les coefficients dans leur échelle originale avec la fonction exponentielle, leur effet n’est plus additif, mais multiplicatif. Prenons un exemple concret, admettons que nous avons ajusté un modèle de Poisson à une variable de comptage <em>Y</em> avec deux variables <span class="math inline">\(X_1\)</span> et <span class="math inline">\(X_2\)</span> et que nous avons obtenus les coefficients suivants&nbsp;:</p>
<p><span class="math inline">\(\beta_0 = 1,8 \text{; } \beta_1 = 0,5 \text{; } \beta_2 = -1,5\)</span></p>
<p>L’interprétation basique (sur l’échelle logarithmique) est la suivante&nbsp;: une augmentation d’une unité de la variable <span class="math inline">\(X_1\)</span> est associée avec une augmentation de 0,5 du logarithme du nombre de cas attendus. Une augmentation d’une unité de la variable <span class="math inline">\(X_2\)</span> est associée avec une réduction de 1,5 unité du logarithme du nombre de cas attendus. Avec la conversion avec la fonction exponentielle, nous obtenons alors&nbsp;:</p>
<ul>
<li><p><span class="math inline">\(exp\mbox{(0,5) = 1,649}\)</span>, soit une multiplication par 1,649 du nombre de cas attendu (aussi appelé taux d’incident) à chaque augmentation d’une unité de <span class="math inline">\(X_1\)</span>;</p></li>
<li><p><span class="math inline">\(exp\mbox{(-1,5) = 0,223}\)</span>, soit une division par 4,54 (1/0,223) du nombre de cas attendu (aussi appelé taux d’incident) à chaque augmentation d’une unité de <span class="math inline">\(X_2\)</span>.</p></li>
</ul>
<p>Utilisons maintenant notre équation pour effectuer une prédiction si <span class="math inline">\(X_1 = 1\)</span> et <span class="math inline">\(X_2 = 1\)</span>.</p>
<p><span class="math inline">\(\lambda = exp(\mbox{1,8} + (\mbox{0,5}\times 1) + (\mbox{-1,5}\times1)) = \mbox{2,225}\)</span></p>
<p>Si nous augmentons <span class="math inline">\(X_1\)</span> d’une unité, nous obtenons alors&nbsp;:</p>
<p><span class="math inline">\(\lambda = exp(1,8 + (\mbox{0,5}\times 2) + (\mbox{-1,5}\times1)) = \mbox{3,670}\)</span></p>
<p>En ayant augmenté d’une unité <span class="math inline">\(X_1\)</span>, nous avons multiplié notre résultat par 1,649 (<span class="math inline">\(\mbox{2,225} \times \mbox{1,649 = 3,670}\)</span>).</p>
<p>Notez que ces effets se multiplient entre eux. Si nous augmentons à la fois <span class="math inline">\(X_1\)</span> et <span class="math inline">\(X_2\)</span> d’une unité chacune, nous obtenons&nbsp;: <span class="math inline">\(\lambda = exp(1,8 + (\mbox{0,5} \times 2) + (\mbox{-1,5} \times 2)) = \mbox{0,818}\)</span>, ce qui correspond bien à <span class="math inline">\(\mbox{2,225} \times \mbox{1,649} \text{ (effet de  }X_1\text{)} \times \mbox{0,223} \text{ (effet de }X_2\text{)} = \mbox{0,818}\)</span>.</p>
<p>Il existe des fonctions dans R qui calculent ces prédictions à partir des équations des modèles. Il est cependant essentiel de bien saisir ce comportement multiplicatif induit par la fonction de lien <em>log</em>.</p>
</section><section id="sec-08312" class="level4" data-number="8.3.1.2"><h4 data-number="8.3.1.2" class="anchored" data-anchor-id="sec-08312">
<span class="header-section-number">8.3.1.2</span> Conditions d’application</h4>
<p>Puisque la distribution de Poisson n’a qu’un seul paramètre, le modèle GLM de Poisson est exposé au même problème potentiel de sur-dispersion que les modèles binomiaux de la section précédente. Référez-vous à la <a href="#sec-08212">section&nbsp;<span>8.2.1.2</span></a> pour davantage de détails sur le problème posé par la sur-dispersion. Pour détecter une potentielle sur-dispersion dans un modèle de Poisson, il est possible, dans un premier temps, de calculer le ratio entre la déviance du modèle et son nombre de degrés de liberté <span class="citation" data-cites="Saspoiss">(<a href="references.html#ref-Saspoiss" role="doc-biblioref">SAS Institute Inc 2020b</a>)</span>. Ce ratio doit être proche de 1, s’il est plus grand, le modèle souffre de sur-dispersion.</p>
<p><span id="eq-glm16"><span class="math display">\[
\hat{\phi} = \frac{D(modele)}{N-p}
\tag{8.19}\]</span></span></p>
<p>avec <span class="math inline">\(N\)</span> et <span class="math inline">\(p\)</span> étant respectivement les nombres d’observations et de paramètres. Il est également possible de tester formellement si la sur-dispersion est significative avec un test de dispersion.</p>
<p>La question de l’excès de zéros a été abordée dans la <a href="02-univarie.html#sec-poissonzero">section&nbsp;<span>2.4.3.7</span></a> du <a href="02-univarie.html">chapitre&nbsp;<span>2</span></a>. Il s’agit d’une situation où un plus grand nombre de zéros sont présents dans les données que ce que suppose la distribution de Poisson. Dans ce cas, il convient d’utiliser la distribution de Poisson avec excès de zéros.</p>
</section><section id="sec-08313" class="level4" data-number="8.3.1.3"><h4 data-number="8.3.1.3" class="anchored" data-anchor-id="sec-08313">
<span class="header-section-number">8.3.1.3</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous reproduisons l’analyse effectuée dans l’article de <span class="citation" data-cites="cloutier2014carrefours">Cloutier et al. (<a href="references.html#ref-cloutier2014carrefours" role="doc-biblioref">2014</a>)</span>. L’enjeu de cette étude était de modéliser le nombre de piétons blessés autour de plus de 500 carrefours dans les quartiers centraux de Montréal. Pour cela, trois types de variables étaient utilisées&nbsp;: des variables décrivant l’intersection, des variables décrivant les activités humaines dans un rayon d’un kilomètre autour de l’intersection et des variables représentant le trafic routier autour de l’intersection. Un effet direct de ce type d’étude est bien évidemment l’établissement de meilleures pratiques d’aménagement réduisant les risques encourus par les piétons lors de leurs déplacements en ville. Le <a href="#tbl-variablepoiss">tableau&nbsp;<span>8.21</span></a> présente l’ensemble des variables utilisées dans l’analyse.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-variablepoiss" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.21: Variables indépendantes utilisées dans le modèle de Poisson</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 37%">
<col style="width: 8%">
<col style="width: 45%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom de la variable</th>
<th style="text-align: left;">Signification</th>
<th style="text-align: left;">Type de variable</th>
<th style="text-align: left;">Mesure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Feux_auto</td>
<td style="text-align: left;">Présence de feux de circulation</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
<tr class="even">
<td style="text-align: left;">Feux_piet</td>
<td style="text-align: left;">Présence de feux de traversée pour les piétons</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pass_piet</td>
<td style="text-align: left;">Présence d’un passage piéton</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
<tr class="even">
<td style="text-align: left;">Terreplein</td>
<td style="text-align: left;">Présence d’un terre-plein central</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apaisement</td>
<td style="text-align: left;">Présence de mesure d’apaisement de la circulation</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
<tr class="even">
<td style="text-align: left;">LogEmploi</td>
<td style="text-align: left;">Logarithme du nombre d’emplois dans un rayon d’un kilomètre</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Logarithme du nombre d’emplois. Utilisation du logarithme, car la variable est fortement asymétrique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Densite_pop</td>
<td style="text-align: left;">Densité de population dans un rayon d’un kilomètre</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Habitants par hectare</td>
</tr>
<tr class="even">
<td style="text-align: left;">Entropie</td>
<td style="text-align: left;">Diversité des occupations du sol dans un rayon d’un kilomètre (indice d’entropie)</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Mesure de 0 à 1; 0 = spécialisation parfaite; 1 = diversité parfaite</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DensiteInter</td>
<td style="text-align: left;">Densité d’intersections dans un rayon d’un kilomètre (connexité)</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Nombre d’intersection par km2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Artere</td>
<td style="text-align: left;">Présence d’une artère à l’intersection</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Long_arterePS</td>
<td style="text-align: left;">Longueur d’artère dans un rayon d’un kilomètre</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Exprimée en mètres</td>
</tr>
<tr class="even">
<td style="text-align: left;">NB_voies5</td>
<td style="text-align: left;">Présence d’une cinq voies à l’intersection</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">0 = absence; 1 = présence</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>La distribution originale de la variable est décrite à la <a href="#fig-distripoissmod">figure&nbsp;<span>8.23</span></a>. Les barres grises représentent la distribution du nombre d’accidents et les barres rouges une distribution de Poisson ajustée sans variable indépendante (modèle nul). Ce premier graphique peut laisser penser qu’un modèle de Poisson n’est pas nécessairement le plus adapté considérant le grand nombre d’intersections pour lesquelles nous n’avons aucun accident. Cependant, rappelons que la variable <em>Y</em> n’a pas besoin de suivre une distribution de Poisson. Dans un modèle GLM, l’hypothèse que nous formulons est que la variable dépendante (<em>Y</em>) <strong>conditionnée par les variables indépendantes (<em>X</em>)</strong> suit une certaine distribution (ici Poisson).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="va">data_accidents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/accident_pietons.csv"</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span><span class="co"># Ajustement d'une distribution de Poisson sans variable indépendante</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lbbe.univ-lyon1.fr/fr/fitdistrplus">fitdistrplus</a></span><span class="op">)</span></span>
<span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fitdistrplus/man/fitdist.html">fitdist</a></span><span class="op">(</span><span class="va">data_accidents</span><span class="op">$</span><span class="va">Nbr_acci</span>, distr <span class="op">=</span> <span class="st">"pois"</span><span class="op">)</span></span>
<span><span class="co"># Création d'un graphique pour comparer les deux distributions</span></span>
<span><span class="va">dfpoisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span>,</span>
<span>                        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">19</span>, <span class="va">model_poisson</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data_accidents</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nb_accident"</span>,<span class="st">'frequence'</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">frequence</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">frequence</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nb_accident</span>, weight <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="st">"real"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.6</span>, data <span class="op">=</span> <span class="va">counts</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, weight <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="st">"adj"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.15</span>, data <span class="op">=</span> <span class="va">dfpoisson</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">7</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>,</span>
<span>          breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"real"</span> , <span class="st">"adj"</span><span class="op">)</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"distribution originale"</span>, <span class="st">"distribution de Poisson"</span><span class="op">)</span>,</span>
<span>          values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"real"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span>, <span class="st">"adj"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"nombre d'accidents"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-distripoissmod" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-distripoissmod-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.23: Distribution originale du nombre d’accidents par intersection</figcaption></figure>
</div>
</div>
</div>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Comme précédemment, notre première étape est de vérifier l’absence de multicolinéarité excessive avec la fonction <code>vif</code> du <em>package</em> <code>car</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span> <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span></span>
<span>          <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span></span>
<span>          <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">data_accidents</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Feux_auto     Feux_piet     Pass_piet    Terreplein    Apaisement 
     2.861708      1.518668      2.321213      1.221683      1.059722 
    LogEmploi   Densite_pop      Entropie  DensiteInter Long_arterePS 
     4.763692      1.153096      1.770904      2.040457      4.467841 
       Artere     NB_voies5 
     1.887728      1.520514 </code></pre>
</div>
</div>
<p>Toutes les valeurs de VIF sont inférieures à 5. Notons tout de même que le logarithme de l’emploi et la longueur d’artère dans un rayon d’un kilomètre ont des valeurs de VIF proches de 5. La seconde étape du diagnostic consiste à calculer et à visualiser les distances de Cook.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement d'une première version du modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span> <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span></span>
<span>                <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span></span>
<span>                <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data_accidents</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-poisscookdist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-poisscookdist-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.24: Distances de Cook pour le modèle de Poisson</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-poisscookdist">figure&nbsp;<span>8.24</span></a> signale la présence de trois observations avec des valeurs extrêmement fortes de distance de Cook. Nous les isolons dans un premier temps pour les analyser.</p>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cas_etrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_accidents</span>, <span class="va">cooksd</span><span class="op">&gt;</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etrange</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Nbr_acci Feux_auto Feux_piet Pass_piet Terreplein Apaisement EmpTotBuffer
1         19         1         1         1          1          0     7208.538
26         7         0         0         1          0          0     1342.625
428        0         1         1         1          0          1    13122.560
    Densite_pop  Entropie DensiteInter Long_arterePS Artere NB_voies5 log_acci
1      5980.923 0.8073926     42.41597       6955.00      1         1 2.995732
26     2751.012 0.0000000     73.35344       2849.66      0         0 2.079442
428   14148.827 0.6643891    109.25066       4634.20      0         0 0.000000
    catego_acci catego_acci2 Arret VAG sum_app LogEmploi AccOrdinal     PopHa
1             1            1     0   1       4  8.883021          2  5.980923
26            1            1     1   1       3  7.202382          2  2.751012
428           0            0     0   0       3  9.482088          0 14.148827</code></pre>
</div>
</div>
<p>Les deux premiers cas sont des intersections avec de nombreux accidents (respectivement 19 et 7) qui risquent de perturber les estimations du modèle. Le troisième cas ne comprend en revanche aucun accident. Puisqu’il ne s’agit que de trois observations et que leurs distances de Cook sont très nettement supérieures aux autres, nous les retirons du modèle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_accidents</span>, <span class="va">cooksd</span><span class="op">&lt;</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co"># Ajustement d'une première version du modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span> <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span></span>
<span>                <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span></span>
<span>                <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-poisscookdist2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-poisscookdist2-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.25: Distances de Cook pour le modèle de Poisson après avoir retiré les valeurs aberrantes</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-poisscookdist2">figure&nbsp;<span>8.25</span></a> montre que nous n’avons plus d’observations fortement influentes dans le modèle après avoir retiré les trois observations identifiées précédemment. Nous devons à présent vérifier l’absence de sur-dispersion.</p>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du rapport entre déviance et nombre de degrés de liberté du modèle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span> <span class="op">-</span> <span class="va">modele</span><span class="op">$</span><span class="va">rank</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.674691</code></pre>
</div>
</div>
<p>Le rapport entre la déviance et le nombre de degrés de liberté du modèle est nettement supérieur à 1, indiquant une sur-dispersion excessive. Nous pouvons confirmer ce résultat avec la fonction <code>dispersiontest</code> du <em>package</em> <code>AER</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">AER</span><span class="op">)</span></span>
<span><span class="co"># Test de sur-dispersion</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AER/man/dispersiontest.html">dispersiontest</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Overdispersion test

data:  modele
z = 5.2737, p-value = 6.686e-08
alternative hypothesis: true dispersion is greater than 1
sample estimates:
dispersion 
  1.891565 </code></pre>
</div>
</div>
<p>Contrairement à la forme classique d’un modèle de Poisson pour laquelle la dispersion attendue est de&nbsp;1, le test nous indique qu’une dispersion de 1,89 serait mieux ajustée aux données.</p>
<p>Il est également possible d’illuster cet écart à l’aide d’un graphique représentant les valeurs réelles, les valeurs prédites, ainsi que la variance (sous forme de barres d’erreurs) attendue par le modèle (<a href="#fig-surdisppoiss">figure&nbsp;<span>8.26</span></a>). Nous constatons ainsi que les valeurs réelles (en rouge) ont largement tendance à dépasser la variance attendue par le modèle, surtout pour les valeurs les plus faibles de la distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle</span></span>
<span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Création d'un DataFrame pour contenir la prédiction et les vraies valeurs</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  lambdas <span class="op">=</span> <span class="va">lambdas</span>,</span>
<span>  reals <span class="op">=</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Calcul de l'intervalle de confiance à 95 % selon la distribution de Poisson</span></span>
<span><span class="co"># et stockage dans un second DataFrame</span></span>
<span><span class="va">seqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  lambdas <span class="op">=</span> <span class="va">seqa</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">qpois</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.025</span>, lambda <span class="op">=</span> <span class="va">seqa</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">qpois</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, lambda <span class="op">=</span> <span class="va">seqa</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lambdas</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df1</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lambdas</span>, y <span class="op">=</span> <span class="va">reals</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"valeurs prédites"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"valeurs réelles"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-surdisppoiss" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-surdisppoiss-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.26: Représentation de la sur-dispersion des données dans le modèle de Poisson</figcaption></figure>
</div>
</div>
</div>
<p>Pour tenir compte de cette particularité des données, nous modifions légèrement le modèle pour utiliser une distribution de quasi-Poisson, intégrant spécifiquement un paramètre de dispersion. Cet ajustement ne modifie pas l’estimation des coefficients du modèle, mais modifie le calcul des erreurs standards et par extension les valeurs de <em>p</em> pour les rendre moins sensibles au problème de sur-dispersion. Une autre approche aurait été de calculer une version robuste des erreurs standards avec le <em>package</em> <code>sandwich</code> comme nous l’avons fait dans la <a href="#sec-0821">section&nbsp;<span>8.2.1</span></a> sur le modèle binomial. Après réajustement du modèle, le nouveau paramètre de dispersion estimé est de 1,92.</p>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Les quasi-distributions</strong></p>
</div>
<div class="bloc_notes-body">
<p>Les distributions binomiale et de Poisson ne disposent chacune que d’un paramètre décrivant à la fois leur dispersion et leur espérance. Elles manquent donc de flexibilité et échouent parfois à représenter fidèlement des données avec une forte variance. Il existe donc d’autres distributions, respectivement les distributions quasi-binomiale et quasi-Poisson comprenant chacune un paramètre supplémentaire pour contrôler la dispersion. Bien que cette solution soit attrayante, il ne faut pas perdre de vue que la sur ou la sous dispersion peuvent être causées par l’absence de certaines variables explicatives, la sur-représentation de zéros, ou encore une séparation parfaite de la variable dépendante causée par une variable indépendante.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span> <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span></span>
<span>                <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span></span>
<span>                <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">quasipoisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons à présent comparer la distribution originale des données et les simulations issues du modèle. Notez que contrairement à la distribution de Poisson simple, il n’existe pas dans R de fonction pour simuler des valeurs issues d’une distribution de quasi-Poisson. Il est cependant possible d’exploiter sa proximité théorique avec la distribution binomiale négative pour définir notre propre fonction de simulation. La <a href="#fig-comppoissdistr">figure&nbsp;<span>8.27</span></a> permet de comparer la distribution originale (en gris) et l’intervalle de confiance à 95&nbsp;% des simulations (en rouge). Nous remarquons que le modèle semble capturer efficacement la forme générale de la distribution originale. À titre de comparaison, nous pouvons effectuer le même exercice avec la distribution de Poisson classique (le code n’est pas montré pour éviter les répétitions). La <a href="#fig-comppoissdistr2">figure&nbsp;<span>8.28</span></a> montre qu’un simple modèle de Poisson est très éloigné de la distribution originale de <em>Y</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Définition d'une fonction pour simuler des données quasi-Poisson</span></span>
<span><span class="va">rqpois</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">lambda</span>, <span class="va">disp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">lambda</span>, size <span class="op">=</span> <span class="va">lambda</span><span class="op">/</span><span class="op">(</span><span class="va">disp</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Extraction des valeurs prédites par le modèle</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span><span class="va">disp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele2</span><span class="op">)</span><span class="op">$</span><span class="va">dispersion</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">preds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">rqpois</span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, disp <span class="op">=</span> <span class="va">disp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Préparation des données pour le graphique (valeurs réelles)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nb_accident"</span>,<span class="st">'frequence'</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">frequence</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">frequence</span><span class="op">)</span></span>
<span><span class="co"># Préparation des données pour le graphique (valeurs simulées)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">count_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsim</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="va">mat_sims</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">cnt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">cnt</span>, by.x <span class="op">=</span> <span class="st">"count"</span>, by.y <span class="op">=</span> <span class="st">"sim"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">df2</span><span class="op">$</span><span class="va">Freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>,<span class="fl">0</span>, <span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">count_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">count_sims</span><span class="op">)</span></span>
<span><span class="va">df_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  val <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span>,</span>
<span>  med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nb_accident</span>, weight <span class="op">=</span> <span class="va">frequence</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.6</span>, data <span class="op">=</span> <span class="va">counts</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">df_sims</span>, color <span class="op">=</span> <span class="st">"red"</span>, width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, y <span class="op">=</span> <span class="va">med</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1.3</span>, data <span class="op">=</span> <span class="va">df_sims</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">7</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"nombre d'accidents"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"nombre d'occurrences"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-comppoissdistr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-comppoissdistr-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.27: Comparaison de la distribution originale et des simulations pour le modèle de quasi-Poisson</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-comppoissdistr2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-comppoissdistr2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.28: Comparaison de la distribution originale et des simulations pour le modèle de Poisson</figcaption></figure>
</div>
</div>
</div>
<p>La prochaine étape du diagnostic est l’analyse des résidus simulés. La <a href="#fig-simrespoiss">figure&nbsp;<span>8.29</span></a> indique que les résidus du modèle suivent bien une distribution uniforme et qu’aucune valeur aberrante n’est observable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span><span class="va">disp</span> <span class="op">&lt;-</span> <span class="fl">1.918757</span> <span class="co"># trouvable dans le summary(modele2)</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">preds</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">rqpois</span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, disp <span class="op">=</span> <span class="va">disp</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">modele2</span><span class="op">$</span><span class="va">fitted.values</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-simrespoiss" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-simrespoiss-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.29: Analyse globale des résidus simulés pour le modèle de quasi-Poisson</figcaption></figure>
</div>
</div>
</div>
<p>Pour affiner notre diagnostic, nous pouvons également comparer les résidus simulés et chaque variable indépendante. La <a href="#fig-simrespoiss2">figure&nbsp;<span>8.30</span></a> n’indique aucune relation problématique entre nos variables indépendantes et les résidus.</p>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Feux_auto"</span>, <span class="st">"Feux_piet"</span>, <span class="st">"Pass_piet"</span>, <span class="st">"Terreplein"</span>, <span class="st">"Apaisement"</span>,</span>
<span>                <span class="st">"LogEmploi"</span>, <span class="st">"Densite_pop"</span>, <span class="st">"Entropie"</span>, <span class="st">"DensiteInter"</span>,</span>
<span>                <span class="st">"Long_arterePS"</span>, <span class="st">"Artere"</span>, <span class="st">"NB_voies5"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">v</span> <span class="kw">in</span>  <span class="va">vars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html">plotResiduals</a></span><span class="op">(</span><span class="va">sim_res</span>, <span class="va">data2</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="va">v</span>, main <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">"résidus"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-simrespoiss2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/simrespoiss2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.30: Comparaison des résidus simulés et de chaque variable indépendante</figcaption></figure>
</div>
</div>
</div>
<p>Maintenant que l’ensemble des diagnostics a été effectué, nous pouvons passer à la vérification de la qualité d’ajustement.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<p>Pour le calcul des pseudo-R<sup>2</sup>, notez qu’il n’existe pas à proprement parler de <em>loglikelihood</em> pour les quasi-distributions. Pour contourner ce problème, il est possible d’utiliser le <em>loglikelihood</em> d’un simple modèle de Poisson (puisque les coefficients ne changent pas), mais il est important de garder à l’esprit que ces pseudo-R<sup>2</sup> seront d’autant plus faibles que la sur-dispersion originale était forte.</p>
<div class="cell">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelnull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelnull</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelnull</span><span class="op">)</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modele</span><span class="op">$</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.4805998

$`McFadden ajuste`
'log Lik.' 0.3258375 (df=13)

$`Cox and Snell`
'log Lik.' 0.7789704 (df=13)

$Nagelkerke
'log Lik.' 0.787958 (df=13)</code></pre>
</div>
</div>
<p>Le modèle parvient ainsi à expliquer 48&nbsp;% de la déviance totale. Il obtient un R<sup>2</sup> ajusté de McFadden de 0,33 et un R<sup>2</sup> de Cox et Snell de 0,78.</p>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">-</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.838026</code></pre>
</div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Nombre moyen d'accidents</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.503984</code></pre>
</div>
</div>
<p>L’erreur quadratique moyenne du modèle est de 1,84, ce que signifie qu’en moyenne le modèle se trompe d’environ deux accidents pour chaque intersection. Cette valeur est relativement élevée si nous la comparons avec le nombre moyen d’accidents, soit 1,5. Cela s’explique certainement par le grand nombre de zéros dans la variable <em>Y</em> qui tendent à tirer les prédictions vers le bas.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>. Puisque la fonction de lien du modèle est la fonction <code>log</code>, il est pertinent de convertir les coefficients avec la fonction <code>exp</code> afin de pouvoir les interpréter sur l’échelle originale (<code>nombre d'accidents</code>) plutôt que l’échelle logarithmique (<code>log(nombre d'accidents)</code>). N’oubliez pas que ces effets sont multiplicatifs une fois transformés avec la fonction <code>exp</code>. Nous pouvons également utiliser les erreurs standards pour calculer des intervalles de confiance à 95&nbsp;% des exponentiels des coefficients. Le <a href="#tbl-coeffpoiss">tableau&nbsp;<span>8.22</span></a> présente l’ensemble des informations pertinentes pour l’interprétation des résultats.</p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul des coefficients en exponentiel et des intervalles de confiance</span></span>
<span><span class="va">tableau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele2</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">tableau</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">err.std</span> <span class="op">&lt;-</span> <span class="va">tableau</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">expcoeff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span></span>
<span><span class="va">exp2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">err.std</span><span class="op">)</span></span>
<span><span class="va">exp975</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">err.std</span><span class="op">)</span></span>
<span><span class="va">pvals</span> <span class="op">&lt;-</span> <span class="va">tableau</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">tableauComplet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coeffs</span>, <span class="va">err.std</span>, <span class="va">expcoeff</span>, <span class="va">exp2.5</span>, <span class="va">exp975</span>, <span class="va">pvals</span><span class="op">)</span></span>
<span><span class="co"># print(tableauComplet)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffpoiss" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.22: Résultats du modèle de quasi-Poisson</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 6%">
<col style="width: 23%">
<col style="width: 25%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">exp(Coeff.)</th>
<th style="text-align: right;">Val.p</th>
<th style="text-align: right;">IC 2,5 % exp(Coeff.)</th>
<th style="text-align: right;">IC 97,5 % exp(Coeff.)</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">-3,680</td>
<td style="text-align: right;">0,030</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">0,090</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Feux_auto</td>
<td style="text-align: right;">1,100</td>
<td style="text-align: right;">3,000</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,970</td>
<td style="text-align: right;">4,660</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Feux_piet</td>
<td style="text-align: right;">0,330</td>
<td style="text-align: right;">1,390</td>
<td style="text-align: right;">0,009</td>
<td style="text-align: right;">1,090</td>
<td style="text-align: right;">1,790</td>
<td style="text-align: right;">**</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pass_piet</td>
<td style="text-align: right;">0,340</td>
<td style="text-align: right;">1,400</td>
<td style="text-align: right;">0,149</td>
<td style="text-align: right;">0,880</td>
<td style="text-align: right;">2,200</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Terreplein</td>
<td style="text-align: right;">-0,360</td>
<td style="text-align: right;">0,700</td>
<td style="text-align: right;">0,099</td>
<td style="text-align: right;">0,440</td>
<td style="text-align: right;">1,050</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Apaisement</td>
<td style="text-align: right;">0,290</td>
<td style="text-align: right;">1,330</td>
<td style="text-align: right;">0,157</td>
<td style="text-align: right;">0,880</td>
<td style="text-align: right;">1,950</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">LogEmploi</td>
<td style="text-align: right;">0,230</td>
<td style="text-align: right;">1,260</td>
<td style="text-align: right;">0,017</td>
<td style="text-align: right;">1,040</td>
<td style="text-align: right;">1,520</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;">Densite_pop</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Entropie</td>
<td style="text-align: right;">-0,420</td>
<td style="text-align: right;">0,660</td>
<td style="text-align: right;">0,271</td>
<td style="text-align: right;">0,320</td>
<td style="text-align: right;">1,390</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">DensiteInter</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">0,410</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">1,010</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Long_arterePS</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">0,684</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Artere</td>
<td style="text-align: right;">0,030</td>
<td style="text-align: right;">1,030</td>
<td style="text-align: right;">0,842</td>
<td style="text-align: right;">0,780</td>
<td style="text-align: right;">1,360</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">NB_voies5</td>
<td style="text-align: right;">0,640</td>
<td style="text-align: right;">1,890</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,460</td>
<td style="text-align: right;">2,440</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Parmi les variables décrivant les aménagements de l’intersection, nous constatons que les présences d’un feu de circulation et d’un feu de traversée pour les piétons multiplient le nombre attendu d’accidents à une intersection par 3,0 et 1,39. Par contre, les présences d’un passage piéton, d’un terre-plein ou de mesures d’apaisement n’ont pas d’effets significatifs (valeurs de <em>p</em>&nbsp;&gt;&nbsp;0,05). Concernant les variables décrivant l’environnement à proximité des intersections, nous observons que la concentration d’emplois et la densité de population contribuent toutes les deux à augmenter le nombre d’accidents à une intersection, bien que leurs effets soient limités. Enfin, la présence d’une rue à cinq voies à l’intersection augmente le nombre d’accidents attendu à l’intersection de 89&nbsp;%. Nous ne détaillons pas plus les résultats, car nous utilisons le même jeu de données dans les prochaines sections.</p>
</section></section><section id="sec-0832" class="level3" data-number="8.3.2"><h3 data-number="8.3.2" class="anchored" data-anchor-id="sec-0832">
<span class="header-section-number">8.3.2</span> Modèle binomial négatif</h3>
<p>Dans le cas où une variable de comptage est marquée par une sur ou sous-dispersion, la distribution de Poisson n’est pas en mesure de capturer efficacement sa variance. Pour contourner ce problème, il est possible d’utiliser la distribution binomiale négative plutôt que la distribution de Poisson (ou quasi-Poisson). Cette distribution peut être décrite comme une généralisation de la distribution de Poisson&nbsp;: elle inclut un second paramètre <span class="math inline">\(\theta\)</span> contrôlant la dispersion. L’intérêt premier de ce changement de distribution est que l’interprétation des paramètres est la même pour les deux modèles, tout en contrôlant directement l’effet d’une potentielle sur ou sous-dispersion.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-nbdentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.23: Carte d’identité du modèle binomial négatif</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable de comptage</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Négative binomiale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim NB(\mu,\theta)\)</span> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) =log(x)\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">log</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span> et <span class="math inline">\(\theta\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Absence d’excès de zéros, respect du lien variance-moyenne</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08321" class="level4" data-number="8.3.2.1"><h4 data-number="8.3.2.1" class="anchored" data-anchor-id="sec-08321">
<span class="header-section-number">8.3.2.1</span> Conditions d’application</h4>
<p>Les conditions d’application d’un modèle binomial négatif sont presque les mêmes que celles d’un modèle de Poisson. La seule différence est que la condition d’absence de sur ou sous-dispersion est remplacée par une condition de respect du lien espérance-variance. En effet, dans un modèle binomial négatif, le paramètre de dispersion <span class="math inline">\(\theta\)</span> est combiné avec <span class="math inline">\(\mu\)</span> (l’espérance) pour exprimer la dispersion de la distribution. Dans le <em>package</em> <code>mgcv</code> que nous utilisons dans l’exemple, le lien entre <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\theta\)</span> et la variance est le suivant&nbsp;:</p>
<p><span id="eq-glm17"><span class="math display">\[
variance = \mu + \mu^{\frac{2}{\theta}}
\tag{8.20}\]</span></span></p>
<p>Il s’agit donc d’un <strong>modèle hétéroscédastique</strong> : sa variance n’est pas fixe, mais varie en fonction de sa propre espérance. Si celle-ci augmente, la variance augmente (comme pour un modèle de Poisson), et l’intensité de cette augmentation est contrôlée par le paramètre <span class="math inline">\(\theta\)</span>. Si cette condition n’est pas respectée, l’analyse des résidus simulés révélera un problème de dispersion.</p>
</section><section id="sec-08322" class="level4" data-number="8.3.2.2"><h4 data-number="8.3.2.2" class="anchored" data-anchor-id="sec-08322">
<span class="header-section-number">8.3.2.2</span> Exemple appliqué dans R</h4>
<p>Dans l’exemple précédent avec le modèle de Poisson, nous avons observé une certaine sur-dispersion que nous avons contournée en utilisant un modèle de quasi-Poisson. Dans l’article original, les auteurs ont opté pour un modèle binomial négatif, ce que nous reproduisons ici. Les variables utilisées sont les mêmes que pour le modèle de Poisson. Nous utilisons le <em>package</em> <code>mgcv</code> et sa fonction <code>gam</code> pour ajuster le modèle.</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Nous avons vu précédemment que nos variables indépendantes ne sont pas marquées par une multicolinéarité forte. Il n’est pas nécessaire de recalculer les valeurs de VIF puisque nous utilisons les mêmes données. La première étape du diagnostic est donc de calculer les distances de Cook.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co"># Chargement des données</span></span>
<span><span class="va">data_accidents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/accident_pietons.csv"</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span><span class="co"># Ajustement d'une première version du modèle</span></span>
<span><span class="va">modelnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span> </span>
<span>                 <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span></span>
<span>                <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span></span>
<span>                <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/negbin.html">nb</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data_accidents</span><span class="op">)</span></span>
<span><span class="co"># Calcul et affichage des distances de Cook</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modelnb</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistnb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistnb-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.31: Distances de Cook pour le modèle binomial négatif</figcaption></figure>
</div>
</div>
</div>
<p>Nous observons, dans la <a href="#fig-cookdistnb">figure&nbsp;<span>8.31</span></a>, que quatre observations se distinguent très nettement des autres.</p>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cas_etrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_accidents</span>, <span class="va">cooksd</span> <span class="op">&gt;</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etrange</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Nbr_acci Feux_auto Feux_piet Pass_piet Terreplein Apaisement EmpTotBuffer
1        19         1         1         1          1          0     7208.538
5        12         1         0         1          0          0     8585.350
26        7         0         0         1          0          0     1342.625
34        6         0         0         1          0          0    12516.410
   Densite_pop  Entropie DensiteInter Long_arterePS Artere NB_voies5 log_acci
1     5980.923 0.8073926     42.41597       6955.00      1         1 2.995732
5     8655.430 0.7607852     89.11495       6412.27      0         0 2.564949
26    2751.012 0.0000000     73.35344       2849.66      0         0 2.079442
34    8950.942 0.4300549     74.91879       8443.01      1         0 1.945910
   catego_acci catego_acci2 Arret VAG sum_app LogEmploi AccOrdinal    PopHa
1            1            1     0   1       4  8.883021          2 5.980923
5            1            1     0   1       4  9.057813          2 8.655430
26           1            1     1   1       3  7.202382          2 2.751012
34           1            1     1   0       3  9.434796          2 8.950942</code></pre>
</div>
</div>
<p>Il s’agit à nouveau de quatre observations avec un grand nombre d’accidents. Nous décidons de les retirer du jeu de données pour ne pas fausser les résultats concernant l’ensemble des autres intersections. Dans une analyse plus détaillée, il serait judicieux de chercher à comprendre pourquoi ces quatre observations sont particulièrement accidentogènes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_accidents</span>, <span class="va">cooksd</span> <span class="op">&lt;</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="co"># Ajustement d'une première version du modèle</span></span>
<span><span class="va">modelnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span> </span>
<span>                 <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span></span>
<span>                <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span></span>
<span>                <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/negbin.html">nb</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span>
<span><span class="co"># Calcul et affichage des distances de Cook</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modelnb</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistnb2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistnb2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.32: Distances de Cook pour le modèle binomial négatif (après avoir retiré quatre observations fortement influentes</figcaption></figure>
</div>
</div>
</div>
<p>Après avoir retiré ces quatre observations, les distances de Cook ne révèlent plus d’observations fortement influentes dans le modèle (<a href="#fig-cookdistnb2">figure&nbsp;<span>8.32</span></a>). La prochaine étape du diagnostic est donc d’analyser les résidus simulés.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction de la valeur de theta</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">modelnb</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">getTheta</span><span class="op">(</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="co"># Extraction des valeurs prédites par le modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelnb</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Calcul des simulations</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, mu <span class="op">=</span> <span class="va">mu</span>, size <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calcul des résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">mus</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Affichage du diagnostic</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diagresnb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-diagresnb-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.33: Diagnostic général des résidus simulés pour le modèle binomial négatif</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-diagresnb">figure&nbsp;<span>8.33</span></a> présentant le diagnostic des résidus simulés, montre que ces derniers suivent bien une distribution uniforme et aucun problème de dispersion ni de valeurs aberrantes. La <a href="#fig-compnbdistr2">figure&nbsp;<span>8.34</span></a> permet de comparer la distribution originale de la variable <em>Y</em> et les simulations issues du modèle (intervalles de confiance représentés en bleu). Nous constatons que le modèle parvient bien à reproduire la distribution originale, et ce, même pour les valeurs les plus extrèmes de la distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des valeurs prédites par le modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelnb</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">modelnb</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">getTheta</span><span class="op">(</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, mu <span class="op">=</span> <span class="va">mu</span>, size <span class="op">=</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Préparation des données pour le graphique (valeurs réelles)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nb_accident"</span>,<span class="st">'frequence'</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">frequence</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">frequence</span><span class="op">)</span></span>
<span><span class="co"># Préparation des données pour le graphique (valeurs simulées)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">count_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsim</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="va">mat_sims</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">cnt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">cnt</span>, by.x <span class="op">=</span> <span class="st">"count"</span>, by.y <span class="op">=</span> <span class="st">"sim"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">df2</span><span class="op">$</span><span class="va">Freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>,<span class="fl">0</span>, <span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">count_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">count_sims</span><span class="op">)</span></span>
<span><span class="va">df_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  val <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span>,</span>
<span>  med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage du graphique</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nb_accident</span>, weight <span class="op">=</span> <span class="va">frequence</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.6</span>, data <span class="op">=</span> <span class="va">counts</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">df_sims</span>, color <span class="op">=</span> <span class="st">"blue"</span>, width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, y <span class="op">=</span> <span class="va">med</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1.3</span>, data <span class="op">=</span> <span class="va">df_sims</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">7</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"nombre d'accidents"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"nombre d'occurrences"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-compnbdistr2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-compnbdistr2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.34: Comparaison de la distribution originale et des simulations pour le modèle binomial négatif</figcaption></figure>
</div>
</div>
</div>
<p>À titre de comparaison, nous pouvons à nouveau réaliser le graphique permettant de visualiser si la variance attendue par le modèle est proche de celle effectivement observée dans les données. Nous avons constaté avec ce graphique, lorsque nous ajustions un modèle de Poisson, que la variance des données était trop grande comparativement à celle attendue par le modèle (<a href="#fig-surdisppoiss">figure&nbsp;<span>8.26</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelnb</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co"># Création d'un DataFrame pour contenir la prédiction et les vraies valeurs</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  mus <span class="op">=</span> <span class="va">mus</span>,</span>
<span>  reals <span class="op">=</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Calcul de l'intervalle de confiance à 95 % selon la distribution de Poisson</span></span>
<span><span class="co"># et stockage dans un second DataFrame</span></span>
<span><span class="va">seqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  mus <span class="op">=</span> <span class="va">seqa</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">qnbinom</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.025</span>, mu <span class="op">=</span> <span class="va">seqa</span>, size <span class="op">=</span> <span class="va">theta</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html">qnbinom</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, mu <span class="op">=</span> <span class="va">seqa</span>, size <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mus</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df1</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mus</span>, y <span class="op">=</span> <span class="va">reals</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"valeurs prédites"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"valeurs réelles"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-surdispnb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-surdispnb-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.35: Représentation de la sur-dispersion des données dans le modèle de Poisson</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons ainsi constater à la <a href="#fig-surdispnb">figure&nbsp;<span>8.35</span></a> que le modèle binomial négatif autorise une variance bien plus large que le modèle de Poisson et est ainsi mieux ajusté aux données.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<div class="cell">
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul des pseudo R2</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelnb</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelnull</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelnb</span><span class="op">)</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="va">modelnb</span><span class="op">$</span><span class="va">null.deviance</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modelnb</span><span class="op">$</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.458052

$`McFadden ajuste`
'log Lik.' 0.384353 (df=14)

$`Cox and Snell`
'log Lik.' 0.8304773 (df=14)

$Nagelkerke
'log Lik.' 0.8399731 (df=14)</code></pre>
</div>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelnb</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">-</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.825278</code></pre>
</div>
</div>
<p>Le modèle parvient à expliquer 45&nbsp;% de la déviance. Il obtient un R<sup>2</sup> ajusté de McFadden de 0,14 et un R<sup>2</sup> de Nagelkerke de 0,42. L’erreur moyenne quadratique de la prédiction est de 1,82, ce qui est identique au modèle de Poisson ajusté précédemment.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>Il est possible d’accéder à l’ensemble des coefficients du modèle via la fonction <code>summary</code>. À nouveau, les coefficients doivent être convertis avec la fonction exponentielle (du fait de la fonction de lien <em>log</em>) et interprétés comme des effets multiplicatifs. Le <a href="#tbl-coeffsnb">tableau&nbsp;<span>8.24</span></a> présente les coefficients estimés par le modèle. Les résultats sont très similaires à ceux du modèle de quasi-Poisson original. Nous notons cependant que la variable représentant la présence d’un feu pour piéton n’est plus significative au seuil de 0,05.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffsnb" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.24: Résultats du modèle binomial négatif</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 6%">
<col style="width: 23%">
<col style="width: 25%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">exp(Coeff.)</th>
<th style="text-align: right;">Val.p</th>
<th style="text-align: right;">IC 2,5 % exp(Coeff.)</th>
<th style="text-align: right;">IC 97,5 % exp(Coeff.)</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">-3,880</td>
<td style="text-align: right;">0,020</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">0,080</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Feux_auto</td>
<td style="text-align: right;">1,130</td>
<td style="text-align: right;">3,100</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">2,030</td>
<td style="text-align: right;">4,710</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Feux_piet</td>
<td style="text-align: right;">0,350</td>
<td style="text-align: right;">1,420</td>
<td style="text-align: right;">0,016</td>
<td style="text-align: right;">1,060</td>
<td style="text-align: right;">1,900</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pass_piet</td>
<td style="text-align: right;">0,220</td>
<td style="text-align: right;">1,240</td>
<td style="text-align: right;">0,300</td>
<td style="text-align: right;">0,830</td>
<td style="text-align: right;">1,880</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Terreplein</td>
<td style="text-align: right;">-0,340</td>
<td style="text-align: right;">0,710</td>
<td style="text-align: right;">0,155</td>
<td style="text-align: right;">0,440</td>
<td style="text-align: right;">1,140</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Apaisement</td>
<td style="text-align: right;">0,240</td>
<td style="text-align: right;">1,270</td>
<td style="text-align: right;">0,315</td>
<td style="text-align: right;">0,790</td>
<td style="text-align: right;">2,030</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">LogEmploi</td>
<td style="text-align: right;">0,230</td>
<td style="text-align: right;">1,260</td>
<td style="text-align: right;">0,025</td>
<td style="text-align: right;">1,030</td>
<td style="text-align: right;">1,550</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;">Densite_pop</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Entropie</td>
<td style="text-align: right;">-0,170</td>
<td style="text-align: right;">0,840</td>
<td style="text-align: right;">0,669</td>
<td style="text-align: right;">0,380</td>
<td style="text-align: right;">1,860</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">DensiteInter</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">0,925</td>
<td style="text-align: right;">0,990</td>
<td style="text-align: right;">1,010</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Long_arterePS</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">0,587</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Artere</td>
<td style="text-align: right;">0,110</td>
<td style="text-align: right;">1,110</td>
<td style="text-align: right;">0,497</td>
<td style="text-align: right;">0,820</td>
<td style="text-align: right;">1,510</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">NB_voies5</td>
<td style="text-align: right;">0,700</td>
<td style="text-align: right;">2,010</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,480</td>
<td style="text-align: right;">2,750</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="sec-0833" class="level3" data-number="8.3.3"><h3 data-number="8.3.3" class="anchored" data-anchor-id="sec-0833">
<span class="header-section-number">8.3.3</span> Modèle de Poisson avec excès fixe de zéros</h3>
<p>Dans le cas où la variable <em>Y</em> comprendrait significativement plus de zéros que ce que suppose une distribution de Poisson, il est possible d’utiliser la distribution de Poisson avec excès de zéros. Pour rappel, cette distribution ajoute un paramètre <em>p</em> contrôlant pour la proportion de zéros dans la distribution. Du point de vue conceptuel, cela revient à formuler l’hypothèse suivante&nbsp;: dans les données que nous avons observées, deux processus distincts sont à l’œuvre. Le premier est issu d’une distribution de Poisson et l’autre produit des zéros qui s’ajoutent aux données. Les zéros produits par la distribution de Poisson sont appelés les <strong>vrais zéros</strong>, alors que ceux produits par le second phénomène sont appelés les <strong>faux zéros</strong>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-poisszidentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.25: Carte d’identité du modèle de Poisson avec excès fixe de zéros</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable de comptage</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Poisson avec excès de zéros</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim ZIP(\mu,\theta)\)</span> <span class="math inline">\(g(\lambda) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) =log(x)\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">log</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\lambda\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span> et <em>p</em>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Absence de sur-dispersion</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Dans cette formulation, <em>p</em> est fixé. Nous n’avons donc aucune information sur ce qui produit les zéros supplémentaires, mais seulement leur proportion totale dans le jeu de données.</p>
<section id="sec-08331" class="level4" data-number="8.3.3.1"><h4 data-number="8.3.3.1" class="anchored" data-anchor-id="sec-08331">
<span class="header-section-number">8.3.3.1</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres est identique à celle d’un modèle de Poisson. Le paramètre <em>p</em> représente la proportion de faux zéros dans la variable <em>Y</em> une fois que les variables indépendantes sont contrôlées.</p>
</section><section id="sec-08332" class="level4" data-number="8.3.3.2"><h4 data-number="8.3.3.2" class="anchored" data-anchor-id="sec-08332">
<span class="header-section-number">8.3.3.2</span> Exemple appliqué dans R</h4>
<p>La variable de comptage des accidents des piétons que nous avons utilisée dans les deux exemples précédents semble être une bonne candidate pour une distribution de Poisson avec excès de zéros. En effet, nous avons pu constater une sur-dispersion dans le modèle de Poisson original, ainsi qu’un nombre important d’intersections sans accident. Tentons donc d’améliorer notre modèle en ajustant un excès fixe de zéros. Nous utilisons la fonction <code>gamlss</code> du <em>package</em> <code>gamlss</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.gamlss.com/">gamlss</a></span><span class="op">)</span></span>
<span><span class="va">modelzi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss/man/gamlss.html">gamlss</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span></span>
<span>                    <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span> <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> </span>
<span>                    <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span> <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>                  sigma.formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/ZIP.html">ZIP</a></span><span class="op">(</span>mu.link <span class="op">=</span> <span class="st">"log"</span>, sigma.link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_accidents</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAMLSS-RS iteration 1: Global Deviance = 1516.53 
GAMLSS-RS iteration 2: Global Deviance = 1514.656 
GAMLSS-RS iteration 3: Global Deviance = 1514.52 
GAMLSS-RS iteration 4: Global Deviance = 1514.508 
GAMLSS-RS iteration 5: Global Deviance = 1514.506 
GAMLSS-RS iteration 6: Global Deviance = 1514.506 </code></pre>
</div>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelnull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Nbr_acci</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_accidents</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Constante pour p</span></span>
<span><span class="va">coeff_p</span> <span class="op">&lt;-</span> <span class="va">modelzi</span><span class="op">$</span><span class="va">sigma.coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Coefficient pour p ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">coeff_p</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coefficient pour p = -1.4376</code></pre>
</div>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul de la déviance expliquée</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelzi</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelnull</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08267513</code></pre>
</div>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul de la probabilité de base p d'être un faux 0</span></span>
<span><span class="co"># en appliquant l'inverse de la fonction logistique</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">coeff_p</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">coeff_p</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
    0.80809 </code></pre>
</div>
</div>
<p>Nous constatons immédiatement que le modèle avec excès fixe de zéros est peu ajusté aux données. Cette version du modèle ne parvient à capter que 8&nbsp;% de la déviance, ce qui s’explique facilement, car nous n’avons donné aucune variable au modèle pour distinguer les vrais et les faux zéros. Pour cela, nous devons passer au prochain modèle&nbsp;: Poisson avec excès ajusté de zéros. Notons tout de même que d’après ce modèle, 81&nbsp;% des observations seraient des faux zéros.</p>
</section></section><section id="sec-0834" class="level3" data-number="8.3.4"><h3 data-number="8.3.4" class="anchored" data-anchor-id="sec-0834">
<span class="header-section-number">8.3.4</span> Modèle de Poisson avec excès ajusté de zéros</h3>
<p>Nous avons vu dans le modèle précédent que l’excès de zéro était conceptualisé comme la combinaison de deux phénomènes, l’un issu d’une distribution de Poisson que nous souhaitons modéliser, et l’autre générant des zéros supplémentaires. Il est possible d’aller plus loin que de simplement contrôler la proportion de zéros supplémentaires en modélisant explicitement ce second processus en ajoutant une deuxième équation au modèle. Cette deuxième équation a pour enjeu de modéliser <em>p</em> (la proportion de 0) à l’aide de variables indépendantes, ces dernières pouvant se retrouver dans les deux parties du modèle. L’idée étant que, pour chaque observation, le modèle évalue sa probabilité d’être un faux zéro (partie binomiale), et le nombre attendu d’accidents.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-poisszadentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.26: Carte d’identité du modèle de Poisson avec excès ajusté de zéros</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable de comptage</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Poisson avec excès de zéros</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim ZIP(\mu,\theta)\)</span> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <span class="math inline">\(s(p) = \alpha_0 + \alpha_X\)</span> <span class="math inline">\(g(x) =log(x)\)</span> <span class="math inline">\(s(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">log et logistique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;">
<span class="math inline">\(\mu\)</span> et <em>p</em>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\alpha_0\)</span> et <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Absence de sur-dispersion</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08341" class="level4" data-number="8.3.4.1"><h4 data-number="8.3.4.1" class="anchored" data-anchor-id="sec-08341">
<span class="header-section-number">8.3.4.1</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres <span class="math inline">\(\beta_0\)</span> et <span class="math inline">\(\beta\)</span> est identique à celle d’un modèle de Poisson. Les paramètres <span class="math inline">\(\alpha_0\)</span> et <span class="math inline">\(\alpha\)</span> sont identiques à ceux d’un modèle binomial. Plus spécifiquement, ces derniers paramètres modélisent la probabilité d’observer des valeurs supérieures à zéro.</p>
</section><section id="sec-08342" class="level4" data-number="8.3.4.2"><h4 data-number="8.3.4.2" class="anchored" data-anchor-id="sec-08342">
<span class="header-section-number">8.3.4.2</span> Exemple appliqué</h4>
<p>Nous avons vu, dans l’exemple précédent, que l’utilisation du modèle avec excès fixe de zéros pour les données d’accident des piétons aux intersections ne donnait pas de résultats satisfaisants. Nous tentons ici d’améliorer le modèle en ajoutant les variables indépendantes significatives du modèle Poisson dans la seconde équation de régression destinée à détecter les faux zéros.</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Pour un modèle de Poisson avec excès de zéros, il n’est pas possible de calculer les distances de Cook. Nous devons donc directement passer à l’analyse des résidus simulés.</p>
<div class="cell">
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajuster une première version du modèle</span></span>
<span><span class="va">modelza</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss/man/gamlss.html">gamlss</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span></span>
<span>                    <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span> <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> </span>
<span>                    <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span> <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>                  sigma.formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/ZIP.html">ZIP</a></span><span class="op">(</span>mu.link <span class="op">=</span> <span class="st">"log"</span>, sigma.link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data_accidents</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAMLSS-RS iteration 1: Global Deviance = 1505.155 
GAMLSS-RS iteration 2: Global Deviance = 1488.658 
GAMLSS-RS iteration 3: Global Deviance = 1483.304 
GAMLSS-RS iteration 4: Global Deviance = 1482.085 
GAMLSS-RS iteration 5: Global Deviance = 1481.868 
GAMLSS-RS iteration 6: Global Deviance = 1481.832 
GAMLSS-RS iteration 7: Global Deviance = 1481.827 
GAMLSS-RS iteration 8: Global Deviance = 1481.825 
GAMLSS-RS iteration 9: Global Deviance = 1481.825 </code></pre>
</div>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraire la prédiction des valeurs lambda</span></span>
<span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelza</span>, type <span class="op">=</span> <span class="st">"response"</span>, what <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></span>
<span><span class="co"># Extraire la prédiction des valeurs p</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelza</span>, type <span class="op">=</span> <span class="st">"response"</span>, what <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span></span>
<span><span class="co"># Calculer la combinaison de ces deux éléments</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">lambdas</span> <span class="op">*</span> <span class="va">ps</span></span>
<span><span class="co"># Effectuer les 1000 simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">lambdas</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/ZIP.html">rZIP</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, mu <span class="op">=</span> <span class="va">lambda</span>, sigma <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">data_accidents</span><span class="op">$</span><span class="va">Nbr_acci</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">preds</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-diagzip" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/diagzip.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.36: Diagnostic général des résidus simulés du modèle de Poisson avec excès de zéros ajusté”,</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-diagzip">figure&nbsp;<span>8.36</span></a> indique deux problèmes importants dans le modèle&nbsp;: la présence de valeurs aberrantes ainsi qu’un potentiel problème de dispersion. Nous commençons donc par identifier ces valeurs aberrantes.</p>
<div class="cell">
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Identification des outliers</span></span>
<span><span class="va">isOutlier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/outliers.html">outliers</a></span><span class="op">(</span><span class="va">sim_res</span>, return <span class="op">=</span> <span class="st">"logical"</span>, lowerQuantile <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                      upperQuantile <span class="op">=</span> <span class="fl">0.999</span><span class="op">)</span></span>
<span><span class="va">cas_etrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_accidents</span>, <span class="va">isOutlier</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etrange</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Nbr_acci Feux_auto Feux_piet Pass_piet Terreplein Apaisement EmpTotBuffer
1         19         1         1         1          1          0     7208.538
5         12         1         0         1          0          0     8585.350
26         7         0         0         1          0          0     1342.625
44         5         0         0         0          0          0     4998.519
74         3         0         0         0          0          0     1103.884
481        0         0         0         0          0          0     4072.706
    Densite_pop  Entropie DensiteInter Long_arterePS Artere NB_voies5 log_acci
1      5980.923 0.8073926     42.41597       6955.00      1         1 2.995732
5      8655.430 0.7607852     89.11495       6412.27      0         0 2.564949
26     2751.012 0.0000000     73.35344       2849.66      0         0 2.079442
44     8090.478 0.7879618     66.86856       4517.65      0         0 1.791759
74     4191.428 0.5486432     56.52712       3691.33      0         0 1.386294
481    9014.759 0.7510579     50.32579       3947.19      0         0 0.000000
    catego_acci catego_acci2 Arret VAG sum_app LogEmploi AccOrdinal    PopHa
1             1            1     0   1       4  8.883021          2 5.980923
5             1            1     0   1       4  9.057813          2 8.655430
26            1            1     1   1       3  7.202382          2 2.751012
44            1            1     1   1       4  8.516897          2 8.090478
74            1            0     1   1       4  7.006590          2 4.191428
481           0            0     1   1       4  8.312063          0 9.014759</code></pre>
</div>
</div>
<p>Nous retirons des données les quelques observations pouvant avoir une trop forte influence sur le modèle. Après réajustement, la <a href="#fig-diagzip2">figure&nbsp;<span>8.37</span></a> nous informe que nous n’avons plus de valeurs aberrantes restantes ni de fort problème de dispersion. En revanche, le premier quantile des résidus tant à être plus faible que ce que nous aurions pu nous attendre d’une distribution uniforme. Ce constat laisse penser que le modèle a du mal à bien identifier les faux zéros. Ce résultat n’est pas étonnant, car aucune variable n’avait été identifiée à cette fin dans l’article original <span class="citation" data-cites="cloutier2014carrefours">(<a href="references.html#ref-cloutier2014carrefours" role="doc-biblioref">Cloutier et al. 2014</a>)</span> qui utilisait un modèle binomial négatif.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_accidents</span>, <span class="va">isOutlier</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Ajuster une première version du modèle</span></span>
<span><span class="va">modelza</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss/man/gamlss.html">gamlss</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Nbr_acci</span> <span class="op">~</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Pass_piet</span> <span class="op">+</span></span>
<span>                    <span class="va">Terreplein</span> <span class="op">+</span> <span class="va">Apaisement</span> <span class="op">+</span> <span class="va">LogEmploi</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> </span>
<span>                    <span class="va">Entropie</span> <span class="op">+</span> <span class="va">DensiteInter</span> <span class="op">+</span> <span class="va">Long_arterePS</span> <span class="op">+</span> <span class="va">Artere</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>                  sigma.formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Feux_auto</span> <span class="op">+</span> <span class="va">Feux_piet</span> <span class="op">+</span> <span class="va">Densite_pop</span> <span class="op">+</span> <span class="va">NB_voies5</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/ZIP.html">ZIP</a></span><span class="op">(</span>mu.link <span class="op">=</span> <span class="st">"log"</span>, sigma.link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAMLSS-RS iteration 1: Global Deviance = 1377.478 
GAMLSS-RS iteration 2: Global Deviance = 1368.424 
GAMLSS-RS iteration 3: Global Deviance = 1365.835 
GAMLSS-RS iteration 4: Global Deviance = 1365.067 
GAMLSS-RS iteration 5: Global Deviance = 1364.803 
GAMLSS-RS iteration 6: Global Deviance = 1364.713 
GAMLSS-RS iteration 7: Global Deviance = 1364.681 
GAMLSS-RS iteration 8: Global Deviance = 1364.67 
GAMLSS-RS iteration 9: Global Deviance = 1364.666 
GAMLSS-RS iteration 10: Global Deviance = 1364.664 
GAMLSS-RS iteration 11: Global Deviance = 1364.663 </code></pre>
</div>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraire la prédiction des valeurs lambda</span></span>
<span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelza</span>, type <span class="op">=</span> <span class="st">"response"</span>, what <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></span>
<span><span class="co"># Extraire la prédiction des valeurs p</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelza</span>, type <span class="op">=</span> <span class="st">"response"</span>, what <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span></span>
<span><span class="co"># Calculer la combinaison de ces deux éléments</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">lambdas</span> <span class="op">*</span> <span class="va">ps</span></span>
<span><span class="co"># Effectuer les 1000 simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">lambdas</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/ZIP.html">rZIP</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, mu <span class="op">=</span> <span class="va">lambda</span>, sigma <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">preds</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diagzip2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-diagzip2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.37: Diagnostic général des résidus simulés du modèle de Poisson avec excès de zéros ajusté (sans valeurs aberrantes)</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons une fois encore comparer des simulations issues du modèle et de la distribution originale de la variable <em>Y</em>. La <a href="#fig-compzipdistr">figure&nbsp;<span>8.38</span></a> montre clairement que les simulations du modèle (en bleu) sont très éloignées dans la distribution originale (en gris), ce qui remet directement en question la pertinence de ce modèle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#| # Extraire la prédiction des valeurs lambda</span></span>
<span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelza</span>, type <span class="op">=</span> <span class="st">"response"</span>, what <span class="op">=</span> <span class="st">"mu"</span><span class="op">)</span></span>
<span><span class="co"># Extraire la prédiction des valeurs p</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modelza</span>, type <span class="op">=</span> <span class="st">"response"</span>, what <span class="op">=</span> <span class="st">"sigma"</span><span class="op">)</span></span>
<span><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">lambdas</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/ZIP.html">rZIP</a></span><span class="op">(</span><span class="va">nsim</span>, mu<span class="op">=</span><span class="va">lambda</span>, sigma <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Préparation des données pour le graphique (valeurs réelles)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nb_accident"</span>,<span class="st">'frequence'</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">nb_accident</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">counts</span><span class="op">$</span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">counts</span><span class="op">$</span><span class="va">frequence</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">frequence</span><span class="op">)</span></span>
<span><span class="co"># Préparation des données pour le graphique (valeurs simulées)</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">count_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsim</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sim</span> <span class="op">&lt;-</span> <span class="va">mat_sims</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">cnt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">cnt</span>, by.x <span class="op">=</span> <span class="st">"count"</span>, by.y <span class="op">=</span> <span class="st">"sim"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, all.y <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">df2</span><span class="op">$</span><span class="va">Freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>,<span class="fl">0</span>, <span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">count_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">count_sims</span><span class="op">)</span></span>
<span><span class="va">df_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  val <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span>,</span>
<span>  med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">count_sims</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage du graphique</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nb_accident</span>, weight <span class="op">=</span> <span class="va">frequence</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.6</span>, data <span class="op">=</span> <span class="va">counts</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">df_sims</span>, color <span class="op">=</span> <span class="st">"blue"</span>, width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, y <span class="op">=</span> <span class="va">med</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1.3</span>, data <span class="op">=</span> <span class="va">df_sims</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">7</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">12</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"nombre d'accidents"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"nombre d'occurrences"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-compzipdistr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-compzipdistr-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.38: Comparaison de la distribution originale et des simulations pour le modèle de Poisson avec excès de zéros ajusté</figcaption></figure>
</div>
</div>
</div>
<p><strong>Vérification la qualité d’ajustement</strong></p>
<div class="cell">
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelenull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Nbr_acci</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span>,</span>
<span>               data <span class="op">=</span> <span class="va">data2</span><span class="op">)</span></span>
<span><span class="co"># Calcul des R2</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelza</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelza</span><span class="op">)</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modelza</span><span class="op">$</span><span class="va">sigma.df</span> <span class="op">+</span> <span class="va">modelza</span><span class="op">$</span><span class="va">mu.df</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.1146181

$`McFadden ajuste`
'log Lik.' 0.3632167 (df=18)

$`Cox and Snell`
'log Lik.' 0.812355 (df=18)

$Nagelkerke
'log Lik.' 0.8223711 (df=18)</code></pre>
</div>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">preds</span> <span class="op">-</span> <span class="va">data2</span><span class="op">$</span><span class="va">Nbr_acci</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.641866</code></pre>
</div>
</div>
<p>Le modèle avec excès de zéro ajusté ne parvient à expliquer que 11&nbsp;% de la déviance totale. Il obtient toutefois des valeurs de R<sup>2</sup> assez hautes (McFadden ajusté&nbsp;: 0,36, Nagerlkerke&nbsp;: 0,82). Son RMSE est très élevé (2,6), comparativement à celui que nous avons obtenu avec le modèle binomial négatif (1,9). Considérant ces éléments, ce modèle est nettement moins informatif que le modèle binomial négatif et ne devrait pas être retenu. Nous montrons tout de même ici comment interpréter ces résultats.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles avec la fonction <code>summary</code>. Les coefficients dédiés à la partie Poisson (appelée <strong>Mu</strong> dans le résumé) doivent être analysés et interprétés de la même manière que s’ils provenaient d’un modèle de Poisson. Les coefficients appartenant à la partie logistique (appelé <strong>Sigma</strong> dans le résumé) doivent être analysés et interprétés de la même manière que s’ils provenaient d’un modèle logistique.</p>
<div class="cell">
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des résultats</span></span>
<span><span class="va">base_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modelza</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>******************************************************************
Family:  c("ZIP", "Poisson Zero Inflated") 

Call:  gamlss(formula = Nbr_acci ~ Feux_auto + Feux_piet +  
    Pass_piet + Terreplein + Apaisement + LogEmploi +  
    Densite_pop + Entropie + DensiteInter + Long_arterePS +  
    Artere + NB_voies5, sigma.formula = ~1 + Feux_auto +  
    Feux_piet + Densite_pop + NB_voies5, family = ZIP(mu.link = "log",  
    sigma.link = "logit"), data = data2) 

Fitting method: RS() 

------------------------------------------------------------------
Mu link function:  log
Mu Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -2.792e+00  5.432e-01  -5.139 4.02e-07 ***
Feux_auto      5.850e-01  1.912e-01   3.060  0.00233 ** 
Feux_piet      4.206e-01  1.045e-01   4.026 6.59e-05 ***
Pass_piet      4.337e-01  1.950e-01   2.224  0.02659 *  
Terreplein    -3.305e-01  1.666e-01  -1.984  0.04784 *  
Apaisement     2.323e-01  1.534e-01   1.514  0.13056    
LogEmploi      1.815e-01  7.472e-02   2.429  0.01552 *  
Densite_pop    8.854e-05  1.502e-05   5.895 7.07e-09 ***
Entropie      -2.994e-01  2.933e-01  -1.021  0.30784    
DensiteInter   3.917e-03  2.046e-03   1.915  0.05612 .  
Long_arterePS  8.740e-06  1.992e-05   0.439  0.66097    
Artere         9.867e-02  1.108e-01   0.891  0.37360    
NB_voies5      4.298e-01  1.014e-01   4.237 2.71e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

------------------------------------------------------------------
Sigma link function:  logit
Sigma Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  9.948e-01  5.717e-01   1.740  0.08246 . 
Feux_auto   -1.737e+00  6.225e-01  -2.789  0.00549 **
Feux_piet    3.407e-01  7.496e-01   0.455  0.64965   
Densite_pop -1.202e-04  5.605e-05  -2.146  0.03241 * 
NB_voies5   -2.033e+00  1.511e+00  -1.345  0.17912   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

------------------------------------------------------------------
No. of observations in the fit:  499 
Degrees of Freedom for the fit:  18
      Residual Deg. of Freedom:  481 
                      at cycle:  11 
 
Global Deviance:     1364.663 
            AIC:     1400.663 
            SBC:     1476.49 
******************************************************************</code></pre>
</div>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Multiplication par 1000 des coefficients de population</span></span>
<span><span class="co"># (effet pour 1000 habitants)</span></span>
<span><span class="va">base_table</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">base_table</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">8</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">base_table</span><span class="op">[</span><span class="fl">17</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">17</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">base_table</span><span class="op">[</span><span class="fl">17</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">17</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Multiplication par 1000 des coefficients de longueur artère</span></span>
<span><span class="co"># (effet pour 1 km)</span></span>
<span><span class="va">base_table</span><span class="op">[</span><span class="fl">11</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">11</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">base_table</span><span class="op">[</span><span class="fl">11</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">11</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Calcul des exponentiels des variables indépendantes</span></span>
<span><span class="co"># et des intervalles de confiance</span></span>
<span><span class="va">expcoeff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">base_table</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">expcoeff2.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">base_table</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">expcoeff97.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">base_table</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">base_table</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">base_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">base_table</span>, <span class="va">expcoeff</span>, <span class="va">expcoeff2.5</span>, <span class="va">expcoeff97.5</span><span class="op">)</span></span>
<span><span class="co"># Calculer une colonne indiquant le niveau de significativité</span></span>
<span><span class="va">sign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0.001</span> <span class="op">~</span> <span class="st">"***"</span>,</span>
<span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>  <span class="op">&gt;=</span> <span class="fl">0.001</span> <span class="op">&amp;</span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.01</span> <span class="op">~</span> <span class="st">"**"</span>,</span>
<span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>  <span class="op">&gt;=</span> <span class="fl">0.01</span> <span class="op">&amp;</span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.05</span> <span class="op">~</span> <span class="st">"*"</span>,</span>
<span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>  <span class="op">&gt;=</span> <span class="fl">0.05</span> <span class="op">&amp;</span>  <span class="va">base_table</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.1</span> <span class="op">~</span> <span class="st">"."</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Arrondir à trois décimales</span></span>
<span><span class="va">base_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">base_table</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># Enlever les colonnes de valeurs de t et d'erreur standard</span></span>
<span><span class="va">base_table</span> <span class="op">&lt;-</span> <span class="va">base_table</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">base_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">base_table</span>, <span class="va">sign</span><span class="op">)</span></span>
<span><span class="co"># Remplacer les 0 dans la colonne pval</span></span>
<span><span class="va">base_table</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">base_table</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="st">"0"</span> , <span class="st">"&lt;0.001"</span>,<span class="va">base_table</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Séparer le tout en deux tableaux</span></span>
<span><span class="va">part_poiss</span> <span class="op">&lt;-</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,<span class="op">]</span></span>
<span><span class="va">part_logit</span> <span class="op">&lt;-</span> <span class="va">base_table</span><span class="op">[</span><span class="fl">14</span><span class="op">:</span><span class="fl">18</span>,<span class="op">]</span></span>
<span><span class="co"># Mettre les bons noms de colonnes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">part_poiss</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Coeff."</span> , <span class="st">"Val.p"</span> , <span class="st">"Exp(Coeff.)"</span>,</span>
<span>                          <span class="st">"IC 2,5 % exp(Coeff.)"</span> , <span class="st">"IC 97,5 % exp(Coeff.)"</span>, <span class="st">"Sign."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">part_logit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Coeff."</span> , <span class="st">"Val.p"</span> , <span class="st">"RC"</span> , <span class="st">"IC 2,5 % RC"</span> , <span class="st">"IC 97,5 % RC"</span>, <span class="st">"Sign."</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous rapportons les résultats de ce modèle de Poisson avec excès de zéro ajusté dans les tableaux <a href="#tbl-zapoisstab1"><span>8.27</span></a> et <a href="#tbl-zapoisstab2"><span>8.28</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-zapoisstab1" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.27: Résultats de la partie Poisson du modèle de Poisson avec excès de zéros ajusté</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 23%">
<col style="width: 24%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">Val.p</th>
<th style="text-align: right;">Exp(Coeff.)</th>
<th style="text-align: right;">IC 2,5 % exp(Coeff.)</th>
<th style="text-align: right;">IC 97,5 % exp(Coeff.)</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-2.792</td>
<td style="text-align: right;">&lt;0.001</td>
<td style="text-align: right;">0.061</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">0.178</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Feux_auto</td>
<td style="text-align: right;">0.585</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">1.795</td>
<td style="text-align: right;">1.234</td>
<td style="text-align: right;">2.611</td>
<td style="text-align: right;">**</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Feux_piet</td>
<td style="text-align: right;">0.421</td>
<td style="text-align: right;">&lt;0.001</td>
<td style="text-align: right;">1.523</td>
<td style="text-align: right;">1.241</td>
<td style="text-align: right;">1.869</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pass_piet</td>
<td style="text-align: right;">0.434</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">1.543</td>
<td style="text-align: right;">1.053</td>
<td style="text-align: right;">2.261</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Terreplein</td>
<td style="text-align: right;">-0.33</td>
<td style="text-align: right;">0.048</td>
<td style="text-align: right;">0.719</td>
<td style="text-align: right;">0.518</td>
<td style="text-align: right;">0.996</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;">Apaisement</td>
<td style="text-align: right;">0.232</td>
<td style="text-align: right;">0.131</td>
<td style="text-align: right;">1.261</td>
<td style="text-align: right;">0.934</td>
<td style="text-align: right;">1.704</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">LogEmploi</td>
<td style="text-align: right;">0.181</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">1.199</td>
<td style="text-align: right;">1.036</td>
<td style="text-align: right;">1.388</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;">Densite_pop</td>
<td style="text-align: right;">0.089</td>
<td style="text-align: right;">&lt;0.001</td>
<td style="text-align: right;">1.093</td>
<td style="text-align: right;">1.061</td>
<td style="text-align: right;">1.125</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Entropie</td>
<td style="text-align: right;">-0.299</td>
<td style="text-align: right;">0.308</td>
<td style="text-align: right;">0.741</td>
<td style="text-align: right;">0.417</td>
<td style="text-align: right;">1.317</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">DensiteInter</td>
<td style="text-align: right;">0.004</td>
<td style="text-align: right;">0.056</td>
<td style="text-align: right;">1.004</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.008</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Long_arterePS</td>
<td style="text-align: right;">0.009</td>
<td style="text-align: right;">0.661</td>
<td style="text-align: right;">1.009</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">1.049</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Artere</td>
<td style="text-align: right;">0.099</td>
<td style="text-align: right;">0.374</td>
<td style="text-align: right;">1.104</td>
<td style="text-align: right;">0.888</td>
<td style="text-align: right;">1.371</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">NB_voies5</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">&lt;0.001</td>
<td style="text-align: right;">1.537</td>
<td style="text-align: right;">1.26</td>
<td style="text-align: right;">1.875</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-zapoisstab2" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.28: Résultats de la partie logistique du modèle de Poisson avec excès de zéros ajusté</caption>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">Val.p</th>
<th style="text-align: right;">RC</th>
<th style="text-align: right;">IC 2,5 % RC</th>
<th style="text-align: right;">IC 97,5 % RC</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.995</td>
<td style="text-align: right;">0.082</td>
<td style="text-align: right;">2.704</td>
<td style="text-align: right;">0.882</td>
<td style="text-align: right;">8.292</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Feux_auto</td>
<td style="text-align: right;">-1.737</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.176</td>
<td style="text-align: right;">0.052</td>
<td style="text-align: right;">0.597</td>
<td style="text-align: right;">**</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Feux_piet</td>
<td style="text-align: right;">0.341</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">1.406</td>
<td style="text-align: right;">0.324</td>
<td style="text-align: right;">6.111</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Densite_pop</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">0.032</td>
<td style="text-align: right;">0.887</td>
<td style="text-align: right;">0.794</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NB_voies5</td>
<td style="text-align: right;">-2.033</td>
<td style="text-align: right;">0.179</td>
<td style="text-align: right;">0.131</td>
<td style="text-align: right;">0.007</td>
<td style="text-align: right;">2.532</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Nous observons ainsi que la présence d’un feu de circulation divise par 5 les chances de rentrer dans la catégorie d’intersection où des accidents peuvent se produire. De même, la densité de population réduit les chances de passer dans cette catégorie de 11&nbsp;%.</p>
<p>Concernant les coefficients pour la partie Poisson du modèle, nous observons que les présences d’un feu de circulation et d’un feu pour piéton contribuent à multiplier respectivement par 2 et 1,5 le nombre attendu d’accidents à une intersection. De même, la présence d’un axe de circulation à cinq voies augmente de 57&nbsp;% le nombre d’accidents. Enfin, la densité de population est aussi associée à une augmentation du nombre d’accidents&nbsp;: pour 1&nbsp;000 habitants supplémentaires autour de l’intersection, nous augmentons le nombre d’accidents attendu de 9&nbsp;%.</p>
</section></section><section id="sec-0835" class="level3" data-number="8.3.5"><h3 data-number="8.3.5" class="anchored" data-anchor-id="sec-0835">
<span class="header-section-number">8.3.5</span> Conclusion sur les modèles destinés à des variables de comptage</h3>
<p>Dans cette section, nous avons vu que modéliser une variable de comptage ne doit pas toujours être réalisé avec une simple distribution de Poisson. Il est nécessaire de tenir compte de la sur ou sous-dispersion potentielle ainsi que de l’excès de zéros. Nous n’avons cependant pas couvert tous les cas. Il est en effet possible d’ajuster des modèles avec une distribution binomiale négative avec excès de zéros (avec le <em>package</em> <code>gamlss</code>), ainsi que des modèles de <strong>Hurdle</strong>. Ces derniers ont une approche différente de celle proposée par les distributions ajustées pour tenir compte de l’excès de zéro que nous détaillons dans l’encadré «&nbsp;pour aller plus loin&nbsp;» ci-dessous. Le processus de sélection du modèle peut être résumé avec la <a href="#fig-poisswork">figure&nbsp;<span>8.39</span></a>. Notez que même en suivant cette procédure, rien ne garantit que votre modèle final reflète bien les données que vous étudiez. L’analyse approfondie des résidus et des prédictions du modèle est la seule façon de déterminer si oui ou non le modèle est fiable.</p>
<div id="fig-poisswork" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/poisson_workflow.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.39: Processus de sélection d’un modèle pour une variable de comptage</figcaption></figure>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Modèle de Hurdle <em>versus</em> modèle avec excès de zéro</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Les modèles de Hurdle sont une autre catégorie de modèles GLM. Ils peuvent être décrits avec la formulation suivante&nbsp;:</p>
<p><span id="eq-glmHurdle"><span class="math display">\[
\left\{\begin{array}{c}
Y \sim \text {Binomial}(p) \text { si } y = 0 \\
\text { logit }(p)=\beta_{a} X_{a} \\
Y \sim \text { TrPoisson}(\lambda) \text { si } y&gt;0 \\
\log (\lambda)=\beta_{b} X_{b}
\end{array}\right.
\tag{8.21}\]</span></span></p>
<p>Nous constatons qu’un modèle de Hurdle utilise deux distributions, la première est une distribution binomiale dont l’objectif est de prédire si les observations sont à 0 ou au-dessus de 0. La seconde est une distribution strictement positive (supérieure à 0), il peut s’agir d’une distribution tronquée de Poisson, tronquée binomiale négative, Gamma, log-normale ou autre, dépendamment du phénomène modélisé. Puisque le modèle fait appel à deux distributions, deux équations de régression sont utilisées, l’une pour prédire <em>p</em> (la probabilité d’observer une valeur au-dessus de 0) et l’autre l’espérance (moyenne) de la seconde distribution.</p>
<p>En d’autres termes, un modèle de Hurdle modélise les données à zéro et les données au-delà de 0 comme deux processus différents (chacun avec sa propre distribution). Cette approche se distingue des modèles avec excès de zéros qui utilisent une seule distribution pour décrire l’ensemble des données. D’après un modèle avec excès de zéro, il existe de vrais et de faux zéros que l’on tente de distinguer. Dans un modèle de Hurdle, l’idée est que les zéros constituent une limite. Nous modélisons la probabilité de dépasser cette limite et ensuite la magnitude du dépassement de cette limite.</p>
<p>Prenons un exemple pour rendre la distinction plus concrète. Admettons que nous utilisons un capteur capable de mesurer la concentration de particules fines dans l’air. D’après les spécifications du fabricant, le capteur est capable de mesurer des taux de concentration à partir de 0,001 µg/m<sup>3</sup>. Dans une ville avec des niveaux de concentration très faibles, il est très fréquent que le capteur enregistre des valeurs à zéro. Considérant ce phénomène, il serait judicieux de modéliser le processus avec un modèle de Hurdle Gamma puisque les 0 représentent une limite qui n’a pas été franchie&nbsp;: le seuil de détection du capteur. Nous traitons donc différemment les secteurs au-dessous et au-dessus de ce seuil. Si nous reprenons notre exemple sur les accidents des piétons à des intersections, il est plus judicieux, dans ce cas, de modéliser le phénomène avec un modèle avec excès de zéro puisque nous pouvons observer zéro accident à une intersection dangereuse (vrai zéro) et zéro accident à une intersection sur laquelle aucun piéton ne traverse jamais (faux zéro).</p>
</div>
</div>
</section></section><section id="sec-084" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="sec-084">
<span class="header-section-number">8.4</span> Modèles GLM pour des variables continues</h2>
<p>Comme nous l’avons vu dans la <a href="02-univarie.html#sec-024">section&nbsp;<span>2.4</span></a>, il existe un grand nombre de distributions permettant de décrire une grande diversité de variables continues. Il serait fastidieux de toutes les présenter, nous revenons donc seulement sur les plus fréquentes.</p>
<section id="sec-0841" class="level3" data-number="8.4.1"><h3 data-number="8.4.1" class="anchored" data-anchor-id="sec-0841">
<span class="header-section-number">8.4.1</span> Modèle GLM gaussien</h3>
<p>Comme nous l’avons vu en introduction, le modèle GLM gaussien est le plus simple puisqu’il correspond à la transposition de la régression linéaire classique (des moindres carrés) dans la forme des modèles généralisés.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-gaussiandentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.29: Carte d’identité du modèle gaussien</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 75%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable continue dans l’intervalle <span class="math inline">\(]-\infty ; + \infty[\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Normale</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Normal(\mu,\sigma)\)</span> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) = x\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">Identitaire</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span> et <span class="math inline">\(\sigma\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Homoscédasticité</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08411" class="level4" data-number="8.4.1.1"><h4 data-number="8.4.1.1" class="anchored" data-anchor-id="sec-08411">
<span class="header-section-number">8.4.1.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que celles d’une régression linéaire classique. La condition de l’homoscédasticité (homogénéité de la variance) est due au fait que la variance du modèle est contrôlée par un seul paramètre fixe <span class="math inline">\(var(y) = \sigma\)</span> (l’écart-type de la distribution normale). À titre de comparaison, rappelons que dans un modèle de Poisson, la variance est égale à la moyenne (<span class="math inline">\(var(y) = E(y)\)</span>) alors que dans un modèle binomial négatif, la variance est fonction de la moyenne et d’un paramètre <span class="math inline">\(\theta\)</span> (<span class="math inline">\(var(y) = E(y) + E(y)^{\frac{2}{\theta}}\)</span>). Pour ces deux exemples, la variance augmente au fur et à mesure que la moyenne augmente.</p>
</section><section id="sec-08412" class="level4" data-number="8.4.1.2"><h4 data-number="8.4.1.2" class="anchored" data-anchor-id="sec-08412">
<span class="header-section-number">8.4.1.2</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres est la même que pour une régression linéaire classique&nbsp;:</p>
<ul>
<li><p><span class="math inline">\(\beta_0\)</span>&nbsp;: la constante, soit la moyenne attendue de la variable <em>Y</em> lorsque les valeurs de toutes les variables <em>X</em> sont 0.</p></li>
<li><p><span class="math inline">\(\beta\)</span>&nbsp;: les coefficients de régression qui quantifient l’effet d’une augmentation d’une unité des variables <em>X</em> sur la moyenne de la variable <em>Y</em>.</p></li>
<li><p><span class="math inline">\(\sigma\)</span>&nbsp;: l’écart-type de <em>Y</em> après avoir contrôlé les variables <em>X</em>. Il peut s’interpréter comme l’incertitude restante après modélisation de la moyenne de <em>Y</em>. Concrètement, si vous utilisez votre équation de régression pour prédire une nouvelle valeur de <em>Y</em>&nbsp;: <span class="math inline">\(\hat{Y}\)</span>, l’intervalle de confiance à 95&nbsp;% de cette prédiction est (<span class="math inline">\(\hat{Y} - 3\sigma\text{ ; }\hat{Y} + 3\sigma\)</span>). Vous noterez donc que plus <span class="math inline">\(\sigma\)</span> est grand, plus grande est l’incertitude de la prédiction.</p></li>
</ul></section><section id="sec-08413" class="level4" data-number="8.4.1.3"><h4 data-number="8.4.1.3" class="anchored" data-anchor-id="sec-08413">
<span class="header-section-number">8.4.1.3</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous reprenons le modèle LM que nous avons présenté dans la <a href="07-regressionlineaire.html#sec-077">section&nbsp;<span>7.7</span></a>. À titre de rappel, l’objectif est de modéliser la densité végétale dans les secteurs de recensement de Montréal. Pour cela, nous utilisons des variables relatives aux populations vulnérables physiologiquement ou socioéconomiquement, tout en contrôlant l’effet de la forme urbaine. Parmi ces dernières, l’âge médian des bâtiments est ajouté au modèle avec une polynomiale d’ordre deux, et la densité d’habitants est transformée avec la fonction logarithmique.</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>La première étape de la vérification des conditions d’application est bien sûr de s’assurer de l’absence de multicolinéarité excessive.</p>
<div class="cell">
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/lm/DataVegetation.RData"</span><span class="op">)</span></span>
<span><span class="co"># Calcul du VIF</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">VegPct</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">HABHA</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">AgeMedian</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                       <span class="va">Pct_014</span><span class="op">+</span><span class="va">Pct_65P</span><span class="op">+</span><span class="va">Pct_MV</span><span class="op">+</span><span class="va">Pct_FR</span>, data <span class="op">=</span> <span class="va">DataFinal</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       GVIF Df GVIF^(1/(2*Df))
log(HABHA)         1.289495  1        1.135559
poly(AgeMedian, 2) 1.387429  2        1.085307
Pct_014            1.517957  1        1.232054
Pct_65P            1.304094  1        1.141969
Pct_MV             1.480275  1        1.216666
Pct_FR             1.729646  1        1.315160</code></pre>
</div>
</div>
<p>Puisque l’ensemble des valeurs de VIF sont inférieures à deux, nos données ne sont pas marquées par une multicolinéarité problématique. La seconde étape du diagnostic consiste à calculer et à afficher les distances de Cook.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gausscook" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gausscook-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.40: Distances de Cook pour le modèle gaussien</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-gausscook">figure&nbsp;<span>8.40</span></a> indique clairement que quatre observations sont très influentes dans le modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sélection des cas étranges</span></span>
<span><span class="va">cas_etranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">DataFinal</span>, <span class="va">cooksd</span> <span class="op">&gt;</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etranges</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     VegPct ArbPct V250Pct V500Pct A250Pct A500Pct      HABHA AgeMedian Pct_014
3374 10.481  5.478  18.987  13.744   2.908   2.704  74.835867       226    4.76
3378  0.000  0.000  12.709  12.505   2.116   2.324  88.006946       206    6.25
4446 23.162  5.209  31.437  31.535   8.672   9.108 313.142733       206   14.40
9088 85.767 27.583  78.195  83.492  42.999  51.074   2.070472       207   12.00
     Pct_65P Pct_MV Pct_FR DistCBDkm   SDRNOM
3374   14.29  23.81  14.29     0.748 Montréal
3378   12.50  25.00  12.50     0.706 Montréal
4446   16.87  53.50  42.39     8.678 Montréal
9088   24.00  12.00  16.00    28.440 Montréal</code></pre>
</div>
</div>
<p>Il s’agit de quatre îlots dans Montréal avec des logements très anciens&nbsp;: plus de 200 ans, alors que la moyenne est de 52 ans pour le reste de la zone d’étude. Le fait que nous ayons dans le modèle une polynomiale d’ordre 2 pour cette variable intensifie l’influence de ces valeurs extrêmes. Par conséquent, nous décidons de simplement les supprimer. Nous verrons plus tard qu’une alternative envisageable est de changer la distribution du modèle pour une distribution de Student (plus robuste aux valeurs extrêmes).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gausscook2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gausscook2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.41: Distances de Cook pour le modèle gaussien après suppression des observations influentes</figcaption></figure>
</div>
</div>
</div>
<p>Une fois ces observations retirées, les nouvelles distances de Cook ne révèlent plus d’observations fortement influentes (<a href="#fig-gausscook2">figure&nbsp;<span>8.41</span></a>). Nous pouvons passer à l’analyse des résidus simulés. La <a href="#fig-gaussresid">figure&nbsp;<span>8.42</span></a> démontre que la distribution des résidus est significativement différente d’une distribution uniforme, que des valeurs aberrantes sont encore présentes et qu’il existe un lien entre résidus et prédiction dans le modèle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span><span class="va">modsigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Extraction de l'écart type du modèle</span></span>
<span><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">nsim</span>, mean<span class="op">=</span><span class="va">mu</span>, sd <span class="op">=</span> <span class="va">modsigma</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">DataFinal2</span><span class="op">$</span><span class="va">VegPct</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">mus</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gaussresid" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gaussresid-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.42: Diagnostic général des résidus simulés pour le modèle gaussien</figcaption></figure>
</div>
</div>
</div>
<p>Pour mieux cerner ce problème, nous pouvons, dans un premier temps, comparer la distribution originale des données et les simulations issues du modèle. La <a href="#fig-gausssim">figure&nbsp;<span>8.43</span></a> montre clairement que la distribution normale est mal ajustée aux données. Ces dernières sont légèrement asymétriques et ne peuvent pas être inférieures à zéro, ce que la distribution normale ne parvient pas à reproduire.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">mat_sims</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DataFinal2</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VegPct</span>, y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span>, </span>
<span>               color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Pourcentage de végétation dans l'îlot (%)"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"Densité"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gausssim" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gausssim-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.43: Comparaison de la distribution originale de la variable et des simulations issues du modèle</figcaption></figure>
</div>
</div>
</div>
<p>Il est également possible de vérifier si la condition d’homogénéité de la variance s’applique bien aux données.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">sigma_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Création d'un DataFrame pour contenir les prédictions et les vraies valeurs</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  mus <span class="op">=</span> <span class="va">mus</span>,</span>
<span>  reals <span class="op">=</span> <span class="va">DataFinal2</span><span class="op">$</span><span class="va">VegPct</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Calcul de l'intervalle de confiance à 95 % selon la distribution normale</span></span>
<span><span class="co"># et stockage dans un second DataFrame</span></span>
<span><span class="va">seqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  mus <span class="op">=</span> <span class="va">seqa</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.025</span>, mean <span class="op">=</span> <span class="va">seqa</span>, sd <span class="op">=</span> <span class="va">sigma_model</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, mean <span class="op">=</span> <span class="va">seqa</span>, sd <span class="op">=</span> <span class="va">sigma_model</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df1</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mus</span>, y <span class="op">=</span> <span class="va">reals</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span><span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mus</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"valeurs prédites"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"valeurs réelles"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gausssim2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gausssim2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.44: Comparaison de la distribution originale de la variable et des simulations issues du modèle</figcaption></figure>
</div>
</div>
</div>
<p>À nouveau, nous constatons à la <a href="#fig-gausssim2">figure&nbsp;<span>8.44</span></a> que le modèle s’attend à trouver des valeurs négatives pour la concentration de végétation, ce qui n’est pas possible dans notre cas. En revanche, il semble que la variance soit bien homogène puisque la dispersion des observations semble suivre à peu près la dispersion attendue par le modèle (en noir).</p>
<p>Malgré ces différents constats indiquant clairement qu’un modèle gaussien est un choix sous-optimal pour ces données, nous poursuivons l’analyse de ce modèle.</p>
<p><strong>Vérification de la qualité d’ajustement</strong></p>
<div class="cell">
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement d'un modèle nul</span></span>
<span><span class="va">modelenull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">VegPct</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">DataFinal2</span>, </span>
<span>                  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Calcul des pseudo R2</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">modelenull</span><span class="op">)</span>, </span>
<span>     nb.params <span class="op">=</span> <span class="va">modele</span><span class="op">$</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">DataFinal2</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.4706321

$`McFadden ajuste`
'log Lik.' 0.07310662 (df=9)

$`Cox and Snell`
'log Lik.' 0.4706321 (df=9)

$Nagelkerke
'log Lik.' 0.4707122 (df=9)</code></pre>
</div>
</div>
<p>Le modèle parvient à expliquer 47&nbsp;% de la déviance totale, mais obtient un R<sup>2</sup> ajusté de McFadden de seulement 0,07.</p>
<div class="cell">
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">-</span> <span class="va">DataFinal2</span><span class="op">$</span><span class="va">VegPct</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.49885</code></pre>
</div>
</div>
<p>L’erreur quadratique moyenne et de 13,5 points de pourcentage, ce qui indique que le modèle a une assez faible capacité prédictive.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>; le <a href="#tbl-tableaugauss">tableau&nbsp;<span>8.30</span></a> présente les résultats pour les coefficients du modèle.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-tableaugauss" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.30: Résultats du modèle gaussien</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 17%">
<col style="width: 18%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">Err.std</th>
<th style="text-align: right;">Val.z</th>
<th style="text-align: right;">val.p</th>
<th style="text-align: right;">IC coeff 2,5 %</th>
<th style="text-align: right;">IC coeff 97,5 %</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">53,606</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">53,640</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">51,647</td>
<td style="text-align: right;">55,565</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">AgeMedian ordre 1</td>
<td style="text-align: right;">2,732</td>
<td style="text-align: right;">15,560</td>
<td style="text-align: right;">0,180</td>
<td style="text-align: right;">0,861</td>
<td style="text-align: right;">-27,772</td>
<td style="text-align: right;">33,237</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">AgeMedian ordre 2</td>
<td style="text-align: right;">-320,869</td>
<td style="text-align: right;">14,000</td>
<td style="text-align: right;">-22,910</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">-348,318</td>
<td style="text-align: right;">-293,420</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pct_014</td>
<td style="text-align: right;">0,915</td>
<td style="text-align: right;">0,030</td>
<td style="text-align: right;">29,310</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,853</td>
<td style="text-align: right;">0,976</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct_65P</td>
<td style="text-align: right;">0,280</td>
<td style="text-align: right;">0,020</td>
<td style="text-align: right;">15,050</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,243</td>
<td style="text-align: right;">0,316</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pct_MV</td>
<td style="text-align: right;">-0,042</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">-4,190</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">-0,061</td>
<td style="text-align: right;">-0,022</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct_FR</td>
<td style="text-align: right;">-0,340</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">-30,940</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">-0,362</td>
<td style="text-align: right;">-0,318</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Les résultats de la régression linéaire multiple ont déjà été interprétés dans la <a href="07-regressionlineaire.html#sec-0771">section&nbsp;<span>7.7.1</span></a>, nous ne commenterons pas ici les résultats du modèle GLM gaussien qui sont identiques.</p>
</section></section><section id="sec-0842" class="level3" data-number="8.4.2"><h3 data-number="8.4.2" class="anchored" data-anchor-id="sec-0842">
<span class="header-section-number">8.4.2</span> Modèle GLM avec une distribution de Student</h3>
<p>Pour rappel, la distribution de Student ressemble à une distribution normale (<a href="02-univarie.html#sec-024311">section&nbsp;<span>2.4.3.11</span></a>). Elle est symétrique autour de sa moyenne et a également une forme de cloche. Cependant, elle dispose de queues lourdes, ce qui signifie qu’elle permet de représenter des phénomènes présentant davantage de valeurs extrêmes qu’une distribution normale. Pour contrôler le poids des queues, la distribution de Student intègre un troisième paramètre&nbsp;: <span class="math inline">\(\nu\)</span> (nu). Lorsque <span class="math inline">\(\nu\)</span> tends vers l’infini, la distribution de Student tend vers une distribution normale (<a href="#fig-studentdistrib">figure&nbsp;<span>8.45</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-studentdistrib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-studentdistrib-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.45: Effet du paramètre nu sur une distribution de Student</figcaption></figure>
</div>
</div>
</div>
<p>Comme vous pouvez le constater dans la carte d’identité au <a href="#tbl-studentdentity">tableau&nbsp;<span>8.31</span></a>, le modèle GLM de Student est très proche du modèle GLM gaussien. Nous modélisons explicitement la moyenne de la distribution et son paramètre de dispersion (variance) est laissé fixe. Ce GLM est même souvent utilisé comme une version «&nbsp;robuste&nbsp;» du modèle gaussien du fait de sa capacité à intégrer explicitement l’effet des observations extrêmes. En effet, dans un modèle gaussien, les observations extrêmes (aussi appelées observations aberrantes) vont davantage influencer les paramètres du modèle que pour un modèle utilisant une distribution de Student.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-studentdentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.31: Carte d’identité du modèle de Student</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable continue dans l’intervalle <span class="math inline">\(]-\infty ; + \infty[\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Student</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Student(\mu,\sigma,\nu)\)</span> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) = x\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">Identitaire</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\sigma\)</span> et <span class="math inline">\(\nu\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;">Homoscédasticité</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08421" class="level4" data-number="8.4.2.1"><h4 data-number="8.4.2.1" class="anchored" data-anchor-id="sec-08421">
<span class="header-section-number">8.4.2.1</span> Conditions d’application</h4>
<p>Les conditions d’application sont les mêmes que pour un modèle GLM gaussien, à ceci prêt que le modèle utilisant la distribution de Student est moins sensible aux observations extrêmes.</p>
</section><section id="sec-08422" class="level4" data-number="8.4.2.2"><h4 data-number="8.4.2.2" class="anchored" data-anchor-id="sec-08422">
<span class="header-section-number">8.4.2.2</span> Interprétation des paramètres</h4>
<p>L’interprétation des paramètres est la même que pour un modèle gaussien puisque nous modélisons la moyenne de la distribution et que la fonction de lien est la fonction identitaire. Le seul paramètre supplémentaire est <span class="math inline">\(\nu\)</span>, qui n’a en soit aucune interprétation pratique. Notez simplement que si <span class="math inline">\(\nu\)</span> est supérieur à 30, un simple modèle GLM gaussien serait sûrement suffisant.</p>
</section><section id="sec-08423" class="level4" data-number="8.4.2.3"><h4 data-number="8.4.2.3" class="anchored" data-anchor-id="sec-08423">
<span class="header-section-number">8.4.2.3</span> Exemple appliqué dans R</h4>
<p>Nous proposons ici de simplement réajuster le modèle gaussien présenté dans la section précédente en utilisant une distribution de Student. Nous utilisons pour cela la fonction <code>gam</code> du <em>package</em> <code>mgcv</code> avec le paramètre <code>family = scat</code> pour utiliser une distribution de Student. Les valeurs de VIF ont déjà été calculées dans l’exemple précédent, nous pouvons donc passer directement au calcul des distances de Cook.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"data/lm/DataVegetation.RData"</span><span class="op">)</span></span>
<span><span class="co"># Ajustement du modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">VegPct</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">HABHA</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">AgeMedian</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                       <span class="va">Pct_014</span><span class="op">+</span><span class="va">Pct_65P</span><span class="op">+</span><span class="va">Pct_MV</span><span class="op">+</span><span class="va">Pct_FR</span>, data <span class="op">=</span> <span class="va">DataFinal</span>,</span>
<span>              family <span class="op">=</span> <span class="va">scat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Affichage des valeurs</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.7</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-stucookdist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-stucookdist-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.46: Distances de Cook pour un modèle GLM avec une distribution de Student</figcaption></figure>
</div>
</div>
</div>
<p>Nous retrouvons les quatre observations avec des distances de Cook très fortes que nous avons identifiées dans le modèle gaussien. Nous décidons donc de les enlever pour les mêmes raisons que précédemment.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="va">DataFinal2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">DataFinal</span>, <span class="va">cooksd</span><span class="op">&lt;</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co"># Ajustement du modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">VegPct</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">HABHA</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">AgeMedian</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                       <span class="va">Pct_014</span><span class="op">+</span><span class="va">Pct_65P</span><span class="op">+</span><span class="va">Pct_MV</span><span class="op">+</span><span class="va">Pct_FR</span>, data <span class="op">=</span> <span class="va">DataFinal2</span>,</span>
<span>              family <span class="op">=</span> <span class="va">scat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Affichage des valeurs</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.7</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-stucookdist2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-stucookdist2-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.47: Distances de Cook pour un modèle GLM avec une distribution de Student après suppression des valeurs fortement influentes</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons à présent vérifier si les résidus simulés se comportent tel qu’attendu.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span><span class="co"># Affichage des paramètres nu et sigma</span></span>
<span><span class="va">modele</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="va">family</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Scaled t(6.333,11.281)"</code></pre>
</div>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sigma_model</span> <span class="op">&lt;-</span> <span class="fl">11.281</span></span>
<span><span class="va">nu_model</span> <span class="op">&lt;-</span> <span class="fl">6.333</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LaplacesDemonR/LaplacesDemon">LaplacesDemon</a></span><span class="op">)</span> <span class="co"># pour simuler des données d'une distribution de Student</span></span>
<span><span class="co"># Génération de 1000 simulations pour chaque prédiction</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/LaplacesDemon/man/dist.Student.t.html">rst</a></span><span class="op">(</span><span class="va">nsim</span>, mu<span class="op">=</span><span class="va">mu</span>, sigma <span class="op">=</span> <span class="va">sigma_model</span>, nu <span class="op">=</span> <span class="va">nu_model</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calculer les résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">DataFinal2</span><span class="op">$</span><span class="va">VegPct</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">mus</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-studentresid" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-studentresid-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.48: Diagnostic général des résidus simulés pour le GLM avec distribution de Student</figcaption></figure>
</div>
</div>
</div>
<p>Il semble que nous obtenons des résultats similaires à ceux du modèle gaussien: les résidus divergent significativement d’une distribution uniforme (<a href="#fig-studentresid">figure&nbsp;<span>8.48</span></a>). Le graphique quantile-quantile n’est parfois pas très adapté pour discerner une déviation de la distribution uniforme, nous pouvons dans ce cas afficher un histogramme des résidus pour en avoir le coeur net (<a href="#fig-studentresid2">figure&nbsp;<span>8.49</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"effectifs"</span>, y <span class="op">=</span> <span class="st">"résidus simulés"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-studentresid2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-studentresid2-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.49: Distribution des résidus simulés du modèle GLM avec distribution de Student</figcaption></figure>
</div>
</div>
</div>
<p>Pour cet exercice, il est intéressant de comparer les formes des simulations issues du modèle gaussien et du modèle de Student pour bien distinguer la différence entre les deux.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-studentresid3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-studentresid3-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.50: Simulations issues des modèles gaussien et de Student, comparées aux données originales</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons ainsi que la différence entre les deux modèles est ici très mince, voire inexistante. Le seul élément que nous pouvons noter est que le modèle de Student à une courbe (une queue de distribution) moins aplatie vers la droite. Cela lui permettrait de mieux tenir compte de cas extrêmes avec de fortes densités de végétation (ce qui concerne donc très peu d’observations puisque cette variable a un maximum de 100).</p>
<p>Pour déterminer si le modèle de Student est plus pertinent à retenir que le modèle gaussien, nous pouvons ajuster un second modèle de Student pour lequel nous forçons artificiellement <span class="math inline">\(\nu\)</span> à être très élevé. Pour rappel, quand <span class="math inline">\(\nu\)</span> tend vers l’infini, la distribution de Student tend vers une distribution normale. Nous forçons ici <span class="math inline">\(\nu\)</span> à être supérieur à 100 pour créer un second modèle de Student se comportant quasiment comme un modèle gaussien et calculons les AIC des deux modèles.</p>
<div class="cell">
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul d'un modèle de Student identique à un modèle gaussien</span></span>
<span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">VegPct</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">HABHA</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">AgeMedian</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>                   <span class="va">Pct_014</span><span class="op">+</span><span class="va">Pct_65P</span><span class="op">+</span><span class="va">Pct_MV</span><span class="op">+</span><span class="va">Pct_FR</span>, data <span class="op">=</span> <span class="va">DataFinal2</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/scat.html">scat</a></span><span class="op">(</span>min.df <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Calcul des deux AIC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 81771.92</code></pre>
</div>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">modele2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 82057.79</code></pre>
</div>
</div>
<p>Le second AIC (modèle gaussien) est plus élevé, indiquant que le modèle est moins bien ajusté aux données. Dans le cas présent, il est plus pertinent de retenir le modèle de Student même si les écarts entre ces deux modèles sont minimes. Ce résultat n’est pas surprenant puisque la variable <em>Y</em> (pourcentage de végétation dans les îlots de l’île de Montréal) est relativement compacte et comporte peu / pas de valeurs pouvant être qualifiées de valeurs extrêmes.</p>
<p>Nous ne détaillons pas ici l’interprétation des coefficients du modèle (présentés au <a href="#tbl-glmstudentres">tableau&nbsp;<span>8.32</span></a>) puisqu’ils s’interprètent de la même façon qu’un modèle GLM et qu’un modèle de régression linéaire multiple.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-glmstudentres" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.32: Résultats du modèle Student</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 7%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">Err.std</th>
<th style="text-align: right;">Val.z</th>
<th style="text-align: right;">val.p</th>
<th style="text-align: right;">IC coeff 2,5 %</th>
<th style="text-align: right;">IC coeff 97,5 %</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">65,096</td>
<td style="text-align: right;">0,940</td>
<td style="text-align: right;">69,110</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">63,250</td>
<td style="text-align: right;">66,943</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">log(HABHA)</td>
<td style="text-align: right;">-9,502</td>
<td style="text-align: right;">0,160</td>
<td style="text-align: right;">-60,160</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">-9,811</td>
<td style="text-align: right;">-9,192</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct_014</td>
<td style="text-align: right;">0,866</td>
<td style="text-align: right;">0,030</td>
<td style="text-align: right;">29,450</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,808</td>
<td style="text-align: right;">0,924</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pct_65P</td>
<td style="text-align: right;">0,237</td>
<td style="text-align: right;">0,020</td>
<td style="text-align: right;">13,540</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,203</td>
<td style="text-align: right;">0,272</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pct_MV</td>
<td style="text-align: right;">-0,015</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">-1,650</td>
<td style="text-align: right;">0,099</td>
<td style="text-align: right;">-0,034</td>
<td style="text-align: right;">0,003</td>
<td style="text-align: right;">.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pct_FR</td>
<td style="text-align: right;">-0,301</td>
<td style="text-align: right;">0,010</td>
<td style="text-align: right;">-29,040</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">-0,321</td>
<td style="text-align: right;">-0,280</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="sec-0843" class="level3" data-number="8.4.3"><h3 data-number="8.4.3" class="anchored" data-anchor-id="sec-0843">
<span class="header-section-number">8.4.3</span> Modèle GLM avec distribution Gamma</h3>
<p>Pour rappel, la distribution Gamma est strictement positive (<span class="math inline">\([0;+\infty[\)</span>), asymétrique, et a une variance proportionnelle à sa moyenne (hétéroscedastique). Dans la section sur les distributions, nous avons vu que la distribution Gamma (<a href="02-univarie.html#sec-024315">section&nbsp;<span>2.4.3.15</span></a>) est formulée avec deux paramètres&nbsp;: sa forme (<span class="math inline">\(\alpha\)</span> ou <em>shape</em>) et son échelle (<span class="math inline">\(b\)</span> ou <em>scale</em>). Ces deux paramètres n’ont pas une interprétation intuitive, mais il est possible avec un peu de jonglage mathématique d’arriver à une reparamétrisation intéressante. Cela est détaillé dans l’encadré ci-dessous; notez toutefois qu’il n’est pas nécessaire de maîtriser le contenu de cet encadré pour lire la suite de cette section sur les modèles GLM avec une distribution Gamma.</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Reparamétrisation d’une distribution Gamma pour un GLM</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Si nous disposons d’une variable <em>Y</em>, suivant une distribution Gamma telle que <span class="math inline">\(Y \sim Gamma(\alpha,b)\)</span> avec <span class="math inline">\(\alpha\)</span> le paramètre de forme et <span class="math inline">\(b\)</span> le paramètre d’échelle, alors, l’espérance et la variance de <em>Y</em> peuvent être définies comme suit&nbsp;:</p>
<p><span id="eq-glm18"><span class="math display">\[
\begin{aligned}
&amp;E(Y) = \alpha \times b \\
&amp;Var(Y) = \alpha \times b^2\\
\end{aligned}
\tag{8.22}\]</span></span></p>
<p>En d’autres termes, l’espérance (l’équivalent de la moyenne pour une distribution normale) de notre variable <em>Y</em> est égale au produit des paramètres de forme et d’échelle.</p>
<p>Avec ces propriétés, il est possible de redéfinir la fonction de densité de la distribution Gamma et d’arriver à une nouvelle formulation&nbsp;: <span class="math inline">\(Y \sim Gamma(\mu,\alpha)\)</span>. <span class="math inline">\(\mu\)</span> est donc l’espérance de <em>Y</em> (interprétable comme sa moyenne, soit sa valeur attendue) et <span class="math inline">\(\alpha\)</span> permet de capturer la dispersion de la distribution Gamma. Par extension des relations présentées ci-dessus, il est possible de reformuler la variance en fonction de <span class="math inline">\(\mu\)</span> et de <span class="math inline">\(\alpha\)</span>.</p>
<p><span id="eq-glm19"><span class="math display">\[
\begin{aligned}
&amp;Var(Y) = \alpha \times b^2\\
&amp;\mu = \alpha \times b \text{ soit }b = \frac{\mu}{a}\\
&amp;Var(Y) = \alpha \times (\frac{\mu}{\alpha})^2 \text{ soit } Var(Y) = \frac{\mu^2}{\alpha}\\
\end{aligned}
\tag{8.23}\]</span></span></p>
<p>Nous observons donc que la variance dans un modèle Gamma augmente de façon quadratique avec la moyenne, mais est tempérée par le paramètre de forme. Nous en concluons qu’un paramètre de forme plus grand produit une distribution moins étalée.</p>
<p>Dans ce contexte, <span class="math inline">\(\mu\)</span> doit être strictement positif&nbsp;: la valeur attendue moyenne d’une distribution Gamma doit être positive par définition puisqu’une distribution Gamma ne peut pas produire de valeurs négatives. Il est donc logique d’utiliser la fonction logarithmique comme fonction de lien, puisque sa contrepartie (la fonction exponentielle) ne produit que des résultats positifs.</p>
</div>
</div>
<p>Pour résumer, nous nous retrouvons donc avec un modèle qui prédit, sur une échelle logarithmique, l’espérance (~moyenne) d’une distribution Gamma. Notez qu’il existe d’autres façons de spécifier un modèle GLM avec une distribution Gamma, mais celle-ci est la plus intuitive.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-gammadentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.33: Carte d’identité du modèle Gamma</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable continue dans l’intervalle <span class="math inline">\(]0 ; + \infty[\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Gamma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Gamma(\mu,\alpha)\)</span> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) = log(x)\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">log</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, et <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;"><span class="math inline">\(Variance = \frac{\mu^2}{\alpha}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08431" class="level4" data-number="8.4.3.1"><h4 data-number="8.4.3.1" class="anchored" data-anchor-id="sec-08431">
<span class="header-section-number">8.4.3.1</span> Interprétation des paramètres</h4>
<p>Puisque le modèle utilise la fonction de lien <em>log</em>, alors les coefficients <span class="math inline">\(\beta\)</span> expriment l’augmentation de l’espérance (la valeur attendue de <em>Y</em>, ce qui est proche de l’idée de moyenne) de la variable Y sur une échelle logarithmique (comme dans un modèle de Poisson). Il est possible de convertir les coefficients dans l’échelle originale de la variable <em>Y</em> en utilisant la fonction exponentielle (l’inverse de la fonction <em>log</em>), mais ces coefficients représentent alors des effets multiplicatifs et non des effets additifs. Prenons un exemple, admettons que le coefficient <span class="math inline">\(\beta_1\)</span>, associé à la variable <span class="math inline">\(X_1\)</span> soit de 1,5. Cela signifie qu’une augmentation d’une unité de <span class="math inline">\(X_1\)</span>, augmente le log de l’espérance de <em>Y</em> de 1,5 unité. L’exponentielle du coefficient est 4,48, ce qui signifie qu’une augmentation d’une unité entraîne une multiplication par 4,48 de la valeur attendue de <em>Y</em> (l’espérance de <em>Y</em>). Le paramètre de forme (<span class="math inline">\(\alpha\)</span>) n’a pas d’interprétation pratique, bien qu’il soit utilisé dans les différents tests des conditions d’application du modèle et dans le calcul de sa déviance.</p>
</section><section id="sec-08432" class="level4" data-number="8.4.3.2"><h4 data-number="8.4.3.2" class="anchored" data-anchor-id="sec-08432">
<span class="header-section-number">8.4.3.2</span> Conditions d’application</h4>
<p>Dans un modèle GLM gaussien, la variance est capturée par un paramètre <span class="math inline">\(\sigma\)</span> et est constante, produisant la condition d’homoscédasticité des résidus. Dans un modèle Gamma, la variance varie en fonction de l’espérance et du paramètre de forme selon la relation&nbsp;: <span class="math inline">\(Var(Y) = \frac{E(Y)^2}{\alpha}\)</span>. Les résidus sont donc par nature hétéroscédastiques dans un modèle Gamma et doivent suivre cette relation.</p>
</section><section id="sec-08433" class="level4" data-number="8.4.3.3"><h4 data-number="8.4.3.3" class="anchored" data-anchor-id="sec-08433">
<span class="header-section-number">8.4.3.3</span> Exemple appliqué dans R</h4>
<p>Pour cet exemple, nous nous intéressons à la durée de déplacement en milieu urbain. Ce type d’analyse permet notamment de mieux comprendre les habitudes de déplacement de la population et d’orienter les politiques de transport. Plusieurs travaux concluent que les durées de déplacement en milieu urbain varient en fonction du motif du déplacement, du mode de transport utilisé, des caractéristiques socio-économiques de l’individu et des caractéristiques du trajet lui-même <span class="citation" data-cites="anastasopoulos2012analysis frank2008urban">(<a href="references.html#ref-anastasopoulos2012analysis" role="doc-biblioref">Anastasopoulos et al. 2012</a>; <a href="references.html#ref-frank2008urban" role="doc-biblioref">Frank et al. 2008</a>)</span>. Nous modélisons ici la durée en minute d’un ensemble de déplacements effectués par des Montréalais en 2017 et enregistrés avec l’application MTL Trajet proposée par la Ville de Montréal. Ces données sont disponibles sur le site web des <a href="http://donnees.ville.montreal.qc.ca/dataset/mtl-trajet">données ouvertes de Montréal</a> et sont anonymisées. Nous ne disposons donc d’aucune information individuelle. Compte tenu du très grand nombre d’observations (plus de 185&nbsp;000), nous avons dû effectuer quelques opérations de tri et nous avons ainsi supprimé:</p>
<ul>
<li><p>les trajets utilisant de multiples modes de transport (sauf en combinaison avec la marche, par exemple, un trajet effectué à pied et en transport en commun a été recatégorisé comme un trajet en transport en commun uniquement). Les déplacements multimodaux se distinguent largement des déplacements unimodaux dans la littérature scientifique;</p></li>
<li><p>les trajets de nuit (seuls les trajets démarrant dans l’intervalle de 7&nbsp;h à 21&nbsp;h ont été conservés);</p></li>
<li><p>les trajets dont le point de départ est un arrondissement / municipalité pour lequel moins de 150 trajets ont été enregistrés (trop peu d’observations);</p></li>
<li><p>les trajets de plus de deux heures (cas rares, considérés comme des données aberrantes);</p></li>
<li><p>les trajets dont le point de départ est à moins de 100 mètres du point d’arrivée (formant des boucles plutôt que des déplacements).</p></li>
</ul>
<p>Nous arrivons ainsi à un total de 24&nbsp;969 observations. Pour modéliser ces durées de déplacement, nous utilisons les variables indépendantes présentées dans le <a href="#tbl-variablegamma">tableau&nbsp;<span>8.34</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-variablegamma" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.34: Variables indépendantes utilisées dans le modèle Gamma</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 40%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom de la variable</th>
<th style="text-align: left;">Signification</th>
<th style="text-align: left;">Type de variable</th>
<th style="text-align: left;">Mesure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mode</td>
<td style="text-align: left;">Mode de déplacement</td>
<td style="text-align: left;">Variable catégorielle</td>
<td style="text-align: left;">Transport collectif; piéton; vélo et véhicule individuel</td>
</tr>
<tr class="even">
<td style="text-align: left;">Motif</td>
<td style="text-align: left;">Motif du déplacement</td>
<td style="text-align: left;">Variable catégorielle</td>
<td style="text-align: left;">Travail; loisir; magasinage et éducation</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HeureDep</td>
<td style="text-align: left;">Heure de départ</td>
<td style="text-align: left;">Variable catégorielle</td>
<td style="text-align: left;">De 7 h à 21 h</td>
</tr>
<tr class="even">
<td style="text-align: left;">ArrondDep</td>
<td style="text-align: left;">Arrondissement de départ</td>
<td style="text-align: left;">Variable catégorielle</td>
<td style="text-align: left;">Nom de l’arrondissement dont part le trajet</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LogDist</td>
<td style="text-align: left;">Logarithme de la distance à vol d’oiseau en km</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Logarithme de la distance à vol d’oiseau en km entre le point de départ et d’arrivée</td>
</tr>
<tr class="even">
<td style="text-align: left;">MemeArrond</td>
<td style="text-align: left;">L’arrivée du trajet se situe-t-elle dans le même arrondissement que celui du départ?</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Oui ou non</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Semaine</td>
<td style="text-align: left;">Le trajet a-t-il été effectué en semaine ou en fin de semaine?</td>
<td style="text-align: left;">Variable binaire</td>
<td style="text-align: left;">Semaine ou fin de semaine</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Les temps de trajet forment une variable strictement positive et très vraisemblablement asymétrique. En effet, nous nous attendons à observer une certaine concentration de valeurs autour d’une moyenne, et davantage de trajets avec de courtes durées que de trajets avec de longues durées. Pour nous en assurer, réalisons un histogramme de la distribution de notre variable <em>Y</em> et comparons-la avec des distributions normale et Gamma.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/DureeTrajets.csv"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">arrondMTL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mercier-Hochelaga-Maisonneuve"</span>, <span class="st">"Villeray-Saint-Michel-Parc-Extension"</span>, </span>
<span>               <span class="st">"Ville-Marie"</span>, <span class="st">"Verdun"</span>, <span class="st">"Saint-Leonard"</span>, <span class="st">"Saint-Laurent"</span>, </span>
<span>               <span class="st">"Rosemont-La Petite-Patrie"</span>, <span class="st">"Riviere-des-Prairies-Pointe-aux-Trembles"</span>, </span>
<span>               <span class="st">"Pierrefonds-Roxboro"</span>, <span class="st">"Outremont"</span>, <span class="st">"Montreal-Nord"</span>, <span class="st">"Le Sud-Ouest"</span>, </span>
<span>               <span class="st">"Le Plateau-Mont-Royal"</span>, <span class="st">"Lachine"</span> , <span class="st">"Ahuntsic-Cartierville"</span>,</span>
<span>               <span class="st">"Anjou"</span> ,<span class="st">"Cote-des-Neiges-Notre-Dame-de-Grace"</span>, <span class="st">"LaSalle"</span>  </span>
<span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">ArrondDep</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">arrondMTL</span><span class="op">)</span></span>
<span><span class="co"># Définissons 7 h du matin comme la référence pour la variable Heure de départ</span></span>
<span><span class="va">dataset</span><span class="op">$</span><span class="va">HeureDep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html">relevel</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">HeureDep</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">21</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"7"</span><span class="op">)</span></span>
<span><span class="co"># Comparaison de la distribution originale avec une distribution </span></span>
<span><span class="co"># normale et une distribution Gamma</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lbbe.univ-lyon1.fr/fr/fitdistrplus">fitdistrplus</a></span><span class="op">)</span></span>
<span><span class="va">model_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fitdistrplus/man/fitdist.html">fitdist</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Duree</span>, distr <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataset</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Duree</span>, y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">40</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dgamma</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">model_gamma</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Duree</span><span class="op">)</span>, </span>
<span>                            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Duree</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Temps de déplacement (minutes)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"modèles Gamma et gaussien"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gammadatadistrib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gammadatadistrib-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.51: Distribution des temps de trajet diurne à Montréal</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-gammadatadistrib">figure&nbsp;<span>8.51</span></a> permet de constater l’asymétrie de la distribution des temps de trajet et qu’un modèle Gamma (ligne rouge) a plus de chance d’être adapté aux données qu’un modèle gaussien (ligne bleue).</p>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Comme pour les modèles précédents, nous commençons par la vérification de l’absence de multicolinéarité.</p>
<div class="cell">
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Calcul du VIF</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Duree</span> <span class="op">~</span> <span class="va">Mode</span> <span class="op">+</span> <span class="va">Motif</span> <span class="op">+</span> <span class="va">HeureDep</span> <span class="op">+</span> <span class="va">LogDist</span> <span class="op">+</span></span>
<span>          <span class="va">ArrondDep</span> <span class="op">+</span> <span class="va">MemeArrond</span> <span class="op">+</span> <span class="va">Jour</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">Gamma</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"log"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               GVIF Df GVIF^(1/(2*Df))
Mode       2.103392  3        1.131931
Motif      1.934997  3        1.116298
HeureDep   1.791009 14        1.021032
LogDist    2.665998  1        1.632789
ArrondDep  1.439499 17        1.010772
MemeArrond 2.151113  1        1.466667
Jour       1.330091  6        1.024055</code></pre>
</div>
</div>
<p>L’ensemble des valeurs de VIF sont inférieures à trois, indiquant donc l’absence de multicolinéarité excessive. Nous pouvons donc ajuster une première version du modèle (ici avec le <em>package</em> <code>VGAM</code> et la fonction <code>vglm</code>) et calculer les distances de Cook.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du modèle avec VGAM</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Duree</span> <span class="op">~</span> <span class="va">Mode</span> <span class="op">+</span> <span class="va">Motif</span> <span class="op">+</span> <span class="va">HeureDep</span> <span class="op">+</span> <span class="va">LogDist</span> <span class="op">+</span></span>
<span>                 <span class="va">ArrondDep</span><span class="op">+</span> <span class="va">MemeArrond</span> <span class="op">+</span> <span class="va">Semaine</span>,</span>
<span>               data <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/gamma2.html">gamma2</a></span><span class="op">(</span>lmu <span class="op">=</span> <span class="st">"loglink"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hatvalues.html">hatvaluesvlm</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">disp</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">**</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">nbparams</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">rank</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">res</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hats</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">hats</span><span class="op">/</span><span class="op">(</span><span class="va">disp</span> <span class="op">*</span> <span class="va">nbparams</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Représentation des distances de Cook</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.003</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistgamma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistgamma-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.52: Distances de Cook pour le modèle Gamma</figcaption></figure>
</div>
</div>
</div>
<p>Puisque nous disposons d’un (très) grand nombre d’observations, nous pouvons nous permettre de retirer les quelques observations fortement influentes (distance de Cook &gt; 0,003 dans notre cas) qui apparaissent dans la <a href="#fig-cookdistgamma">figure&nbsp;<span>8.52</span></a>. Nous retirons ainsi 28 observations et réajustons le modèle.</p>
<div class="cell">
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retirer les valeurs influentes</span></span>
<span><span class="va">dataset2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">cooksd</span><span class="op">&lt;</span><span class="fl">0.003</span><span class="op">)</span></span>
<span><span class="co"># Calcul du modèle avec VGAM</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Duree</span> <span class="op">~</span> <span class="va">Mode</span> <span class="op">+</span> <span class="va">Motif</span> <span class="op">+</span> <span class="va">HeureDep</span> <span class="op">+</span> <span class="va">LogDist</span> <span class="op">+</span></span>
<span>                 <span class="va">ArrondDep</span><span class="op">+</span> <span class="va">MemeArrond</span> <span class="op">+</span> <span class="va">Semaine</span>,</span>
<span>               data <span class="op">=</span> <span class="va">dataset2</span>,</span>
<span>               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/gamma2.html">gamma2</a></span><span class="op">(</span>lmu <span class="op">=</span> <span class="st">"loglink"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous constatons ainsi que dans la nouvelle version du modèle (<a href="#fig-cookdistgamma2">figure&nbsp;<span>8.53</span></a>), aucune valeur particulièrement influente ne semble être présente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">hats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/hatvalues.html">hatvaluesvlm</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">disp</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">**</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">nbparams</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">rank</span></span>
<span><span class="va">cooksd</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">res</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">hats</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">hats</span><span class="op">/</span><span class="op">(</span><span class="va">disp</span> <span class="op">*</span> <span class="va">nbparams</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cook <span class="op">=</span> <span class="va">cooksd</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooksd</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Représentation des distances de Cook</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cook</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistgamma2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistgamma2-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.53: Distances de Cook pour le modèle Gamma (sans les observations fortement influentes)</figcaption></figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle (mu)</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">fitted.values</span></span>
<span><span class="co"># Extraction du paramètre de forme</span></span>
<span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">modele</span><span class="op">@</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Calcul des simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, shape <span class="op">=</span> <span class="va">shape</span>, scale <span class="op">=</span> <span class="va">mu</span><span class="op">/</span><span class="va">shape</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Représentation graphique de 20 simulations</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">mat_sims</span><span class="op">[</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Duree</span>, y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">dataset</span>, bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">..density..</span>, group <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df2</span>, </span>
<span>               fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.22</span>,<span class="fl">0.27</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"durée (minutes)"</span>, y <span class="op">=</span> <span class="st">"densité"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-simdistribgamma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-simdistribgamma-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.54: Comparaison de la distribution originale et de simulations issues du modèle Gamma</figcaption></figure>
</div>
</div>
</div>
<p>Avant de calculer les résidus simulés, nous comparons la distribution originale des données et des simulations issues du modèle. La <a href="#fig-simdistribgamma">figure&nbsp;<span>8.54</span></a> permet de constater que le modèle semble bien capturer l’essentiel de la forme de la variable <em>Y</em> originale. Nous notons un léger décalage entre la pointe des deux distributions, laissant penser que les valeurs prédites par le modèle tendent à être légèrement plus grandes que les valeurs réelles. Pour mieux appréhender ce constat, nous passons à l’analyse des résidus simulés.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># DHarma tests</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">dataset2</span><span class="op">$</span><span class="va">Duree</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">modele</span><span class="op">@</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"résidus simulés"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"effectifs"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gammaresids" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gammaresids-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.55: Distribution des résidus simulés du modèle Gamma</figcaption></figure>
</div>
</div>
</div>
<p>Nul besoin d’un test statistique pour constater que ces résidus (<a href="#fig-gammaresids">figure&nbsp;<span>8.55</span></a>) ne suivent pas une distribution uniforme. Nous observons une nette surreprésentation de résidus à 1 et une nette sous-représentation de résidus à 0. Il y a donc de nombreuses observations dans notre modèle pour lesquelles les simulations sont systématiquement trop fortes et il n’y en a pas assez pour lesquelles les simulations seraient systématiquement trop faibles.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gammaresids2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gammaresids2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.56: Diagnostic général des résidus simulés du modèle Gamma</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-gammaresids2">figure&nbsp;<span>8.56</span></a> indique que le modèle souffre à la fois d’un problème de dispersion (la relation espérance-variance n’est donc pas respectée) et est affecté par des valeurs aberrantes. Considérant que nous avons encore un très grand nombre d’observations, nous faisons le choix de retirer celles pour lesquelles la méthode des résidus simulés estime qu’elles sont des valeurs aberrantes dans au moins 1&nbsp;% des simulations, soit environ 620 observations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sélection des valeurs aberrantes au seuil 0.01</span></span>
<span><span class="va">sim_outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/outliers.html">outliers</a></span><span class="op">(</span><span class="va">sim_res</span>, </span>
<span>                         lowerQuantile <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                         upperQuantile <span class="op">=</span> <span class="fl">0.99</span>, </span>
<span>                         return <span class="op">=</span> <span class="st">"logical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sim_outliers</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sim_outliers
FALSE  TRUE 
22923   623 </code></pre>
</div>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retirer ces observations des données</span></span>
<span><span class="va">dataset3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dataset2</span>, <span class="va">sim_outliers</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Réajuster le modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Duree</span> <span class="op">~</span> <span class="va">Mode</span> <span class="op">+</span> <span class="va">Motif</span> <span class="op">+</span> <span class="va">HeureDep</span> <span class="op">+</span> </span>
<span>                 <span class="va">LogDist</span> <span class="op">+</span> <span class="va">ArrondDep</span> <span class="op">+</span> <span class="va">MemeArrond</span> <span class="op">+</span> <span class="va">Semaine</span>,</span>
<span>               data <span class="op">=</span> <span class="va">dataset3</span>,</span>
<span>               model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               family <span class="op">=</span> <span class="va">gamma2</span><span class="op">)</span></span>
<span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Duree</span> <span class="op">~</span> <span class="va">Mode</span> <span class="op">+</span> <span class="va">Motif</span> <span class="op">+</span> <span class="va">HeureDep</span> <span class="op">+</span> <span class="va">ArrondDep</span> <span class="op">+</span> <span class="va">MemeArrond</span> <span class="op">+</span> <span class="va">Semaine</span>,</span>
<span>               data <span class="op">=</span> <span class="va">dataset3</span>,</span>
<span>               model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               family <span class="op">=</span> <span class="va">gamma2</span><span class="op">)</span></span>
<span><span class="co"># Extraction des prédictions du modèle (mu)</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">fitted.values</span></span>
<span><span class="co"># Extration du paramètre de forme</span></span>
<span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">modele</span><span class="op">@</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Calcul des simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, shape <span class="op">=</span> <span class="va">shape</span>, scale <span class="op">=</span> <span class="va">mu</span><span class="op">/</span><span class="va">shape</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calcul des résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>, </span>
<span>                            observedResponse <span class="op">=</span> <span class="va">dataset3</span><span class="op">$</span><span class="va">Duree</span>,</span>
<span>                            fittedPredictedResponse <span class="op">=</span> <span class="va">modele</span><span class="op">@</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            integerResponse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gammaresids3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-gammaresids3-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.57: Diagnostic général des résidus simulés du modèle Gamma (après suppression d’environ 620 valeurs aberrantes)</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-gammaresids3">figure&nbsp;<span>8.57</span></a> indique que les résidus simulés ne suivent toujours pas une distribution uniforme et qu’il existe une relation prononcée (panneau de droite) entre les résidus et les valeurs prédites. Cette dernière laisse penser que des variables indépendantes importantes ont été omises dans le modèle, ce qui n’est pas surprenant compte tenu du fait que nous ne disposons d’aucune donnée socioéconomique sur les individus ayant réalisé les trajets. Nos données sont également potentiellement affectées par la présence de dépendance spatiale.</p>
<p>Nous pouvons comparer graphiquement la variance observée dans les données et la variance attendue par le modèle. La <a href="#fig-dispgamma">figure&nbsp;<span>8.58</span></a> montre clairement que la variance des données tend à être plus grande qu’attendu quand les temps de trajet sont courts, mais diminue trop vite quand les temps de trajet augmentent. D’autres distributions pourraient être envisagées pour ajuster notre modèle&nbsp;: Lognormal, Weibull, etc.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des prédictions du modèle</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Création d'un DataFrame pour contenir la prédiction et les vraies valeurs</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  mus <span class="op">=</span> <span class="va">mus</span>,</span>
<span>  reals <span class="op">=</span> <span class="va">dataset3</span><span class="op">$</span><span class="va">Duree</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Calcul de l'intervalle de confiance à 95 % selon la distribution Gamma</span></span>
<span><span class="co"># et stockage dans un second DataFrame</span></span>
<span><span class="va">seqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">120</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">modele</span><span class="op">@</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  mus <span class="op">=</span> <span class="va">seqa</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">qgamma</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.025</span>, shape <span class="op">=</span> <span class="va">shape</span>, scale <span class="op">=</span> <span class="va">seqa</span><span class="op">/</span><span class="va">shape</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">qgamma</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, shape <span class="op">=</span> <span class="va">shape</span>, scale <span class="op">=</span> <span class="va">seqa</span><span class="op">/</span><span class="va">shape</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des valeurs réelles et prédites (en rouge)</span></span>
<span><span class="co"># et de leur variance selon le modèle (en noir)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df1</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mus</span>, y <span class="op">=</span> <span class="va">reals</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.22</span>,<span class="fl">0.27</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span>,</span>
<span>                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mus</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"valeurs prédites"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"valeurs réelles"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dispgamma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-dispgamma-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.58: Comparaison de la variance attendue par le modèle et la variance observée dans les données pour le modèle Gamma</figcaption></figure>
</div>
</div>
</div>
<p>À ce stade, nous disposons de suffisamment d’éléments pour douter des résultats du modèle. Nous poursuivons tout de même notre analyse afin d’illustrer l’estimation de la qualité d’ajustement d’un tel modèle et son interprétation.</p>
<p><strong>Analyse de la qualité d’ajustement</strong></p>
<div class="cell">
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement d'un modèle nul</span></span>
<span><span class="va">modele.null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html">vglm</a></span><span class="op">(</span><span class="va">Duree</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>               data <span class="op">=</span> <span class="va">dataset3</span>,</span>
<span>               model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               family <span class="op">=</span> <span class="va">gamma2</span><span class="op">)</span></span>
<span><span class="co"># Calcul des pseudos R2</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele.null</span><span class="op">)</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span> <span class="op">*</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">modele.null</span><span class="op">)</span> <span class="op">*</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modele2</span><span class="op">@</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.05082616

$`McFadden ajuste`
[1] 0.05037842

$`Cox and Snell`
[1] 0.3337405

$Nagelkerke
[1] 0.3338537</code></pre>
</div>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du RMSE</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">preds</span> <span class="op">-</span> <span class="va">dataset3</span><span class="op">$</span><span class="va">Duree</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.36587</code></pre>
</div>
</div>
<p>Le modèle n’explique que 5&nbsp;% de la déviance et obtient des valeurs de R<sup>2</sup> ajusté de McFadden, de Cox et Snell et de Nagelkerke de respectivement 0,05, 0,33 et 0,33. La moyenne de l’erreur quadratique est de seulement 13,4 indiquant que le modèle se trompe en moyenne de seulement 13,4 minutes. La capacité de prédiction du modèle est donc limitée sans être catastrophique.</p>
<p><strong>Interprétation des résultats</strong></p>
<p>Pour rappel, la fonction de lien dans notre modèle est la fonction <code>log</code>. Chaque coefficient représente donc l’effet de l’augmentation d’une unité des variables indépendantes sur le logarithme de l’espérance de notre variable dépendante. Si nous transformons nos coefficients avec la fonction exponentielle (<code>exp</code>), nous obtenons, pour chaque augmentation d’une unité des variables indépendantes, la multiplication de l’espérance de notre variable dépendante.</p>
<p>Puisque nos trajets peuvent provenir de nombreux arrondissements, nous proposons de représenter l’exponentiel de leurs coefficients avec un graphique. Nous pouvons d’ailleurs comparer les exponentiels des coefficients et les effets marginaux pour simplifier l’interprétation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des coefficient du modèle</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">modele</span><span class="op">@</span><span class="va">coefficients</span></span>
<span><span class="co"># Calcul des interval de confiance des coefficients</span></span>
<span><span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span>
<span><span class="co"># Passage en exponentiel</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">coeffs</span>, <span class="va">conf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Extraction des coefficients pour les arrondissements</span></span>
<span><span class="va">dfArrond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"ArrondDep"</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dfArrond</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coeff"</span>, <span class="st">"lower"</span> , <span class="st">"upper"</span><span class="op">)</span></span>
<span><span class="va">dfArrond</span><span class="op">$</span><span class="va">Arrondissement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"ArrondDep"</span> , <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dfArrond</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Graphique des exponentiels des coefficients</span></span>
<span><span class="va">P1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfArrond</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrondissement</span>, <span class="va">coeff</span><span class="op">)</span>, xmin <span class="op">=</span> <span class="va">upper</span>, xmax <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>,</span>
<span>                 height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrondissement</span>, <span class="va">coeff</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">coeff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">upper</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrondissement</span>, <span class="va">coeff</span><span class="op">)</span>,</span>
<span>                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"coeff. : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">coeff</span>,<span class="fl">2</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">3</span>, nudge_x <span class="op">=</span> <span class="fl">0.07</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Coefficient multiplicateur (ref : Ahuntsic-Cartierville)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Exponentiels des coefficients du modèle"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.75</span>,<span class="fl">1.46</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Création d'un DataFrame fictif pour les effets marginaux</span></span>
<span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  LogDist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">LogDist</span><span class="op">)</span>,</span>
<span>  Motif <span class="op">=</span> <span class="st">'education'</span>,</span>
<span>  HeureDep <span class="op">=</span> <span class="st">'7'</span>,</span>
<span>  MemeArrond <span class="op">=</span> <span class="st">'Different'</span>,</span>
<span>  ArrondDep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">ArrondDep</span><span class="op">)</span>,</span>
<span>  Mode <span class="op">=</span> <span class="st">'pieton'</span>,<span class="st">'velo'</span>,<span class="st">'transport collectif'</span>,</span>
<span>  Semaine <span class="op">=</span> <span class="st">'lundi au vendredi'</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Utiliser le modèle pour effectuer des prédictions (échelle log)</span></span>
<span><span class="va">lin_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, <span class="va">dfpred</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mu_lin_pred</span> <span class="op">&lt;-</span> <span class="va">lin_pred</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">se_lin_pred</span> <span class="op">&lt;-</span> <span class="va">lin_pred</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">dfpred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">mu_lin_pred</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">mu_lin_pred</span><span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">se_lin_pred</span><span class="op">)</span>,</span>
<span>  upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">mu_lin_pred</span><span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">se_lin_pred</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dfpred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dfpred2</span>, <span class="va">dfpred</span><span class="op">)</span></span>
<span><span class="co"># Réaliser le graphique des effets marginaux</span></span>
<span><span class="va">P2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfpred2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred</span>, y <span class="op">=</span> <span class="va">ArrondDep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>, xmax <span class="op">=</span> <span class="va">upper</span>, y <span class="op">=</span> <span class="va">ArrondDep</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Temps de déplacement prédit"</span>, y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Prédiction du modèle"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">P1</span>, <span class="va">P2</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-arrondgamma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-arrondgamma-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.59: Effet de l’arrondissement de départ sur les temps de trajet à Montréal”,</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-arrondgamma">figure&nbsp;<span>8.59</span></a> permet de constater que les arrondissements Ville-Marie et Plateau-Mont-Royal se distinguent avec des trajets plus courts (environ 20&nbsp;% plus courts en moyenne que les trajets partant d’Ahuntsic-Cartierville). À l’inverse, Lachine est de loin l’arrondissement avec les trajets les plus longs (25&nbsp;% plus longs en moyenne que les trajets partant d’Ahuntsic-Cartierville).</p>
<p>Nous appliquons la même méthode de visualisation à la variable <em>Heure de départ</em> des trajets.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction des valeurs pour les heures de départ</span></span>
<span><span class="va">dfHeures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"HeureDep"</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dfHeures</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"coeff"</span>, <span class="st">"lower"</span> , <span class="st">"upper"</span><span class="op">)</span></span>
<span><span class="va">dfHeures</span><span class="op">$</span><span class="va">Heure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"HeureDep"</span> , <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dfHeures</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Rajouter des 0 et des h pour de jolies légendes</span></span>
<span><span class="va">dfHeures</span><span class="op">$</span><span class="va">Heure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">dfHeures</span><span class="op">$</span><span class="va">Heure</span>,<span class="st">"h"</span>, sep<span class="op">=</span><span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Afficher le graphique</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfHeures</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Heure</span>, ymin <span class="op">=</span> <span class="va">upper</span>, ymax <span class="op">=</span> <span class="va">lower</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Heure</span>, y <span class="op">=</span> <span class="va">coeff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">upper</span>, x <span class="op">=</span> <span class="va">Heure</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">coeff</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, nudge_y <span class="op">=</span> <span class="fl">0.07</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Coefficient multiplicateur (ref : 7 h)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-heuresgamma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-heuresgamma-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.60: Effet de l’heure de départ sur les temps de trajet à Montréal”</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons ainsi observer, à la <a href="#fig-heuresgamma">figure&nbsp;<span>8.60</span></a>, que les trajets effectués à 10&nbsp;h, 11&nbsp;h et 12&nbsp;h sont les plus longs de la journée, entre 30 et 40&nbsp;% plus longs que ceux effectués à 7&nbsp;h et 8&nbsp;h qui constituent les trajets les plus courts.</p>
<p>Le reste des coefficients (ainsi que le paramètre de forme) sont affichés dans le <a href="#tbl-coeffsgamma">tableau&nbsp;<span>8.35</span></a>. Comparativement à un trajet effectué à pied, un trajet en transport en commun dure en moyenne 52&nbsp;% plus longtemps (1,53 fois plus long), alors que les déplacements en véhicule individuel et en vélo sont respectivement 28&nbsp;% et 23&nbsp;% moins longs. Aucune différence n’est observable entre les déplacements effectués en semaine ou pendant la fin de semaine.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffsgamma" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.35: Résultats pour le modèle GLM Gamma</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 21%">
<col style="width: 22%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">Exp(Coeff.)</th>
<th style="text-align: right;">Val.p</th>
<th style="text-align: right;">IC 2,5 % exp(Coeff.)</th>
<th style="text-align: right;">IC 97,5 % exp(Coeff.)</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">2,926</td>
<td style="text-align: right;">18,661</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">14,939</td>
<td style="text-align: right;">23,313</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Mode</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : pieton</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">transport collectif</td>
<td style="text-align: right;">0,424</td>
<td style="text-align: right;">1,529</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,490</td>
<td style="text-align: right;">1,568</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vehicule individuel</td>
<td style="text-align: right;">-0,319</td>
<td style="text-align: right;">0,727</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,709</td>
<td style="text-align: right;">0,746</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">velo</td>
<td style="text-align: right;">-0,257</td>
<td style="text-align: right;">0,773</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,754</td>
<td style="text-align: right;">0,793</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Motif</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ref : education</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loisir</td>
<td style="text-align: right;">-0,013</td>
<td style="text-align: right;">0,987</td>
<td style="text-align: right;">0,451</td>
<td style="text-align: right;">0,954</td>
<td style="text-align: right;">1,021</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">magasinage</td>
<td style="text-align: right;">-0,109</td>
<td style="text-align: right;">0,897</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,867</td>
<td style="text-align: right;">0,928</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">travail</td>
<td style="text-align: right;">-0,067</td>
<td style="text-align: right;">0,936</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,908</td>
<td style="text-align: right;">0,965</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">LogDist</td>
<td style="text-align: right;">0,335</td>
<td style="text-align: right;">1,398</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,383</td>
<td style="text-align: right;">1,413</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>MemeArrond</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ref : Different</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Meme</td>
<td style="text-align: right;">-0,036</td>
<td style="text-align: right;">0,964</td>
<td style="text-align: right;">0,001</td>
<td style="text-align: right;">0,944</td>
<td style="text-align: right;">0,985</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Semaine</em></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ref : lundi au vendredi</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
<td style="text-align: right;">–</td>
</tr>
<tr class="even">
<td style="text-align: left;">samedi et dimanche</td>
<td style="text-align: right;">0,003</td>
<td style="text-align: right;">1,003</td>
<td style="text-align: right;">0,779</td>
<td style="text-align: right;">0,982</td>
<td style="text-align: right;">1,024</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">shape</td>
<td style="text-align: right;">1,147</td>
<td style="text-align: right;">3,150</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">3,096</td>
<td style="text-align: right;">3,206</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Les déplacements ayant comme motif le magasinage et le travail ont tendance à être en moyenne plus courts de 11&nbsp;% et 6&nbsp;% respectivement, comparativement aux déplacements effectués pour l’éducation ou le loisir (différence non significative entre loisir et éducation). Sans surprise, la distance entre le point de départ et d’arrivée du trajet (<code>LogDist</code>) affecte sa durée de façon positive. Considérant qu’il est difficile d’interpréter des log de kilomètre (dû à une transformation de la variable originale), nous représentons l’effet de cette variable avec la prédiction du modèle à la figure. Nous utilisons pour cela le cas suivant: déplacement à pied à 7&nbsp;h en semaine, ayant pour motif éducation, dont le point de départ se situe dans l’arrondissement Ahuntsic et donc le point d’arrivée est dans un autre arrondissement. Seule la distance du trajet varie de 1 à 40&nbsp;km. À titre de comparaison, nous représentons aussi, pour les mêmes conditions, le cas d’une personne à vélo (en vert) et d’une personne utilisant le transport en commun (en bleu). Les lignes en pointillés représentent les intervalles de confiance à 95&nbsp;% des prédictions (<a href="#fig-distancegamma">figure&nbsp;<span>8.61</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Création d'un DataFrame fictif pour la prédiction</span></span>
<span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  Dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">40</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  Motif <span class="op">=</span> <span class="st">'education'</span>,</span>
<span>  HeureDep <span class="op">=</span> <span class="st">'7'</span>,</span>
<span>  MemeArrond <span class="op">=</span> <span class="st">'Different'</span>,</span>
<span>  ArrondDep <span class="op">=</span> <span class="st">'Ahuntsic-Cartierville'</span>,</span>
<span>  Mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'pieton'</span>,<span class="st">'velo'</span>,<span class="st">'transport collectif'</span><span class="op">)</span>,</span>
<span>  Semaine <span class="op">=</span> <span class="st">'lundi au vendredi'</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Mise en log de la variable de distance</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">LogDist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">Dist</span><span class="op">)</span></span>
<span><span class="co"># Calcul des prédictions et de leur erreur standard (échelle log)</span></span>
<span><span class="va">lin_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele</span>, <span class="va">dfpred</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Calcul des intervalles de confiance et mise en exponentielle des prédictions</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">lin_pred</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">lin_pred</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">lin_pred</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">lin_pred</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">lin_pred</span><span class="op">$</span><span class="va">se.fit</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Ajoutons les accents pour le graphiques</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">Mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">Mode</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">Mode2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">Mode</span> <span class="op">==</span> <span class="st">"pieton"</span> <span class="op">~</span> <span class="st">"piéton"</span>,</span>
<span>                         <span class="va">dfpred</span><span class="op">$</span><span class="va">Mode</span> <span class="op">==</span> <span class="st">"velo"</span> <span class="op">~</span> <span class="st">"vélo"</span>,</span>
<span>                         <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">dfpred</span><span class="op">$</span><span class="va">Mode</span><span class="op">)</span></span>
<span><span class="co"># Affichage des résultats</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfpred</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dist</span>, y <span class="op">=</span> <span class="va">lower</span>, color <span class="op">=</span> <span class="va">Mode2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dist</span>, y <span class="op">=</span> <span class="va">upper</span>, color <span class="op">=</span> <span class="va">Mode2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Dist</span>, y <span class="op">=</span> <span class="va">pred</span>, color <span class="op">=</span> <span class="va">Mode2</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"temps de trajet prédit (minutes)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"distance à vol d'oiseau (km)"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-distancegamma" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-distancegamma-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.61: Effet de la distance à vol d’oiseau sur les temps de trajet à Montréal</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-0844" class="level3" data-number="8.4.4"><h3 data-number="8.4.4" class="anchored" data-anchor-id="sec-0844">
<span class="header-section-number">8.4.4</span> Modèle GLM avec une distribution bêta</h3>
<p>Pour rappel, la distribution bêta est une distribution définie sur l’intervalle <span class="math inline">\([0,1]\)</span>, elle est donc particulièrement utile pour décrire des proportions, des pourcentages ou des probabilités. Dans la <a href="02-univarie.html#sec-024316">section&nbsp;<span>2.4.3.16</span></a> sur les distributions, nous avons présenté la paramétrisation classique de la distribution avec les paramètres <span class="math inline">\(a\)</span> et <span class="math inline">\(b\)</span> étant tous les deux des paramètres de forme. Ces deux paramètres n’ont pas d’interprétation pratique, mais il est possible (comme pour la distribution Gamma) de reparamétrer la distribution bêta avec un paramètre de centralité (espérance) et de dispersion.</p>
<p>Notez également que si la distribution bêta autorise la présence de 0 et de 1, le modèle GLM utilisant cette distribution doit les exclure des valeurs possibles s’il utilise la fonction de lien logistique. En effet, cette fonction à la forme suivante&nbsp;:</p>
<p><span id="eq-logitbeta"><span class="math display">\[
logit(x) = log(\frac{x}{1-x})\\
\tag{8.24}\]</span></span></p>
<p>Nous pouvons constater que si <span class="math inline">\(x = 1\)</span>, alors le dénominateur de la fraction est 0, or il est impossible de diviser par 0. Si <span class="math inline">\(x = 0\)</span>, alors nous obtenons <span class="math inline">\(log(0)\)</span> ce qui est également impossible au plan mathématique.</p>
<p>Dans le cas de figure où des 0 et/ou des 1 sont présents dans les données, quatre options sont possibles pour contourner le problème&nbsp;:</p>
<ol type="1">
<li>Si les observations à 0 ou 1 sont très peu nombreuses, il est envisageable de les retirer des données.</li>
<li>Si la variable mesurée le permet, il est possible de remplacer les 0 et les 1 par des valeurs très proches (0,0001 et 0,9999 par exemple) sans dénaturer excessivement les données initiales.</li>
<li>Plutôt que d’utiliser une valeur arbitraire, <span class="citation" data-cites="smithson2006better">Smithson et Verkuilen (<a href="references.html#ref-smithson2006better" role="doc-biblioref">2006</a>)</span> recommandent de recalculer la variable <span class="math inline">\(Y \in [0;1]\)</span> avec la formule <a href="#eq-correctbeta">équation&nbsp;<span>8.25</span></a>;</li>
<li>Employer un modèle Hurdle à trois équations, la première prédisant la probabilité d’observer <span class="math inline">\(Y &gt; 0\)</span>, la seconde, la probabilité d’observer <span class="math inline">\(Y = 1\)</span> et la dernière prédisant les valeurs de <em>Y</em> pour <span class="math inline">\(0&gt;Y&gt;1\)</span>.</li>
</ol>
<p><span id="eq-correctbeta"><span class="math display">\[
Y' = \frac{Y(N-1)+s}{N}
\tag{8.25}\]</span></span></p>
<p>Avec <em>N</em> le nombre d’observations, <em>Y’</em> la variable <em>Y</em> transformée et <em>s</em> une constante. Plus cette dernière est élevée, plus la variable <em>Y’</em> a des valeurs éloignées de 0 et 1. la valeur de 0,5 est recommandée par les auteurs.</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Reparamétrisation de la distribution bêta</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Pour une distribution bêta telle que définie par <span class="math inline">\(Y \sim Beta(a,b)\)</span>, l’espérance de cette distribution et sa variance sont données par :</p>
<p><span id="eq-glm20"><span class="math display">\[
\begin{aligned}
&amp;E(Y) = \frac{a}{a+b} \\
&amp;Var(Y) = \frac{a \times b}{(a+b)^2(a+b+1)}\\
\end{aligned}
\tag{8.26}\]</span></span></p>
<p>Pour reparamétrer cette distribution, nous définissons un nouveau paramètre <span class="math inline">\(\phi\)</span> (phi) tel que:</p>
<p><span id="eq-glm21"><span class="math display">\[
\begin{aligned}
&amp;a = \phi * E(Y) \\
&amp;b = \phi - a \\
&amp;Var(Y) = \frac{E(Y) \times (1-E(Y))}{1+\phi}
\end{aligned}
\tag{8.27}\]</span></span></p>
<p>De cette manière, il est possible d’exprimer la distribution bêta en fonction de son espérance (sa valeur attendue, ce qui s’interprète approximativement comme une moyenne) et d’un paramètre <span class="math inline">\(\phi\)</span> intervenant dans le calcul de sa variance. Vous noterez d’ailleurs que la variance de cette distribution dépend de sa moyenne, impliquant à nouveau une hétéroscédasticité intrinsèque.</p>
</div>
</div>
<p>Pour résumer, nous nous retrouvons donc avec un modèle qui prédit l’espérance d’une distribution bêta avec une fonction de lien logistique. La variance de cette distribution est fonction de cette moyenne et d’un second paramètre <span class="math inline">\(\phi\)</span>. Ces informations sont résumées dans la fiche d’identité du modèle (<a href="#tbl-betaentity">tableau&nbsp;<span>8.36</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-betaentity" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.36: Carte d’identité du modèle bêta</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">Type de variable dépendante</td>
<td style="text-align: left;">Variable continue dans l’intervalle <span class="math inline">\(]0,1[\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Distribution utilisée</td>
<td style="text-align: left;">Student</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Formulation</td>
<td style="text-align: left;">
<span class="math inline">\(Y \sim Beta(\mu,\phi)\)</span> <span class="math inline">\(g(\mu) = \beta_0 + \beta X\)</span> <span class="math inline">\(g(x) = log(\frac{x}{1-x})\)</span>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction de lien</td>
<td style="text-align: left;">log</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Paramètre modélisé</td>
<td style="text-align: left;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Paramètres à estimer</td>
<td style="text-align: left;">
<span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta\)</span>, et <span class="math inline">\(\phi\)</span>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Conditions d’application</td>
<td style="text-align: left;"><span class="math inline">\(Variance = \frac{\mu \times (1-\mu)}{1+\phi}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-08441" class="level4" data-number="8.4.4.1"><h4 data-number="8.4.4.1" class="anchored" data-anchor-id="sec-08441">
<span class="header-section-number">8.4.4.1</span> Conditions d’application</h4>
<p>Comme pour un modèle Gamma, la seule condition d’application spécifique à un modèle avec distribution bêta est que la variance des résidus suit la forme attendue par la distribution bêta.</p>
</section><section id="sec-08442" class="level4" data-number="8.4.4.2"><h4 data-number="8.4.4.2" class="anchored" data-anchor-id="sec-08442">
<span class="header-section-number">8.4.4.2</span> Interprétation des coefficients</h4>
<p>Puisque le modèle utilise la fonction de lien logistique, les exponentiels des coefficients <span class="math inline">\(\beta\)</span> du modèle peuvent être interprétés comme des rapports de cotes (voir la <a href="#sec-0821">section&nbsp;<span>8.2.1</span></a> sur le modèle GLM binomial). Admettons ainsi que nous avons obtenu pour une variable indépendante <span class="math inline">\(X_1\)</span> le coefficient <span class="math inline">\(\beta_1\)</span> de 0,12. Puisque le coefficient est positif, cela signifie qu’une augmentation de <span class="math inline">\(X_1\)</span> conduit à une augmentation de l’espérance de <em>Y</em>. L’exponentiel de 0,12 est 1,13, ce qui signifie qu’une augmentation d’une unité de <span class="math inline">\(X_1\)</span> multiplie par 1,13 (augmente de 13&nbsp;%) les chances d’une augmentation de <em>Y</em>. <strong>Pour ce type de modèle, il est particulièrement important de calculer ses prédictions afin d’en faciliter l’interprétation</strong>.</p>
</section><section id="sec-08443" class="level4" data-number="8.4.4.3"><h4 data-number="8.4.4.3" class="anchored" data-anchor-id="sec-08443">
<span class="header-section-number">8.4.4.3</span> Exemple appliqué dans R</h4>
<p>Afin de présenter le modèle GLM avec une distribution bêta, nous utilisons un jeu de données que nous avons construit pour l’île de Montréal. Nous nous intéressons à la question des îlots de chaleur urbains au niveau des aires de diffusion (AD – entités spatiales du recensement canadien comprenant entre 400 et 700 habitants). Pour cela, nous avons calculé dans chaque AD le pourcentage de sa surface classifiée comme îlot de chaleur dans la carte des îlots de <a href="https://www.donneesquebec.ca/recherche/fr/dataset/ilots-de-chaleur-fraicheur-urbains-et-temperature-de-surface">chaleur/fraicheur</a> réalisée par l’INSPQ et le CERFO.</p>
<p>La question que nous nous posons est la suivante&nbsp;: les populations vulnérables socioéconomiquement et/ou physiologiquement sont-elles systématiquement plus exposées à la nuisance que représentent les îlots de chaleur? Cette question se rattache donc au champ de la recherche sur l’équité environnementale. Plusieurs études se sont d’ailleurs déjà penchées sur la question des îlots de chaleur abordée sous l’angle de l’équité environnementale <span class="citation" data-cites="harlan2007shade sanchez2019cooling huang2011everyone">(<a href="references.html#ref-harlan2007shade" role="doc-biblioref">Harlan et al. 2007</a>; <a href="references.html#ref-sanchez2019cooling" role="doc-biblioref">Sanchez et Reames 2019</a>; <a href="references.html#ref-huang2011everyone" role="doc-biblioref">Huang, Zhou et Cadenasso 2011</a>)</span>. Nous modélisons donc pour chaque AD (n&nbsp;=&nbsp;3&nbsp;158) de l’île de Montréal la proportion de sa surface couverte par des îlots de chaleur. Nos variables indépendantes sont divisées en deux catégories&nbsp;: variables environnementales et variables socio-économiques. Les premières sont des variables de contrôle, il s’agit de la densité de végétation dans l’AD (ajoutée avec une polynomiale d’ordre deux) et de l’arrondissement dans lequel elle se situe. Ces deux paramètres affectent directement les chances d’observer des îlots de chaleur, mais nous souhaitons isoler leurs effets (toutes choses étant égales par ailleurs) de ceux des variables socio-économiques. Ces dernières ont pour objectif de cibler les populations vulnérables sur le plan physiologique (personnes âgées et enfants de moins de 14 ans) ou socio-économique (minorités visibles et faible revenu). L’ensemble de ces variables sont présentées dans le <a href="#tbl-variablebeta">tableau&nbsp;<span>8.37</span></a>. Notez que, puisque le modèle avec distribution bêta ne peut pas prendre en compte des valeurs exactes de 1 ou 0, nous les avons remplacées respectivement par 0,99 et 0,01. Cette légère modification n’altère que marginalement les données, surtout si nous considérons qu’elles sont agrégées au niveau des AD et proviennent originalement d’imagerie satellitaire.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-variablebeta" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.37: Variables indépendantes utilisées dans le modèle bêta</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 22%">
<col style="width: 13%">
<col style="width: 50%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Nom de la variable</th>
<th style="text-align: left;">Signification</th>
<th style="text-align: left;">Type de variable</th>
<th style="text-align: left;">Mesure</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A65PlusPct</td>
<td style="text-align: left;">Population de 65 ans et plus</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de la population ayant 65 ans et plus</td>
</tr>
<tr class="even">
<td style="text-align: left;">A014Pct</td>
<td style="text-align: left;">Population de 14 ans et moins</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de la population ayant 14 ans et moins</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PopFRPct</td>
<td style="text-align: left;">Population à faible revenu</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de la population à faible revenu</td>
</tr>
<tr class="even">
<td style="text-align: left;">PopMVPct</td>
<td style="text-align: left;">Minorités visibles</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de la population faisant partie des minorités visibles</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VegPct</td>
<td style="text-align: left;">Végétation</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Pourcentage de la surface de l’AD couverte par de la végétation</td>
</tr>
<tr class="even">
<td style="text-align: left;">Arrond</td>
<td style="text-align: left;">Arrondissements</td>
<td style="text-align: left;">Variable continue</td>
<td style="text-align: left;">Arrondissement de l’Île de Montréal</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Vérification des conditions d’application</strong></p>
<p>Sans surprise, nous commençons par charger nos données et nous nous assurons de l’absence de multicolinéarité excessive entre nos variables indépendantes.</p>
<div class="cell">
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Chargement des données</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/glm/data_chaleur.csv"</span>, fileEncoding <span class="op">=</span> <span class="st">"utf8"</span><span class="op">)</span></span>
<span><span class="co">## Calcul des valeurs de vif</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">prt_veg</span>, degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              GVIF Df GVIF^(1/(2*Df))
A65Pct                    1.609917  1        1.268825
A014Pct                   2.206072  1        1.485285
PopFRPct                  2.162036  1        1.470386
PopMVPct                  2.370269  1        1.539568
poly(prt_veg, degree = 2) 2.619552  2        1.272204
Arrond                    7.899208 32        1.032820</code></pre>
</div>
</div>
<p>La seule variable semblant poser un problème de multicolinéarité est la variable <code>Arrond</code>. Cependant, du fait de sa nature multinomiale, elle regroupe en réalité 32 coefficients (voir la colonne <code>Df</code>). Il faut donc utiliser la règle habituelle de 5 sur le carré de la troisième colonne (<code>GVIF^(1/(2*Df))</code>) du tableau <span class="citation" data-cites="fox1992generalized">(<a href="references.html#ref-fox1992generalized" role="doc-biblioref">Fox et Monette 1992</a>)</span>, soit <code>1,032820^2 = 1,066717</code>, ce qui est bien inférieur à la limite de 5. Nous n’avons donc pas de problème de multicolinéarité excessive. Nous pouvons passer au calcul des distances de Cook. Pour ajuster notre modèle, nous utilisons le <em>package</em> <code>mgcv</code> et la fonction <code>gam</code> avec le paramètre <code>family = betar(link = "logit")</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement d'une première version du modèle</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>                <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">prt_veg</span>, degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cooksd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des distances de Cook</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cooksd</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistbeta" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistbeta-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.62: Distances de Cook pour le modèle GLM bêta</figcaption></figure>
</div>
</div>
</div>
<p>Nous pouvons observer à la <a href="#fig-cookdistbeta">figure&nbsp;<span>8.62</span></a> que seulement deux observations se distinguent très nettement des autres. Nous les isolons donc dans un premier temps.</p>
<div class="cell">
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cas_etranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">df</span><span class="op">$</span><span class="va">cooksd</span> <span class="op">&gt;=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etranges</span><span class="op">[</span>,<span class="fl">23</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">cas_etranges</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A014Pct A65Pct PopFRPct PopMVPct      Km2    HabKm2 Shape_Leng Shape_Area
1666   11.78  26.77     6.38    11.65 6.458460   72.3083  21153.055  6458456.6
2803   15.54  31.07    24.17    52.17 0.134013 5283.0879   1651.471   134012.5
       prt_hot  prt_veg dist_cntr     Arrond  hot
1666  1.824483 90.11691 29.181345 Senneville 0.02
2803 40.117994 60.15745  4.178823  Westmount 0.40</code></pre>
</div>
</div>
<p>Ces deux observations n’ont pas de points communs marqués, et ne semblent pas avoir de valeurs particulièrement fortes sur les différentes variables indépendantes ou la variable dépendante. Nous décidons donc de les supprimer et de recalculer les distances de Cook.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Suppression des deux observations très influentes</span></span>
<span><span class="va">dataset2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">df</span><span class="op">$</span><span class="va">cooksd</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">modele2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>                <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">prt_veg</span> <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dataset2</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, methode <span class="op">=</span> <span class="st">"REML"</span><span class="op">)</span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cooksd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele2</span><span class="op">)</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dataset2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des distances de Cook</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cooksd</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistbeta2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistbeta2-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.63: Distances de Cook pour le modèle GLM bêta (suppression de deux observations influentes)</figcaption></figure>
</div>
</div>
</div>
<p>Après réajustement, nous constatons à nouveau qu’une observation est <strong>extrêmement</strong> éloignée des autres (<a href="#fig-cookdistbeta2">figure&nbsp;<span>8.63</span></a>). Nous la retirons également, car cette différence est si forte qu’elle risque de polluer le modèle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Suppression de l'observation très étonnante</span></span>
<span><span class="va">dataset3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dataset2</span>, <span class="va">df2</span><span class="op">$</span><span class="va">cooksd</span><span class="op">&lt;</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">cooksd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Réajustement du modèle</span></span>
<span><span class="va">modele3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>                <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">prt_veg</span> <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dataset3</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, methode <span class="op">=</span> <span class="st">"REML"</span><span class="op">)</span></span>
<span><span class="co"># Calcul des distances de Cook</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  cooksd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span>,</span>
<span>  oid <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Affichage des distances de Cook</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oid</span>, y <span class="op">=</span> <span class="va">cooksd</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Distance de Cook"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cookdistbeta3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-cookdistbeta3-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.64: Distances de Cook pour le modèle GLM bêta (suppression de trois observations influentes)</figcaption></figure>
</div>
</div>
</div>
<p>Tout semble aller pour le mieux après ce second passage (<a href="#fig-cookdistbeta3">figure&nbsp;<span>8.64</span></a>). Si nous avions continué à observer des valeurs aussi influentes, nous aurions dû commencer à sérieusement questionner nos données ou notre modèle. La prochaine étape du diagnostic est donc l’analyse des résidus simulés.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction de phi</span></span>
<span><span class="va">modele3</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="va">family</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Beta regression(14.612)"</code></pre>
</div>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">14.612</span></span>
<span><span class="co"># Réalisation des simulations</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="va">modele3</span><span class="op">$</span><span class="va">fitted.values</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mus</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">mus</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">*</span> <span class="va">phi</span></span>
<span>  <span class="va">q</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">mu</span><span class="op">)</span><span class="op">*</span><span class="va">phi</span></span>
<span>  <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nsim</span>, shape1 <span class="op">=</span> <span class="va">p</span>, shape2 <span class="op">=</span> <span class="va">q</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">mat_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">cols</span><span class="op">)</span></span>
<span><span class="co"># Calcul des résidus simulés</span></span>
<span><span class="va">sim_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html">createDHARMa</a></span><span class="op">(</span>simulatedResponse <span class="op">=</span> <span class="va">mat_sims</span>,</span>
<span>                           observedResponse <span class="op">=</span> <span class="va">dataset3</span><span class="op">$</span><span class="va">hot</span>,</span>
<span>                           fittedPredictedResponse <span class="op">=</span> <span class="va">modele3</span><span class="op">$</span><span class="va">fitted.values</span>,</span>
<span>                           integerResponse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residsimbeta" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-residsimbeta-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.65: Diagnostic général des résidus simulés du modèle bêta</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-residsimbeta">figure&nbsp;<span>8.65</span></a> indique que les résidus suivent bien une distribution uniforme. Le test des valeurs aberrantes n’est pas significatif au seuil de 0,01 (nous retenons ce seuil considérant le grand nombre de simulations et d’observations de notre jeu de données), nous décidons donc de ne pas supprimer davantage d’observations. Le panneau de droite indique une relation non linéaire instable, mais essentiellement centrée sur la ligne droite attendue. Pour plus de détails, nous calculons ces résidus simulés avec chacune des variables indépendantes.</p>
<div class="cell">
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Préparons un plot multiple</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A65Pct"</span>, <span class="st">"A014Pct"</span>, <span class="st">"PopFRPct"</span>, <span class="st">"PopMVPct"</span>, <span class="st">"prt_veg"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="va">vars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html">plotResiduals</a></span><span class="op">(</span><span class="va">sim_res</span>, <span class="va">dataset3</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="va">v</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html">plotResiduals</a></span><span class="op">(</span><span class="va">sim_res</span>, <span class="va">dataset3</span><span class="op">[[</span><span class="st">"prt_veg"</span><span class="op">]</span><span class="op">]</span><span class="op">**</span><span class="fl">2</span>, xlab <span class="op">=</span> <span class="st">"prt_veg^2"</span>, main <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-residsimbeta2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/residsimbeta2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.66: Relation entre chaque variable indépendante et les résidus simulés du modèle bêta</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-residsimbeta2">figure&nbsp;<span>8.66</span></a> indique des relations marginales et négligeables entre nos variables indépendantes et nos résidus simulés. Concernant la variable <code>Arrond</code> (<a href="#fig-residsimbeta3">figure&nbsp;<span>8.67</span></a>), nous observons une situation plus particulière. Pour quelques arrondissements, les résidus simulés sont nettement plus forts ou plus faibles. Notre hypothèse est que cet effet est provoqué par l’introduction de cette variable dans notre modèle comme un effet fixe alors que sa nature devrait nous inciter à l’introduire comme un effet aléatoire. Nous n’avons pas encore présenté ces concepts ici, mais nous le ferons dans le <a href="09-GLMM.html">chapitre&nbsp;<span>9</span></a>. En attendant, nous conservons le modèle tel quel et passons à l’analyse de sa qualité d’ajustement.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  resid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">sim_res</span><span class="op">)</span>,</span>
<span>  Arrond <span class="op">=</span> <span class="va">dataset3</span><span class="op">$</span><span class="va">Arrond</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Arrond</span>, y <span class="op">=</span> <span class="va">resid</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Arrondissements"</span>, y <span class="op">=</span> <span class="st">"Résidus simulés"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residsimbeta3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-residsimbeta3-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.67: Relation entre la variable Arrondissement et les résidus simulés du modèle bêta</figcaption></figure>
</div>
</div>
</div>
<p><strong>Analyse de la qualité d’ajustement</strong></p>
<p>Dans un premier temps, nous comparons la distribution originale des données à des simulations issues du modèle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Extraction de 20 simulations</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">mat_sims</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hot</span>, y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">dataset3</span>, bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">..density..</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df3</span>,</span>
<span>               fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"résidus simulés"</span>, y <span class="op">=</span> <span class="st">"densité"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residsimbeta4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-residsimbeta4-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.68: Comparaison entre la distribution originale et les simulations issues du modèle</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons à la <a href="#fig-residsimbeta4">figure&nbsp;<span>8.68</span></a> que le modèle est parvenu à reproduire la forme générale de la distribution originale&nbsp;: un plus grand nombre de valeurs proches de zéro, suivies d’une répartition presque homogène dans les valeurs comprises entre 0,15 et 0,8, suivies par un plus faible nombre de valeurs quand <em>Y</em> est supérieur à 0,8. Il semble en revanche manquer un certain nombre de valeurs extrêmes proches de 0 (absence d’îlot de chaleur) et proches de 1 (couverture à 100&nbsp;% par des îlots de chaleur).</p>
<div class="cell">
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul des pseudo R2</span></span>
<span><span class="fu">rsqs</span><span class="op">(</span>loglike.full <span class="op">=</span> <span class="va">modele3</span><span class="op">$</span><span class="va">deviance</span><span class="op">/</span><span class="op">-</span><span class="fl">2</span>,</span>
<span>     loglike.null <span class="op">=</span> <span class="va">modele3</span><span class="op">$</span><span class="va">null.deviance</span><span class="op">/</span><span class="op">-</span><span class="fl">2</span>,</span>
<span>     full.deviance <span class="op">=</span> <span class="va">modele3</span><span class="op">$</span><span class="va">deviance</span>,</span>
<span>     null.deviance <span class="op">=</span> <span class="va">modele3</span><span class="op">$</span><span class="va">null.deviance</span>,</span>
<span>     nb.params <span class="op">=</span> <span class="va">modele3</span><span class="op">$</span><span class="va">rank</span>,</span>
<span>     n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`deviance expliquee`
[1] 0.9017396

$`McFadden ajuste`
[1] 0.8992329

$`Cox and Snell`
[1] 0.999828

$Nagelkerke
[1] 0.9998949</code></pre>
</div>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcul du RMSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">modele3</span><span class="op">$</span><span class="va">fitted.values</span> <span class="op">-</span> <span class="va">modele3</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1025719</code></pre>
</div>
</div>
<p>Le modèle parvient à expliquer 90&nbsp;% de la déviance totale et obtient des pseudo-R<sup>2</sup> très élevés. Il obtient cependant un RMSE de 0,10 soit une erreur quadratique moyenne de 10&nbsp;% dans la prédiction, ce qui est tout de même important. Le modèle ne semble pas souffrir particulièrement de sur-ajustement comme les pseudo-R<sup>2</sup> auraient pu nous le laisser penser.</p>
<p>L’ensemble des coefficients du modèle sont accessibles via la fonction <code>summary</code>. Pour rappel, il est nécessaire de les convertir avec la fonction exponentielle pour pouvoir les interpréter en termes de rapport de cotes. À nouveau, nous proposons de construire dans un premier temps une figure pour observer l’effet des arrondissements.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Identifier les coefficients pour les arrondissements</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Arrond"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Extraire les coefficients et les erreurs standards</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="va">modele3</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">test</span><span class="op">]</span></span>
<span><span class="va">err.std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele3</span><span class="op">)</span><span class="op">$</span><span class="va">se</span><span class="op">[</span><span class="va">test</span><span class="op">]</span></span>
<span><span class="co"># Créer un DataFrame avec les rapports de cote et les intervalles de confiance</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Arrond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"Arrond"</span> , <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  coeffs <span class="op">=</span> <span class="va">coeffs</span>,</span>
<span>  err.std <span class="op">=</span> <span class="va">err.std</span>,</span>
<span>  RC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">)</span>,</span>
<span>  lowerRC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">err.std</span><span class="op">)</span>,</span>
<span>  upperRC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coeffs</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">err.std</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Retrouver l'arrondissement de référence</span></span>
<span><span class="va">allArrond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">Arrond</span><span class="op">)</span></span>
<span><span class="va">refArrond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">allArrond</span>, <span class="va">df</span><span class="op">$</span><span class="va">Arrond</span><span class="op">)</span></span>
<span><span class="co"># Créer le graphique</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lowerRC</span>, xmax <span class="op">=</span> <span class="va">upperRC</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrond</span>,<span class="va">RC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RC</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrond</span>,<span class="va">RC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">upperRC</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrond</span>, <span class="va">RC</span><span class="op">)</span>, </span>
<span>                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"RC : "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">RC</span>,<span class="fl">2</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, nudge_x <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Rapport de cote (rouge : "</span>, <span class="va">refArrond</span>,<span class="st">')'</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Arrondissement"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-betaArrond" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-betaArrond-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.69: Rapports de cote pour les arrondissements dans le modèle bêta</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons ainsi que seuls quelques arrondissements ont une différence d’exposition aux îlots de chaleur significative au seuil de 0,05 comparativement à Ahuntsic-Cartierville (<a href="#fig-betaArrond">figure&nbsp;<span>8.69</span></a>). Pour l’essentiel, il s’agit d’arrondissements pour lesquels nous observons des rapports de cotes supérieurs à 1. Verdun, Lasalle et le Plateau-Mont-Royal sont les arrondissements les plus touchés avec des chances d’observer des niveaux supérieurs de densité d’îlots de chaleur multipliés par 3,19, 2,89 et 2,74. Le reste des coefficients sont affichés dans le <a href="#tbl-coeffsbeta">tableau&nbsp;<span>8.38</span></a>.</p>
<p>Nous notons ainsi que le seul groupe associé avec une augmentation significative des chances d’observer une augmentation de la densité d’îlot de chaleur est le groupe des personnes à faible revenu (1,4&nbsp;% de chance supplémentaire à chaque augmentation d’un point de pourcentage de la variable indépendante). Pour mieux cerner la taille de cet effet, nous représentons l’effet marginal de ce coefficient en maintenant toutes les autres variables à leur moyenne. Nous calculons également ces effets marginaux pour trois arrondissements différents&nbsp;: Verdun (RC le plus fort), Ahuntsic-Cartierville (la référence) et Dollard-des-Ormeaux (RC le plus faible). Nous réalisons également un second graphique pour visualiser l’effet non linéaire de la variable <em>pourcentage de végétation</em>. La <a href="#fig-betaFR">figure&nbsp;<span>8.70</span></a> nous indique ainsi que le rôle de l’arrondissement est plus important que celui du pourcentage de personnes à faible revenu. Cependant, nous constatons que passer de 0&nbsp;% de personnes à faible revenu dans une AD à 75&nbsp;% est associé avec une multiplication de la surface couverte par des îlots de chaleur par environ 1,5 (toutes choses égales par ailleurs). Le rôle de la végétation dans la réduction de la surface des îlots de chaleur est très net et non linéaire. L’essentiel de la réduction est observé entre 0 et 50&nbsp;% de végétation dans une AD, au-delà de ce seuil, la réduction des îlots de chaleur par la végétation est moins flagrante. Il semblerait donc exister à Montréal une forme d’iniquité systématique pour les populations à faible revenu, qui seraient davantage exposées aux îlots de chaleur. Cependant, compte tenu de la dépendance spatiale et de l’hétéroscésadicité observées plus haut, des ajustements devraient être apportés au modèle pour confirmer ou infirmer ce résultat.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-coeffsbeta" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;8.38: Résultats pour le modèle GLM bêta</caption>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: right;">Coeff.</th>
<th style="text-align: right;">RC</th>
<th style="text-align: right;">Val.p</th>
<th style="text-align: right;">IC 2,5 % RC</th>
<th style="text-align: right;">IC 97,5 % RC</th>
<th style="text-align: right;">Sign.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Constante</td>
<td style="text-align: right;">3,468</td>
<td style="text-align: right;">32,059</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">25,636</td>
<td style="text-align: right;">40,085</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">A65Pct</td>
<td style="text-align: right;">-0,002</td>
<td style="text-align: right;">0,998</td>
<td style="text-align: right;">0,243</td>
<td style="text-align: right;">0,996</td>
<td style="text-align: right;">1,001</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">A014Pct</td>
<td style="text-align: right;">-0,006</td>
<td style="text-align: right;">0,994</td>
<td style="text-align: right;">0,035</td>
<td style="text-align: right;">0,988</td>
<td style="text-align: right;">1,000</td>
<td style="text-align: right;">*</td>
</tr>
<tr class="even">
<td style="text-align: left;">PopFRPct</td>
<td style="text-align: right;">0,013</td>
<td style="text-align: right;">1,014</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">1,011</td>
<td style="text-align: right;">1,016</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PopMVPct</td>
<td style="text-align: right;">-0,003</td>
<td style="text-align: right;">0,997</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,995</td>
<td style="text-align: right;">0,998</td>
<td style="text-align: right;">***</td>
</tr>
<tr class="even">
<td style="text-align: left;">prt_veg</td>
<td style="text-align: right;">-0,137</td>
<td style="text-align: right;">0,872</td>
<td style="text-align: right;">0,000</td>
<td style="text-align: right;">0,865</td>
<td style="text-align: right;">0,879</td>
<td style="text-align: right;">***</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Créer un DataFrame pour la prédiction</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  A65Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">A65Pct</span><span class="op">)</span>,</span>
<span>  A014Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">A014Pct</span><span class="op">)</span>,</span>
<span>  PopFRPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  PopMVPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">PopMVPct</span><span class="op">)</span>,</span>
<span>  prt_veg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">prt_veg</span><span class="op">)</span>,</span>
<span>  Arrond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Verdun"</span>,<span class="st">'Ahuntsic-Cartierville'</span>,<span class="st">'Dollard-des-Ormeaux'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Effectuer les prédictions sur l'échelle log</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele3</span>, <span class="va">df</span>, se<span class="op">=</span><span class="cn">T</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="co"># Calculer les prédictions et leurs intervalles de confiance</span></span>
<span><span class="va">ilink</span> <span class="op">&lt;-</span> <span class="va">modele3</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="va">linkinv</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span> <span class="va">pred</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span> <span class="va">pred</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="co"># Afficher le résultat</span></span>
<span><span class="va">P1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PopFRPct</span>, y <span class="op">=</span> <span class="va">pred</span>, color <span class="op">=</span> <span class="va">Arrond</span><span class="op">)</span>, size <span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PopFRPct</span>, y <span class="op">=</span> <span class="va">lower</span>, color <span class="op">=</span> <span class="va">Arrond</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PopFRPct</span>, y <span class="op">=</span> <span class="va">upper</span>, color <span class="op">=</span> <span class="va">Arrond</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Personnes à faible revenu (%)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Surface de l'AD couverte par des îlots de chaleur (%)"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">'Arrondissement'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Pour la végétation</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  A65Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">A65Pct</span><span class="op">)</span>,</span>
<span>  A014Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">A014Pct</span><span class="op">)</span>,</span>
<span>  PopFRPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">PopFRPct</span><span class="op">)</span>,</span>
<span>  PopMVPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset3</span><span class="op">$</span><span class="va">PopMVPct</span><span class="op">)</span>,</span>
<span>  prt_veg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">95</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  Arrond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Verdun"</span>,<span class="st">'Ahuntsic-Cartierville'</span>,<span class="st">'Dollard-des-Ormeaux'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Effectuer les prédiction sur l'échelle log</span></span>
<span><span class="va">pred2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modele3</span>, <span class="va">df2</span>, se<span class="op">=</span><span class="cn">T</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="co"># Calculer les prédictions et leurs intervalles de confiance</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">pred2</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">pred2</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span> <span class="va">pred2</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu">ilink</span><span class="op">(</span><span class="va">pred2</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span> <span class="va">pred2</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="co"># Afficher le résultat</span></span>
<span><span class="va">P2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg</span>, y <span class="op">=</span> <span class="va">pred</span>, color <span class="op">=</span> <span class="va">Arrond</span><span class="op">)</span>, size <span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg</span>, y <span class="op">=</span> <span class="va">lower</span>, color <span class="op">=</span> <span class="va">Arrond</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg</span>, y <span class="op">=</span> <span class="va">upper</span>, color <span class="op">=</span> <span class="va">Arrond</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Couverture végétale (%)"</span>, y <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Arrondissement"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">P1</span>, <span class="va">P2</span>, common.legend <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-betaFR" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="08-GLM_files/figure-html/fig-betaFR-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.70: Effets marginaux des variables pourcentage de personnes à faible revenu et densité de végétation</figcaption></figure>
</div>
</div>
</div>
</section></section></section><section id="sec-085" class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" data-anchor-id="sec-085">
<span class="header-section-number">8.5</span> Conclusion sur les modèles linéaires généralisés</h2>
<p>Comme vous avez dû le remarquer, les modèles linéaires généralisés constituent un monde à part entière et tout un livre pourrait être rédigé à leur sujet. Leur grande flexibilité les rend extrêmement utiles dans de nombreux contextes, mais complique leur mise en œuvre, chaque modèle ayant ses propres spécificités théoriques. Ils partagent cependant tous une base commune&nbsp;: le choix d’une distribution et d’une fonction de lien. L’ensemble de leurs spécificités découle directement de ces deux choix.</p>
<p>La <a href="#fig-GLMfinal">figure&nbsp;<span>8.71</span></a> résume les choix de modèles présentés au cours de ce chapitre pour des variables qualitatives, de comptage et continues. Notez bien qu’il ne s’agit que de la partie émergée de l’iceberg, car il existe de nombreuses autres distributions plus ou moins complexes (skew-normale, log-normal, beta-binomiale, Box-Cox, Gumbel etc.). D’autres pistes pourraient aussi être explorées pour aller plus loin avec les GLM, notamment les modèles Hurdle (combinant un modèle binomial et un modèle avec une distribution continue), les modèles tronqués ou censurés (tenant compte d’une limite nette dans la variable dépendante) ou encore les modèles distributionnels ajustant une équation de régression pour chaque paramètre de la distribution utilisée.</p>
<div id="fig-GLMfinal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap08/guide_GLM.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;8.71: Résumé graphique des principaux GLM abordés</figcaption></figure>
</div>
</section><section id="sec-086" class="level2" data-number="8.6"><h2 data-number="8.6" class="anchored" data-anchor-id="sec-086">
<span class="header-section-number">8.6</span> Quiz de révision du chapitre</h2>
<div id="quizz_glm" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_glm;
  window.onload = function() {
    quizz_quizz_glm = new Quiz('quizz_glm', [['1', '3'],['2', '3'],'2',['1', '4'],'3',['1', '2'],'4','3',['1', '2']]);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
Contrairement à un modèle LM, un GLM permet de choisir :
</div>
<div>
Relisez au besoin la <a href="#sec-081">section&nbsp;<span>8.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>la distribution conditionnelle de la variable Y</label>
</td>
<td>
<input type="checkbox" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>une fonction de lien appliquée aux coefficients du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="2">
</td>
</tr>
<tr>
<td>
<label>une fonction de lien appliquée à l’équation de régression du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="3">
</td>
</tr>
<tr>
<td>
<label>la distribution à priori de la variable Y</label>
</td>
<td>
<input type="checkbox" name="q1" value="4">
</td>
</tr>
<tr>
<td>
<label>la distribution des résidus du modèle</label>
</td>
<td>
<input type="checkbox" name="q1" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
La fonction de lien est utilisée pour transformer :
</div>
<div>
Relisez au besoin la <a href="#sec-0812">section&nbsp;<span>8.1.2</span></a>
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>les paramètres d’un modèle et les rendre plus interprétables</label>
</td>
<td>
<input type="checkbox" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>le résultat de l’équation d’un modèle pour le contraindre à un intervalle de valeurs cohérent avec le paramètre de la distribution modélisée</label>
</td>
<td>
<input type="checkbox" name="q2" value="2">
</td>
</tr>
<tr>
<td>
<label>le résultat de l’équation d’un modèle pour obtenir un effet multiplicatif plutôt qu’additif des coefficients</label>
</td>
<td>
<input type="checkbox" name="q2" value="3">
</td>
</tr>
<tr>
<td>
<label>la variable Y pour qu’elle suive une distribution normale</label>
</td>
<td>
<input type="checkbox" name="q2" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Un modèle GLM est ajusté par la méthode des moindres carrés.
</div>
<div>
Relisez au besoin la <a href="#sec-0811">section&nbsp;<span>8.1.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q3" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Dans un modèle GLM la vraisemblance (likelihood) est :
</div>
<div>
Relisez au besoin la <a href="11-GAM.html#sec-113">section&nbsp;<span>11.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>le produit des probabilités d’observer chacune des observations selon le modèle</label>
</td>
<td>
<input type="checkbox" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>la somme des résidus du modèle</label>
</td>
<td>
<input type="checkbox" name="q4" value="2">
</td>
</tr>
<tr>
<td>
<label>un test de significativité du modèle</label>
</td>
<td>
<input type="checkbox" name="q4" value="3">
</td>
</tr>
<tr>
<td>
<label>impossible à calculer en pratique, nous lui préférons le log-likelihood</label>
</td>
<td>
<input type="checkbox" name="q4" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Idéalement, les résidus simulés d’un modèle GLM devraient :
</div>
<div>
Relisez au besoin la <a href="#sec-0814">section&nbsp;<span>8.1.4</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>suivre une distribution normale</label>
</td>
<td>
<input type="radio" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>ne suivre aucune distribution particulière</label>
</td>
<td>
<input type="radio" name="q5" value="2">
</td>
</tr>
<tr>
<td>
<label>suivre une distribution uniforme</label>
</td>
<td>
<input type="radio" name="q5" value="3">
</td>
</tr>
<tr>
<td>
<label>être corrélés avec la variable Y</label>
</td>
<td>
<input type="radio" name="q5" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
L’AIC
</div>
<div>
Relisez au besoin la <a href="#sec-0815">section&nbsp;<span>8.1.5</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>mesure la qualité d’ajustement d’un modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>tient compte du nombre de paramètres dans un modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="2">
</td>
</tr>
<tr>
<td>
<label>mesure le niveau de significativité des coefficients d’un modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="3">
</td>
</tr>
<tr>
<td>
<label>pénalise les modèles avec un plus petit nombre de paramètres</label>
</td>
<td>
<input type="checkbox" name="q6" value="4">
</td>
</tr>
<tr>
<td>
<label>tient compte du nombre d’observations dans le modèle</label>
</td>
<td>
<input type="checkbox" name="q6" value="5">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour un modèle utilisant une distribution binomiale, le paramètre modélisé par l’équation de régression est :
</div>
<div>
Relisez au besoin la <a href="#sec-0821">section&nbsp;<span>8.2.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>mu, la moyenne de y</label>
</td>
<td>
<input type="radio" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>lambda, le nombre d’occurrences attendu pour y</label>
</td>
<td>
<input type="radio" name="q7" value="2">
</td>
</tr>
<tr>
<td>
<label>sigma, la variance de y</label>
</td>
<td>
<input type="radio" name="q7" value="3">
</td>
</tr>
<tr>
<td>
<label>p, la probabilité d’observer y = 1</label>
</td>
<td>
<input type="radio" name="q7" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Si la fonction de lien logistique est utilisée dans un modèle binomial, comment peuvent être interprétés les coefficients?
</div>
<div>
Relisez au besoin la <a href="#sec-0821">section&nbsp;<span>8.2.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>En appliquant la fonction log aux coefficients, nous obtenons l’effet linéaire de ceux-ci sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="1">
</td>
</tr>
<tr>
<td>
<label>En appliquant la fonction exp aux coefficients, nous obtenons l’effet linéaire de ceux-ci sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="2">
</td>
</tr>
<tr>
<td>
<label>En appliquant la fonction exp aux coefficients, nous obtenons leur effet sous forme de rapport de cote sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="3">
</td>
</tr>
<tr>
<td>
<label>En appliquant la fonction 1/exp aux coefficients, nous obtenons leur effet sous forme de rapport de cote sur la probabilité p</label>
</td>
<td>
<input type="radio" name="q8" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour choisir la distribution la mieux adaptée pour un modèle GLM, il est possible de :
</div>
<div>
Relisez au besoin la <a href="#sec-086">section&nbsp;<span>8.6</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>consulter la littérature et retenir les distributions utilisées habituellement</label>
</td>
<td>
<input type="checkbox" name="q9" value="1">
</td>
</tr>
<tr>
<td>
<label>comparer plusieurs distributions et conserver le modèle le mieux ajusté selon les AIC</label>
</td>
<td>
<input type="checkbox" name="q9" value="2">
</td>
</tr>
<tr>
<td>
<label>utiliser systématiquement la distribution normale</label>
</td>
<td>
<input type="checkbox" name="q9" value="3">
</td>
</tr>
<tr>
<td>
<label>demander à un service de voyance</label>
</td>
<td>
<input type="checkbox" name="q9" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_glm);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-anastasopoulos2012analysis" class="csl-entry" role="listitem">
Anastasopoulos, Panagiotis C, John E Haddock, Matthew G Karlaftis et Fred L Mannering. 2012. <span>«&nbsp;Analysis of urban travel times: Hazard-based approach to random parameters.&nbsp;»</span> <em>Transportation research record</em> 2302 (1): 121‑129. <a href="https://doi.org/10.3141%2F2302-13">https://doi.org/10.3141%2F2302-13</a>.
</div>
<div id="ref-brant1990assessing" class="csl-entry" role="listitem">
Brant, Rollin. 1990. <span>«&nbsp;Assessing proportionality in the proportional odds model for ordinal logistic regression.&nbsp;»</span> <em>Biometrics</em>: 1171‑1178. <a href="https://www.jstor.org/stable/2532457">https://www.jstor.org/stable/2532457</a>.
</div>
<div id="ref-cloutier2014carrefours" class="csl-entry" role="listitem">
Cloutier, Marie-soleil, Mathieu Tremblay, Patrick Morency et Philippe Apparicio. 2014. <span>«&nbsp;Carrefours en milieu urbain: quels risques pour les pi<span>é</span>tons? Exemple empirique des quartiers centraux de Montr<span>é</span>al, Canada.&nbsp;»</span> <em>Recherche Transports Sécurité</em> 30: 3‑20.
</div>
<div id="ref-RandomizedResid" class="csl-entry" role="listitem">
Dunn, Peter K. et Gordon K. Smyth. 1996. <span>«&nbsp;Randomized Quantile Residuals.&nbsp;»</span> <em>Journal of Computational and Graphical Statistics</em> 5 (3): 236‑244. <a href="https://doi.org/10.2307/1390802">https://doi.org/10.2307/1390802</a>.
</div>
<div id="ref-fox1992generalized" class="csl-entry" role="listitem">
Fox, John et Georges Monette. 1992. <span>«&nbsp;Generalized collinearity diagnostics.&nbsp;»</span> <em>Journal of the American Statistical Association</em> 87 (417): 178‑183. <a href="https://doi.org/10.2307/2290467">https://doi.org/10.2307/2290467</a>.
</div>
<div id="ref-frank2008urban" class="csl-entry" role="listitem">
Frank, Lawrence, Mark Bradley, Sarah Kavage, James Chapman et T Keith Lawton. 2008. <span>«&nbsp;Urban form, travel time, and cost relationships with tour complexity and mode choice.&nbsp;»</span> <em>Transportation</em> 35 (1): 37‑54. <a href="https://doi.org/10.1007/s11116-007-9136-6">https://doi.org/10.1007/s11116-007-9136-6</a>.
</div>
<div id="ref-gelman2006data" class="csl-entry" role="listitem">
Gelman, Andrew et Jennifer Hill. 2006. <em>Data analysis using regression and multilevel/hierarchical models</em>. Cambridge university press.
</div>
<div id="ref-harlan2007shade" class="csl-entry" role="listitem">
Harlan, Sharon L, Anthony J Brazel, G Darrel Jenerette, Nancy S Jones, Larissa Larsen, Lela Prashad et William L Stefanov. 2007. <span>«&nbsp;In the shade of affluence: the inequitable distribution of the urban heat island.&nbsp;»</span> <em>Research in Social Problems and Public Policy</em> 15: 173‑202. <a href="http://dx.doi.org/10.1016/S0196-1152(07)15005-5">http://dx.doi.org/10.1016/S0196-1152(07)15005-5</a>.
</div>
<div id="ref-hilbe2009logistic" class="csl-entry" role="listitem">
Hilbe, Joseph M. 2009. <em>Logistic regression models</em>. CRC press.
</div>
<div id="ref-huang2011everyone" class="csl-entry" role="listitem">
Huang, Ganlin, Weiqi Zhou et ML Cadenasso. 2011. <span>«&nbsp;Is everyone hot in the city? Spatial pattern of land surface temperatures, land cover and neighborhood socioeconomic characteristics in Baltimore, MD.&nbsp;»</span> <em>Journal of environmental management</em> 92 (7): 1753‑1759. <a href="https://doi.org/10.1016/j.jenvman.2011.02.006">https://doi.org/10.1016/j.jenvman.2011.02.006</a>.
</div>
<div id="ref-mcfadden2016examining" class="csl-entry" role="listitem">
McFadden, Brandon R. 2016. <span>«&nbsp;Examining the gap between science and public opinion about genetically modified food and global warming.&nbsp;»</span> <em>PloS one</em> 11 (11): e0166140. <a href="https://doi.org/10.1371/journal.pone.0166140">https://doi.org/10.1371/journal.pone.0166140</a>.
</div>
<div id="ref-GLMnelder" class="csl-entry" role="listitem">
Nelder, John A. et Robert W. M. Wedderburn. 1972. <span>«&nbsp;Generalized Linear Models.&nbsp;»</span> <em>Journal of the Royal Statistical Society. Series A (General)</em> 135 (3): 370‑384. <a href="http://www.jstor.org/stable/2344614">http://www.jstor.org/stable/2344614</a>.
</div>
<div id="ref-NeymanLemma" class="csl-entry" role="listitem">
Neyman, Jerzy, Egon Sharpe Pearson et Karl Pearson. 1933. <span>«&nbsp;IX. On the problem of the most efficient tests of statistical hypotheses.&nbsp;»</span> <em>Philosophical Transactions of the Royal Society of London. Series A, Containing Papers of a Mathematical or Physical Character</em> 231 (694-706): 289‑337. <a href="https://royalsocietypublishing.org/doi/abs/10.1098/rsta.1933.0009">https://royalsocietypublishing.org/doi/abs/10.1098/rsta.1933.0009</a>.
</div>
<div id="ref-sanchez2019cooling" class="csl-entry" role="listitem">
Sanchez, Lino et Tony G Reames. 2019. <span>«&nbsp;Cooling Detroit: A socio-spatial analysis of equity in green roofs as an urban heat island mitigation strategy.&nbsp;»</span> <em>Urban Forestry &amp; Urban Greening</em> 44: 126331. <a href="https://doi.org/10.1016/j.ufug.2019.04.014">https://doi.org/10.1016/j.ufug.2019.04.014</a>.
</div>
<div id="ref-Sasmultinom" class="csl-entry" role="listitem">
SAS Institute Inc. 2020a. <span>«&nbsp;<span>SAS/STAT 15.2 User’s Guide</span> Modeling Multinomial Overdispersion.&nbsp;»</span> <a href="https://documentation.sas.com/?docsetId=statug&amp;docsetTarget=statug_fmm_examples04.htm&amp;docsetVersion=15.2&amp;locale=en" class="uri">https://documentation.sas.com/?docsetId=statug&amp;docsetTarget=statug_fmm_examples04.htm&amp;docsetVersion=15.2&amp;locale=en</a>.
</div>
<div id="ref-Saspoiss" class="csl-entry" role="listitem">
———. 2020b. <span>«&nbsp;<span>SAS/STAT 15.2 User’s Guide</span> Poisson Regression | SAS Annotated Output.&nbsp;»</span> <a href="https://stats.idre.ucla.edu/sas/output/poisson-regression/" class="uri">https://stats.idre.ucla.edu/sas/output/poisson-regression/</a>.
</div>
<div id="ref-smithson2006better" class="csl-entry" role="listitem">
Smithson, Michael et Jay Verkuilen. 2006. <span>«&nbsp;A better lemon squeezer? Maximum-likelihood regression with beta-distributed dependent variables.&nbsp;»</span> <em>Psychological methods</em> 11 (1): 54. <a href="https://doi.org/10.1037/1082-989x.11.1.54">https://doi.org/10.1037/1082-989x.11.1.54</a>.
</div>
<div id="ref-teubner2017price" class="csl-entry" role="listitem">
Teubner, Timm, Florian Hawlitschek et David Dann. 2017. <span>«&nbsp;Price determinants on AirBnB: How reputation pays off in the sharing economy.&nbsp;»</span> <em>Journal of Self-Governance &amp; Management Economics</em> 5 (4). <a href="http://dx.doi.org/10.22381/JSME5420173">http://dx.doi.org/10.22381/JSME5420173</a>.
</div>
<div id="ref-wang2017price" class="csl-entry" role="listitem">
Wang, Dan et Juan L Nicolau. 2017. <span>«&nbsp;Price determinants of sharing economy based accommodation rental: A study of listings from 33 cities on Airbnb.com.&nbsp;»</span> <em>International Journal of Hospitality Management</em> 62: 120‑131. <a href="https://doi.org/10.1016/j.ijhm.2016.12.007">https://doi.org/10.1016/j.ijhm.2016.12.007</a>.
</div>
<div id="ref-zeileis2004econometric" class="csl-entry" role="listitem">
Zeileis, Achim. 2004. <em>Econometric computing with HC and HAC covariance matrix estimators</em>. Institut f<span>ü</span>r Statistik und Mathematik.
</div>
<div id="ref-zhang2017key" class="csl-entry" role="listitem">
Zhang, Zhihua, Rachel JC Chen, Lee D Han et Lu Yang. 2017. <span>«&nbsp;Key factors affecting the price of Airbnb listings: A geographically weighted approach.&nbsp;»</span> <em>Sustainability</em> 9 (9): 1635. <a href="http://dx.doi.org/10.3390/su9091635">http://dx.doi.org/10.3390/su9091635</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./07-regressionlineaire.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Régression linéaire multiple</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-GLMM.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes quantitatives en sciences sociales : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>