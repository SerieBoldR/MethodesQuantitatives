<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes quantitatives en sciences sociales : un grand bol d’R - 11&nbsp; Modèles généralisés additifs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-AnalysesFactorielles.html" rel="next">
<link href="./10-Multiniveau.html" rel="prev">
<link href="./images/introduction/Couverture.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-GAM.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modèles généralisés additifs</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes quantitatives en sciences sociales : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesQuantitatives" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Découverte de R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-priseenmainR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Prise en main de R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Analyses univariées et représentations graphiques</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-univarie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistiques descriptives univariées</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-magiedesgraphiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Magie des graphiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Analyses bivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-bivarieeQuantiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relation linéaire entre deux variables quantitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-bivarieeQualiQuali.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Relation entre deux variables qualitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-bivarieeQualiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Relation entre une variable qualitative et une variable quantitative</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Modèles de régression</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-regressionlineaire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Régression linéaire multiple</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-GLMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Multiniveau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Régressions multiniveaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-GAM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modèles généralisés additifs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Analyses exploratoires multivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-AnalysesFactorielles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Méthodes factorielles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-MethodeClassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Annexes et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Annexes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Annexes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-111" id="toc-sec-111" class="nav-link active" data-scroll-target="#sec-111"><span class="header-section-number">11.1</span> Introduction</a>
  <ul class="collapse">
<li><a href="#sec-1111" id="toc-sec-1111" class="nav-link" data-scroll-target="#sec-1111"><span class="header-section-number">11.1.1</span> Non-linéarité fonctionnelle</a></li>
  <li><a href="#sec-1112" id="toc-sec-1112" class="nav-link" data-scroll-target="#sec-1112"><span class="header-section-number">11.1.2</span> Non-linéarité avec des polynomiales</a></li>
  <li><a href="#sec-1113" id="toc-sec-1113" class="nav-link" data-scroll-target="#sec-1113"><span class="header-section-number">11.1.3</span> Non-linéarité par segments</a></li>
  <li><a href="#sec-1114" id="toc-sec-1114" class="nav-link" data-scroll-target="#sec-1114"><span class="header-section-number">11.1.4</span> Non-linéarité avec des <em>splines</em></a></li>
  </ul>
</li>
  <li><a href="#sec-112" id="toc-sec-112" class="nav-link" data-scroll-target="#sec-112"><span class="header-section-number">11.2</span> <em>Spline</em> de régression et <em>spline</em> de lissage</a></li>
  <li><a href="#sec-113" id="toc-sec-113" class="nav-link" data-scroll-target="#sec-113"><span class="header-section-number">11.3</span> Interprétation d’une <em>spline</em></a></li>
  <li><a href="#sec-114" id="toc-sec-114" class="nav-link" data-scroll-target="#sec-114"><span class="header-section-number">11.4</span> Multicolinéarité non linéaire</a></li>
  <li>
<a href="#sec-115" id="toc-sec-115" class="nav-link" data-scroll-target="#sec-115"><span class="header-section-number">11.5</span> <em>Splines</em> avancées</a>
  <ul class="collapse">
<li><a href="#sec-1151" id="toc-sec-1151" class="nav-link" data-scroll-target="#sec-1151"><span class="header-section-number">11.5.1</span> <em>Splines</em> cycliques</a></li>
  <li><a href="#sec-1152" id="toc-sec-1152" class="nav-link" data-scroll-target="#sec-1152"><span class="header-section-number">11.5.2</span> Splines par groupe</a></li>
  <li><a href="#sec-1153" id="toc-sec-1153" class="nav-link" data-scroll-target="#sec-1153"><span class="header-section-number">11.5.3</span> <em>Splines</em> multivariées et <em>splines</em> d’interaction</a></li>
  </ul>
</li>
  <li><a href="#sec-116" id="toc-sec-116" class="nav-link" data-scroll-target="#sec-116"><span class="header-section-number">11.6</span> Mise en œuvre dans R</a></li>
  <li><a href="#sec-117" id="toc-sec-117" class="nav-link" data-scroll-target="#sec-117"><span class="header-section-number">11.7</span> GAMM</a></li>
  <li><a href="#sec-118" id="toc-sec-118" class="nav-link" data-scroll-target="#sec-118"><span class="header-section-number">11.8</span> Quiz de révision du chapitre</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesQuantitatives/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap11" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modèles généralisés additifs</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Dans les précédents chapitres, nous avons eu l’occasion d’explorer toute une panoplie de modèles&nbsp;: régressions linéaires, modèles généralisés, modèles généralisés à effets mixtes et modèles multiniveaux. Dans ce chapitre, nous abordons une nouvelle extension dans le monde des régressions&nbsp;: les modèles généralisés additifs (<em>Generalized additive model</em> en anglais — GAM). Cette extension a pour but de permettre de modéliser des relations non linéaires entre les variables indépendantes et la variable dépendante.</p>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour créer des graphiques&nbsp;:
<ul>
<li>
<code>ggplot2</code> le seul, l’unique!</li>
<li>
<code>ggpubr</code> pour combiner des graphiques et réaliser des diagrammes.</li>
<li>
<code>metR</code> pour placer des étiquettes sur des isolignes.</li>
</ul>
</li>
<li>Pour jouer avec des <em>splines</em>&nbsp;:
<ul>
<li>
<code>splines2</code> pour construire les fonctions de base de nombreuses <em>splines</em>.</li>
<li>
<code>segmented</code> pour ajuster des modèles avec des coefficients variant par segment.</li>
</ul>
</li>
<li>Pour ajuster des modèles GAM&nbsp;:
<ul>
<li>
<code>mgcv</code>, le <em>package</em> de référence pour ajuster des GAM dans R!</li>
<li>
<code>gamlss</code>, un second <em>package</em> très flexible pour ajuster des GAM.</li>
<li>
<code>gamlss.add</code>, une extension de <code>gamlss</code> ajoutant des distributions supplémentaires.</li>
</ul>
</li>
<li>Pour analyser des modèles GAM&nbsp;:
<ul>
<li>
<code>itsadug</code> pour notamment extraire certains résultats d’un GAM.</li>
<li>
<code>mixedup</code> pour notamment extraire les effets aléatoires d’un GAM.</li>
<li>
<code>DHARMa</code> pour le diagnostic des résidus simulés.</li>
</ul>
</li>
</ul>
</div>
</div>
<section id="sec-111" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="sec-111">
<span class="header-section-number">11.1</span> Introduction</h2>
<p>Puisque les modèles GAM sont une extension des modèles GLM, ils peuvent s’appliquer à des modèles pour des variables indépendantes qualitatives, de comptage ou continues. Nous l’appliquons ici, à titre d’illustration, à une variable indépendante continue. Pour rappel, la formule décrivant un modèle linéaire généralisé (GLM) utilisant une distribution normale et une fonction de lien identitaire est la suivante&nbsp;:</p>
<p><span id="eq-glm1B"><span class="math display">\[
\begin{aligned}
&amp;Y \sim Normal(\mu,\sigma)\\
&amp;g(\mu) = \beta_0 + \beta X\\
&amp;g(x) = x
\end{aligned}
\tag{11.1}\]</span></span></p>
<p>Les coefficients <span class="math inline">\(\beta\)</span> permettent de quantifier l’effet des variables indépendantes (<em>X</em>) sur la moyenne (l’espérance) (<span class="math inline">\(\mu\)</span>) de la variable dépendante (<em>Y</em>). Un coefficient <span class="math inline">\(\beta_k\)</span> négatif indique que, si la variable <span class="math inline">\(X_k\)</span> augmente, alors la variable <em>Y</em> tend à diminuer et inversement, si le coefficient est positif. L’inconvénient de cette formulation est que le modèle est capable de capter uniquement des relations linéaires entre ces variables. Or, il existe de nombreuses situations dans lesquelles une variable indépendante a un lien non linéaire avec une variable dépendante; voici quelques exemples&nbsp;:</p>
<ul>
<li><p>Si nous mesurons le niveau de bruit émis par une source sonore (variable dépendante) à plusieurs endroits et que nous tentons de prédire l’intensité sonore en fonction de la distance à la source (variable indépendante), nous pouvons nous attendre à observer une relation non linéaire entre les deux. En effet, le son étant une énergie se dispersant selon une sphère dans l’espace, son intensité est inversement proportionnelle au carré de la distance avec la source sonore.</p></li>
<li><p>La concentration de la pollution atmosphérique en ville suit généralement des patrons temporels et spatiaux influencés directement par la météorologie et les activités humaines. Autrement dit, il serait absurde d’introduire l’espace de façon linéaire (avec un gradient nord-sud ou est-ouest), ou le moment de la journée de façon linéaire (comme si la pollution augmentait du matin au soir ou inversement). En guise d’exemple, la <a href="#fig-gam1">figure&nbsp;<span>11.1</span></a>, tirée de <span class="citation" data-cites="2020_3">Gelb et Apparicio (<a href="references.html#ref-2020_3" role="doc-biblioref">2020</a>)</span>, illustre bien ces variations temporelles pour deux polluants (le dioxyde d’azote et l’ozone).</p></li>
</ul>
<div id="fig-gam1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap11/no2_03_patterns.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.1: Patron journalier du dioxyde d’azote et de l’ozone à Paris</figcaption></figure>
</div>
<section id="sec-1111" class="level3" data-number="11.1.1"><h3 data-number="11.1.1" class="anchored" data-anchor-id="sec-1111">
<span class="header-section-number">11.1.1</span> Non-linéarité fonctionnelle</h3>
<p>Il existe de nombreuses façons d’introduire des relations non linéaires dans un modèle. La première et la plus simple à mettre en œuvre est de transformer la variable indépendante à l’aide d’une fonction inverse, exponentielle, logarithmique ou autre.</p>
<p>Prenons un premier exemple avec une variable <em>Y</em> que nous tentons de prédire avec une variable <em>X</em>, présenté à la <a href="#fig-gam2">figure&nbsp;<span>11.2</span></a>. Si nous ajustons une droite de régression à ces données (en bleu), nous constatons que l’augmentation de <em>X</em> est associée à une augmentation de <em>Y</em>. Cependant, la droite de régression est très éloignée des données et ne capte qu’une petite partie de la relation. Une lecture attentive permet de constater que l’effet de <em>X</em> sur <em>Y</em> augmente de plus en plus rapidement à mesure que <em>X</em> augmente. Cette forme est caractéristique d’une relation exponentielle. Nous pouvons donc transformer la variable <em>X</em> avec la fonction exponentielle afin d’obtenir un meilleur ajustement (en rouge).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam2-1.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.2: Relation non linéaire exponentielle</figcaption></figure>
</div>
</div>
</div>
<p>La <a href="#fig-gam3">figure&nbsp;<span>11.3</span></a> illustre trois autres situations avec les fonctions logarithmique, logistique inverse et racine carrée. Cette approche peut donner des résultats intéressants si vous disposez d’une bonne justification théorique sur la forme attendue de la relation entre <em>X</em> et <em>Y</em>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam3-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.3: Autres relations non linéaires</figcaption></figure>
</div>
</div>
</div>
<p>Il existe également des cas de figure dans lesquels aucune fonction ne donne de résultats pertinents, comme illustré à la <a href="#fig-gam4">figure&nbsp;<span>11.4</span></a>. Nous constatons facilement qu’aucune des fonctions proposées n’est capable de bien capter la relation entre les deux variables. Puisque cette relation est complexe, il convient alors d’utiliser une autre stratégie pour la modéliser.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam4-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.4: Relation non linéaire plus complexe</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-1112" class="level3" data-number="11.1.2"><h3 data-number="11.1.2" class="anchored" data-anchor-id="sec-1112">
<span class="header-section-number">11.1.2</span> Non-linéarité avec des polynomiales</h3>
<p>Nous avons vu, dans le chapitre sur la régression simple (<a href="07-regressionlineaire.html#sec-07511">section&nbsp;<span>7.5.1.1</span></a>), qu’il est possible d’utiliser des polynomiales pour ajuster des relations non linéaires. Pour rappel, il s’agit simplement d’ajouter à un modèle la variable <em>X</em> à différents exposants (<span class="math inline">\(X+X^2+\dots+X^k\)</span>). Chaque exposant supplémentaire (chaque ordre supplémentaire) permet au modèle d’ajuster une relation plus complexe. Rien de tel qu’un graphique pour illustrer le tout (<a href="#fig-gam5">figure&nbsp;<span>11.5</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam5-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.5: Visualisation de plusieurs polynomiales</figcaption></figure>
</div>
</div>
</div>
<p>L’enjeu est de sélectionner le bon nombre de degrés de la polynomiale pour le modèle. Chaque degré supplémentaire constitue une nouvelle variable dans le modèle, et donc un paramètre supplémentaire. Un trop faible nombre de degrés produit des courbes trop simplistes, alors qu’un nombre trop élevé conduit à un surajustement (<em>overfitting</em> en anglais) du modèle. La <a href="#fig-gam6">figure&nbsp;<span>11.6</span></a> illustre ces deux situations.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam6-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.6: Sur et sous-ajustement d’une polynomiale</figcaption></figure>
</div>
</div>
</div>
<p>Un des problèmes inhérents à l’approche des polynomiales est la difficulté d’interprétation. En effet, les coefficients ne sont pas directement interprétables et seule une figure représentant les prédictions du modèle permet d’avoir une idée de l’effet de la variable <em>X</em> sur la variable <em>Y</em>.</p>
</section><section id="sec-1113" class="level3" data-number="11.1.3"><h3 data-number="11.1.3" class="anchored" data-anchor-id="sec-1113">
<span class="header-section-number">11.1.3</span> Non-linéarité par segments</h3>
<p>Un compromis intéressant offrant une interprétation simple et une relation potentiellement complexe consiste à découper la variable <em>X</em> en segments, puis d’ajuster un coefficient pour chacun de ces segments. Nous obtenons ainsi une ligne brisée et des coefficients faciles à interpréter (<a href="#fig-gam7">figure&nbsp;<span>11.7</span></a>). Nous ne présentons pas d’exemple d’application dans R, mais sachez que le <em>package</em> <code>segmented</code> permet d’ajuster ce type de modèle.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam7-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.7: Régression par segment</figcaption></figure>
</div>
</div>
</div>
<p>L’enjeu est alors de déterminer le nombre de points et la localisation de points de rupture. L’inconvénient majeur de cette approche est qu’en réalité, peu de phénomènes sont marqués par des ruptures très nettes.</p>
<p>À la <a href="#fig-gam7">figure&nbsp;<span>11.7</span></a>, nous avons divisé la variable <em>X</em> en trois segments (<span class="math inline">\(k_1\)</span>, <span class="math inline">\(k_2\)</span> et <span class="math inline">\(k_3\)</span>), définis respectivement avec les intervalles suivants&nbsp;: [0,00-0,22], [0,22-0,41] et [0,41-1,00]. Concrètement, cela revient à diviser la variable <em>X</em> en trois nouvelles variables <span class="math inline">\(X_{k1}\)</span>, <span class="math inline">\(X_{k2}\)</span>, et <span class="math inline">\(X_{k3}\)</span>. La valeur de <span class="math inline">\(X_{ik}\)</span> est égale à <span class="math inline">\(x_i\)</span> si <span class="math inline">\(x_i\)</span> se trouve dans l’intervalle propre à <em>k</em>, et à 0 autrement. Ici, nous obtenons trois coefficients&nbsp;:</p>
<ul>
<li><p>le premier est positif, une augmentation de <em>X</em> sur le premier segment est associée à une augmentation de <em>Y</em>;</p></li>
<li><p>le second est négatif, une augmentation de <em>X</em> sur le second segment est associée à une diminution de <em>Y</em>;</p></li>
<li><p>le troisième est aussi négatif, une augmentation de <em>X</em> sur le troisième segment est associée à une diminution de <em>Y</em>, mais moins forte que pour le second segment.</p></li>
</ul></section><section id="sec-1114" class="level3" data-number="11.1.4"><h3 data-number="11.1.4" class="anchored" data-anchor-id="sec-1114">
<span class="header-section-number">11.1.4</span> Non-linéarité avec des <em>splines</em>
</h3>
<p>La dernière approche, et certainement la plus flexible, est d’utiliser ce que l’on appelle une <em>spline</em> pour capter des relations non linéaires. Une <em>spline</em> est une fonction créant des variables supplémentaires à partir d’une variable <em>X</em> et d’une fonction de base. Ces variables supplémentaires, appelées bases (<em>basis</em> en anglais), sont ajoutées au modèle; la sommation de leurs valeurs multipliées par leurs coefficients permet de capter les relations non linéaires entre une variable dépendante et une variable indépendante. Le nombre de bases et leur localisation (plus souvent appelé nœuds) permettent de contrôler la complexité de la fonction non linéaire.</p>
<p>Prenons un premier exemple simple avec une fonction de base triangulaire (<em>tent basis</em> en anglais). Nous créons ici une <em>spline</em> avec sept nœuds répartis équitablement sur l’intervalle de valeurs de la variable <em>X</em>. Les sept bases qui en résultent sont présentées à la <a href="#fig-gam8">figure&nbsp;<span>11.8</span></a>. Dans cette figure, chaque sommet d’un triangle correspond à un nœud et chaque triangle correspond à une base.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam8" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam8-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.8: Bases de la spline triangulaire</figcaption></figure>
</div>
</div>
</div>
<p>En ajoutant ces bases dans notre modèle de régression, nous pouvons ajuster un coefficient pour chacune et le représenter en multipliant ces bases par les coefficients obtenus avec une simple régression linéaire (<a href="#fig-gam9">figure&nbsp;<span>11.9</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam9-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.9: Spline triangulaire multipliée par ces coefficients</figcaption></figure>
</div>
</div>
</div>
<p>Nous remarquons ainsi que les bases correspondant à des valeurs plus fortes de <em>Y</em> ont reçu des coefficients plus élevés. Pour reconstituer la fonction non linéaire, il suffit d’additionner ces bases multipliées par leurs coefficients, soit la ligne bleue à la <a href="#fig-gam10">figure&nbsp;<span>11.10</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam10" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam10-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.10: Spline triangulaire</figcaption></figure>
</div>
</div>
</div>
<p>La fonction de base triangulaire est intéressante pour présenter la logique qui sous-tend les <em>splines</em>, mais elle est rarement utilisée en pratique. On lui préfère généralement d’autres formes donnant des résultats plus lisses comme les <em>B-spline</em> quadratiques, <em>B-spline</em> cubiques, <em>M-spline</em>, <em>Duchon spline</em>, etc.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam11" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam11-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.11: Comparaison de différentes bases</figcaption></figure>
</div>
</div>
</div>
<p>Les approches que nous venons de décrire sont regroupées sous l’appellation de modèles additifs. Dans les prochaines sous-sections, nous nous concentrons davantage sur les <em>splines</em> du fait de leur plus grande flexibilité.</p>
</section></section><section id="sec-112" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="sec-112">
<span class="header-section-number">11.2</span> <em>Spline</em> de régression et <em>spline</em> de lissage</h2>
<p>Dans les exemples précédents, nous avons vu que la construction d’une <em>spline</em> nécessite d’effectuer deux choix importants&nbsp;: le nombre de nœuds et leur localisation. Un trop grand nombre de nœuds conduit à un surajustement du modèle alors qu’un trop faible nombre de nœuds conduit à un sous-ajustement. Lorsque ces choix sont effectués par l’utilisateur et que les bases sont ajoutées manuellement dans le modèle tel que décrit précédemment, nous parlons alors de <strong><em>splines</em> de régression</strong> (<em>Regression Spline</em> en anglais).</p>
<p>Une approche a été proposée pour faciliter le choix du nombre de nœuds, il s’agit de <strong><em>splines</em> de lissage</strong> (<em>smoothing spline</em> en anglais). L’idée derrière cette approche est d’introduire dans le modèle une pénalisation associée avec le nombre de nœuds (ou degré de liberté) de la <em>spline</em>, dans un souci de parcimonie&nbsp;: chaque nœud supplémentaire doit suffisamment contribuer au modèle pour être conservé. Il n’est pas nécessaire ici de rentrer dans le détail mathématique de cette pénalisation qui est un peu complexe. Retenez simplement qu’elle dépend d’un paramètre appelé <span class="math inline">\(\lambda\)</span>&nbsp;:</p>
<ul>
<li><p>plus <span class="math inline">\(\lambda\)</span> tend vers 0, plus la pénalisation est faible et plus la <em>spline</em> de lissage devient une simple <em>spline</em> de régression;</p></li>
<li><p>à l’inverse, plus elle est forte, plus la pénalité est importante, au point que la <em>spline</em> peut se résumer à une simple ligne droite.</p></li>
</ul>
<p>Cela est illustré à la <a href="#fig-gam12">figure&nbsp;<span>11.12</span></a> comprenant trois <em>splines</em> avec 20 nœuds et des valeurs <span class="math inline">\(\lambda\)</span> différentes contrôlant la force de la pénalité.</p>
<p>Bien évidemment, nous constatons qu’avec la <em>spline</em> de régression (non pénalisée), 20 nœuds conduisent à un fort surajustement du modèle. En revanche, les <em>splines</em> de lissage (pénalisées) permettent de corriger ce problème de surajustement. Toutefois, une valeur trop importante de <span class="math inline">\(\lambda\)</span> conduit à un sous-ajustement du modèle (ici <span class="math inline">\(\lambda = 3\)</span> et <span class="math inline">\(\lambda = 100\)</span>, lignes verte et bleue).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam12" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam12-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.12: Pénalisation des splines</figcaption></figure>
</div>
</div>
</div>
<p>Avec les <em>splines</em> de lissage, l’enjeu est de sélectionner une valeur optimale de <span class="math inline">\(\lambda\)</span>. Le plus souvent, les <em>packages</em> R <strong>estiment eux-mêmes</strong> ce paramètre à partir des données utilisées dans le modèle. Toutefois, gardez en mémoire que vous pouvez modifier ce paramètre. Mentionnons également que les <em>splines</em> de lissage peuvent être reparamétrées dans un modèle pour être intégrées comme des effets aléatoires. Dans ce cas-ci, <span class="math inline">\(\lambda\)</span> est remplacé par un simple paramètre de variance directement estimé dans le modèle <span class="citation" data-cites="wood2004stable">(<a href="references.html#ref-wood2004stable" role="doc-biblioref">Wood 2004</a>)</span>.</p>
</section><section id="sec-113" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="sec-113">
<span class="header-section-number">11.3</span> Interprétation d’une <em>spline</em>
</h2>
<p>L’interprétation d’une <em>spline</em> se fait à l’aide de graphiques. En effet, puisqu’elle est composée d’un ensemble de coefficients appliqués à des bases, il est difficile d’interpréter directement ces derniers. Nous préférons alors représenter la fonction obtenue à l’aide d’un graphique, illustrant son <strong>effet marginal</strong>. Ce graphique est construit en trois étapes&nbsp;:</p>
<ol type="1">
<li><p>Créer un jeu de données fictif dans lequel l’ensemble des variables indépendantes sont fixées à leurs moyennes respectives, sauf la variable pour laquelle nous souhaitons représenter la <em>spline</em>. Pour cette dernière, un ensemble de valeurs allant de son minimum à son maximum est utilisé;</p></li>
<li><p>Utiliser le modèle pour prédire les valeurs attendues de la variable dépendante pour chacune des observations fictives ainsi créées;</p></li>
<li><p>Afficher les prédictions obtenues dans un graphique.</p></li>
</ol>
<p>Notez ici qu’un graphique des effets marginaux se base sur les prédictions du modèle. Si un modèle est mal ajusté, les prédictions ne seront pas fiables et il sera inutile d’interpréter la <em>spline</em> obtenue.</p>
<p>Il est aussi possible, dans le cas des <em>splines</em> de lissage, d’interpréter les <em>estimated degrees of freedom</em> (EDF) qui constituent une approximation du nombre de nœuds de la <em>spline</em>. S’ils ne nous renseignent pas sur la forme de la <em>spline</em>, ils nous indiquent son niveau de complexité. Une <em>spline</em> avec un EDF de 1 est en réalité un simple terme linéaire. Plus l’EDF augmente, plus la <em>spline</em> est complexe.</p>
</section><section id="sec-114" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="sec-114">
<span class="header-section-number">11.4</span> Multicolinéarité non linéaire</h2>
<p>Lorsque des <em>splines</em> sont ajoutées dans un modèle, il est nécessaire de vérifier si ces dernières ne posent pas un problème de multicolinéarité. Cependant, le VIF ne peut plus être utilisé du fait de la non-linéarité des relations modélisées. Il est alors nécessaire d’utiliser une autre mesure&nbsp;: la concurvité (<em>concurvity</em>) permettant de mesurer sur une échelle allant de 0 à 1 à quel point deux <em>splines</em> ont en réalité capturé le même effet et se substituent l’une à l’autre. Une valeur de 0 indique une absence totale de concurvité alors qu’une valeur de 1 indique que deux <em>splines</em> sont rigoureusement identiques (modèle non identifiable).</p>
</section><section id="sec-115" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="sec-115">
<span class="header-section-number">11.5</span> <em>Splines</em> avancées</h2>
<p>Jusqu’ici, nous avons seulement présenté le cas le plus simple pour lequel une <em>spline</em> est construite à partir d’une seule variable dépendante continue, mais les <strong>splines</strong> peuvent être utilisées dans de nombreux autres contextes et ont une incroyable flexibilité. Nous détaillons ici trois exemples fréquents&nbsp;: les <em>splines</em> cycliques, les <em>splines</em> variant par groupe et les <em>splines</em> multivariées. Pour une description complète des effets non linéaires possibles avec <code>mgcv</code>, n’hésitez pas à consulter sa <a href="https://stat.ethz.ch/R-manual/R-patched/library/mgcv/html/smooth.terms.html">documentation</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-exemplesplines" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;11.1: Exemples de splines avancées</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 79%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Code</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">spline cyclique</td>
<td style="text-align: left;"><code>s(x, bs = 'cc')</code></td>
<td style="text-align: left;">Une spline cyclique doit être utilisée si le 0 de la variable X correspond également à sa valeur maximum. Un bon exemple est le temps dans une journée, car 24 h est équivalent à 0 h</td>
</tr>
<tr class="even">
<td style="text-align: left;">spline variant par groupe</td>
<td style="text-align: left;"><code>s(x, by = x2)</code></td>
<td style="text-align: left;">Une spline variant par groupe permet d’ajuster une spline à une variable X1 différente pour chaque groupe identifié par une variable qualitative X2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">spline bivariée</td>
<td style="text-align: left;"><code>s(x1,x2)</code></td>
<td style="text-align: left;">Une spline bivariée est utilisée pour modéliser l’interaction non linéaire de deux variables X1 et X2 s’exprimant dans la même unité (typiquement des coordonnées géographiques cartésiennes)</td>
</tr>
<tr class="even">
<td style="text-align: left;">spline d’interaction complète</td>
<td style="text-align: left;"><code>te(x1,x2)</code></td>
<td style="text-align: left;">Une spline d’interaction permet de modéliser l’interaction non linéaire de deux variables continues pouvant s’exprimer dans des unités différentes, elle combine les effets spécifiques de chacune des deux variables et leur interaction</td>
</tr>
<tr class="odd">
<td style="text-align: left;">spline d’interaction partielle</td>
<td style="text-align: left;"><code>s(x1) + s(x2) + ti(x1,x2)</code></td>
<td style="text-align: left;">Une spline d’interaction partielle permet de distinguer les effets non linéaires individuels de deux variables de leur interaction non linéaire</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sec-1151" class="level3" data-number="11.5.1"><h3 data-number="11.5.1" class="anchored" data-anchor-id="sec-1151">
<span class="header-section-number">11.5.1</span> <em>Splines</em> cycliques</h3>
<p>Une <em>spline</em> cyclique est une extension d’une <em>spline</em> classique dont les bases aux extrémités sont spécifiées de telle sorte que la valeur au départ de la <em>spline</em> soit la même que celle à la fin de la <em>spline</em>. Cela permet à la <em>spline</em> de former une boucle, ce qui est particulièrement intéressant pour des variables dont le 0 et la valeur maximale correspondent en réalité à la même valeur. L’exemple le plus parlant est certainement le cas d’une variable représentant la mesure d’un angle en degrés. Les valeurs de 0 et 360 sont identiques et les valeurs 350 et 10 sont toutes les deux à une distance de 10 degrés de 0. Un autre exemple possible serait de considérer l’heure comme une variable continue; dans ce cas, 24&nbsp;h et 0&nbsp;h signifient la même chose.</p>
<p>Prenons un exemple concret. Nous souhaitons modéliser la concentration de dioxyde d’azote (NO<sub>2</sub>) à Paris, mesurée par un ensemble de stations fixes. Nous pourrions nous attendre à ce que le NO<sub>2</sub> suive chaque jour un certain patron. Concrètement, à proximité d’axes routiers majeurs, nous nous attendons à observer des pics suivant les flux pendulaires. À la <a href="#fig-gam13">figure&nbsp;<span>11.13</span></a>, nous retrouvons bien les deux pics attendus correspondant aux heures de pointe du matin et du soir. Aussi, comme indiqué par la ligne rouge, la valeur prédite par la <em>spline</em> est la même à 24&nbsp;h et à 0&nbsp;h.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam13" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam13-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.13: Spline cyclique pour modéliser la concentration de dioxyde d’azote</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-1152" class="level3" data-number="11.5.2"><h3 data-number="11.5.2" class="anchored" data-anchor-id="sec-1152">
<span class="header-section-number">11.5.2</span> Splines par groupe</h3>
<p>Tel qu’abordé dans les chapitres précédents, il arrive régulièrement que les observations appartiennent à différents groupes. Dans ce cas de figure, nous pouvons être amenés à vérifier si la relation décrite par une <em>spline</em> est identique pour chacun des groupes d’observations. Il s’agit alors d’ajuster une <em>spline</em> différente par groupe. Dans l’exemple précédent, chaque valeur de NO<sub>2</sub> a été mesurée par une station fixe de mesure spécifique. Compte tenu du fait que l’environnement autour de chaque station est particulier, nous pourrions s’attendre à ce que les valeurs de NO<sub>2</sub> ne présentent pas exactement les mêmes patrons journaliers pour chaque station.</p>
<p>À la <a href="#fig-gam14">figure&nbsp;<span>11.14</span></a>, il est possible de constater que le NO<sub>2</sub> suit globalement le même patron temporel pour l’ensemble des stations à l’exception de trois d’entres-elles. Il s’agit en réalité de stations situées dans des secteurs ruraux de la région parisienne, et donc moins impactées par le trafic routier.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam14" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam14-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.14: Spline cyclique variant par groupe</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-1153" class="level3" data-number="11.5.3"><h3 data-number="11.5.3" class="anchored" data-anchor-id="sec-1153">
<span class="header-section-number">11.5.3</span> <em>Splines</em> multivariées et <em>splines</em> d’interaction</h3>
<p>Jusqu’ici, nous n’avons considéré que des <em>splines</em> ne s’appliquant qu’à une seule variable indépendante; cependant, il est possible de construire des <em>splines</em> multivariées s’ajustant simultanément sur plusieurs variables indépendantes. L’objectif est alors de modéliser les potentielles interactions non linéaires entre les variables indépendantes combinées dans une même <em>spline</em>. Prenons un exemple concret, dans la section sur les modèles GLM, nous avons modélisé la couverture des aires de diffusion (AD) à Montréal par des îlots de chaleur. Parmi les variables indépendantes, nous avons notamment utilisé la distance au centre-ville ainsi que la part de la surface végétalisée des AD. Nous pourrions formuler l’hypothèse que ces deux variables influencent conjointement et de façon non linéaire la proportion de la surface d’îlot de chaleur dans chaque AD. Pour représenter une <em>spline</em> sur plusieurs dimensions, nous utilisons alors une carte de chaleur dont la couleur représente la valeur de la variable dépendante prédite en fonction des deux variables indépendantes.</p>
<p>Il est important de distinguer la <em>spline</em> d’<strong>interaction</strong> et la <em>spline</em> <strong>multivariée</strong>. La première est utilisée lorsque les variables indépendantes introduites dans la <em>spline</em> ne sont pas exprimées sur la même échelle et n’évoluent pas conjointement. L’exemple donné ci-dessus avec les variables de végétation et de distance au centre-ville est un exemple de <em>spline</em> d’interaction, la première variable étant exprimée en pourcentage et l’autre en mètres. De plus, ces deux variables ne sont pas conjointes, mais bien distinctes l’une de l’autre. Un cas typique où une <em>spline</em> multivariée serait à privilégier est le cas de l’ajout des coordonnées spatiales dans le modèle. L’emplacement des AD est mesuré par deux variables (coordonnées spatiales <em>x</em> et <em>y</em>) toutes les deux exprimées en mètres évoluant conjointement, au sens où les coordonnées <em>x</em> n’interagissent pas avec les coordonnées <em>y</em>, mais forment à elles deux un espace propre. Au-delà de la problématique de l’échelle des données, il est important de retenir que les <em>splines</em> d’interaction tendent à être davantage pénalisées que les splines <em>multivariées</em>.</p>
<p>La <em>spline</em> d’interaction représentée à la <a href="#fig-gam15">figure&nbsp;<span>11.15</span></a> indique que les AD avec la plus grande proportion de leur surface couverte par des îlots de chaleur sont situées à moins de 25 kilomètres du centre-ville, au-delà de cette distance, cette proportion chute en bas de 0,1, soit 10&nbsp;% de la surface de l’AD. En revanche, à proximité du centre-ville (moins d’un kilomètre), même les AD disposant d’un fort pourcentage de surface végétalisée sont tout de même marquées par un fort pourcentage de surface couverte par des îlots de chaleur.</p>
<p>Les <em>splines</em> bivariées sont fréquemment utilisées pour capturer un potentiel patron spatial dans les données. En effet, si nous disposons des coordonnées spatiales de chaque observation (<em>x, y</em>), il est possible d’ajuster une <em>spline</em> bivariée sur ces coordonnées, contrôlant ainsi l’effet de l’espace.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-gam15" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam15-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.15: Spline d’interaction bivariée</figcaption></figure>
</div>
</div>
</div>
<p>Il n’y a pas de limite théorique au nombre de variables qui peuvent être ajoutées dans une <em>spline</em> d’interaction ou multivariée. Notez cependant que plus le nombre de dimensions augmente, plus la fonction à estimer est complexe et plus le volume de données nécessaire est grand et doit couvrir densément l’ensemble de l’espace d’échantillonnage multidimensionnel.</p>
</section></section><section id="sec-116" class="level2" data-number="11.6"><h2 data-number="11.6" class="anchored" data-anchor-id="sec-116">
<span class="header-section-number">11.6</span> Mise en œuvre dans R</h2>
<p>Il est possible d’ajuster des <em>splines</em> de régression dans n’importe quel <em>package</em> permettant d’ajuster des coefficients pour un modèle de régression. Il suffit de construire les bases des <em>splines</em> en amont à l’aide du <em>package</em> <code>splines2</code> et de les ajouter directement dans l’équation de régression. En revanche, il est nécessaire d’utiliser des <em>packages</em> spécialisés pour ajuster des <em>splines</em> de lissage. Parmi ceux-ci, <code>mgcv</code> est probablement le plus populaire du fait de sa (très) grande flexibilité, suivi des <em>packages</em> <code>gamlss</code>, <code>gam</code> et <code>VGAM.</code> Nous comparons ici les deux approches, puis nous tentons d’améliorer le modèle que nous avons ajusté pour prédire le pourcentage de surface couverte par des îlots de chaleur dans les aires de diffusion de Montréal, dans une perspective d’équité environnementale. Pour rappel, la variable dépendante est exprimée en pourcentage et nous utilisons une distribution bêta pour la modéliser.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co"># Chargement des données</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/gam/data_chaleur.csv"</span>, fileEncoding <span class="op">=</span> <span class="st">"utf8"</span><span class="op">)</span></span>
<span><span class="co"># Ajustement du modèle de base</span></span>
<span><span class="va">refmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">prt_veg</span>, degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans notre première analyse de ces données, nous avons ajusté une polynomiale d’ordre 2 pour représenter un potentiel effet non linéaire de la végétation sur les îlots de chaleur. Nous remplaçons à présent ce terme par une <em>spline</em> de régression en sélectionnant quatre nœuds.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wwenjie.org/splines2">splines2</a></span><span class="op">)</span></span>
<span><span class="co"># Création des bases de la spline</span></span>
<span><span class="va">basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wwenjie.org/splines2/reference/bSpline.html">bSpline</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">prt_veg</span>, df <span class="op">=</span><span class="fl">4</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Ajouter les bases au DataFrame</span></span>
<span><span class="va">basisdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">basis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">basisdf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'spline'</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">basisdf</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">basisdf</span><span class="op">)</span></span>
<span><span class="co"># Ajuster le modèle</span></span>
<span><span class="va">model0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="va">spline1</span> <span class="op">+</span> <span class="va">spline2</span> <span class="op">+</span> <span class="va">spline3</span> <span class="op">+</span> <span class="va">spline4</span> <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons à présent ajuster une <em>spline</em> de lissage et laisser <code>mgcv</code> déterminer son niveau de complexité.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement du modèle avec une spline simple</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">)</span>  <span class="op">+</span> <span class="va">Arrond</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notez ici que la syntaxe à employer est très simple, il suffit de spécifier <code>s(prt_veg)</code> pour indiquer à la fonction <code>gam</code> que vous souhaitez ajuster une <em>spline</em> pour la variable <code>prt_veg</code>. Nous pouvons à présent comparer l’ajustement des deux modèles en utilisant la mesure de l’AIC.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Comparaison des AIC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">refmodel</span>, <span class="va">model0</span>, <span class="va">model1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               df       AIC
refmodel 40.00000 -6399.784
model0   42.00000 -6419.630
model1   44.61065 -6417.562</code></pre>
</div>
</div>
<p>Nous constatons que la valeur de l’AIC du second modèle est plus réduite, indiquant un meilleur ajustement du modèle avec une <em>spline</em> de régression. Notons cependant que la différence avec la <em>spline</em> de lissage est anecdotique (deux points de l’AIC) et que nous connaissions a priori le bon nombre de nœuds à utiliser. Pour des relations plus complexes, les <em>splines</em> de lissage ont tendance à nettement mieux performer. Voyons à présent comment représenter ces trois termes non linéaires.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Création d'un DataFrame de prédiction dans lequel seule</span></span>
<span><span class="co"># la variable prt_veg varie.</span></span>
<span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  prt_veg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">prt_veg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">prt_veg</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  A65Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">A65Pct</span><span class="op">)</span>,</span>
<span>  A014Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">A014Pct</span><span class="op">)</span>,</span>
<span>  PopFRPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">PopFRPct</span><span class="op">)</span>,</span>
<span>  PopMVPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">PopMVPct</span><span class="op">)</span>,</span>
<span>  Arrond <span class="op">=</span> <span class="st">"Verdun"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Recréation des bases de la spline de régression</span></span>
<span><span class="co"># pour les nouvelles observations</span></span>
<span><span class="va">nvl_bases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">basis</span>, newx <span class="op">=</span> <span class="va">dfpred</span><span class="op">$</span><span class="va">prt_veg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">nvl_bases</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'spline'</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">basisdf</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span></span>
<span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dfpred</span>, <span class="va">nvl_bases</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Définition de la fonction inv.logit, soit l'inverse de la fonction </span></span>
<span><span class="co"># de lien du modèle pour retrouver les prédictions dans l'échelle </span></span>
<span><span class="co"># originales des données</span></span>
<span><span class="va">inv.logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Utilisation des deux modèles pour effectuer les prédictions</span></span>
<span><span class="va">predref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">refmodel</span>, newdata <span class="op">=</span> <span class="va">dfpred</span>, type <span class="op">=</span> <span class="st">'link'</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predmod0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model0</span>, newdata <span class="op">=</span> <span class="va">dfpred</span>, type <span class="op">=</span> <span class="st">'link'</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predmod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model1</span>, newdata <span class="op">=</span> <span class="va">dfpred</span>, type <span class="op">=</span> <span class="st">'link'</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calcul de la valeur prédite et construction des intervalles de confiance</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">polypred</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predref</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">poly025</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predref</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">predref</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">poly975</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predref</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">predref</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">regsplinepred</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predmod0</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">regspline025</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predmod0</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">predmod0</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">regspline975</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predmod0</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">predmod0</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">splinepred</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predmod1</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">spline025</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predmod1</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">predmod1</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">spline975</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">predmod1</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">predmod1</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Créer un graphique pour afficher les résultats</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dfpred</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg</span>, ymin <span class="op">=</span> <span class="va">poly025</span>, ymax <span class="op">=</span> <span class="va">poly975</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg</span>, ymin <span class="op">=</span> <span class="va">spline025</span>, ymax <span class="op">=</span> <span class="va">spline975</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">prt_veg</span>, ymin <span class="op">=</span> <span class="va">regspline025</span>, ymax <span class="op">=</span> <span class="va">regspline975</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">polypred</span>, x <span class="op">=</span> <span class="va">prt_veg</span>, color <span class="op">=</span> <span class="st">"polynomiale"</span><span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">regsplinepred</span>, x <span class="op">=</span> <span class="va">prt_veg</span>, color <span class="op">=</span> <span class="st">"spline de régression"</span><span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">splinepred</span>, x <span class="op">=</span> <span class="va">prt_veg</span>, color <span class="op">=</span> <span class="st">"spline de lissage"</span><span class="op">)</span>,</span>
<span>            linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gam16" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam16-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.16: Comparaison d’une spline et d’une polynomiale</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons que les trois termes renvoient des prédictions très similaires et qu’une légère différence n’est observable que pour les secteurs avec les plus hauts niveaux de végétation (supérieurs à 75&nbsp;%).</p>
<p>Jusqu’ici, nous utilisons l’arrondissement dans lequel est comprise chaque aire de diffusion comme une variable nominale afin de capturer la dimension spatiale du jeu de données. Puisque nous avons abordé la notion de <em>splines</em> bivariées, il serait certainement plus efficace d’en construire une à partir des coordonnées géographiques (<em>x</em>,<em>y</em>) des centroïdes des aires de diffusion. En effet, il est plus probable que la distribution des îlots de chaleur suive un patron spatial continu sur le territoire plutôt que les délimitations arbitraires des arrondissements.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Ajustement du modèle avec une spline bivariée pour l'espace</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notez ici que l’expression <code>s(X,Y)</code> permet de créer une <em>spline</em> bivariée à partir des coordonnées (<em>x, y</em>), soit deux colonnes présentes dans le jeu de données. Ces coordonnées sont exprimées toutes deux en mètres et n’interagissent pas ensemble au sens strict, nous devons donc ajuster une <em>spline</em> bivariée. Si vous avez besoin d’ajuster une <em>spline</em> d’interaction (notamment quand les variables sont dans des unités différentes), il est nécessaire d’utiliser une autre syntaxe <code>te(X,Y)</code> ou <code>t2(X,Y)</code> faisant appel à une structure mathématique légèrement différente, soit des <em>tensor product smooths</em>.</p>
<p>Puisque notre modèle intègre deux <em>splines</em>, nous devons nous assurer que nous n’avons pas de problème de concurvité, ce que nous pouvons faire avec la fonction <code>concurvity</code> du <em>package</em> <code>mgcv</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/concurvity.html">concurvity</a></span><span class="op">(</span><span class="va">model2</span>, full <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Worst, estimation pessimiste de la concurvité</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">values</span><span class="op">$</span><span class="va">worst</span>,<span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           para s(prt_veg) s(X,Y)
para          1      0.000  0.000
s(prt_veg)    0      1.000  0.458
s(X,Y)        0      0.458  1.000</code></pre>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Observed, estimation optimiste de la concurvité</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">values</span><span class="op">$</span><span class="va">observed</span>,<span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           para s(prt_veg) s(X,Y)
para          1      0.000  0.000
s(prt_veg)    0      1.000  0.154
s(X,Y)        0      0.403  1.000</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Estimate, estimation entre deux de la concurvité</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">values</span><span class="op">$</span><span class="va">estimate</span>,<span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           para s(prt_veg) s(X,Y)
para          1      0.000  0.000
s(prt_veg)    0      1.000  0.142
s(X,Y)        0      0.358  1.000</code></pre>
</div>
</div>
<p>Nous pouvons ainsi constater des niveaux de concurvité tout à fait acceptables dans notre modèle. Des valeurs supérieures à 0,8 devraient être considérées comme alarmantes, surtout si elles sont reportées pour <code>observed</code> et <code>estimate</code>.</p>
<p>Voyons désormais, le résumé d’un modèle GAM tel que présenté dans R.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: Beta regression(15.469) 
Link function: logit 

Formula:
hot ~ A65Pct + A014Pct + PopFRPct + PopMVPct + s(prt_veg) + s(X, 
    Y)

Parametric coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.6050031  0.0645191  -9.377  &lt; 2e-16 ***
A65Pct       0.0027671  0.0014072   1.966   0.0493 *  
A014Pct     -0.0019040  0.0027674  -0.688   0.4914    
PopFRPct     0.0095992  0.0014323   6.702 2.06e-11 ***
PopMVPct     0.0010113  0.0008159   1.239   0.2152    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
             edf Ref.df Chi.sq p-value    
s(prt_veg)  6.38  7.565   6731  &lt;2e-16 ***
s(X,Y)     27.10 28.764   1349  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.891   Deviance explained = 90.8%
-REML = -3234.3  Scale est. = 1         n = 3157</code></pre>
</div>
</div>
<p>La première partie du résumé comprend les résultats pour les effets fixes et linéaires du modèle. Ils s’interprètent comme pour ceux d’un GLM classique. La seconde partie présente les résultats pour les termes non linéaires. La valeur de <em>p</em> permet de déterminer si la <em>spline</em> a ou non un effet différent de 0. Une valeur non significative indique que la <em>spline</em> ne contribue pas au modèle. Les colonnes <em>edf</em> et <em>Ref.df</em> indiquent la complexité de la <em>spline</em> et peuvent être considérées comme une approximation du nombre de nœuds. Dans notre cas, la <em>spline</em> spatiale (<code>s(X,Y)</code>) est environ 5 fois plus complexe que la <em>spline</em> ajustée pour la végétation (<code>s(prt_veg)</code>). Cela n’est pas surprenant puisque la dimension spatiale (<em>spline</em> bivariée) du phénomène est certainement plus complexe que l’effet de la végétation. Notez ici que des valeurs <em>edf</em> et <em>Ref.df</em> proches de 1 signaleraient que l’effet d’un prédicteur est essentiellement linéaire et qu’il n’est pas nécessaire de recourir à une <em>spline</em> pour cette variable.</p>
<p>La dernière partie du résumé comprend deux indicateurs de qualité d’ajustement, soit le R<sup>2</sup> ajusté et la part de la déviance expliquée.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">refmodel</span>, <span class="va">model1</span>, <span class="va">model2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               df       AIC
refmodel 40.00000 -6399.784
model1   44.61065 -6417.562
model2   40.06053 -6596.884</code></pre>
</div>
</div>
<p>Nous pouvons constater que le fait d’introduire la <em>spline</em> spatiale dans le modèle contribue à réduire encore la valeur de l’AIC, et donc à améliorer le modèle. À ce stade, nous pourrions tenter de forcer la <em>spline</em> à être plus complexe en augmentant le nombre de nœuds.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Augmentation de la complexité de la spline spatiale</span></span>
<span><span class="va">model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,k <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">refmodel</span>, <span class="va">model1</span>, <span class="va">model2</span>, <span class="va">model3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               df       AIC
refmodel 40.00000 -6399.784
model1   44.61065 -6417.562
model2   40.06053 -6596.884
model3   48.28633 -6639.955</code></pre>
</div>
</div>
<p>Cela a pour effet d’améliorer de nouveau le modèle. Pour vérifier si l’augmentation du nombre nœuds est judicieuse, il est possible de représenter le résultat des deux <em>splines</em> précédentes. Pour ce faire, nous proposons de calculer les valeurs prédites de la <em>spline</em> pour chaque localisation dans notre terrain d’étude, en le découpant préalablement en pixels de 100 de côté. Pour cette prédiction, nous maintenons toutes les autres variables à leur moyenne respective afin d’évaluer uniquement l’effet de la <em>spline</em> spatiale.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/metR/">metR</a></span><span class="op">)</span> <span class="co"># pour placer des étiquettes sur les isolignes</span></span>
<span></span>
<span><span class="co"># Création d'un DataFrame fictif pour les prédictions</span></span>
<span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  prt_veg <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">prt_veg</span><span class="op">)</span>,</span>
<span>  A65Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">A65Pct</span><span class="op">)</span>,</span>
<span>  A014Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">A014Pct</span><span class="op">)</span>,</span>
<span>  PopFRPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">PopFRPct</span><span class="op">)</span>,</span>
<span>  PopMVPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">PopMVPct</span><span class="op">)</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>,<span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">predicted1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model2</span>, newdata <span class="op">=</span> <span class="va">dfpred</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">predicted2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model3</span>, newdata <span class="op">=</span> <span class="va">dfpred</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Centrage des prédictions</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">predicted1</span> <span class="op">&lt;-</span> <span class="va">dfpred</span><span class="op">$</span><span class="va">predicted1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">predicted1</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">predicted2</span> <span class="op">&lt;-</span> <span class="va">dfpred</span><span class="op">$</span><span class="va">predicted2</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">predicted2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Représentation des splines</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">dfpred</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, fill <span class="op">=</span> <span class="va">predicted1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, data <span class="op">=</span> <span class="va">dataset</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_contour</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, z <span class="op">=</span> <span class="va">predicted1</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"white"</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://eliocamp.github.io/metR/reference/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, z <span class="op">=</span> <span class="va">predicted1</span><span class="op">)</span>, </span>
<span>                    color <span class="op">=</span> <span class="st">"white"</span>, binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title<span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span>  <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"spline de base"</span>, fill <span class="op">=</span> <span class="st">"prédictions"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">dfpred</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, fill <span class="op">=</span> <span class="va">predicted2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"black"</span>, data <span class="op">=</span> <span class="va">dataset</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_contour</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, z <span class="op">=</span> <span class="va">predicted2</span><span class="op">)</span>,</span>
<span>               binwidth <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"white"</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://eliocamp.github.io/metR/reference/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, z <span class="op">=</span> <span class="va">predicted2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, binwidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.title<span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span>  <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"spline plus complexe"</span>, fill <span class="op">=</span> <span class="st">"prédictions"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gam17" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-gam17-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.17: Comparaison de deux splines spatiales</figcaption></figure>
</div>
</div>
</div>
<p>Or, il s’avère que les deux <em>splines</em> spatiales sont très similaires (<a href="#fig-gam17">figure&nbsp;<span>11.17</span></a>). Par conséquent, il est vraisemblablement plus pertinent de conserver la plus simple des deux. Notez que le Mont-Royal, compris dans le cercle central avec une isoligne à 0, est caractérisé par des valeurs plus faibles d’îlots de chaleur, alors que les quartiers centraux situés un peu plus au nord sont au contraire marqués par des pourcentages d’îlots de chaleur supérieurs de 20 points de pourcentage en moyenne.</p>
</section><section id="sec-117" class="level2" data-number="11.7"><h2 data-number="11.7" class="anchored" data-anchor-id="sec-117">
<span class="header-section-number">11.7</span> GAMM</h2>
<p>Bien entendu, il est possible de combiner les modèles généralisés additifs (GAM) avec les modèles à effet mixtes (GLMM) abordés dans les sections précédentes. Ces modèles généralisés additifs à effets mixtes (GAMM) peuvent facilement être mis en œuvre avec <code>mgcv</code>.</p>
<section id="sec-1171" class="level4" data-number="11.7.0.1"><h4 data-number="11.7.0.1" class="anchored" data-anchor-id="sec-1171">
<span class="header-section-number">11.7.0.1</span> GAMM et interceptes aléatoires</h4>
<p>Pour définir des constantes aléatoires, il suffit d’utiliser la notation <code>s(var, bs = 're')</code> avec <code>var</code> une variable nominale. Reprenons l’exemple précédent, mais avec cette fois-ci les arrondissements comme un intercepte aléatoire.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dataset</span><span class="op">$</span><span class="va">Arrond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Arrond</span><span class="op">)</span></span>
<span><span class="va">model4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">Arrond</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’enjeu est ensuite d’extraire la variance propre à cet effet aléatoire ainsi que les valeurs des interceptes pour chaque arrondissement.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.vcomp.html">gam.vcomp</a></span><span class="op">(</span><span class="va">model4</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Standard deviations and 0.95 confidence intervals:

               std.dev       lower      upper
s(prt_veg) 0.007047166 0.003785275 0.01311993
s(Arrond)  0.393539474 0.302707198 0.51162747

Rank: 2/2</code></pre>
</div>
</div>
<p>Nous constatons donc que l’écart-type de l’effet aléatoire des arrondissements est de 0,39, ce qui signifie que les effets de chaque arrondissement seront compris à 95&nbsp;% entre -1,17 et 1,17 (<code>1.17 = 3*0.39</code>) sur l’échelle du prédicteur linéaire. En effet, rappelons que les effets aléatoires sont modélisés comme des distributions normales et que 95&nbsp;% de la densité d’une distribution normale se situe entre -3 et +3 écarts-types. Pour extraire les interceptes spécifiques de chaque arrondissement, nous pouvons utiliser la fonction <code>get_random</code> du <em>package</em> <code>itsadug.</code></p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">itsadug</span><span class="op">)</span></span>
<span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/get_random.html">get_random</a></span><span class="op">(</span><span class="va">model4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  ri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span>,</span>
<span>  arrond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ri</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">arrond</span>, <span class="va">ri</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Arrondissement"</span>, x <span class="op">=</span> <span class="st">"intercepte aléatoire"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstGAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-randomconstGAM-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11.18: Constantes aléatoires pour les arrondissements</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons ainsi, à la <a href="#fig-randomconstGAM">figure&nbsp;<span>11.18</span></a>, que pour une partie des arrondissements, la densité d’îlot de chaleur est systématiquement supérieure à la moyenne régionale représentée ici par la ligne rouge (0 = effet moyen pour tous les arrondissements). Il convient alors d’améliorer ce graphique en ajoutant le niveau d’incertitude associé à chaque intercepte. Pour ce faire, nous utilisons la fonction <code>extract_random_effects</code> du <em>package</em> <code>mixedup.</code> Notez que ce <em>package</em> n’est actuellement pas disponible sur CRAN et doit être téléchargé sur <strong>github</strong> avec la commande suivante&nbsp;:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">'m-clark/mixedup'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Avec la version 4.0.1 de R, nous avons rencontré des difficultés pour installer <code>mixedup</code>. Nous avons donc simplement récupéré le code source de la fonction et l’avons enregistré dans un fichier de code séparé que nous appelons ici.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"code_complementaire/gam_functions.R"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons ensuite procéder à l’extraction des effets aléatoires et les représenter à nouveau (<a href="#fig-randomconstGAM2">figure&nbsp;<span>11.19</span></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_re</span> <span class="op">&lt;-</span> <span class="fu">extract_random_effects.gam</span><span class="op">(</span><span class="va">model4</span>, re <span class="op">=</span> <span class="st">"Arrond"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df_re</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower_2.5</span>, xmax <span class="op">=</span> <span class="va">upper_97.5</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Arrondissement"</span>, x <span class="op">=</span> <span class="st">"Intercepte aléatoire"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstGAM2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-randomconstGAM2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11.19: Constantes aléatoires pour les arrondissements avec intervalle de confiance</figcaption></figure>
</div>
</div>
</div>
<p>Cela permet de distinguer quels écarts sont significativement différents de 0 au seuil de 95&nbsp;%. À titre de rappel, pour être significatif à ce seuil, un intervalle représenté par une ligne noire horizontale ne doit pas intersecter la ligne rouge verticale. Puisque nous utilisons ici la distribution bêta et une fonction de lien logistique, nous devons utiliser des prédictions pour simplifier l’interprétation des coefficients. Nous fixons ici toutes les variables à leur moyenne respective, sauf l’arrondissement, et calculons les prédictions dans l’échelle originale (0 à 1).</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  A65Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">A65Pct</span><span class="op">)</span>,</span>
<span>  A014Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">A014Pct</span><span class="op">)</span>,</span>
<span>  PopFRPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">PopFRPct</span><span class="op">)</span>,</span>
<span>  PopMVPct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">PopMVPct</span><span class="op">)</span>,</span>
<span>  prt_veg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">prt_veg</span><span class="op">)</span>,</span>
<span>  Arrond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Arrond</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculer les prédictions pour le prédicteur linéaire</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model4</span>, newdata <span class="op">=</span> <span class="va">dfpred</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculer l'intervalle de confiance en utilisant les valeurs</span></span>
<span><span class="co"># extraites avec extract_random_effects</span></span>
<span><span class="va">dfpred</span> <span class="op">&lt;-</span> <span class="va">dfpred</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">Arrond</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">df_re</span> <span class="op">&lt;-</span> <span class="va">df_re</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">df_re</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="va">dfpred</span><span class="op">$</span><span class="va">preds</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">df_re</span><span class="op">$</span><span class="va">se</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="va">dfpred</span><span class="op">$</span><span class="va">preds</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="va">df_re</span><span class="op">$</span><span class="va">se</span></span>
<span></span>
<span><span class="co"># Il nous reste juste à reconvertir le tout dans l'unité d'origine</span></span>
<span><span class="co"># en utilisant l'inverse de la fonction logistique</span></span>
<span><span class="va">inv.logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">lower</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span></span>
<span><span class="va">dfpred</span><span class="op">$</span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu">inv.logit</span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">preds</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">dfpred</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower</span>, xmax <span class="op">=</span> <span class="va">upper</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrond</span>, <span class="va">preds</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">preds</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">Arrond</span>, <span class="va">preds</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dfpred</span><span class="op">$</span><span class="va">preds</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Arrondissement"</span>, x <span class="op">=</span> <span class="st">"intercepte aléatoire"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstGAM3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-randomconstGAM3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11.20: Prédictions pour les différents arrondissements pour une AD fictive moyenne</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons ainsi, à la <a href="#fig-randomconstGAM3">figure&nbsp;<span>11.20</span></a>, que pour une hypothétique aire de diffusion moyenne, la différence de densité d’îlot de chaleur peut être de 0,32 (32&nbsp;% de la surface de l’AD) entre les arrondissements Verdun et Dollard-des-Ormeaux.</p>
</section><section id="sec-1172" class="level4" data-number="11.7.0.2"><h4 data-number="11.7.0.2" class="anchored" data-anchor-id="sec-1172">
<span class="header-section-number">11.7.0.2</span> GAMM et coefficients aléatoires</h4>
<p>En plus des interceptes aléatoires, il est aussi possible de définir des coefficients aléatoires. Reprenons notre exemple et tentons de faire varier l’effet de la variable <code>PopFRPct</code> en fonction de l’arrondissement.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span> <span class="op">+</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">Arrond</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">PopFRPct</span>, <span class="va">Arrond</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/Beta.html">betar</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notez ici une distinction importante! Le modèle n’assume aucune corrélation entre les coefficients aléatoires pour la variable <code>PopFRPct</code> et pour les constantes aléatoires. Il est présumé que ces deux effets proviennent de deux distributions normales distinctes. En d’autres termes, le modèle ne dispose pas des paramètres nécessaires pour vérifier si les arrondissements avec les constantes les plus fortes (avec des densités supérieures d’îlot de chaleur) sont aussi des arrondissements dans lesquels l’effet de la variable <code>PopFRPct</code> est plus prononcé (et vice-versa). Pour plus d’informations sur cette distinction, référez-vous à la <a href="09-GLMM.html#sec-0924">section&nbsp;<span>9.2.3</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">model4</span>, <span class="va">model5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             df       AIC
model4 41.54635 -6421.791
model5 56.84734 -6466.726</code></pre>
</div>
</div>
<p>Ce dernier modèle présente une valeur de l’AIC plus faible et serait donc ainsi mieux ajusté que notre modèle avec seulement un intercepte aléatoire. Nous pouvons donc extraire les coefficients aléatoires et les représenter à la <a href="#fig-randomconstcoefGAM">figure&nbsp;<span>11.21</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_re</span> <span class="op">&lt;-</span> <span class="fu">extract_random_effects.gam</span><span class="op">(</span><span class="va">model5</span><span class="op">)</span></span>
<span><span class="va">df_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">df_re</span>, <span class="va">df_re</span><span class="op">$</span><span class="va">effect</span> <span class="op">==</span> <span class="st">'PopFRPct'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df_re</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_errorbarh</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lower_2.5</span>, xmax <span class="op">=</span> <span class="va">upper_97.5</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Arrondissement"</span>, x <span class="op">=</span> <span class="st">"coefficient aléatoire"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-randomconstcoefGAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-randomconstcoefGAM-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11.21: Pentes et constantes aléatoires pour les arrondissements</figcaption></figure>
</div>
</div>
</div>
<p>Nous constatons notamment que seuls trois arrondissements ont des coefficients aléatoires significativement différents de 0. Ainsi, pour les arrondissements Anjou et Plateau-Mont-Royal, les coefficients aléatoires sont respectivement de -0,013 et -0,015, et viennent donc se retrancher à la valeur moyenne régionale de 0,0154 qui atteint alors presque 0. Du point de vue de l’interprétation, nous pouvons en conclure que le groupe des personnes à faible revenu ne subit pas de surexposition aux îlots de chaleur à l’échelle des AD dans ces arrondissements.</p>
<p>En revanche, dans l’arrondissement Mercier-Hochelaga-Maisonneuve, la situation est à l’inverse plus systématiquement en défaveur des populations à faible revenu, avec une taille d’effet près de deux fois supérieure à la moyenne régionale. En effet, l’effet moyen régional (coefficient fixe) est de 0,0154, auquel vient s’ajouter l’effet spécifique (coefficient aléatoire) de Mercier-Hochelaga-Maisonneuve, soit 0,011, pour un effet total de 0,0264</p>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Des effets aléatoires plus complexes dans les GAMM</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Il est possible de spécifier des GAMM avec des effets aléatoires plus complexes autorisant, par exemple, des corrélations entre les différents effets / niveaux. Il faut pour cela utiliser la fonction <code>gamm</code> de <code>mgcv</code> ou la fonction <code>gamm4</code> du <em>package</em> <code>gamm4.</code> La première offre plus de flexibilité, mais la seconde est plus facile à utiliser et doit être privilégiée quand un modèle comporte un très grand nombre de groupes dans un effet aléatoire, ou lorsque la distribution du modèle n’est pas gaussienne. La fonction <code>gamm</code> permet d’ajuster des modèles non gaussiens, mais elle utilise une approche appelée PQL (<em>Penalized Quasi-Likelihood</em> en anglais) connue pour être moins stable et moins précise.</p>
<p>Cependant, dans l’exemple de cette section, nous utilisons un modèle GAMM avec une distribution bêta, ce qui n’est actuellement pas supporté par les fonctions <code>gamm</code> et <code>gamm4</code>. Pour un modèle GAMM plus complexe utilisant une distribution bêta, il est nécessaire d’utiliser le <em>package</em> <code>gamlss</code>, mais ce dernier utilise aussi une approche de type PQL. Nous montrons tout de même ici comment ajouter un modèle qui inclut une corrélation entre les deux effets aléatoires de l’exemple précédent. Notez ici que le terme <code>re</code> apparaissant dans la formule permet de spécifier un effet aléatoire en utilisant la syntaxe du <em>package</em> <code>nlme.</code> Plus spécifiquement, <code>gamlss</code> fait un pont avec <code>nlme</code> et utilise son algorithme d’ajustement au sein de ces propres routines. De même, le terme <code>pb</code> permet de spécifier une <em>spline</em> de lissage dans le même esprit que <code>mgcv.</code> Il est également possible d’utiliser le terme <code>ga</code> faisant le lien avec <code>mgcv</code> et de profiter de sa flexibilité dans <code>gamlss</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.gamlss.com/">gamlss</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.gamlss.com/">gamlss.add</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss/man/gamlss.html">gamlss</a></span><span class="op">(</span><span class="va">hot</span> <span class="op">~</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/gamlss/man/ps.html">pb</a></span><span class="op">(</span><span class="va">prt_veg</span><span class="op">)</span> <span class="op">+</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/gamlss/man/random.html">re</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="op">~</span> <span class="va">A65Pct</span> <span class="op">+</span> <span class="va">A014Pct</span> <span class="op">+</span> <span class="va">PopFRPct</span> <span class="op">+</span> <span class="va">PopMVPct</span>, </span>
<span>             random <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">PopFRPct</span><span class="op">)</span><span class="op">|</span><span class="va">Arrond</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">dataset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gamlss.dist/man/BE.html">BE</a></span><span class="op">(</span>mu.link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nous pouvons ensuite accéder à la partie du modèle qui nous intéresse, soit celle concernant les effets aléatoires.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">randomPart</span> <span class="op">&lt;-</span> <span class="va">model6</span><span class="op">$</span><span class="va">mu.coefSmo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">randomPart</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by maximum likelihood
  Data: Data 
  Log-likelihood: -2964.494
  Fixed: fix.formula 
 (Intercept)       A65Pct      A014Pct     PopFRPct     PopMVPct 
-0.060862840 -0.001945204 -0.010139278  0.017259606 -0.002599745 

Random effects:
 Formula: ~(1 + PopFRPct) | Arrond
 Structure: General positive-definite, Log-Cholesky parametrization
            StdDev     Corr  
(Intercept) 0.47298363 (Intr)
PopFRPct    0.01078909 -0.646
Residual    0.99888012       

Variance function:
 Structure: fixed weights
 Formula: ~W.var 
Number of Observations: 3157
Number of Groups: 33 </code></pre>
</div>
</div>
<p>À lecture de la partie du résumé consacrée aux résultats pour les effets aléatoires, nous constatons que la corrélation entre les interceptes aléatoires et les coefficients aléatoires est de -0,65. Cela signifie que pour les arrondissements avec des interceptes élevés (plus grande proportion d’îlots de chaleur), l’effet de la variable <code>PopFRPct</code> tend à être plus faible. Autrement dit, dans les arrondissements avec beaucoup d’îlots de chaleur, les personnes à faible revenu ont tendance à être moins exposées, tel qu’illustré à la <a href="#fig-corrrandom">figure&nbsp;<span>11.22</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/random.effects.html">ranef</a></span><span class="op">(</span><span class="va">randomPart</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">arrond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Intercept'</span>, <span class="st">'PopFRPct'</span>, <span class="st">'Arrondissement'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Intercept</span>, y <span class="op">=</span> <span class="va">PopFRPct</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-corrrandom" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="11-GAM_files/figure-html/fig-corrrandom-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;11.22: Relation entre les effets aléatoires des arrondissements et la variable population à faible revenu</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="sec-118" class="level2" data-number="11.8"><h2 data-number="11.8" class="anchored" data-anchor-id="sec-118">
<span class="header-section-number">11.8</span> Quiz de révision du chapitre</h2>
<div id="quizz_gam" class="card">
<link type="text/javascript" src="libs/quizlib.1.0.1.min.js">
<script>var Quiz=function(a,b){this.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),this.unansweredQuestionText="Question sans réponse !",this.container=document.getElementById(a),this.questions=[],this.result=new QuizResult,this.answers=b;for(var c=0;c<this.container.children.length;c++)this.container.children[c].classList.contains(Quiz.Classes.QUESTION)&&this.questions.push(this.container.children[c]);if(this.answers.length!=this.questions.length)throw new Error("Number of answers does not match number of questions!")};Quiz.Classes=Object.freeze({QUESTION:"quizlib-question",QUESTION_TITLE:"quizlib-question-title",QUESTION_ANSWERS:"quizlib-question-answers",QUESTION_WARNING:"quizlib-question-warning",CORRECT:"quizlib-correct",INCORRECT:"quizlib-incorrect",TEMP:"quizlib-temp"}),Quiz.prototype.checkAnswers=function(a){void 0===a&&(a=!0);for(var b=[],c=[],d=0;d<this.questions.length;d++){var e=this.questions[d],f=this.answers[d],g=[];this.clearHighlights(e);for(var h,i=e.getElementsByClassName(Quiz.Classes.QUESTION_ANSWERS)[0].getElementsByTagName("input"),j=0;j<i.length;j++)h=i[j],"checkbox"===h.type||"radio"===h.type?h.checked&&g.push(h.value):""!==h.value&&g.push(h.value);1!=g.length||Array.isArray(f)?0===g.length&&b.push(e):g=g[0],c.push(Utils.compare(g,f))}if(0===b.length||!a)return this.result.setResults(c),!0;for(d=0;d<b.length;d++){var k=document.createElement("span");k.appendChild(document.createTextNode(this.unansweredQuestionText)),k.className=Quiz.Classes.QUESTION_WARNING,b[d].getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].appendChild(k)}return!1},Quiz.prototype.clearHighlights=function(a){for(var b=a.getElementsByClassName(Quiz.Classes.QUESTION_WARNING);b.length>0;)b[0].parentNode.removeChild(b[0]);var c,d=[a.getElementsByClassName(Quiz.Classes.CORRECT),a.getElementsByClassName(this.Classes.INCORRECT)];for(i=0;i<d.length;i++)for(;d[i].length>0;)c=d[i][0],c.classList.remove(Quiz.Classes.CORRECT),c.classList.remove(Quiz.Classes.INCORRECT);for(var e=a.getElementsByClassName(Quiz.Classes.TEMP);e.length>0;)e[0].parentNode.removeChild(e[0])},Quiz.prototype.highlightResults=function(a){for(var b,c=0;c<this.questions.length;c++)b=this.questions[c],b.getElementsByClassName(Quiz.Classes.QUESTION_TITLE)[0].classList.add(this.result.results[c]?Quiz.Classes.CORRECT:Quiz.Classes.INCORRECT),void 0!==a&&a(this,b,c,this.result.results[c])};var QuizResult=function(){this.results=[],this.totalQuestions=0,this.score=0,this.scorePercent=0,this.scorePercentFormatted=0};QuizResult.prototype.setResults=function(a){this.results=a,this.totalQuestions=this.results.length,this.score=0;for(var b=0;b<this.results.length;b++)this.results[b]&&this.score++;this.scorePercent=this.score/this.totalQuestions,this.scorePercentFormatted=Math.floor(100*this.scorePercent)};var Utils=function(){};Utils.compare=function(a,b){if(a.length!=b.length)return!1;if(Array.isArray(a)&&Array.isArray(b)){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return a===b};

function showResults(quiz) {
    // Check answers and continue if all questions have been answered
    if (quiz.checkAnswers()) {
        var quizScorePercent = quiz.result.scorePercentFormatted; // The unformatted percentage is a decimal in range 0 - 1
        var quizResultElement = document.getElementById('quiz-result');
        quizResultElement.style.display = 'block';
        document.getElementById('quiz-percent').innerHTML = quizScorePercent.toString();

        // Change background colour of results div according to score percent
        if (quizScorePercent > 75) quizResultElement.style.backgroundColor = '#4caf50';
        else if (quizScorePercent > 50) quizResultElement.style.backgroundColor = '#ffc107';
        else if (quizScorePercent > 25) quizResultElement.style.backgroundColor = '#ff9800';
        else if (quizScorePercent > 0) quizResultElement.style.backgroundColor = '#f44336';

        // Highlight questions according to whether they were correctly answered. The callback allows us to highlight/show the correct answer
        quiz.highlightResults(handleAnswers);
    }
}

/** Callback for Quiz.highlightResults. Highlights the correct answers of incorrectly answered questions
 * Parameters are: the quiz object, the question element, question number, correctly answered flag
 */
function handleAnswers(quiz, question, no, correct) {
    if (!correct) {
        var answers = question.getElementsByTagName('input');
        for (var i = 0; i < answers.length; i++) {
            if (answers[i].type === 'checkbox' || answers[i].type === 'radio'){
                // If the current input element is part of the correct answer, highlight it
                if (quiz.answers[no].indexOf(answers[i].value) > -1) {
                    answers[i].parentNode.classList.add(Quiz.Classes.CORRECT);
                }
            } else {
                // If the input is anything other than a checkbox or radio button, show the correct answer next to the element
                var correctAnswer = document.createElement('span');
                correctAnswer.classList.add(Quiz.Classes.CORRECT);
                correctAnswer.classList.add(Quiz.Classes.TEMP); // quiz.checkAnswers will automatically remove elements with the temp class
                correctAnswer.innerHTML = quiz.answers[no];
                correctAnswer.style.marginLeft = '10px';
                answers[i].parentNode.insertBefore(correctAnswer, answers[i].nextSibling);
            }
        }
    }
}

  var quizz_quizz_gam;
  window.onload = function() {
    quizz_quizz_gam = new Quiz('quizz_gam', ['2','3','3','1',['1', '2', '3'],'2','1',['1', '3']]);
  };</script><link rel="stylesheet" type="text/css" src="css/quizlib.min.css">
<div class="card quizlib-question">
<div class="quizlib-question-title">
Que signifie l’acronyme GAM?
</div>
<div>
Relisez l’introduction du <a href="#sec-chap11">chapitre&nbsp;<span>11</span></a> au besoin.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Gaussian Asymetric Model</label>
</td>
<td>
<input type="radio" name="q1" value="1">
</td>
</tr>
<tr>
<td>
<label>Generalized Additive Model</label>
</td>
<td>
<input type="radio" name="q1" value="2">
</td>
</tr>
<tr>
<td>
<label>Gaussian Asynchronus Model</label>
</td>
<td>
<input type="radio" name="q1" value="3">
</td>
</tr>
<tr>
<td>
<label>Generalized Asymetric Model</label>
</td>
<td>
<input type="radio" name="q1" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Quel est l’intérêt d’un modèle GAM comparativement à un modèle GLM?
</div>
<div>
Relisez au besoin la <a href="#sec-111">section&nbsp;<span>11.1</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>La possibilité d’ajuster n’importe quelle distribution dans le modèle</label>
</td>
<td>
<input type="radio" name="q2" value="1">
</td>
</tr>
<tr>
<td>
<label>La possibilité de tenir compte de structures de corrélation entre les observations</label>
</td>
<td>
<input type="radio" name="q2" value="2">
</td>
</tr>
<tr>
<td>
<label>L’ajout de termes nonlinéaires pour les prédicteurs</label>
</td>
<td>
<input type="radio" name="q2" value="3">
</td>
</tr>
<tr>
<td>
<label>La transformation de la variable Y pour quelle se rapproche d’une distribution normale</label>
</td>
<td>
<input type="radio" name="q2" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une spline ajustée sur une variable X dans un GAM est construite comme :
</div>
<div>
Relisez au besoin la <a href="#sec-1114">section&nbsp;<span>11.1.4</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>un ensemble de coefficients ajustés à différentes sections de la variable X identifiées par des points de ruptures</label>
</td>
<td>
<input type="radio" name="q3" value="1">
</td>
</tr>
<tr>
<td>
<label>la somme d’un ensemble de polynomiales de X multipliées par des coefficients ajustés par le modèle</label>
</td>
<td>
<input type="radio" name="q3" value="2">
</td>
</tr>
<tr>
<td>
<label>la somme d’un ensemble de fonctions de base appliquées à X et multipliées par des coefficients ajustés par le modèle</label>
</td>
<td>
<input type="radio" name="q3" value="3">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le degré de complexité d’une spline est contrôlé par :
</div>
<div>
Relisez au besoin la <a href="#sec-1114">section&nbsp;<span>11.1.4</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>le nombre de nœuds de la spline</label>
</td>
<td>
<input type="radio" name="q4" value="1">
</td>
</tr>
<tr>
<td>
<label>le nombre de variables X sur lesquelles la spline est ajustée</label>
</td>
<td>
<input type="radio" name="q4" value="2">
</td>
</tr>
<tr>
<td>
<label>le type de fonction de base de la spline</label>
</td>
<td>
<input type="radio" name="q4" value="3">
</td>
</tr>
<tr>
<td>
<label>la distribution du modèle</label>
</td>
<td>
<input type="radio" name="q4" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Le nombre de nœuds d’une spline peut être :
</div>
<div>
Relisez au besoin la <a href="#sec-113">section&nbsp;<span>11.3</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>défini manuellement, nous parlons alors de spline de régression</label>
</td>
<td>
<input type="checkbox" name="q5" value="1">
</td>
</tr>
<tr>
<td>
<label>déterminé par une approche automatique appelée pénalisation de la vraisemblance, nous parlons alors de spline de lissage</label>
</td>
<td>
<input type="checkbox" name="q5" value="2">
</td>
</tr>
<tr>
<td>
<label>déterminé automatiquement en reparamétrisant la spline comme un effet aléatoire, nous parlons alors de spline de lissage</label>
</td>
<td>
<input type="checkbox" name="q5" value="3">
</td>
</tr>
<tr>
<td>
<label>déterminé de façon itérative en ajoutant un nœud à chaque fois et en comparant le R2 de Nagelkerke</label>
</td>
<td>
<input type="checkbox" name="q5" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une spline bivariée est un autre nom pour une spline d’interaction.
</div>
<div>
Relisez au besoin la <a href="#sec-115">section&nbsp;<span>11.5</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q6" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q6" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Une spline peut être ajustée sur plus que deux variables X simultanément.
</div>
<div>
Relisez au besoin la <a href="#sec-115">section&nbsp;<span>11.5</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>Vrai</label>
</td>
<td>
<input type="radio" name="q7" value="1">
</td>
</tr>
<tr>
<td>
<label>Faux</label>
</td>
<td>
<input type="radio" name="q7" value="2">
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="card quizlib-question">
<div class="quizlib-question-title">
Pour interpréter les résultats d’une spline, il est possible de :
</div>
<div>
Relisez au besoin la <a href="#sec-114">section&nbsp;<span>11.4</span></a>.
</div>
<div class="quizlib-question-answers">

<table class="table table-sm table-striped small">
<tbody><tr>
<td>
<label>observer le nombre de degrés de liberté (estimated degree of freedom) de cette dernière pour se faire une idée de son degré de complexité</label>
</td>
<td>
<input type="checkbox" name="q8" value="1">
</td>
</tr>
<tr>
<td>
<label>représenter graphiquement les fonctions de base utilisées par la spline</label>
</td>
<td>
<input type="checkbox" name="q8" value="2">
</td>
</tr>
<tr>
<td>
<label>représenter les prédictions du modèle “toutes choses égales par ailleurs” afin d’obtenir les effets marginaux des termes non linéaires</label>
</td>
<td>
<input type="checkbox" name="q8" value="3">
</td>
</tr>
<tr>
<td>
<label>extraire les coefficients de la spline et les interpréter de façon classique</label>
</td>
<td>
<input type="checkbox" name="q8" value="4">
</td>
</tr>
</tbody></table>
</div>
</div>
<button type="button" onclick="showResults(quizz_quizz_gam);" id="buttonID">
Vérifier votre résultat
</button>
<div id="quiz-result" class="card">
<p><span id="quiz-percent"></span></p>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-2020_3" class="csl-entry" role="listitem">
Gelb, Jérémy et Philippe Apparicio. 2020. <span>«&nbsp;Modelling cyclists’ multi-exposure to air and noise pollution with low-cost sensors: The case of Paris.&nbsp;»</span> <em>Atmosphere</em> 11 (4): 422. <a href="https://doi.org/10.3390/atmos11040422">https://doi.org/10.3390/atmos11040422</a>.
</div>
<div id="ref-wood2004stable" class="csl-entry" role="listitem">
Wood, Simon N. 2004. <span>«&nbsp;Stable and efficient multiple smoothing parameter estimation for generalized additive models.&nbsp;»</span> <em>Journal of the American Statistical Association</em> 99 (467): 673‑686. <a href="https://doi.org/10.1198/016214504000000980">https://doi.org/10.1198/016214504000000980</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./10-Multiniveau.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Régressions multiniveaux</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-AnalysesFactorielles.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Méthodes factorielles</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes quantitatives en sciences sociales : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>