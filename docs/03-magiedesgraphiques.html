<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Méthodes quantitatives en sciences sociales : un grand bol d’R - 3&nbsp; Magie des graphiques</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-bivarieeQuantiQuanti.html" rel="next">
<link href="./02-univarie.html" rel="prev">
<link href="./images/introduction/Couverture.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer"
  }
}</script><link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="site_libs/d3-4.13.0/d3.min.js"></script><script src="site_libs/d3-tip-0.8.1/index.js"></script><link href="site_libs/chorddiag-0.1.2.9000/chorddiag.css" rel="stylesheet">
<script src="site_libs/chorddiag-0.1.2.9000/chorddiag.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="css/quizlib.min.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-magiedesgraphiques.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Magie des graphiques</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Recherche" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Méthodes quantitatives en sciences sociales : un grand bol d’R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/SerieBoldR/MethodesQuantitatives" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-auteurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">À propos des auteurs</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 1. Découverte de R</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-priseenmainR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Prise en main de R</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 2. Analyses univariées et représentations graphiques</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-univarie.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistiques descriptives univariées</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-magiedesgraphiques.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Magie des graphiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 3. Analyses bivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-bivarieeQuantiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relation linéaire entre deux variables quantitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-bivarieeQualiQuali.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Relation entre deux variables qualitatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-bivarieeQualiQuanti.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Relation entre une variable qualitative et une variable quantitative</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 4. Modèles de régression</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-regressionlineaire.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Régression linéaire multiple</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Régressions linéaires généralisées (GLM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-GLMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Régressions à effets mixtes (GLMM)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Multiniveau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Régressions multiniveaux</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-GAM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modèles généralisés additifs</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 5. Analyses exploratoires multivariées</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-AnalysesFactorielles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Méthodes factorielles</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-MethodeClassification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Méthodes de classification non supervisée</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Partie 6. Annexes et bibliographie</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Annexes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Annexes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliographie</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li>
<a href="#sec-031" id="toc-sec-031" class="nav-link active" data-scroll-target="#sec-031"><span class="header-section-number">3.1</span> Philosophie du ggplot2</a>
  <ul class="collapse">
<li><a href="#sec-0311" id="toc-sec-0311" class="nav-link" data-scroll-target="#sec-0311"><span class="header-section-number">3.1.1</span> Grammaire</a></li>
  <li><a href="#sec-0312" id="toc-sec-0312" class="nav-link" data-scroll-target="#sec-0312"><span class="header-section-number">3.1.2</span> Types de géométries</a></li>
  <li><a href="#sec-0313" id="toc-sec-0313" class="nav-link" data-scroll-target="#sec-0313"><span class="header-section-number">3.1.3</span> Habillage</a></li>
  <li><a href="#utilisation-des-th%C3%A8mes" id="toc-utilisation-des-thèmes" class="nav-link" data-scroll-target="#utilisation-des-th%C3%A8mes"><span class="header-section-number">3.1.4</span> Utilisation des thèmes</a></li>
  <li><a href="#sec-0314" id="toc-sec-0314" class="nav-link" data-scroll-target="#sec-0314"><span class="header-section-number">3.1.5</span> Composition d’une figure avec plusieurs graphiques</a></li>
  <li><a href="#sec-0315" id="toc-sec-0315" class="nav-link" data-scroll-target="#sec-0315"><span class="header-section-number">3.1.6</span> Couleur</a></li>
  </ul>
</li>
  <li>
<a href="#sec-032" id="toc-sec-032" class="nav-link" data-scroll-target="#sec-032"><span class="header-section-number">3.2</span> Principaux graphiques</a>
  <ul class="collapse">
<li><a href="#sec-0321" id="toc-sec-0321" class="nav-link" data-scroll-target="#sec-0321"><span class="header-section-number">3.2.1</span> Histogramme</a></li>
  <li><a href="#sec-0322" id="toc-sec-0322" class="nav-link" data-scroll-target="#sec-0322"><span class="header-section-number">3.2.2</span> Graphique de densité</a></li>
  <li><a href="#sec-0323" id="toc-sec-0323" class="nav-link" data-scroll-target="#sec-0323"><span class="header-section-number">3.2.3</span> Nuage de points</a></li>
  <li><a href="#sec-0324" id="toc-sec-0324" class="nav-link" data-scroll-target="#sec-0324"><span class="header-section-number">3.2.4</span> Graphique en ligne</a></li>
  <li><a href="#sec-0325" id="toc-sec-0325" class="nav-link" data-scroll-target="#sec-0325"><span class="header-section-number">3.2.5</span> Boîte à moustaches</a></li>
  <li><a href="#sec-0326" id="toc-sec-0326" class="nav-link" data-scroll-target="#sec-0326"><span class="header-section-number">3.2.6</span> Graphique en violon</a></li>
  <li><a href="#sec-0327" id="toc-sec-0327" class="nav-link" data-scroll-target="#sec-0327"><span class="header-section-number">3.2.7</span> Graphique en barres</a></li>
  <li><a href="#sec-0328" id="toc-sec-0328" class="nav-link" data-scroll-target="#sec-0328"><span class="header-section-number">3.2.8</span> Graphique circulaire</a></li>
  </ul>
</li>
  <li>
<a href="#sec-033" id="toc-sec-033" class="nav-link" data-scroll-target="#sec-033"><span class="header-section-number">3.3</span> Graphiques spéciaux</a>
  <ul class="collapse">
<li><a href="#sec-0331" id="toc-sec-0331" class="nav-link" data-scroll-target="#sec-0331"><span class="header-section-number">3.3.1</span> Graphique en radar</a></li>
  <li><a href="#sec-0332" id="toc-sec-0332" class="nav-link" data-scroll-target="#sec-0332"><span class="header-section-number">3.3.2</span> Diagramme d’accord</a></li>
  <li><a href="#sec-0333" id="toc-sec-0333" class="nav-link" data-scroll-target="#sec-0333"><span class="header-section-number">3.3.3</span> Nuage de mots</a></li>
  <li><a href="#sec-0334" id="toc-sec-0334" class="nav-link" data-scroll-target="#sec-0334"><span class="header-section-number">3.3.4</span> Carte proportionnelle</a></li>
  </ul>
</li>
  <li><a href="#sec-034" id="toc-sec-034" class="nav-link" data-scroll-target="#sec-034"><span class="header-section-number">3.4</span> Cartes</a></li>
  <li><a href="#sec-035" id="toc-sec-035" class="nav-link" data-scroll-target="#sec-035"><span class="header-section-number">3.5</span> Exportation des graphiques</a></li>
  <li><a href="#sec-036" id="toc-sec-036" class="nav-link" data-scroll-target="#sec-036"><span class="header-section-number">3.6</span> Conclusion sur les graphiques</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/SerieBoldR/MethodesQuantitatives/issues/new" class="toc-action">Signaler un problème ou<br>formuler une suggestion</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-chap03" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Magie des graphiques</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Dans ce chapitre, nous découvrons les incroyables capacités graphiques de R. Pour ce faire, nous couvrons en profondeur les fonctionnalités du <em>package</em> <code>ggplot2</code> du <code>tidyverse</code>. Selon nous, il s’agit de loin du meilleur <em>package</em> pour réaliser des graphiques.</p>
<div class="bloc_package">
<div class="bloc_package-header">
<div class="bloc_package-icon">

</div>
<p><strong>Liste des <em>packages</em> utilisés dans ce chapitre</strong></p>
</div>
<div class="bloc_package-body">
<ul>
<li>Pour créer des graphiques&nbsp;:
<ul>
<li>
<code>ggplot2</code>, le seul, l’unique!</li>
<li>
<code>ggpubr</code> pour combiner des graphiques.</li>
<li>
<code>ggthemes</code> pour utiliser des thèmes complémentaires pour les graphiques.</li>
</ul>
</li>
<li>Pour les couleurs&nbsp;:
<ul>
<li>
<code>RColorBrewer</code> pour accéder à des palettes de couleurs.</li>
</ul>
</li>
<li>Pour les graphiques spéciaux&nbsp;:
<ul>
<li>
<code>chorddiag</code> pour construire des graphiques d’accord.</li>
<li>
<code>fmsb</code> pour construire des graphiques en radar.</li>
<li>
<code>treemap</code> pour construire une carte proportionnelle.</li>
<li>
<code>wordcloud2</code> et <code>textrank</code> pour construire un nuage de mots.</li>
</ul>
</li>
<li>Pour les cartes&nbsp;:
<ul>
<li>
<code>classInt</code> pour calculer les intervalles des classes.</li>
<li>
<code>ggspatial</code> pour afficher une échelle avec <code>ggplot2</code>.</li>
<li>
<code>tmap</code> pour la cartographie.</li>
</ul>
</li>
<li>Autres <em>packages</em>&nbsp;:
<ul>
<li>
<code>dplyr</code> et <code>reshape2</code> pour manipuler des données.</li>
<li>
<code>pdftools</code> pour extraire les textes des fichiers <em>pdf</em>.</li>
<li>
<code>udpipe</code> pour obtenir des dictionnaires linguistiques.</li>
<li>
<code>sf</code> pour manipuler des <em>simple feature collections</em>.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="bloc_notes">
<div class="bloc_notes-header">
<div class="bloc_notes-icon">

</div>
<p><strong>Qu’est-ce que la visualisation de données?</strong></p>
</div>
<div class="bloc_notes-body">
<p>La représentation visuelle de données consiste à transposer des informations en une représentation graphique facilitant la lecture de ces dernières. Il s’agit autant d’un ensemble de méthodes, d’un art que d’un moyen de communication. Voici deux exemples marquants avant de détailler ce propos.</p>
<p>La première illustration permet de visualiser le volume de plastique que représente la consommation d’eau en bouteille&nbsp;: 480 milliards de bouteilles vendues en 10 ans! Ce chiffre astronomique est inimaginable. En revanche, une <a href="https://graphics.reuters.com/ENVIRONMENT-PLASTIC/0100B275155/index.html" target="_blank">montagne de plastique</a> de 2400 mètres surplombant Manhattan marque davantage les esprits.</p>
<p>Le <a href="https://www.maplecroft.com/insights/analysis/84-of-worlds-fastest-growing-cities-face-extreme-climate-change-risks/" target="_blank">second graphique</a> représente quatre informations pour 234 villes à travers le monde&nbsp;:</p>
<ul>
<li><p>la croissance démographique (axe des abscisses),</p></li>
<li><p>la vulnérabilité au changement climatique (axe des ordonnées),</p></li>
<li><p>la taille des villes (taille des cercles),</p></li>
<li><p>le continent sur lequel est localisée chaque ville (couleur des cercles).</p></li>
</ul>
<p>Le graphique est à la fois très accrocheur et esthétique. En un coup d’œil, nous constatons que les villes avec une forte croissance démographique sont aussi les plus vénérables (lecture des deux axes) et qu’elles sont surtout localisées en Afrique et secondairement en Asie (en rouge et orange), quelle que soit leur taille (taille du cercle). À l’inverse, les villes européennes et américaines (en bleu) sont beaucoup moins vulnérables aux changements climatiques et une croissance démographique plus faible, qu’elles soient de petites, de moyennes ou de grandes villes.</p>
<p>Souvent négligée, la visualisation de données est perçue comme une tâche triviale&nbsp;: il s’agit simplement de représenter une donnée sous forme d’un graphique, car c’est l’option la plus pratique ou qui prend le moins d’espace. Pourtant, les avantages de la visualisation des données sont nombreux. Par exemple, la visualisation de données intègre aujourd’hui des supports dynamiques comme des animations, des figures interactives ou des applications web. R offre d’ailleurs des possibilités très intéressantes en la matière avec des <em>packages</em> comme <code>shiny</code>, <code>plotly</code> ou <code>leaflet</code>. Toutefois, nous ne couvrons pas ici ces méthodes plus récentes en visualisation des données qui devraient faire l’objet d’un autre livre.</p>
<p><strong>Les principaux avantages de la visualisation des données</strong>&nbsp;:</p>
<ul>
<li><p><strong>Analyse exploratoire des données</strong> (<em>exploratory data analysis - EDA</em> en anglais). Visualiser des données est crucial pour détecter des problèmes en tout genre (données manquantes, valeurs extrêmes ou aberrantes, non-respect de conditions d’application de tests statistiques, etc.), mais aussi pour repérer de nouvelles associations entre les variables.</p></li>
<li><p><strong>Communication de vos résultats</strong>. La raison d’être d’un graphique est de livrer un message clair relatif à un résultat obtenu suite à une analyse rigoureuse de vos données. Si votre graphique n’apporte aucune information claire, il vaut mieux ne pas le présenter, ni le diffuser. Les représentations ne sont pas neutres. Les couleurs et les formes ont des significations particulières en fonction de la culture et du contexte. Posez-vous donc toujours la question&nbsp;: à quel public est destiné le message? Évitez de surcharger vos visualisations de données, sinon l’essence du message sera perdue.</p></li>
<li><p><strong>Aide à la décision</strong>. Une illustration (graphique ou carte) peut être un outil facilitant la prise de décisions.</p></li>
</ul>
</div>
</div>
<section id="sec-031" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="sec-031">
<span class="header-section-number">3.1</span> Philosophie du ggplot2</h2>
<p>Le <em>package</em> <code>ggplot2</code> fait partie du <code>tidyverse</code> et dispose d’une logique de fonctionnement particulière. Cette dernière se nomme <em>The Grammar of Graphics</em> (les deux G sont d’ailleurs à l’origine du nom <code>ggplot2</code>), proposée par Hadley Wickham (le créateur du <code>tidyverse</code>!) dans un article intitulé <em>A layered grammar of graphics</em> <span class="citation" data-cites="wickham2010layered">(<a href="references.html#ref-wickham2010layered" role="doc-biblioref">Wickham 2010</a>)</span>. Nous proposons de synthétiser ici les concepts et principes centraux qui sous-tendent la production de graphiques avec <code>ggplot2</code>.</p>
<section id="sec-0311" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="sec-0311">
<span class="header-section-number">3.1.1</span> Grammaire</h3>
<p>Hadley Wickham propose une grammaire pour unifier la création de graphiques. L’idée est donc de dépasser les simples dénominations comme un nuage de points, un diagramme en boîte, un graphique en ligne, etc., pour comprendre ce qui relie tous ces graphiques. Ces éléments communs et centraux sont les géométries, les échelles et systèmes de coordonnées, et les annotations (<a href="#fig-fig30">figure&nbsp;<span>3.1</span></a>)&nbsp;:</p>
<div id="fig-fig30" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/composantes.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Trois composantes d’un graphique, adapté de <span class="citation" data-cites="wickham2010layered">Wickham (<a href="references.html#ref-wickham2010layered" role="doc-biblioref">2010</a>)</span></figcaption></figure>
</div>
<ul>
<li><p>Les <strong>géométries</strong> sont les formes utilisées pour représenter les données. Il peut s’agir de points, de lignes, de cercles, de rectangles, d’arcs de cercle, etc.</p></li>
<li><p>Les <strong>échelles et systèmes de coordonnées</strong> permettent de contrôler la localisation des éléments dans un graphique en convertissant les données depuis leur échelle originale (dollars, kilomètres, pourcentages, etc.) vers l’échelle du graphique (pixels).</p></li>
<li><p>Les <strong>annotations</strong> recoupent l’ensemble des informations complémentaires ajoutées au graphique comme son titre et sous-titre, la source des données, la mention sur les droits d’auteurs, etc.</p></li>
</ul>
<p>En plus de ces trois éléments, il est bien sûr nécessaire de disposer de <strong>données</strong>. Ces dernières sont assignées à des dimensions du graphique pour être représentées (notamment les axes <em>X</em> et <em>Y</em> et la couleur). Cette étape est appelée <strong>aesthetics mapping</strong> dans <code>ggplot2</code>.</p>
<p>Lorsque nous combinons des données, leur assignation a des dimensions, un type de géométries, des échelles et un système de coordonnées, nous obtenons un <strong>calque</strong> (<em>layer</em> en anglais). Un graphique peut comprendre plusieurs calques comme nous le verrons dans les prochaines sections.</p>
<p>Prenons un premier exemple très simple et construisons un nuage de points à partir du jeu de données <em>iris</em> fourni de base dans R. Nous représentons la relation qui existe entre la longueur et la largeur des sépales de ces fleurs. Pour commencer, nous devons charger le <em>package</em> <code>ggplot2</code> et instancier un graphique avec la fonction <code>ggplot</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     </code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig31" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig31-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Base d’un graphique</figcaption></figure>
</div>
</div>
</div>
<p>Pour le moment, le graphique est vide (<a href="#fig-fig31">figure&nbsp;<span>3.2</span></a>). La seconde étape consiste à lui ajouter des données (au travers du paramètre <code>data</code>) et à définir les dimensions à associer aux données (avec le paramètre <code>mapping</code> et la fonction <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>). Dans notre cas, nous voulons utiliser les coordonnées <em>X</em> pour représenter la largeur des sépales, et les coordonnées <em>Y</em> pour représenter la longueur des sépales. Enfin, nous souhaitons représenter les observations par des points, nous utiliserons donc la géométrie <code>geom_point</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig32" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig32-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Ajout des dimensions au graphique</figcaption></figure>
</div>
</div>
</div>
<p>Ce graphique ne comprend qu’un seul calque avec une géométrie de type point (<a href="#fig-fig32">figure&nbsp;<span>3.3</span></a>). Chaque calque est ajouté avec l’opérateur <code>+</code> qui permet de superposer des calques, le dernier apparaissant au-dessus des autres. Les arguments <code>mapping</code> et <code>data</code> sont définis ici dans la fonction <code>ggplot</code> et sont donc appliqués à tous les calques qui composent le graphique. Il est aussi possible de définir <code>mapping</code> et <code>data</code> au sein des fonctions des géométries&nbsp;:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig33" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig33-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Autre spécification des arguments mapping et data</figcaption></figure>
</div>
</div>
</div>
<p>La troisième étape consiste à ajouter au graphique des annotations. Pour notre cas, il faudrait ajouter un titre, un sous-titre et des intitulés plus clairs pour les axes <em>X</em> et <em>Y</em>, ce qu’il est possible de faire avec la fonction <code>labs</code> (<a href="#fig-fig34">figure&nbsp;<span>3.5</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig34" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig34-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: Ajout de titres</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0312" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="sec-0312">
<span class="header-section-number">3.1.2</span> Types de géométries</h3>
<p>Le <em>package</em> <code>ggplot2</code> permet d’utiliser un très grand nombre de géométries différentes. Dans le <a href="#tbl-geometries">tableau&nbsp;<span>3.1</span></a>, nous avons reporté les principales géométries disponibles afin que vous puissiez vous faire une idée du «&nbsp;bestiaire&nbsp;» existant. Il ne s’agit que d’un extrait des principales fonctions. Sachez qu’il existe aussi des <em>packages</em> proposant des géométries supplémentaires pour compléter <code>ggplot2</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-geometries" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tableau&nbsp;3.1: Principales géométries proposées par <code>ggplot2</code>
</caption>
<thead><tr class="header">
<th style="text-align: left;">Géométrie</th>
<th style="text-align: left;">Fonction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Point</td>
<td style="text-align: left;"><code>geom_point</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Ligne</td>
<td style="text-align: left;"><code>geom_line</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chemin</td>
<td style="text-align: left;"><code>geom_path</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Boîte à moustaches</td>
<td style="text-align: left;"><code>geom_boxplot</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diagramme violon</td>
<td style="text-align: left;"><code>geom_violin</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Histogramme</td>
<td style="text-align: left;"><code>geom_histogram</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Barre</td>
<td style="text-align: left;"><code>geom_bar</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Densité</td>
<td style="text-align: left;"><code>geom_density</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Texte</td>
<td style="text-align: left;"><code>geom_label</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Barre d’erreur</td>
<td style="text-align: left;"><code>geom_errorbar</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Surface</td>
<td style="text-align: left;"><code>geom_ribbon</code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-0313" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="sec-0313">
<span class="header-section-number">3.1.3</span> Habillage</h3>
<p>Dans le premier exemple, nous avons montré comment ajouter le titre, le sous-titre et les titres des axes sur un graphique. Il est aussi possible d’ajouter du texte sous le graphique (généralement la source des données avec l’argument <code>caption</code>) et des annotations textuelles (<code>annotate</code>). Pour ces dernières, il convient de spécifier leur localisation (coordonnées <code>x</code> et <code>y</code>) et le texte à intégrer (<code>label</code>); elles sont ensuite ajoutées au graphique avec l’opérateur <code>+</code>. Ajoutons deux annotations pour identifier deux fleurs spécifiques.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">6.7</span>, y <span class="op">=</span> <span class="fl">2.5</span>, <span class="co"># position de la note</span></span>
<span>           label <span class="op">=</span> <span class="st">"une virginica"</span>,  <span class="co"># texte de la note</span></span>
<span>           hjust <span class="op">=</span> <span class="st">"left"</span>, vjust <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># ajustement</span></span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5.7</span>, y <span class="op">=</span> <span class="fl">4.4</span>, <span class="co"># position de la note</span></span>
<span>           label <span class="op">=</span> <span class="st">"une setosa"</span>,  <span class="co"># texte de la note</span></span>
<span>           hjust <span class="op">=</span> <span class="st">"left"</span>, vjust <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># ajustement</span></span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig35" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig35-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Ajout d’annotations textuelles</figcaption></figure>
</div>
</div>
</div>
<p>Comme vous pouvez le constater, de nombreux paramètres permettent de contrôler le style des annotations. Pour avoir la liste des arguments disponibles, n’hésitez pas à afficher l’aide de la fonction&nbsp;: <code><a href="https://ggplot2.tidyverse.org/reference/annotate.html">help(annotate)</a></code>.</p>
<p>En plus des annotations de type texte, il est possible d’ajouter des annotations de type géométrique. Nous pourrions ainsi délimiter une boîte encadrant les fleurs de l’espère setosa.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">setosas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span></span>
<span><span class="va">sepal.length_extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">setosas</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">setosas</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sepal.width_extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">setosas</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">setosas</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">6.7</span>, y <span class="op">=</span> <span class="fl">2.5</span>, <span class="co"># position de la note</span></span>
<span>           label <span class="op">=</span> <span class="st">"une virginica"</span>,  <span class="co"># texte de la note</span></span>
<span>           hjust <span class="op">=</span> <span class="st">"left"</span>, vjust <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># ajustement</span></span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5.7</span>, y <span class="op">=</span> <span class="fl">4.4</span>, <span class="co"># position de la note</span></span>
<span>           label <span class="op">=</span> <span class="st">"une setosa"</span>,  <span class="co"># texte de la note</span></span>
<span>           hjust <span class="op">=</span> <span class="st">"left"</span>, vjust <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># ajustement</span></span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, </span>
<span>           ymin <span class="op">=</span> <span class="va">sepal.width_extent</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">sepal.width_extent</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           xmin <span class="op">=</span> <span class="va">sepal.length_extent</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           xmax <span class="op">=</span> <span class="va">sepal.length_extent</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">0.7</span>,<span class="fl">0.7</span>,<span class="fl">.5</span><span class="op">)</span>, <span class="co"># remplissage transparent à 50%</span></span>
<span>           color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="co"># contour de couleur verte</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig36" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig36-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: Ajout d’annotations géométriques</figcaption></figure>
</div>
</div>
</div>
<p>Comme le dernier calque ajouté au graphique est le rectangle, vous noterez qu’il recouvre tous les calques existant, y compris les précédentes annotations. Pour corriger cela, il suffit de changer l’ordre des calques.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, </span>
<span>           ymin <span class="op">=</span> <span class="va">sepal.width_extent</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">sepal.width_extent</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           xmin <span class="op">=</span> <span class="va">sepal.length_extent</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           xmax <span class="op">=</span> <span class="va">sepal.length_extent</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.7</span>,<span class="fl">0.7</span>,<span class="fl">0.7</span>,<span class="fl">.5</span><span class="op">)</span>, <span class="co"># remplissage transparent à 50%</span></span>
<span>           color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># contour de couleur verte</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">6.7</span>, y <span class="op">=</span> <span class="fl">2.5</span>, <span class="co"># position de la note</span></span>
<span>           label <span class="op">=</span> <span class="st">"une virginica"</span>,  <span class="co"># texte de la note</span></span>
<span>           hjust <span class="op">=</span> <span class="st">"left"</span>, vjust <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># ajustement</span></span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5.7</span>, y <span class="op">=</span> <span class="fl">4.4</span>, <span class="co"># position de la note</span></span>
<span>           label <span class="op">=</span> <span class="st">"une setosa"</span>,  <span class="co"># texte de la note</span></span>
<span>           hjust <span class="op">=</span> <span class="st">"left"</span>, vjust <span class="op">=</span> <span class="st">"top"</span>, <span class="co"># ajustement</span></span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig37" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig37-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.8: Gestion de l’ordre des annotations</figcaption></figure>
</div>
</div>
</div>
</section><section id="utilisation-des-thèmes" class="level3" data-number="3.1.4"><h3 data-number="3.1.4" class="anchored" data-anchor-id="utilisation-des-thèmes">
<span class="header-section-number">3.1.4</span> Utilisation des thèmes</h3>
<p>De nombreux autres éléments peuvent être modifiés dans un graphique comme les paramètres des polices, l’arrière-plan, la grille de repères, etc. Il peut être fastidieux de paramétrer tous ces éléments. Une option intéressante est d’utiliser des thèmes déjà préconstruits. Le <em>package</em> <code>ggplot2</code> propose une dizaine de thèmes&nbsp;: constatons leur impact sur le graphique précédent.</p>
<ul>
<li>Le thème classique (<code>theme_classic</code>) (<a href="#fig-fig38">figure&nbsp;<span>3.9</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig38" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig38-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.9: Thème classique</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>Le thème gris (<code>theme_gray</code>) (<a href="#fig-fig39">figure&nbsp;<span>3.10</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig39" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig39-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.10: Thème gris</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>Le thème noir et blanc (<code>theme_bw</code>) (<a href="#fig-fig310">figure&nbsp;<span>3.11</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig310" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig310-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.11: Thème noir et blanc</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>Le thème minimal (<code>theme_minimal</code>) (<a href="#fig-fig311">figure&nbsp;<span>3.12</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig311" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig311-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.12: Thème minimal</figcaption></figure>
</div>
</div>
</div>
<p>Il est aussi possible d’utiliser le <em>package</em> <code>ggthemes</code> qui apporte des thèmes complémentaires intéressants dont&nbsp;:</p>
<ul>
<li>Le thème <em>tufte</em> (<code>theme_tufte</code>, à l’ancienne…) (<a href="#fig-fig312">figure&nbsp;<span>3.13</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jrnold.github.io/ggthemes/">ggthemes</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig312" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig312-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.13: Thème tufte</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>Le thème <em>economist</em> (<code>theme_economist</code>, inspiré de la revue du même nom) (<a href="#fig-fig313">figure&nbsp;<span>3.14</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_economist.html">theme_economist</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig313" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig313-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.14: Thème economist</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>Le thème <em>solarized</em> (<code>theme_solarized</code>, plus original) (<a href="#fig-fig314">figure&nbsp;<span>3.15</span></a>)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_solarized.html">theme_solarized</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig314" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig314-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.15: Thème solarized</figcaption></figure>
</div>
</div>
</div>
<p>Il en existe bien d’autres et vous pouvez composer vos propres thèmes. N’hésitez pas à explorer la documentation de <code>ggplot2</code> et de <code>ggthemes</code> pour en apprendre plus!</p>
</section><section id="sec-0314" class="level3" data-number="3.1.5"><h3 data-number="3.1.5" class="anchored" data-anchor-id="sec-0314">
<span class="header-section-number">3.1.5</span> Composition d’une figure avec plusieurs graphiques</h3>
<p>Il est très fréquent de vouloir combiner plusieurs graphiques dans une même figure. Deux cas se distinguent&nbsp;:</p>
<ol type="1">
<li><p>Les données pour les différents graphiques proviennent du même <em>DataFrame</em> et peuvent être distinguées selon une variable catégorielle. L’objectif est alors de dupliquer le même graphique, mais pour des sous-groupes de données. Dans ce cas, nous recommandons d’utiliser la fonction <code>facet_wrap</code> de <code>ggplot2</code>.</p></li>
<li><p>Les graphiques sont complètement indépendants. Dans ce cas, nous recommandons d’utiliser la fonction <code>ggarrange</code> du <em>package</em> <code>ggpubr</code>.</p></li>
</ol>
<section id="sec-03141" class="level4" data-number="3.1.5.1"><h4 data-number="3.1.5.1" class="anchored" data-anchor-id="sec-03141">
<span class="header-section-number">3.1.5.1</span> <code>ggplot2</code> et ses facettes</h4>
<p>Nous pourrions souhaiter réaliser une figure composite avec le jeu de données <em>iris</em> et séparer notre nuage de points en trois graphiques distincts selon l’espèce des iris (<a href="#fig-fig315">figure&nbsp;<span>3.16</span></a>). Pour cela, il faut au préalable convertir la variable <em>espèce</em> en facteur.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris</span><span class="op">$</span><span class="va">Species_fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Species_fac</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig315" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig315-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.16: Graphique à facettes</figcaption></figure>
</div>
</div>
</div>
<p>Notez que le nom de la variable (ici <code>Species_fac</code>) doit être spécifié au sein d’une sous-fonction <code>vars</code>&nbsp;: <code>vars(Species_fac)</code>. Nous aurions aussi pu réaliser le graphique sur une seule ligne en spécifiant <code>ncol = 3</code> (<a href="#fig-fig316">figure&nbsp;<span>3.17</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Morphologie des sépales des iris"</span>, subtitle <span class="op">=</span> <span class="st">"n = 150"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur des sépales"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur des sépales"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source : jeu de données iris"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Species_fac</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig316" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig316-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.17: Graphique à facettes en une ligne</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-03142" class="level4" data-number="3.1.5.2"><h4 data-number="3.1.5.2" class="anchored" data-anchor-id="sec-03142">
<span class="header-section-number">3.1.5.2</span> Arrangement des graphiques</h4>
<p>La solution avec les facettes est très pratique, mais également très limitée puisqu’elle ne permet pas de créer une figure avec des graphiques combinant plusieurs types de géométries. <code>ggarrange</code> du <em>package</em> <code>ggpubr</code> permet tout simplement de combiner des graphiques déjà existant. Créons deux nuages de points comparant plusieurs variables en fonction de l’espèce des iris, puis combinons-les (<a href="#fig-fig317">figure&nbsp;<span>3.18</span></a>). Attribuons également aux points une couleur en fonction de l’espèce des fleurs, afin de mieux les distinguer en associant la variable <code>Species</code> au paramètre <code>color</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Caractéristiques des sépales"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Espèce"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Petal.Length</span>, y <span class="op">=</span> <span class="va">Petal.Width</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Caractéristiques des pétales"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longueur"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Largeur"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Espèce"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">liste_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span><span class="op">)</span></span>
<span><span class="va">comp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">liste_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="co">#gérer la légende</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html">annotate_figure</a></span><span class="op">(</span><span class="va">comp_plot</span>,</span>
<span>                top <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="st">"Morphologie des sépales et pétales des iris"</span>,</span>
<span>                                face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">12</span>, just <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span>,</span>
<span>                bottom <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="st">"Source : jeu de données iris"</span>,</span>
<span>                                face <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">8</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig317" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig317-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.18: Figure avec plusieurs graphiques avec ggarrange</figcaption></figure>
</div>
</div>
</div>
<p>Quatre étapes sont nécessaires&nbsp;:</p>
<ol type="1">
<li>Créer les graphiques et les enregistrer dans des objets (ici <em>plot1</em> et <em>plot2</em>).</li>
<li>Encapsuler ces objets dans une liste (ici <em>liste_plots</em>).</li>
<li>Composer la figure finale avec la fonction <code>ggarrange</code>.</li>
<li>Ajouter les annotations à la figure composite.</li>
</ol>
<p>L’argument <code>common.legend</code> permet d’indiquer à la fonction <code>ggarrange</code> de regrouper les légendes des deux graphiques. Dans notre cas, les deux graphiques ont les mêmes légendes, il est donc judicieux de les regrouper. L’argument <code>legend</code> contrôle la position de la légende et peut prendre les valeurs&nbsp;: <em>top</em>, <em>bottom</em>, <em>left</em>, <em>right</em> ou <em>none</em> (absence de légende). La fonction <code>annotate_figure</code> permet d’ajouter des éléments de texte au-dessus, au-dessous et sur les cotés de la figure composite.</p>
</section></section><section id="sec-0315" class="level3" data-number="3.1.6"><h3 data-number="3.1.6" class="anchored" data-anchor-id="sec-0315">
<span class="header-section-number">3.1.6</span> Couleur</h3>
<p>Dans un graphique, la couleur peut être utilisée à la fois pour représenter une variable quantitative (dégradé de couleur ou mise en classes), ou une variable qualitative (couleur par catégorie). Dans <code>ggplot2</code>, il est possible d’attribuer une couleur au contour des géométries avec l’argument <code>color</code> et au remplissage avec l’argument <code>fill</code>. Il est possible de spécifier une couleur de trois façons dans R&nbsp;:</p>
<ul>
<li>En utilisant le nom de la couleur dans une chaîne de caractère&nbsp;: <code>"chartreuse4"</code>. R dispose de 657&nbsp;noms de couleurs prédéfinis. Pour tous les afficher, utilisez la fonction <code><a href="https://rdrr.io/r/grDevices/colors.html">colors()</a></code>, qui permet de les visualiser (<a href="#fig-colors">figure&nbsp;<span>3.19</span></a>).</li>
</ul>
<div id="fig-colors" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/all_colors.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.19: Couleurs de base</figcaption></figure>
</div>
<ul>
<li><p>En indiquant le code hexadécimal de la couleur. Il s’agit d’une suite de six lettres et de chiffres précédée par un dièse&nbsp;: <code>"#99ff33"</code>.</p></li>
<li><p>En utilisant une notation RGB (rouge, vert, bleu, transparence). Cette notation doit contenir quatre nombres entre 0 et 1 (0&nbsp;% et 100&nbsp;%), indiquant respectivement la quantité de rouge, de vert, de bleu et la transparence. Ces quatre nombres sont donnés comme argument à la fonction <code>rgb</code>&nbsp;: <code>rgb(0.6, 1, 0.2, 0)</code>.</p></li>
</ul>
<p>Le choix des couleurs est un problème plus complexe que la manière de les spécifier. Il existe d’ailleurs tout un pan de la sémiologie graphique dédié à la question du choix et de l’association des couleurs. Une première ressource intéressante est <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3" target="_blank">ColorBrewer</a>. Il s’agit d’une sélection de palettes de couleurs particulièrement efficaces et dont certaines sont même adaptées pour les personnes daltoniennes (<a href="#fig-colorBrewer">figure&nbsp;<span>3.20</span></a>). Il est possible d’accéder directement aux palettes dans R grâce au <em>package</em> <code>RColorBrewer</code> et la fonction <code>brewer.pal</code>&nbsp;:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">display.brewer.all</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-colorBrewer" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-colorBrewer-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.20: Palette de couleurs de ColorBrewer</figcaption></figure>
</div>
</div>
</div>
<p>Une autre ressource pertinente est le site web <a href="https://coolors.co/palettes/trending" target="_blank">coolors.co</a> qui propose de nombreuses palettes à portée de clic.</p>
</section></section><section id="sec-032" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="sec-032">
<span class="header-section-number">3.2</span> Principaux graphiques</h2>
<div class="bloc_objectif">
<div class="bloc_objectif-header">
<div class="bloc_objectif-icon">

</div>
<p><strong>Construire des graphiques avec <code>ggplot2</code></strong></p>
</div>
<div class="bloc_objectif-body">
<p>Puisque vous avez désormais une certaine connaissance des bases de la grammaire des graphiques implémentées par <code>ggplot2</code>, vous apprendrez dans les sous-sections suivantes à construire les principaux graphiques que vous utiliserez régulièrement ou que vous présenterez dans un article scientifique.</p>
</div>
</div>
<section id="sec-0321" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="sec-0321">
<span class="header-section-number">3.2.1</span> Histogramme</h3>
<p>L’histogramme permet de décrire graphiquement la forme de la distribution d’une variable. Pour le réaliser, nous utilisons la fonction <code>geom_histogram</code>. Le paramètre le plus important est le nombre de barres (<code>bins</code>) qui composent l’histogramme. Plus ce nombre est grand, plus l’histogramme est précis et, à l’inverse, plus il est petit, plus l’histogramme est simplifié. En revanche, il faut éviter d’utiliser un nombre de barres trop élevé comparativement au nombre d’observations disponibles dans le jeu de données, sinon l’histogramme risque d’avoir plein de trous.</p>
<section id="sec-03211" class="level4" data-number="3.2.1.1"><h4 data-number="3.2.1.1" class="anchored" data-anchor-id="sec-03211">
<span class="header-section-number">3.2.1.1</span> Histogramme simple</h4>
<p>Générons quatre variables ayant respectivement une distribution gaussienne, Student, Gamma et bêta, puis réalisons un histogramme pour chacune de ces variables et combinons-les avec la fonction <code>ggarrange</code> (<a href="#fig-fig318">figure&nbsp;<span>3.21</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">distribs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  gaussien <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">1000</span>, shape1 <span class="op">=</span> <span class="fl">5</span>, shape2 <span class="op">=</span> <span class="fl">1</span>, ncp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  student <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">rt</a></span><span class="op">(</span><span class="fl">1000</span>, ncp <span class="op">=</span> <span class="fl">20</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gaussien</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#e63946"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"fréquences"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">130</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gamma</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#f1faee"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"fréquences"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">130</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">beta</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#a8dadc"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"fréquences"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">130</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">student</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#1d3557"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"fréquences"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">130</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">histogrammes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span>, <span class="va">plot3</span>, <span class="va">plot4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">histogrammes</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig318" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig318-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.21: Histogrammes</figcaption></figure>
</div>
</div>
</div>
<p>Notez que cette syntaxe est très lourde. Dans le cas présent, il serait plus judicieux d’utiliser la fonction <code>facet_wrap</code>. Pour cela, nous devons au préalable empiler nos données, ce qui signifie changer la forme du <em>DataFrame</em> actuel, qui comprend quatre colonnes (gaussien, Gamma, bêta et student) et 1000 observations, pour qu’il n’ait plus que deux colonnes (la valeur originale et le nom de l’ancienne colonne) et 4000 observations. La <a href="#fig-fig319">figure&nbsp;<span>3.22</span></a> décrit graphiquement ce processus qui peut être effectué avec la fonction <code>melt</code> du <em>package</em> <code>reshape2</code>.</p>
<div id="fig-fig319" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/melting.png" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.22: Empiler les données d’un DataFrame</figcaption></figure>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Faire fondre le jeu de données</span></span>
<span><span class="va">melted_distribs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">distribs</span>, measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gaussien"</span>, <span class="st">"gamma"</span>,</span>
<span>                                                   <span class="st">"beta"</span> , <span class="st">"student"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Renommer les colonnes du nouveau DataFrame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">melted_distribs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"distribution"</span>, <span class="st">"valeur"</span><span class="op">)</span></span>
<span><span class="co"># Convertir la variable catégorielle en facteur</span></span>
<span><span class="va">melted_distribs</span><span class="op">$</span><span class="va">distribution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">melted_distribs</span><span class="op">$</span><span class="va">distribution</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">melted_distribs</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">valeur</span>, fill <span class="op">=</span> <span class="va">distribution</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span>, color <span class="op">=</span> <span class="st">"#343a40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">130</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"valeur"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"fréquences"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e63946"</span> , <span class="st">"#f1faee"</span> , <span class="st">"#a8dadc"</span> , <span class="st">"#1d3557"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig320" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig320-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.23: Histogrammes à facettes</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-03212" class="level4" data-number="3.2.1.2"><h4 data-number="3.2.1.2" class="anchored" data-anchor-id="sec-03212">
<span class="header-section-number">3.2.1.2</span> Histogramme de densité</h4>
<p>Les histogrammes que nous venons de construire utilisent la fréquence des observations pour délimiter la hauteur des barres. Il est possible de changer ce comportement pour plutôt utiliser la densité. L’intérêt est notamment de se rapprocher encore de la définition d’une distribution puisqu’avec cette configuration, la somme totale de la surface de l’histogramme est égale à 1. La hauteur de chaque barre représente alors la probabilité d’obtenir l’étendue de valeurs représentées par cette barre. Prenons pour exemple la variable avec la distribution normale que nous venons de voir.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gaussien</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#1d3557"</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"gaussien"</span>, y <span class="op">=</span> <span class="st">"densité"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gaussien</span>, y <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#a8dadc"</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"gaussien"</span>, y <span class="op">=</span> <span class="st">"fréquences"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(count)` instead.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-fig321" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig321-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.24: Histogrammes de densité</figcaption></figure>
</div>
</div>
</div>
<p>Le graphique de droite (fréquence) nous indique donc que plus de 60&nbsp;observations ont une valeur d’environ&nbsp;5 (entre 4,76 et 5,34, compte tenu de la largeur de la barre), ce qui se traduit par une probabilité de presque 30&nbsp;% d’obtenir cette valeur en tirant une observation au hasard dans le jeu de données.</p>
</section><section id="sec-03213" class="level4" data-number="3.2.1.3"><h4 data-number="3.2.1.3" class="anchored" data-anchor-id="sec-03213">
<span class="header-section-number">3.2.1.3</span> Histogramme avec courbe de distribution</h4>
<p>Les histogrammes sont souvent utilisés pour vérifier graphiquement si une distribution empirique s’approche d’une courbe normale. Pour cela, nous ajoutons sur l’histogramme de la variable empirique la forme qu’aurait une distribution normale parfaite en utilisant la moyenne et l’écart type de la distribution empirique. Pour créer cette figure dans <code>ggplot2</code>, il suffit d’utiliser la fonction <code>stat_function</code> pour créer un nouveau calque. Il est aussi possible d’ajouter une ligne verticale (<code>geom_vline</code>) pour indiquer la moyenne de la distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">moyenne</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">distribs</span><span class="op">$</span><span class="va">gaussien</span><span class="op">)</span></span>
<span><span class="va">ecart_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">distribs</span><span class="op">$</span><span class="va">gaussien</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gaussien</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"#343a40"</span>, fill <span class="op">=</span> <span class="st">"#a8dadc"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"gaussien"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"densité"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">moyenne</span>, sd <span class="op">=</span> <span class="va">ecart_type</span><span class="op">)</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"#e63946"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">moyenne</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">moyenne</span>,<span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fl">0.5</span>, y <span class="op">=</span> <span class="fl">0.31</span>, hjust <span class="op">=</span> <span class="st">'left'</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'moyenne : '</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">moyenne</span>,<span class="fl">2</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig322" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig322-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.25: Histogramme et courbe normale</figcaption></figure>
</div>
</div>
</div>
<p>Dans notre cas, nous savons que notre variable est normalement distribuée (car produite avec la fonction <code>rnorm</code>), et nous pouvons constater la grande proximité entre l’histogramme et la courbe normale.</p>
</section><section id="sec-03214" class="level4" data-number="3.2.1.4"><h4 data-number="3.2.1.4" class="anchored" data-anchor-id="sec-03214">
<span class="header-section-number">3.2.1.4</span> Histogramme avec coloration des valeurs extrêmes</h4>
<p>Il peut être nécessaire d’attirer le regard sur certaines parties de l’histogramme, comme sur des valeurs extrêmes. Si nous reprenons notre distribution de Student, nous pouvons clairement distinguer un ensemble de valeurs fortes à droite de la distribution. Nous pourrions, dans notre cas, considérer que des valeurs au-delà de&nbsp;50 constituent des cas extrêmes que nous souhaitons représenter dans une autre couleur. Pour cela, nous devons créer une variable catégorielle nous permettant de distinguer ces cas particuliers.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">distribs</span><span class="op">$</span><span class="va">cas_extreme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">distribs</span><span class="op">$</span><span class="va">student</span> <span class="op">&gt;=</span><span class="fl">50</span>, <span class="st">"extrême"</span>, <span class="st">"normale"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">distribs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">student</span>, y <span class="op">=</span> <span class="va">..count..</span>, fill <span class="op">=</span> <span class="va">cas_extreme</span><span class="op">)</span>,</span>
<span>                 bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"#343a40"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span><span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#a8dadc"</span> , <span class="st">"#e63946"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution de Student"</span>, x <span class="op">=</span> <span class="st">"valeur"</span>, y <span class="op">=</span> <span class="st">"fréquence"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig323" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig323-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.26: Histogramme coloré</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-0322" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="sec-0322">
<span class="header-section-number">3.2.2</span> Graphique de densité</h3>
<p>L’histogramme est utilisé pour approximer graphiquement la distribution d’une variable. Sa principale limite est de représenter la variable de façon discontinue. Une option intéressante est d’utiliser une version lissée de l’histogramme, soit le graphique de densité. Cette opération de lissage est réalisée le plus souvent à partir de fonctions kernel. Reconstruisons notre figure avec les quatre distributions, mais en utilisant cette fois-ci des graphiques de densité.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">melted_distribs</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">valeur</span>, fill <span class="op">=</span> <span class="va">distribution</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#343a40"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e63946"</span> , <span class="st">"#f1faee"</span> , <span class="st">"#a8dadc"</span> , <span class="st">"#1d3557"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig324" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig324-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.27: Graphiques de densité à facette</figcaption></figure>
</div>
</div>
</div>
<p>Les graphiques de densité sont souvent utilisés pour comparer la distribution d’une variable pour plusieurs sous-groupes d’une population. Si nous reprenons le jeu de données <em>iris</em>, nous pouvons comparer les longueurs de sépales en fonction des espèces. Nous constatons ainsi que les setosas ont une nette tendance à avoir des sépales plus courts et qu’à l’inverse, les virginicas ont les sépales généralement les plus longs.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, fill <span class="op">=</span> <span class="va">Species</span><span class="op">)</span>, </span>
<span>               color <span class="op">=</span> <span class="st">"#343a40"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Longueur de sépales"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Espèce"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig325" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig325-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.28: Graphiques de densité superposés</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0323" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="sec-0323">
<span class="header-section-number">3.2.3</span> Nuage de points</h3>
<p>Un nuage de points est un outil très intéressant pour visualiser la relation existante entre deux variables. Prenons un exemple concret et analysons le volume de CO<sub>2</sub> produit annuellement par habitant en comparaison avec le niveau d’urbanisation dans l’ensemble des pays à travers le monde. Nous avons extrait ces données sur le site web de la <a href="https://donnees.banquemondiale.org/indicateur" target="_blank">Banque mondiale</a>, puis nous les avons structurés dans un fichier <em>csv</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/graphique/world_urb_co2.csv"</span>, encoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data_co2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country_code" "year"         "Population"   "Urbanisation" "CO2_kt"      
[6] "Country.Name" "CO2t_hab"     "region7"      "region23"    </code></pre>
</div>
</div>
<section id="sec-03231" class="level4" data-number="3.2.3.1"><h4 data-number="3.2.3.1" class="anchored" data-anchor-id="sec-03231">
<span class="header-section-number">3.2.3.1</span> Nuage de points simple</h4>
<p>Commençons par un nuage de points simple avec l’ensemble des données.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fig326" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig326-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.29: Nuage de points simple</figcaption></figure>
</div>
</div>
</div>
<p>À la première lecture de ce graphique, nous observons immédiatement un ensemble de points étranges dont le volume de CO<sub>2</sub> par habitant annuel est au-dessus de 150 tonnes et dont le niveau d’urbanisation est proche de 50&nbsp;%. Isolons ces données pour observer de quoi il s’agit.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cas_etrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="va">data_co2</span><span class="op">$</span><span class="va">CO2t_hab</span> <span class="op">&gt;=</span> <span class="fl">150</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cas_etrange</span><span class="op">$</span><span class="va">Country.Name</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba"
[10] "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba"
[19] "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba" "Aruba"</code></pre>
</div>
</div>
<p>Il s’agit d’une petite île néerlandaise des Caraïbes nommée Aruba disposant d’une faible population, mais avec des activités très polluantes (raffinerie et extraction d’or). Nous faisons ici le choix de retirer ces observations puisqu’elles sont assez peu représentatives de la tendance mondiale. Cette démarche si simple relève ainsi de l’analyse exploratoire des données! Sans ce graphique, nous n’aurions probablement jamais identifié ces cas problématiques.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="va">data_co2</span><span class="op">$</span><span class="va">CO2t_hab</span> <span class="op">&lt;=</span> <span class="fl">150</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Reconstruisons le nuage de points maintenant que ces données aberrantes ont été retirées.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">graphique</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Voilà qui est mieux! Cependant, le grand nombre de points restant rend la lecture du graphique assez difficile puisqu’ils se superposent. Une première option à envisager, dans ce cas, est à la fois d’ajouter de la transparence aux points et de réduire leur taille&nbsp;:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig328" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig328-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.30: Nuage de points simple avec transparence</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-03232" class="level4" data-number="3.2.3.2"><h4 data-number="3.2.3.2" class="anchored" data-anchor-id="sec-03232">
<span class="header-section-number">3.2.3.2</span> Nuage de points avec densité</h4>
<p>Bien que la transparence nous aide un peu à distinguer les secteurs du graphique avec le plus de points, il serait plus efficace d’abandonner la géométrie des points pour la remplacer par une géométrie de densité en deux dimensions. Une première approche consiste à diviser l’espace du graphique en petits carrés et à compter le nombre de points tombant dans chaque carré (en somme, un histogramme en deux dimensions).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bin_2d.html">geom_bin2d</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Effectif"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig329" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig329-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.31: Nuage de points simple</figcaption></figure>
</div>
</div>
</div>
<p>Nous observons ainsi une forte concentration dans le bas du graphique; les pays avec des rejets annuels de CO<sub>2</sub> supérieurs à 15 tonnes par habitant sont relativement rares. Pour les personnes préférant les représentations plus élaborées, il est aussi possible de diviser l’espace du graphique avec des hexagones en utilisant le <em>package</em> <code>hexbin</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Effectif"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig330" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig330-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.32: Densité en deux dimensions par hexagones</figcaption></figure>
</div>
</div>
</div>
<p>Enfin, il est aussi possible de réaliser une version lissée de ces graphiques avec une fonction kernel en deux dimensions (<code>stat_density_2d</code>)&nbsp;:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density_2d</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span>, fill <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>, </span>
<span>                  geom <span class="op">=</span> <span class="st">"raster"</span>, n <span class="op">=</span> <span class="fl">50</span>, contour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_fill_continuous</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"densité"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">25</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig331" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig331-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.33: Densité lissée en deux dimensions</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-03233" class="level4" data-number="3.2.3.3"><h4 data-number="3.2.3.3" class="anchored" data-anchor-id="sec-03233">
<span class="header-section-number">3.2.3.3</span> Nuage de points et droite de régression</h4>
<p>Afin de faire ressortir une éventuelle relation entre les variables représentées sur les deux axes, il est possible d’afficher la droite de régression sur le graphique entre X et Y. Cette opération s’effectue avec la fonction <code>geom_smooth</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, method <span class="op">=</span> <span class="va">lm</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig332" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig332-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.34: Nuage de points avec droite de régression</figcaption></figure>
</div>
</div>
</div>
<p>Notez que l’argument <code>method = lm</code> permet d’indiquer que nous souhaitons utiliser une régression linéaire (<em>linear model</em>) pour tracer la géométrie (une droite de régression). La droite semble bien indiquer une relation positive entre les deux variables&nbsp;: une augmentation de l’urbanisation serait associée à une augmentation de la production annuelle de CO<sub>2</sub> par habitant. Nous pourrions également vérifier si une relation non linéaire serait plus adaptée au jeu de données. Dans notre cas, une relation quadratique pourrait produire un meilleur ajustement.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, method <span class="op">=</span> <span class="va">lm</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"red"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig333" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig333-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.35: Nuage de points avec droite de régression quadratique</figcaption></figure>
</div>
</div>
</div>
<p>La régression quadratique (avec <em>x</em> au carré) nous indique ainsi que l’impact du niveau d’urbanisation est plus important à mesure que ce niveau augmente. Vous pouvez également constater que la courbe ne prédit pas de valeurs négatives comparativement à la droite précédente. Il est également possible d’ajuster une courbe sans choisir au préalable sa forme (dans le cas précédent <span class="math inline">\(x^2\)</span>) en utilisant une méthode d’ajustement local appelée <em>loess</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Urbanisation</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, method <span class="op">=</span> <span class="va">loess</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Niveau d'urbanisation (%)"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Relation entre urbanisation et production de CO2 par habitant"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig334" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig334-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.36: Nuage de points avec droite de régression non linéaire</figcaption></figure>
</div>
</div>
</div>
<p>La relation non linéaire révèle davantage d’informations&nbsp;: l’augmentation de l’urbanisation est associée à une augmentation de l’émission de CO<sub>2</sub> par habitant uniquement jusqu’à 75&nbsp;% d’urbanisation; au-delà de ce seuil, la relation ne tient plus. Ces résultats semblent cohérents avec l’évolution classique de l’économie d’un pays passant progressivement d’une économie agricole, à une économie industrialisée et finalement une économie de services.</p>
</section></section><section id="sec-0324" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="sec-0324">
<span class="header-section-number">3.2.4</span> Graphique en ligne</h3>
<p>Un graphique en ligne permet de représenter l’évolution d’une variable, généralement dans le temps. Dans le jeu de données précédent, nous disposons des émissions de CO<sub>2</sub> par habitant de nombreux pays sur plusieurs années. Nous pouvons ainsi représenter l’évolution des émissions pour chaque pays avec un graphique en ligne. Pour éviter de le surcharger, cet exercice est réalisé uniquement sur les pays de l’Europe de l’Ouest.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># conversion de la variable year textuelle en variable numérique</span></span>
<span><span class="va">data_co2</span><span class="op">$</span><span class="va">an</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data_co2</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co"># extraction des données d'Europe de l'Ouest</span></span>
<span><span class="va">data_europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="va">data_co2</span><span class="op">$</span><span class="va">region23</span> <span class="op">==</span> <span class="st">"Europe de l'Ouest"</span><span class="op">)</span></span>
<span><span class="co"># choix des valeurs pour l'axe des x</span></span>
<span><span class="va">x_ticks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1960</span>,<span class="fl">2020</span>,<span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_europe</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">an</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span>, color <span class="op">=</span> <span class="va">Country.Name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Années"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Pays"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Évolution de la production de CO2 par habitant"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">x_ticks</span>, labels <span class="op">=</span> <span class="va">x_ticks</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig335" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig335-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.37: Graphique en ligne</figcaption></figure>
</div>
</div>
</div>
<p>Nous remarquons notamment qu’aucune donnée, avant 2005, n’est disponible pour le Liechtenstein.</p>
<section id="sec-03241" class="level4" data-number="3.2.4.1"><h4 data-number="3.2.4.1" class="anchored" data-anchor-id="sec-03241">
<span class="header-section-number">3.2.4.1</span> Barre d’erreur et en bande</h4>
<p>Sur un graphique, il est souvent pertinent de représenter l’incertitude que nous avons sur nos données. Cela peut être fait à l’aide de barres d’erreur ou à l’aide de polygones délimitant les marges d’incertitude. En guise d’exemple, admettons que les données précédentes sont fiables à plus ou moins 10&nbsp;%. En d’autres termes, la valeur d’émission de CO<sub>2</sub> annuelle serait relativement incertaine et pourrait se situer dans un intervalle de 10&nbsp;% autour de la valeur fournie par la Banque mondiale. Nous obtenons ainsi une borne inférieure (valeur donnée - 10&nbsp;%) et une borne supérieure (valeur donnée + 10&nbsp;%). Nous pouvons facilement calculer ces bornes et les faire apparaître dans notre graphique précédent.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_europe</span><span class="op">$</span><span class="va">borne_basse</span> <span class="op">&lt;-</span> <span class="va">data_europe</span><span class="op">$</span><span class="va">CO2t_hab</span> <span class="op">-</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">data_europe</span><span class="op">$</span><span class="va">CO2t_hab</span></span>
<span><span class="va">data_europe</span><span class="op">$</span><span class="va">borne_haute</span> <span class="op">&lt;-</span> <span class="va">data_europe</span><span class="op">$</span><span class="va">CO2t_hab</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">data_europe</span><span class="op">$</span><span class="va">CO2t_hab</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_europe</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">an</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span>, color <span class="op">=</span> <span class="va">Country.Name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">an</span>, ymin <span class="op">=</span> <span class="va">borne_basse</span>, ymax <span class="op">=</span> <span class="va">borne_haute</span>, color <span class="op">=</span> <span class="va">Country.Name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Années"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Pays"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Évolution de la production de CO2 par habitant"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">x_ticks</span>, labels <span class="op">=</span> <span class="va">x_ticks</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig336" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig336-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.38: Graphique en ligne avec barres d’erreur</figcaption></figure>
</div>
</div>
</div>
<p>Ces barres d’erreurs indiquent notamment qu’il n’y a finalement aucun écart significatif entre la Belgique, les Pays-Bas et l’Allemagne à partir des années 1990. Une autre option de représentation est d’utiliser des polygones avec la fonction <code>geom_ribbon</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_europe</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">an</span>, y <span class="op">=</span> <span class="va">CO2t_hab</span>, color <span class="op">=</span> <span class="va">Country.Name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">an</span>, ymin <span class="op">=</span> <span class="va">borne_basse</span>, ymax <span class="op">=</span> <span class="va">borne_haute</span>,</span>
<span>                  fill <span class="op">=</span> <span class="va">Country.Name</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Années"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Pays"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Évolution de la production de CO2 par habitant"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">x_ticks</span>, labels <span class="op">=</span> <span class="va">x_ticks</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html">theme_tufte</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">FALSE</span>,  scale <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as
of ggplot2 3.3.4.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-fig337" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig337-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.39: Graphique en ligne avec marge d’erreur</figcaption></figure>
</div>
</div>
</div>
<p>Le message du graphique est le même. Notez que nous avons utilisé ici la fonction <code>guides</code> pour retirer de la légende les couleurs associées au remplissage des marges d’erreur. Ces couleurs sont les mêmes que celles des lignes et il n’est pas utile de dédoubler la légende. De nombreuses méthodes statistiques produisent des résultats accompagnés d’une mesure de l’incertitude associée à ces résultats. Représenter cette incertitude est crucial pour que le lecteur puisse délimiter la portée des conclusions de vos analyses.</p>
</section></section><section id="sec-0325" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="sec-0325">
<span class="header-section-number">3.2.5</span> Boîte à moustaches</h3>
<p>Les boîtes à moustaches (<em>box plot</em> en anglais) sont des graphiques permettant de comparer les moyennes et les intervalles interquartiles d’une variable continue selon plusieurs groupes d’une population. Si nous reprenons notre exemple précédent, nous pourrions comparer, en fonction de la région du monde, la moyenne de production annuelle de CO<sub>2</sub> par habitant. Pour cela, il suffit d’utiliser la fonction <code>geom_boxplot</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retirer les observations n'étant pas associées à une région</span></span>
<span><span class="va">data_co2_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_co2</span><span class="op">$</span><span class="va">region7</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2_comp</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">region7</span>, x <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tonnes de CO2 par an et habitant"</span>, y <span class="op">=</span> <span class="st">"Région"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig338" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig338-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.40: Boîtes à moustaches</figcaption></figure>
</div>
</div>
</div>
<p>La barre centrale d’une boîte représente la moyenne. Les extrémités de la boîte représentent le premier et le troisième quartile. Plus une boîte est allongée, plus les situations sont diversifiées pour les observations appartenant au groupe représenté par la boîte. Au contraire, une boîte étroite indique un groupe homogène. Notez qu’en inversant les variables dans les axes <em>X</em> et <em>Y</em>, nous obtiendrions des boîtes à moustaches verticales. Cependant, les noms des régions étant assez longs, cela nécessiterait d’avoir un graphique très large. Améliorons quelque peu le rendu de ce graphique en ajoutant des titres.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2_comp</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">region7</span>, x <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tonnes de CO2 par an et habitant"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Région"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig339" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig339-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.41: Boîtes à moustaches améliorées</figcaption></figure>
</div>
</div>
</div>
<p>Les points noirs sur le graphique représentent des valeurs extrêmes, soit des observations situées à plus de 1,5 intervalle interquartile d’une extrémité de la boîte. Pour mieux rendre compte de la densité d’observations le long de chaque boîte à moustaches, il est possible de les représenter directement avec la fonction <code>geom_jitter</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-fig340" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig340-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.42: Boîtes à moustaches avec observations</figcaption></figure>
</div>
</div>
</div>
<p>Notez que pour éviter que les valeurs extrêmes identifiées par la fonction <code>geom_boxplot</code> se superposent avec les points représentant les observations, nous les avons supprimées avec l’argument <code>outlier.shape = NA</code>.</p>
</section><section id="sec-0326" class="level3" data-number="3.2.6"><h3 data-number="3.2.6" class="anchored" data-anchor-id="sec-0326">
<span class="header-section-number">3.2.6</span> Graphique en violon</h3>
<p>Les boîtes à moustaches donnent des informations pertinentes sur le centre et la dispersion d’une variable en fonction de sous groupes de la population. Cependant, une grande partie de l’information reste masquée par la représentation sous forme de boîte. Une solution est de remplacer la simple boîte par la distribution de la variable étudiée. Nous obtenons ainsi des graphiques en violon (<code>geom_violin</code>). Considérant les très grands écarts que nous avons observés entre les régions avec les boîtes à moustaches, il est préférable de tracer les graphiques en violon en excluant les régions Afrique Sub-Saharienne et Asie du Sud.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retirons les observations de régions que nous ne souhaitons pas garder</span></span>
<span><span class="va">data_co2_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="op">(</span><span class="op">!</span> <span class="va">data_co2</span><span class="op">$</span><span class="va">region7</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> </span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sub-Saharan Africa"</span>, <span class="st">"South Asia"</span><span class="op">)</span><span class="op">)</span> </span>
<span>                        <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_co2</span><span class="op">$</span><span class="va">region7</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2_comp</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">region7</span>, x <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">12</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig341" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig341-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.43: Graphiques en violon</figcaption></figure>
</div>
</div>
</div>
<p>Ces distributions permettent notamment de souligner que deux groupes distincts se retrouvent en Amérique du Nord. L’un dont les émissions annuelles de CO<sub>2</sub> par habitant sont inférieures à 12 tonnes (ligne bleue) et l’autre pour lequel elles sont supérieures. En explorant les données, nous constatons que les Bermudes appartiennent au groupe Amérique du Nord, mais ont des niveaux d’émission inférieurs à ceux du Canada et des États-Unis, ce qui explique cette distribution bimodale. Cette information était masquée avec les boîtes à moustaches. Finalement, il est aussi possible de superposer un graphique en violon et une boîte à moustaches pour bénéficier des avantages des deux.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_co2_comp</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">region7</span>, x <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">region7</span>, x <span class="op">=</span> <span class="va">CO2t_hab</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tonnes de CO2 par année et par habitant"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig342" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig342-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.44: Graphiques en violon et boîtes à moustaches</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0327" class="level3" data-number="3.2.7"><h3 data-number="3.2.7" class="anchored" data-anchor-id="sec-0327">
<span class="header-section-number">3.2.7</span> Graphique en barres</h3>
<p>Les graphiques en barres permettent de représenter des quantités (hauteur des barres) réparties dans des catégories (une barre par catégorie). Nous proposons ici un exemple avec des données de déplacements issues de l’<em>Enquête origine-destination 2017 - Région Québec-Lévis</em>, au niveau des grands secteurs. La <a href="#fig-fig342">figure&nbsp;<span>3.44</span></a>, tirée du <a href="https://www.transports.gouv.qc.ca/fr/ministere/Planification-transports/enquetes-origine-destination/quebec/2017/Documents/EOD17_faits_saillants_VF.pdf">rapport</a> intitulé <em>La mobilité des personnes dans la région de Québec-Lévis (Volet Enquête-ménages&nbsp;: faits saillants)</em> délimite ces grands secteurs.</p>
<div id="fig-fig343" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/carte_secteurs.jpg" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.45: Grands secteurs de Québec</figcaption></figure>
</div>
<p>Nous représentons pour chaque secteur le nombre moyen de déplacements entrant et sortant un jour de semaine en heures de pointe. Les données sont présentées sous forme d’une matrice carrée (avec autant de lignes que de colonnes). L’intersection de la ligne A et de la colonne C indique le nombre de personnes partant du secteur A pour se rendre au secteur C. À l’inverse, l’intersection de la ligne C et de la colonne A indique le nombre de personnes partant du secteur C pour se rendre au secteur A. En sommant les valeurs de chaque ligne, nous obtenons le nombre total de départs par secteur tandis que le nombre d’arrivées est la somme de chaque colonne. Ces opérations peuvent simplement être effectuées avec les fonctions <code>rowSums</code> et <code>colSums</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chargement des données</span></span>
<span><span class="va">matriceOD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'data/graphique/Quebec_2017_OD_MJ.csv'</span>,</span>
<span>                 header <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">';'</span><span class="op">)</span> <span class="co"># fichier csv sans entête</span></span>
<span></span>
<span><span class="co"># Calcul des sommes en lignes et en colonnes</span></span>
<span><span class="va">tot_depart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">matriceOD</span><span class="op">)</span></span>
<span><span class="va">tot_arrivee</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matriceOD</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Création d'un DataFrame avec les valeurs et les noms des secteurs</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>depart <span class="op">=</span> <span class="va">tot_depart</span>,</span>
<span>                 arrivee <span class="op">=</span> <span class="va">tot_arrivee</span>, </span>
<span>                 secteur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Arr. de Beauport (Québec)'</span>,</span>
<span>                            <span class="st">'Arr. de Charlesbourg (Québec)'</span>,</span>
<span>                            <span class="st">'Arr. des Rivières (Québec)'</span>,</span>
<span>                            <span class="st">'Arr. de la Cité-Limoilou (Québec)'</span>,</span>
<span>                            <span class="st">'Arr. de la Haute-Saint-Charles (Québec)'</span>,</span>
<span>                            <span class="st">'Arr. de Sainte-Foy-Sillery-Cap-Rouge (Québec)'</span>,</span>
<span>                            <span class="st">'Arr.de Desjardins (Lévis)'</span>,</span>
<span>                            <span class="st">'Arr. des Chutes–de-la-Chaudière-Est (Lévis)'</span>,</span>
<span>                            <span class="st">'Arr. des Chutes de la Chaudière-Ouest (Lévis)'</span>,</span>
<span>                            <span class="st">'Ceinture Nord'</span>,</span>
<span>                            <span class="st">'Ceinture Sud'</span>,</span>
<span>                            <span class="st">'Hors Territoire'</span><span class="op">)</span>,</span>
<span>                 code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'D'</span>,<span class="st">'E'</span>,<span class="st">'F'</span>,<span class="st">'G'</span>,<span class="st">'H'</span>,<span class="st">'I'</span>,<span class="st">'J'</span>,<span class="st">'K'</span>,<span class="st">'X'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Création des deux graphiques en barre</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">code</span>, weight <span class="op">=</span> <span class="va">depart</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Départs"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"total"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">code</span>, weight <span class="op">=</span> <span class="va">arrivee</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Arrivées"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"total"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Stocker les graphiques dans une liste et composer une figure</span></span>
<span><span class="va">list_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">plot1</span>, <span class="va">plot2</span><span class="op">)</span></span>
<span><span class="va">tot_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">list_plot</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Création d'une légende pour associer le code de chaque secteur </span></span>
<span><span class="co"># à son nom. Pour cela nous concaténons en premier les lettres et les noms.</span></span>
<span><span class="co"># Nous fusionnons ensuite le tout en les séparant par le symbole \n représentant </span></span>
<span><span class="co"># un saut de ligne.</span></span>
<span><span class="va">nom_secteurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">code</span>, <span class="va">df</span><span class="op">$</span><span class="va">secteur</span>, sep<span class="op">=</span> <span class="st">' : '</span><span class="op">)</span></span>
<span><span class="va">string_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">nom_secteurs</span>, collapse <span class="op">=</span> <span class="st">'\n'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">titre</span> <span class="op">&lt;-</span> <span class="st">"Déplacements journaliers moyens en heures de pointe"</span></span>
<span><span class="co"># Production finale de la figure</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html">annotate_figure</a></span><span class="op">(</span><span class="va">tot_plot</span>,</span>
<span>                top <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="va">titre</span>, face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">11</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span>,</span>
<span>                right <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="va">string_names</span>, face <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                  just <span class="op">=</span> <span class="st">"left"</span>, x <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="co"># position du texte</span></span>
<span>                <span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig344" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig344-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.46: Graphiques en barre simples</figcaption></figure>
</div>
</div>
</div>
<p>Plutôt que de représenter les arrivées et les départs dans deux graphiques séparés, il est possible de les empiler dans un même graphique en barres. Nous devons au préalable «&nbsp;faire fondre nos données&nbsp;» avec la fonction <code>melt</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Faire fondre le jeu de données (empiler les colonnes depart et arrivee)</span></span>
<span><span class="va">melted_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">df</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'code'</span><span class="op">)</span>, measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'depart'</span>,<span class="st">'arrivee'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">melted_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'code'</span>,<span class="st">'deplacement'</span>,<span class="st">'effectif'</span><span class="op">)</span></span>
<span><span class="co"># Ajouter les accents dans la colonne déplacement</span></span>
<span><span class="va">melted_df</span><span class="op">$</span><span class="va">deplacement</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">melted_df</span><span class="op">$</span><span class="va">deplacement</span> <span class="op">==</span> <span class="st">'depart'</span>, <span class="st">'départs'</span>, <span class="st">'arrivées'</span><span class="op">)</span></span>
<span><span class="co"># Comparaison du format original et du format "fondu"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   depart arrivee                                       secteur code
V1  49241   34777                     Arr. de Beauport (Québec)    A
V2  48909   36344                 Arr. de Charlesbourg (Québec)    B
V3  48044   67198                    Arr. des Rivières (Québec)    C
V4  63132  108138             Arr. de la Cité-Limoilou (Québec)    D
V5  57367   30859       Arr. de la Haute-Saint-Charles (Québec)    E
V6  86504  112379 Arr. de Sainte-Foy-Sillery-Cap-Rouge (Québec)    F</code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">melted_df</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  code deplacement effectif
1    A     départs    49241
2    B     départs    48909
3    C     départs    48044
4    D     départs    63132
5    E     départs    57367
6    F     départs    86504</code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Réalisation du graphique</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">melted_df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">code</span>, weight <span class="op">=</span> <span class="va">effectif</span>, fill <span class="op">=</span> <span class="va">deplacement</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'#e3e3e3'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e63946"</span> , <span class="st">"#1d3557"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">titre</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Effectifs"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Déplacements"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html">annotate_figure</a></span><span class="op">(</span><span class="va">plot1</span>, right <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="va">string_names</span>, face <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                                  just <span class="op">=</span> <span class="st">"left"</span>, x <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> <span class="co"># position du texte)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig345" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig345-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.47: Graphique en barre empilée</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-0328" class="level3" data-number="3.2.8"><h3 data-number="3.2.8" class="anchored" data-anchor-id="sec-0328">
<span class="header-section-number">3.2.8</span> Graphique circulaire</h3>
<p>Une option directe au graphique en barres est le graphique ou diagramme circulaire, appelé aussi graphique en tarte (pour les personnes à la dent sucrée) ou en camembert (pour celles amatrices de fromage). Il est suffisamment connu et utilisé pour qu’aucune présentation ne s’impose. Pour être exact, un graphique en tarte n’est rien d’autre qu’un graphique en barres dont le système de coordonnées a été modifié. Cela impose cependant de calculer à l’avance la position des étiquettes que nous souhaitons ajouter sur le graphique. Reprenons les données de production mondiale de CO<sub>2</sub> et calculons les productions totales par région géographique en 2015.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extraire les données de 2018 pour lesquelles nous connaissons la région</span></span>
<span><span class="va">data_co2_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="va">data_co2</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2015"</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_co2</span><span class="op">$</span><span class="va">region7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Effectuer la somme du CO2 par région</span></span>
<span><span class="va">co2_2015</span> <span class="op">&lt;-</span> <span class="va">data_co2_2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">region7</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_co2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">CO2_kt</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Attribuer un code à chaque région pour faciliter la lecture</span></span>
<span><span class="va">co2_2015</span><span class="op">$</span><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span> , <span class="st">"B"</span> , <span class="st">"C"</span> , <span class="st">"D"</span> , <span class="st">"E"</span> , <span class="st">"F"</span> , <span class="st">"G"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modifier l'ordre des données, calculer les proportions et la position des labels</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">co2_2015</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">code</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="va">total_co2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">co2_2015</span><span class="op">$</span><span class="va">total_co2</span><span class="op">)</span> <span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ypos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span><span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">prop</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Préparer la légende (pourcentages et vrais noms)</span></span>
<span><span class="va">nom_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">code</span>, <span class="st">" : "</span>, <span class="va">df</span><span class="op">$</span><span class="va">region7</span>, <span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">prop</span>,<span class="fl">1</span><span class="op">)</span>,<span class="st">"%)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">string_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">nom_region</span>, collapse <span class="op">=</span> <span class="st">'\n'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construire le graphique</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="va">code</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, width<span class="op">=</span><span class="fl">1</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, start<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ypos</span>, label <span class="op">=</span> <span class="va">code</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html">scale_fill_grey</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportion du CO2 émis en 2015"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ajouter la légende</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html">annotate_figure</a></span><span class="op">(</span><span class="va">plot1</span>, right <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="va">string_region</span>, face <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">9</span>,</span>
<span>                                  just <span class="op">=</span> <span class="st">"left"</span>, x <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> <span class="co"># position du texte)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig346" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig346-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.48: Graphique en tarte</figcaption></figure>
</div>
</div>
</div>
<p>Si à la place de la géométrie <code>geom_bar</code>, vous utilisez <code>geom_rect</code>, vous pouvez convertir votre graphique en tarte en graphique en anneau (ou en beigne, pour les personnes à la dent sucrée)&nbsp;:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculer la limite inférieure et supérieure du beigne</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">prop</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">ymin</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ymax</span>, n<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construire le graphique</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax <span class="op">=</span> <span class="va">ymax</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, </span>
<span>                        xmax <span class="op">=</span> <span class="fl">4</span>, xmin <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                        y <span class="op">=</span> <span class="va">prop</span>, fill <span class="op">=</span> <span class="va">code</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, start<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3.5</span>, y <span class="op">=</span> <span class="va">ypos</span>, label <span class="op">=</span> <span class="va">code</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html">scale_fill_grey</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportion du CO2 émis en 2015"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ajouter la légende</span></span>
<span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html">annotate_figure</a></span><span class="op">(</span><span class="va">plot1</span>, right <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/text_grob.html">text_grob</a></span><span class="op">(</span><span class="va">string_region</span>, face <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                                  just <span class="op">=</span> <span class="st">"left"</span>, x <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> <span class="co"># position du texte)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig347" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig347-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.49: Graphique en anneau</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-033" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="sec-033">
<span class="header-section-number">3.3</span> Graphiques spéciaux</h2>
<p>Dans cette dernière section, nous abordons des graphiques plus rarement utilisés. Ils sont toutefois très utiles dans certains contextes du fait de leur capacité à synthétiser des informations complexes.</p>
<section id="sec-0331" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-0331">
<span class="header-section-number">3.3.1</span> Graphique en radar</h3>
<p>Les graphiques en radar (ou en toile d’araignée) sont utilisés pour comparer une série de variables continues pour plusieurs observations ou groupes d’observations. Chaque variable est associée à un axe et chaque observation est représentée avec un polygone. Prenons l’exemple de données relatives aux logements par secteur de recensement dans la région métropolitaine de Montréal en 2016. Nous pourrions souhaiter comparer la moyenne des pourcentages des différents types de logements pour les régions des Laurentides, de la Montérégie, de Laval, de Longueuil et de Montréal. Malheureusement, <code>ggplot2</code> ne permet pas de dessiner des graphiques en radar satisfaisants, nous devons donc utiliser le <em>package</em> <code>fmsb</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://minato.sip21c.org/msb/">fmsb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'data/bivariee/sr_rmr_mtl_2016.csv'</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, encoding <span class="op">=</span> <span class="st">'UTF-8'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Agréger les données au niveau des régions en calculant la moyenne des pourcentages</span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MaisonIndi"</span> , <span class="st">"App5Plus"</span> , <span class="st">"MaisRangee"</span> , <span class="st">"AppDuplex"</span> , <span class="st">"Proprio"</span> , <span class="st">"Locataire"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_region</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="va">variables</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span>.funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gérer le nom des colonnes pour ajuster les données aux besoins de </span></span>
<span><span class="co"># la fonction radachart</span></span>
<span><span class="va">new_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Region"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">variables</span>,<span class="st">"_mean"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data_region</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new_names</span></span>
<span><span class="va">data_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">data_region</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">data_region</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">data_region</span><span class="op">$</span><span class="va">Region</span></span>
<span><span class="va">data_region</span><span class="op">$</span><span class="va">Region</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Ajouter deux lignes aux données avec les valeurs maximales et minimales </span></span>
<span><span class="co"># de chaque colonne. Ces informations aideront la fonction radachart à</span></span>
<span><span class="co"># dessiner chacun des axes du radar</span></span>
<span><span class="va">data_chart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data_region</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">max</span><span class="op">)</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data_region</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">min</span><span class="op">)</span>,</span>
<span>                    <span class="va">data_region</span></span>
<span>                    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Choisir les couleurs pour l'intérieur des polygones (avec transparence)</span></span>
<span><span class="va">couleurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.94</span>, <span class="fl">0.28</span>, <span class="fl">0.44</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">0.82</span>, <span class="fl">0.40</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.84</span>, <span class="fl">0.63</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.07</span>, <span class="fl">0.54</span>, <span class="fl">0.70</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.23</span>, <span class="fl">0.30</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Choisir les couleurs pour l'intérieur des polygones (sans transparence)</span></span>
<span><span class="va">couleurs_contour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.94</span>, <span class="fl">0.28</span>, <span class="fl">0.44</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">0.82</span>, <span class="fl">0.40</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.84</span>, <span class="fl">0.63</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.07</span>, <span class="fl">0.54</span>, <span class="fl">0.70</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.23</span>, <span class="fl">0.30</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dessiner du graphique</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/fmsb/man/radarchart.html">radarchart</a></span><span class="op">(</span><span class="va">data_chart</span>,</span>
<span>           title <span class="op">=</span> <span class="st">"Comparaison des types de logements dans la RMR"</span>,</span>
<span>           pcol <span class="op">=</span> <span class="va">couleurs_contour</span>, pfcol <span class="op">=</span> <span class="va">couleurs</span>,</span>
<span>           plwd <span class="op">=</span> <span class="fl">2</span>, plty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>           cglcol <span class="op">=</span> <span class="st">"grey"</span>, cglty <span class="op">=</span> <span class="fl">1</span>, axislabcol<span class="op">=</span><span class="st">"grey"</span>, cglwd<span class="op">=</span><span class="fl">0.8</span>,</span>
<span>           vlcex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>           vlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"maison individuelle"</span>, <span class="st">"immeuble d'appartements"</span>,</span>
<span>                       <span class="st">"maison \nen rangée"</span>, <span class="st">"duplex"</span>,</span>
<span>                       <span class="st">"propriétaire"</span>, <span class="st">"locataire"</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span>
<span></span>
<span><span class="co"># Ajouter une légende</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1.3</span>, y <span class="op">=</span> <span class="fl">1</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">data_chart</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span>, </span>
<span>       pch<span class="op">=</span><span class="fl">20</span> , col<span class="op">=</span><span class="va">couleurs</span> , text.col <span class="op">=</span> <span class="st">"black"</span>, cex <span class="op">=</span> <span class="fl">0.9</span>, pt.cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig348" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig348-1.png" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.50: Graphique en anneau</figcaption></figure>
</div>
</div>
</div>
<p>À la lecture du graphique, nous constatons rapidement que l’île de Montréal a une situation très différente des trois autres régions. Laval se distingue également avec une part importante de logements dans des immeubles d’appartements. Ce type de graphique a pour objectif d’orienter le regard sur de potentielles différences dans un contexte multidimensionnel, mais il présente quelques inconvénients&nbsp;:</p>
<ul>
<li><p>Les échelles de chaque axe sont différentes. Il est donc essentiel de se rapporter aux valeurs exactes pour estimer si les écarts sont importants en termes absolus.</p></li>
<li><p>La superposition de plusieurs polygones peut rendre la lecture difficile. Une solution envisageable est de réaliser un graphique par polygone, mais cela prend beaucoup de place dans un document.</p></li>
<li><p>L’utilisation de polygones donne parfois de fausses impressions d’écarts. Dans le précédent graphique, l’œil est attiré en bas à gauche par le polygone de Montréal qui est très différent des autres. Cependant, les écarts sur l’axe <em>maison en rangée</em> sont relativement petits comparativement à l’axe <em>locataire</em> situé à l’opposé.</p></li>
</ul></section><section id="sec-0332" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="sec-0332">
<span class="header-section-number">3.3.2</span> Diagramme d’accord</h3>
<p>Les diagrammes d’accord (<em>chord diagram</em> en anglais) sont utilisés pour représenter des échanges ou des connexions entre des entités. Il peut s’agir par exemple de marchandises importées / exportées entre pays, des messages envoyés entre personnes via un réseau social, de flux de population, etc. Reprenons nos données de l’<em>Enquête origine-destination 2017 - Région Québec-Lévis</em> pour illustrer le tout. Nous utilisons le <em>package</em> <code>chorddiag</code>, très facile d’utilisation et produisant des graphiques interactifs, pour faciliter grandement la lecture de ce type de graphique. Cependant, ce <em>package</em> ne fait pas partie du répertoire CRAN, nous devons l’installer directement depuis <em>github</em> avec la fonction <code><a href="https://remotes.r-lib.org/reference/install_github.html">devtools::install_github</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">'mattflor/chorddiag'</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mattflor/chorddiag/">chorddiag</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Chargement des données</span></span>
<span><span class="va">matriceOD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'data/graphique/Quebec_2017_OD_MJ.csv'</span>,</span>
<span>                 header <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">';'</span><span class="op">)</span> <span class="co"># fichier csv sans entête</span></span>
<span></span>
<span><span class="co"># Transformation du DataFrame en matrice</span></span>
<span><span class="va">matriceOD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">matriceOD</span><span class="op">)</span></span>
<span><span class="va">codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'D'</span>,<span class="st">'E'</span>,<span class="st">'F'</span>,<span class="st">'G'</span>,<span class="st">'H'</span>,<span class="st">'I'</span>,<span class="st">'J'</span>,<span class="st">'K'</span>,<span class="st">'X'</span><span class="op">)</span></span>
<span><span class="va">secteurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Arr. de Beauport'</span>,</span>
<span>            <span class="st">'Arr. de Charlesbourg'</span>,</span>
<span>            <span class="st">'Arr. des Rivières'</span>,</span>
<span>            <span class="st">'Arr. de la Cité-Limoilou'</span>,</span>
<span>            <span class="st">'Arr. de la Haute-St-Charles'</span>,</span>
<span>            <span class="st">'Arr. de Sainte-Foy-Sillery-Cap-Rouge'</span>,</span>
<span>            <span class="st">'Arr.de Desjardins'</span>,</span>
<span>            <span class="st">'Arr. des Chutes–de-la-Chaudière-Est'</span>,</span>
<span>            <span class="st">'Arr. Les Chutes de la-Chaudière-Ouest'</span>,</span>
<span>            <span class="st">'Ceinture Nord'</span>,</span>
<span>            <span class="st">'Ceinture Sud'</span>,</span>
<span>            <span class="st">'Hors Territoire'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ajout de noms aux colonnes et aux lignes de la matrice</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matriceOD</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">secteurs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">matriceOD</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">secteurs</span></span>
<span></span>
<span><span class="co"># Nous supprimons les trois secteurs Ceinture Nord, Sud et Hors territoire </span></span>
<span><span class="co"># qui comprennent de toute façon peu de déplacements</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">matriceOD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Choix aléatoire de couleurs pour les lignes</span></span>
<span><span class="co"># col &lt;- sample(colors(), nrow(mat), replace = FALSE)</span></span>
<span></span>
<span><span class="co"># Choix de couleurs </span></span>
<span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#a491d3"</span>, <span class="st">"#818aa3"</span>, <span class="st">"#C5DCA0"</span>, <span class="st">"#F5F2B8"</span>,</span>
<span>         <span class="st">"#F9DAD0"</span>, <span class="st">"#F45B69"</span>, <span class="st">"#22181C"</span>, <span class="st">"#5A0001"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Réalisation du graphique : sortie HTLM</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/output_type.html">is_html_output</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chorddiag/man/chorddiag.html">chorddiag</a></span><span class="op">(</span><span class="va">mat</span>, groupColors <span class="op">=</span> <span class="va">col</span>, showTicks <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        type <span class="op">=</span> <span class="st">'bipartite'</span>, chordedgeColor <span class="op">=</span> <span class="st">'white'</span>,</span>
<span>        groupnameFontsize <span class="op">=</span> <span class="fl">12</span>, groupnamePadding <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fig349" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="chorddiag html-widget html-fill-item" id="htmlwidget-879c1f5840631201a81e" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-879c1f5840631201a81e">{"x":{"matrix":[[0,0,0,0,0,0,0,0,21163,3246,4710,12213,455,4864,481,133],[0,0,0,0,0,0,0,0,2645,20763,6293,10805,925,5543,309,126],[0,0,0,0,0,0,0,0,1376,1720,22274,8538,2547,8611,841,330],[0,0,0,0,0,0,0,0,2217,2696,6244,37369,703,11141,813,393],[0,0,0,0,0,0,0,0,1084,2451,10163,7996,22309,8672,774,413],[0,0,0,0,0,0,0,0,1178,1292,8178,15126,1198,52359,2002,1260],[0,0,0,0,0,0,0,0,169,189,978,2041,86,2534,21266,2877],[0,0,0,0,0,0,0,0,270,196,1556,2580,165,4942,5061,13245],[21163,2645,1376,2217,1084,1178,169,270,0,0,0,0,0,0,0,0],[3246,20763,1720,2696,2451,1292,189,196,0,0,0,0,0,0,0,0],[4710,6293,22274,6244,10163,8178,978,1556,0,0,0,0,0,0,0,0],[12213,10805,8538,37369,7996,15126,2041,2580,0,0,0,0,0,0,0,0],[455,925,2547,703,22309,1198,86,165,0,0,0,0,0,0,0,0],[4864,5543,8611,11141,8672,52359,2534,4942,0,0,0,0,0,0,0,0],[481,309,841,813,774,2002,21266,5061,0,0,0,0,0,0,0,0],[133,126,330,393,413,1260,2877,13245,0,0,0,0,0,0,0,0]],"options":{"type":"bipartite","width":null,"height":null,"margin":100,"showGroupnames":true,"groupNames":["Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est","Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est"],"groupColors":["#a491d3","#818aa3","#C5DCA0","#F5F2B8","#F9DAD0","#F45B69","#22181C","#5A0001"],"groupThickness":0.1,"groupPadding":0.03490658503988659,"groupnamePadding":[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],"groupnameFontsize":12,"groupedgeColor":null,"chordedgeColor":"white","categoryNames":null,"categorynamePadding":100,"categorynameFontsize":28,"showTicks":false,"tickInterval":1000,"ticklabelFontsize":10,"fadeLevel":0.1,"showTooltips":true,"showZeroTooltips":true,"tooltipNames":["Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est","Arr. de Beauport","Arr. de Charlesbourg","Arr. des Rivières","Arr. de la Cité-Limoilou","Arr. de la Haute-St-Charles","Arr. de Sainte-Foy-Sillery-Cap-Rouge","Arr.de Desjardins","Arr. des Chutes–de-la-Chaudière-Est"],"tooltipFontsize":12,"tooltipUnit":"","tooltipGroupConnector":" &#x25B6; ","precision":"null","clickAction":null,"clickGroupAction":null}},"evals":[],"jsHooks":[]}</script><figcaption class="figure-caption">Figure&nbsp;3.51: Diagramme d’accord</figcaption></figure>
</div>
</div>
<p>Le graphique permet de remarquer que la plupart des flux s’effectuent au sein d’un même secteur. La majorité des déplacements se font au sein du secteur Sainte-Foy (segment rouge central). Nous pouvons cependant constater que les secteurs des Rivières, de la Cité-Limoilou et de la Haute-Saint-Charles attirent une plus grande quantité et diversité de flux. Si vous lisez ce livre dans un navigateur web (et pas au format <em>pdf</em>), le graphique est interactif! En plaçant votre souris sur un lien, vous verrez s’afficher le nombre de déplacements qu’il représente.</p>
</section><section id="sec-0333" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="sec-0333">
<span class="header-section-number">3.3.3</span> Nuage de mots</h3>
<p>Un nuage de mots est un graphique utilisé en analyse de texte pour représenter les mots les plus importants d’un document. Mesurer l’importance des termes dans un document est une discipline à part entière (<em>Natural Language Processing</em>). Nous proposons un simple exemple ici avec la méthode <em>TextRank</em> (basée sur la théorie des graphes) proposée par <span class="citation" data-cites="mihalcea2004textrank">Mihalcea et Tarau (<a href="references.html#ref-mihalcea2004textrank" role="doc-biblioref">2004</a>)</span> et implémentée dans le <em>package</em> <code>textrank</code>. Nous avons également besoin des <em>packages</em> <code>udpipe</code> (fournissant des dictionnaires linguistiques), <code>RColorBrewer</code> (pour sélectionner une palette de couleurs) et <code>wordcloud2</code> (pour générer le graphique). En guise d’exemple, nous avons choisi d’extraire les textes de deux schémas d’aménagement et de développement (SAD), ceux des agglomérations de Québec et de Montréal en vigueur en 2020. Il s’agit de deux documents de planification définissant les lignes directrices de l’organisation physique du territoire des municipalités régionales de comté (MRC) ou des agglomérations. Pour ces deux documents, nous nous concentrons sur le chapitre portant sur les grandes orientations d’aménagement et de développement, soit les pages 30 à 135 pour Québec et 30 à 97 pour Montréal. Pour extraire les textes des fichiers <em>pdf</em>, nous utilisons le <em>package</em> <code>pdftools</code>.</p>
<p>Nous devons donc réaliser les étapes suivantes pour produire le nuage de mots&nbsp;:</p>
<ol type="1">
<li>Extraire les sections qui nous intéressent des fichiers <em>pdf</em>.</li>
<li>Extraire le texte de ces sections.</li>
<li>Retirer les caractères représentant les sauts de lignes et les sauts de paragraphes (<code>\n</code> et <code>\r</code>).</li>
<li>Concaténer tout le texte en une seule longue chaîne de caractère.</li>
<li>Utiliser un dictionnaire pour déterminer la nature des mots du texte (nom, adjectif, verbe, etc.).</li>
<li>Utiliser l’algorithme <em>TextRank</em> pour identifier les mots clefs.</li>
<li>Nettoyer les erreurs potentielles parmi les mots clefs.</li>
<li>Construire le nuage de mots.</li>
</ol>
<p>Notez que toutes ces étapes de nettoyage ne seraient pas nécessaires si nous utilisions un simple fichier texte comme point de départ. Cependant, comme il est plus courant de rencontrer des fichiers <em>pdf</em>, cet exercice est donc davantage révélateur de la difficulté réelle de la réalisation d’un nuage de mots.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lchiffon/wordcloud2">wordcloud2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bnosac.github.io/udpipe/en/index.html">udpipe</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/pdftools/">pdftools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bnosac/textrank">textrank</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 1 : extraire les sections pertinentes des fichiers pdf</span></span>
<span><span class="va">extrait_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/qpdf/reference/qpdf.html">pdf_subset</a></span><span class="op">(</span><span class="st">"data/graphique/SAD_quebec.pdf"</span>, pages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span><span class="op">:</span><span class="fl">135</span><span class="op">)</span>,</span>
<span>                         output <span class="op">=</span> <span class="st">"data/graphique/SAD_quebec_ext.pdf"</span><span class="op">)</span></span>
<span><span class="va">extrait_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/qpdf/reference/qpdf.html">pdf_subset</a></span><span class="op">(</span><span class="st">"data/graphique/SAD_montreal.pdf"</span>, pages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span><span class="op">:</span><span class="fl">97</span><span class="op">)</span>,</span>
<span>                          output <span class="op">=</span> <span class="st">"data/graphique/SAD_montral_ext.pdf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 2 : extraire le texte des fichiers pdf sous forme de vecteur de texte</span></span>
<span><span class="va">file_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/pdftools/reference/pdftools.html">pdf_text</a></span><span class="op">(</span><span class="va">extrait_qc</span><span class="op">)</span></span>
<span><span class="va">file_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/pdftools/reference/pdftools.html">pdf_text</a></span><span class="op">(</span><span class="va">extrait_mtl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 3 : retirer les sauts de lignes et les paragraphes</span></span>
<span><span class="va">file_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\r"</span> , <span class="st">""</span>, x <span class="op">=</span> <span class="va">file_qc</span><span class="op">)</span></span>
<span><span class="va">file_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\n"</span> , <span class="st">""</span>, x <span class="op">=</span> <span class="va">file_qc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">file_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\r"</span> , <span class="st">""</span>, x <span class="op">=</span> <span class="va">file_mtl</span><span class="op">)</span></span>
<span><span class="va">file_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\n"</span> , <span class="st">""</span>, x <span class="op">=</span> <span class="va">file_mtl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 4 : créer une seule longue chaîne de caractères</span></span>
<span><span class="co"># à partir des vecteurs de texte</span></span>
<span><span class="va">text_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">file_qc</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="va">text_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">file_mtl</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># charger le modèle linguistique français</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/udpipe/man/udpipe_load_model.html">udpipe_load_model</a></span><span class="op">(</span><span class="st">'data/graphique/french-sequoia-ud-2.4-190531.udpipe'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pour télécharger le modèle si ce n'est pas encore fait : </span></span>
<span><span class="co"># model &lt;- udpipe_download_model("french-sequoia")</span></span>
<span><span class="co"># model &lt;- udpipe_load_model(model)</span></span>
<span></span>
<span><span class="co"># Étape 5 : analyse de la nature des mots du texte avec le dictionnaire fr</span></span>
<span><span class="co"># Nous obtenons des DataFrames décrivant les mots des textes</span></span>
<span><span class="va">annote_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/udpipe/man/udpipe_annotate.html">udpipe_annotate</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">text_qc</span><span class="op">)</span></span>
<span><span class="va">df_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">annote_qc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annote_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/udpipe/man/udpipe_annotate.html">udpipe_annotate</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">text_mtl</span><span class="op">)</span></span>
<span><span class="va">df_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">annote_mtl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 6 : utilisation de la méthode TextRank</span></span>
<span><span class="va">stats_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/textrank/man/textrank_keywords.html">textrank_keywords</a></span><span class="op">(</span><span class="va">df_qc</span><span class="op">$</span><span class="va">lemma</span>,</span>
<span>                  relevant <span class="op">=</span> <span class="va">df_qc</span><span class="op">$</span><span class="va">upos</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOUN"</span>, <span class="st">"ADJ"</span><span class="op">)</span>, ngram_max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/textrank/man/textrank_keywords.html">textrank_keywords</a></span><span class="op">(</span><span class="va">df_mtl</span><span class="op">$</span><span class="va">lemma</span>,</span>
<span>                  relevant <span class="op">=</span> <span class="va">df_mtl</span><span class="op">$</span><span class="va">upos</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NOUN"</span> , <span class="st">"ADJ"</span><span class="op">)</span>, ngram_max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 7 : nettoyer les coquilles dans les mots clefs </span></span>
<span><span class="co"># Note : nous faisons ici le choix de garder des mots clefs uniques (ngram == 1)</span></span>
<span><span class="co"># Il serait aussi possible de garder des associations de plusieurs mots</span></span>
<span><span class="va">dfstats_qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">stats_qc</span><span class="op">$</span><span class="va">keywords</span>, <span class="va">stats_qc</span><span class="op">$</span><span class="va">keywords</span><span class="op">$</span><span class="va">ngram</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">stats_qc</span><span class="op">$</span><span class="va">keywords</span><span class="op">$</span><span class="va">keyword</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dfstats_qc</span><span class="op">$</span><span class="va">keyword</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"d’"</span> , <span class="st">""</span>, <span class="va">dfstats_qc</span><span class="op">$</span><span class="va">keyword</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dfstats_qc</span><span class="op">$</span><span class="va">keyword</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"l’"</span> , <span class="st">""</span>, <span class="va">dfstats_qc</span><span class="op">$</span><span class="va">keyword</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dfstats_mtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">stats_mtl</span><span class="op">$</span><span class="va">keywords</span>, <span class="va">stats_mtl</span><span class="op">$</span><span class="va">keywords</span><span class="op">$</span><span class="va">ngram</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">stats_mtl</span><span class="op">$</span><span class="va">keywords</span><span class="op">$</span><span class="va">keyword</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dfstats_mtl</span><span class="op">$</span><span class="va">keyword</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"d’"</span> , <span class="st">""</span>, <span class="va">dfstats_mtl</span><span class="op">$</span><span class="va">keyword</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dfstats_mtl</span><span class="op">$</span><span class="va">keyword</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"l’"</span> , <span class="st">""</span>, <span class="va">dfstats_mtl</span><span class="op">$</span><span class="va">keyword</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Étape 8 : réaliser les nuages de mots</span></span>
<span><span class="va">couleurs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">12</span>, <span class="st">"Paired"</span><span class="op">)</span><span class="op">)</span> <span class="co"># mise en désordre des couleurs</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud2/man/wordcloud2.html">wordcloud2</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfstats_mtl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"keyword"</span>, <span class="st">"freq"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>           color <span class="op">=</span> <span class="va">couleurs</span>, size <span class="op">=</span> <span class="fl">0.5</span>, shuffle <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud2/man/wordcloud2.html">wordcloud2</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfstats_qc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"keyword"</span>, <span class="st">"freq"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>           color <span class="op">=</span> <span class="va">couleurs</span>, size <span class="op">=</span> <span class="fl">0.6</span>, shuffle <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-fig350" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/nuage_mtl.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.52: Nuage de mots pour le SAD de Montréal</figcaption></figure>
</div>
<div id="fig-fig351" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/nuage_qc.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.53: Nuage de mots pour le SAD de Québec</figcaption></figure>
</div>
<p>Notez qu’à chaque génération du nuage de mots, vous obtiendrez une disposition différente. N’hésitez pas à en essayer plusieurs jusqu’à ce que vous trouviez celle qui vous semble optimale.</p>
</section><section id="sec-0334" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="sec-0334">
<span class="header-section-number">3.3.4</span> Carte proportionnelle</h3>
<p>Une carte proportionnelle ou carte à cases (<em>treemap</em> en anglais) est un graphique permettant de représenter une quantité partagée entre plusieurs observations structurées dans une hiérarchie de groupe. Le jeu de données portant sur les émissions de CO<sub>2</sub> se prête tout à fait à une représentation par <em>treemap</em>. La variable de quantité est bien sûr les émissions de CO<sub>2</sub> par pays; ces pays sont regroupés dans un premier ensemble de régions (découpage en 23 régions), qui elles-mêmes sont regroupées dans des régions plus larges (découpage en sept régions). Pour construire un <em>treemap</em>, nous allons utilisons le <em>package</em> <code>treemap</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">treemap</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extraire les données de CO2 en 2015</span></span>
<span><span class="va">data_co2_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data_co2</span>, <span class="va">data_co2</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2015"</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">data_co2</span><span class="op">$</span><span class="va">region7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># construire le treemap</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/treemap/man/treemap.html">treemap</a></span><span class="op">(</span><span class="va">data_co2_2015</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"region7"</span> , <span class="st">"region23"</span><span class="op">)</span>,</span>
<span>    vSize <span class="op">=</span> <span class="st">"CO2_kt"</span>, type <span class="op">=</span> <span class="st">"index"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"CO2 rejetés par pays en 2015"</span>,</span>
<span>    fontsize.labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">8</span><span class="op">)</span>, <span class="co"># taille des étiquettes              </span></span>
<span>    fontcolor.labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span> , <span class="st">"black"</span><span class="op">)</span>, <span class="co"># couleur des étiquettes</span></span>
<span>    fontface.labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, <span class="co"># style des polices</span></span>
<span>    bg.labels <span class="op">=</span> <span class="fl">0</span>, <span class="co"># arrière-plan des étiquettes</span></span>
<span>    align.labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"center"</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,  <span class="co"># localisation des étiquettes dans les boîtes</span></span>
<span>    overlap.labels<span class="op">=</span><span class="fl">0.5</span>, <span class="co"># tolérance de superposition</span></span>
<span>    inflate.labels <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># agrandir la taille des étiquettes ou non</span></span>
<span>    palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>,<span class="st">'Paired'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig352" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig352-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.54: Treemap</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="sec-034" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="sec-034">
<span class="header-section-number">3.4</span> Cartes</h2>
<p>Toute comme un graphique, une carte est aussi une illustration visuelle. Avec la généralisation des données géographiques, il peut être utile de savoir représenter ce type de données. Si R n’est pas un logiciel de cartographie, il est possible de réaliser des cartes assez facilement, directement avec <code>ggplot2</code>. Nous avons cependant une préférence pour le <em>package</em> <code>tmap</code>, qui propose de nombreuses fonctionnalités. Pour tracer des cartes, <code>tmap</code> et <code>ggplot2</code> ont besoin d’utiliser un format de données comprenant la géométrie (polygones, lignes ou points), la localisation et le système de projection des entités spatiales étudiées. Le format de fichier le plus courant pour ce type de données est le <em>shapefile</em> (<em>.shp</em>), mais vous pourrez parfois croiser des fichiers <em>geojson</em> (<em>.js</em>), ou encore <em>geopackages</em> (<em>.gpkg</em>). Pour lire ces fichiers, il est possible d’utiliser la fonction <code>readOGR</code> du <em>package</em> <code>rgdal</code>, ou la fonction <code>st_read</code> du <em>package</em> <code>sf</code>. Notez ici que ces deux fonctions ne produisent pas de <em>DataFrame</em>, mais respectivement un <em>SpatialDataFrame</em> et un objet <code>sf</code> (<em>spatial feature collection</em>). Sans entrer dans les détails, sachez que deux <em>packages</em> permettent de manipuler des objets spatiaux dans R&nbsp;: le traditionnel <code>sp</code> (avec les <em>SpatialDataFrames</em>) et le plus récent <code>sf</code> (avec les <em>spatial feature collections</em>). Il est assez facile de convertir un objet de <code>sp</code> vers <code>sf</code> (et inversement) et cette opération est souvent nécessaire, car de nombreux <em>packages</em> dédiés à l’analyse spatiale utilisent l’un ou l’autre des formats. Dans le cas de <code>tmap</code>, des objets <code>sp</code> et <code>sf</code> peuvent être utilisés sans distinction. En revanche, pour cartographier directement avec <code>ggplot2</code>, il est plus facile d’utiliser un objet de type <code>sf</code>. Toutefois, nous vous recommandons fortement d’utiliser le <em>package</em> <code>sf</code>, puisque <code>sp</code> (et son format <em>SpatialDataFrame</em>) est progressivement délaissé dans R.</p>
<p>Une carte thématique permet de représenter la répartition spatiale de variables qualitatives ou quantitatives. Nous la distinguons des cartes topographiques, dont l’objectif est de représenter la localisation d’objets spécifiques (route, habitation, rivière, lac, etc.). La première est relativement facile à construire dans R, car elle se limite à quelques symboles relativement simples. Pour la seconde, nous préférons généralement utiliser un logiciel comme <a href="https://qgis.org/en/site/" target="_blank">QGIS</a>.</p>
<p>Créons une carte thématique à partir des données de densité de végétation sur l’île de Montréal avec les <em>packages</em> <code>ggplot2</code> puis <code>tmap</code>.</p>
<p>Avec <code>ggplot2</code>, nous avons aussi besoin des <em>packages</em> <code>classInt</code> pour calculer les intervalles des classes et <code>ggsn</code> pour afficher une échelle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/classInt/">classInt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/">ggspatial</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Chargement des données</span></span>
<span><span class="va">spatialdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/bivariee/IlotsVeg2006.shp"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `IlotsVeg2006' from data source 
  `C:\Users\appariciop\OneDrive - USherbrooke\Articles Publies ne pas supprimer\_Livres\BolR_MethodesQuantitatives\data\bivariee\IlotsVeg2006.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 10213 features and 12 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 267518.7 ymin: 5029292 xmax: 306663.7 ymax: 5062652
Projected CRS: NAD83 / MTM zone 8</code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Création d'une discrétisation en 7 classes égales</span></span>
<span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">spatialdf</span><span class="op">$</span><span class="va">ArbPct</span><span class="op">)</span><span class="op">+</span><span class="fl">0.01</span>, <span class="va">spatialdf</span><span class="op">$</span><span class="va">ArbPct</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/classInt/reference/classIntervals.html">classIntervals</a></span><span class="op">(</span><span class="va">values</span>, n <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                        style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>                        intervalClosure <span class="op">=</span> <span class="st">'right'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatialdf</span><span class="op">$</span><span class="va">class_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">spatialdf</span><span class="op">$</span><span class="va">ArbPct</span>, breaks <span class="op">=</span> <span class="va">quant</span><span class="op">$</span><span class="va">brks</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cartographie avec ggplot2</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spatialdf</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">class_col</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Greens"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Végétation dans les îlos de recensement"</span>,</span>
<span>       <span class="st">'fill'</span> <span class="op">=</span> <span class="st">'Densité de la canopée (%)'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.border<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, panel.grid.major<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig353" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig353-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.55: Carte thématique avec ggplot2</figcaption></figure>
</div>
</div>
</div>
<p>Il est possible d’arriver à un résultat similaire avec <code>tmap</code> avec moins de code!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>,<span class="st">"Greens"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">spatialdf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"ArbPct"</span>, palette <span class="op">=</span> <span class="va">colors</span>, border.alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            n <span class="op">=</span> <span class="fl">7</span>, style <span class="op">=</span> <span class="st">'quantile'</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Densité de la canopée (%)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Végétation dans les îlos de recensement"</span>,</span>
<span>            attr.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig354" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig354-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.56: Carte thématique avec tmap</figcaption></figure>
</div>
</div>
</div>
<p>Les graphiques créés par <code>tmap</code> ne peuvent malheureusement pas être combinés avec la fonction <code>ggarrange</code>, mais <code>tmap</code> dispose de sa propre fonction <code>tmap_arrange</code> si vous souhaitez combiner plusieurs cartes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/">tmap</a></span><span class="op">)</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>,<span class="st">"Greens"</span><span class="op">)</span></span>
<span><span class="va">colors2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">7</span>,<span class="st">"Reds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">carte1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">spatialdf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"ArbPct"</span>, palette <span class="op">=</span> <span class="va">colors</span>, border.alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            n <span class="op">=</span> <span class="fl">7</span>, </span>
<span>            style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Densité de la canopée (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>attr.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">carte2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">spatialdf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_polygons</a></span><span class="op">(</span><span class="st">"LogDens"</span>, palette <span class="op">=</span> <span class="va">colors2</span>, border.alpha <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            n <span class="op">=</span> <span class="fl">7</span>, </span>
<span>            style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Densité de logement"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_bar.html">tm_scale_bar</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html">tm_layout</a></span><span class="op">(</span>attr.outside <span class="op">=</span> <span class="cn">TRUE</span>, frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">carte1</span>, <span class="va">carte2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig355" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="03-magiedesgraphiques_files/figure-html/fig-fig355-1.png" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.57: Combiner des cartes avec tmap</figcaption></figure>
</div>
</div>
</div>
<div class="bloc_aller_loin">
<div class="bloc_aller_loin-header">
<div class="bloc_aller_loin-icon">

</div>
<p><strong>Construction de cartes : aller plus loin avec <code>tmap</code>…</strong></p>
</div>
<div class="bloc_aller_loin-body">
<p>Pour explorer les multitudes possibilités du <em>package</em> <code>tmap</code>, nous vous recommandons les ressources suivantes&nbsp;:</p>
<ul>
<li><p><a href="https://serieboldr.github.io/MethodesAnalyseSpatiale/01-ManipulationDonneesSpatiales.html#sec-016">La section intitulée <em>Cartographie avec R</em></a> du manuel <a href="https://serieboldr.github.io/MethodesAnalyseSpatiale/"><em>Méthodes d’analyse spatiale : un grand bol d’R</em></a>.</p></li>
<li><p>L’excellente vignette intitulée <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html"><em><code>tmap</code>: get started!</em></a></p></li>
<li><p><a href="http://www.wvview.org/os_sa/10_Maps_with_tmap.html#visualizing-spatial-data-in-r-with-tmap"><em>Visualizing Spatial Data in R with tmap</em></a>.</p></li>
<li><p><a href="https://bookdown.org/nicohahn/making_maps_with_r5/docs/introduction.html"><em>Making Maps with R</em></a>.</p></li>
<li><p>Le chapitre <a href="https://geocompr.robinlovelace.net/adv-map.html"><em>Making maps with R</em></a> du livre <a href="https://geocompr.robinlovelace.net/index.html"><em>Geocomputation with R</em></a>.</p></li>
</ul>
</div>
</div>
</section><section id="sec-035" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="sec-035">
<span class="header-section-number">3.5</span> Exportation des graphiques</h2>
<p>Tous les graphiques que nous avons construits dans ce chapitre peuvent être exportés assez facilement. Dans RStudio, vous pouvez directement cliquer sur le bouton <em>Export</em> (<a href="#fig-fig356">figure&nbsp;<span>3.58</span></a>) pour enregistrer votre figure au format image ou au format <em>pdf</em> (vectoriel). Notez qu’avec la seconde option, vous pourrez retoucher votre graphique avec un logiciel externe comme <em>Inkscape</em> ou <em>Illustrator</em>.</p>
<div id="fig-fig356" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Chap03/export.jpg" class="img-fluid figure-img" style="width:40.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;3.58: Exporter un graphique dans RStudio</figcaption></figure>
</div>
<p>Lorsque vous créez un graphique avec <code>ggplot2</code>, il est aussi possible de l’exporter avec la fonction <code>ggsave</code>. Cette fonctionnalité est très pratique lorsque vous souhaitez automatiser la production de graphiques et ne pas avoir à tous les exporter à la main.</p>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">'graphique.pdf'</span>,</span>
<span>       path <span class="op">=</span> <span class="st">'mon/dossier'</span>,</span>
<span>       plot <span class="op">=</span> <span class="va">plot1</span>,</span>
<span>       width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">10</span>, units <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour les graphiques n’étant pas réalisés avec <code>ggplot2</code>, la solution de remplacement à la fonction <code>ggsave</code> est l’ensemble de fonctions <code>png</code>, <code>bmp</code>, <code>jpeg</code>, <code>tiff</code> et <code>pdf</code>, qui permettent d’exporter n’importe quel graphique dans ces différents formats. Le processus comprend trois étapes&nbsp;:</p>
<ol type="1">
<li><p>Ouvrir une connexion vers le fichier dans lequel le graphique sera exporté avec une des fonctions <code>png</code>, <code>bmp</code>, <code>jpeg</code>, <code>tiff</code> et <code>pdf</code>.</p></li>
<li><p>Réaliser son graphique comme si nous souhaitions l’afficher dans RSudio. Il n’apparaîtra cependant pas, car il sera écrit dans le fichier en question à la place.</p></li>
<li><p>Fermer la connexion au fichier avec la fonction <code>dev.off</code> pour définitivement enregistrer le graphique.</p></li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Ouvrir la connexion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">'mon/dossier/graphique.png'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Afficher le graphique</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. fermer la connexion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-036" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="sec-036">
<span class="header-section-number">3.6</span> Conclusion sur les graphiques</h2>
<p>Vous avez pu constater que les capacités de représentation graphique de R sont vastes et pourtant nous n’avons qu’observé la partie émergée de l’iceberg dans ce chapitre. Il est également possible de réaliser une visualisation en 3D dans R (<code>plot3D</code>, <code>rgl</code>), d’animer des graphiques pour en faire des <em>GIF</em> ou des vidéos (<code>gganimate</code>), de rendre des graphiques interactifs, ou même de construire des plateformes de visualisation de données disponibles en ligne (<code>shiny</code>). Vous continuerez à découvrir de nouvelles formes de représentations au fur et à mesure de votre pratique, en apprenant de nouvelles méthodes nécessitant des visualisations spécifiques.</p>
<p>Voici également deux références très utiles qui nous ont notamment aidé à construire ce chapitre&nbsp;:</p>
<ul>
<li>
<a href="https://www.r-graph-gallery.com/" target="_blank">The R Graph Gallery</a>, probablement <strong>LE</strong> site web proposant le plus de matériel sur la réalisation des graphiques dans R.</li>
<li>
<a href="https://www.data-to-viz.com/" target="_blank">Data to viz</a>, si vous ne savez pas quel graphique pourrait le mieux correspondre à vos données, Data to viz est là pour vous aider. Vous y trouverez un arbre de décision pour vous indiquer quel graphique utiliser dans quelle situation, ainsi que de nombreux conseils sur la visualisation de données.</li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-mihalcea2004textrank" class="csl-entry" role="listitem">
Mihalcea, Rada et Paul Tarau. 2004. <span>«&nbsp;Textrank: Bringing order into text.&nbsp;»</span> In <em>Proceedings of the 2004 conference on empirical methods in natural language processing</em>, 404‑411. s.n.
</div>
<div id="ref-wickham2010layered" class="csl-entry" role="listitem">
Wickham, Hadley. 2010. <span>«&nbsp;A layered grammar of graphics.&nbsp;»</span> <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3‑28. <a href="http://dx.doi.org/10.1198/jcgs.2009.07098">http://dx.doi.org/10.1198/jcgs.2009.07098</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-univarie.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistiques descriptives univariées</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-bivarieeQuantiQuanti.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Relation linéaire entre deux variables quantitatives</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Méthodes quantitatives en sciences sociales : un grand bol d’R.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Ce livre a été réalisé avec <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>